/*! For license information please see grumpycat.bundle.js.LICENSE.txt */
(()=>{var t={956:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(81),n=i.n(s),r=i(645),o=i.n(r)()(n());o.push([t.id,"body {\n\n    background-color: black;\n    color: white;\n\n    /* Allow mouse dragging. */\n    -moz-user-select: none;\n    -ms-user-select: none;\n    -o-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n\n    /* disable touch panning/zooming */\n    -ms-touch-action: none;\n    touch-action: none;\n\n    /* Allow canvas to hit the edges of the browser viewport. */\n    margin: 0;\n}\n\n#screen canvas {\n    margin: auto;\n    /* Hide the gap for font descenders. */\n    display: block;\n}\n\n#screen {\n    position: relative;\n}\n\n#screen input {\n    position: absolute;\n    z-index: 2;\n}\n\n/* The Modal (background) */\n.modal {\n    display: none;\n    /* Hidden by default */\n    position: fixed;\n    /* Stay in place */\n    z-index: 1;\n    /* Sit on top */\n    padding-top: 100px;\n    /* Location of the box */\n    left: 0;\n    top: 0;\n    width: 100%;\n    /* Full width */\n    height: 100%;\n    /* Full height */\n    overflow: auto;\n    /* Enable scroll if needed */\n    background-color: rgb(0, 0, 0);\n    /* Fallback color */\n    background-color: rgba(0, 0, 0, 0.4);\n    /* Black w/ opacity */\n}\n\n/* Modal Content */\n.modal-content {\n    position: relative;\n    background-color: #fefefe;\n    margin: auto;\n    padding: 0;\n    border: 1px solid #888;\n    width: 80%;\n    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);\n    -webkit-animation-name: animatetop;\n    -webkit-animation-duration: 0.4s;\n    animation-name: animatetop;\n    animation-duration: 0.4s\n}\n\n/* Add Animation */\n@-webkit-keyframes animatetop {\n    from {\n        top: -300px;\n        opacity: 0\n    }\n\n    to {\n        top: 0;\n        opacity: 1\n    }\n}\n\n@keyframes animatetop {\n    from {\n        top: -300px;\n        opacity: 0\n    }\n\n    to {\n        top: 0;\n        opacity: 1\n    }\n}\n\n/* The Close Button */\n.close {\n    color: white;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n}\n\n.close:hover,\n.close:focus {\n    color: #000;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n.modal-header {\n    padding: 2px 16px;\n    background-color: #5cb85c;\n    color: white;\n}\n\n.modal-body {\n    padding: 2px 16px;\n}\n\n.modal-footer {\n    padding: 2px 16px;\n    background-color: #5cb85c;\n    color: white;\n}",""]);const a=o},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);s&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),e.push(d))}},e}},81:t=>{"use strict";t.exports=function(t){return t[1]}},755:function(t,e){var i;!function(e,i){"use strict";"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(e)}("undefined"!=typeof window?window:this,(function(s,n){"use strict";var r=[],o=Object.getPrototypeOf,a=r.slice,h=r.flat?function(t){return r.flat.call(t)}:function(t){return r.concat.apply([],t)},l=r.push,d=r.indexOf,c={},u=c.toString,p=c.hasOwnProperty,f=p.toString,g=f.call(Object),m={},y=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},v=function(t){return null!=t&&t===t.window},x=s.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function w(t,e,i){var s,n,r=(i=i||x).createElement("script");if(r.text=t,e)for(s in b)(n=e[s]||e.getAttribute&&e.getAttribute(s))&&r.setAttribute(s,n);i.head.appendChild(r).parentNode.removeChild(r)}function _(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?c[u.call(t)]||"object":typeof t}var E="3.6.1",C=function(t,e){return new C.fn.init(t,e)};function T(t){var e=!!t&&"length"in t&&t.length,i=_(t);return!y(t)&&!v(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}C.fn=C.prototype={jquery:E,constructor:C,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=C.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return C.each(this,t)},map:function(t){return this.pushStack(C.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(C.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(C.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:r.sort,splice:r.splice},C.extend=C.fn.extend=function(){var t,e,i,s,n,r,o=arguments[0]||{},a=1,h=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[a]||{},a++),"object"==typeof o||y(o)||(o={}),a===h&&(o=this,a--);a<h;a++)if(null!=(t=arguments[a]))for(e in t)s=t[e],"__proto__"!==e&&o!==s&&(l&&s&&(C.isPlainObject(s)||(n=Array.isArray(s)))?(i=o[e],r=n&&!Array.isArray(i)?[]:n||C.isPlainObject(i)?i:{},n=!1,o[e]=C.extend(l,r,s)):void 0!==s&&(o[e]=s));return o},C.extend({expando:"jQuery"+(E+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==u.call(t)||(e=o(t))&&("function"!=typeof(i=p.call(e,"constructor")&&e.constructor)||f.call(i)!==g))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){w(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,s=0;if(T(t))for(i=t.length;s<i&&!1!==e.call(t[s],s,t[s]);s++);else for(s in t)if(!1===e.call(t[s],s,t[s]))break;return t},makeArray:function(t,e){var i=e||[];return null!=t&&(T(Object(t))?C.merge(i,"string"==typeof t?[t]:t):l.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:d.call(e,t,i)},merge:function(t,e){for(var i=+e.length,s=0,n=t.length;s<i;s++)t[n++]=e[s];return t.length=n,t},grep:function(t,e,i){for(var s=[],n=0,r=t.length,o=!i;n<r;n++)!e(t[n],n)!==o&&s.push(t[n]);return s},map:function(t,e,i){var s,n,r=0,o=[];if(T(t))for(s=t.length;r<s;r++)null!=(n=e(t[r],r,i))&&o.push(n);else for(r in t)null!=(n=e(t[r],r,i))&&o.push(n);return h(o)},guid:1,support:m}),"function"==typeof Symbol&&(C.fn[Symbol.iterator]=r[Symbol.iterator]),C.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){c["[object "+e+"]"]=e.toLowerCase()}));var A=function(t){var e,i,s,n,r,o,a,h,l,d,c,u,p,f,g,m,y,v,x,b="sizzle"+1*new Date,w=t.document,_=0,E=0,C=ht(),T=ht(),A=ht(),S=ht(),P=function(t,e){return t===e&&(c=!0),0},M={}.hasOwnProperty,O=[],L=O.pop,k=O.push,I=O.push,R=O.slice,B=function(t,e){for(var i=0,s=t.length;i<s;i++)if(t[i]===e)return i;return-1},D="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",N="[\\x20\\t\\r\\n\\f]",F="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",G="\\[[\\x20\\t\\r\\n\\f]*("+F+")(?:"+N+"*([*^$|!~]?=)"+N+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+N+"*\\]",U=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+G+")*)|.*)\\)|)",j=new RegExp(N+"+","g"),z=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),H=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),Y=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),V=new RegExp(N+"|>"),W=new RegExp(U),K=new RegExp("^"+F+"$"),q={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+G),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+D+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},X=/HTML$/i,J=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),it=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},st=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,nt=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},rt=function(){u()},ot=bt((function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{I.apply(O=R.call(w.childNodes),w.childNodes),O[w.childNodes.length].nodeType}catch(t){I={apply:O.length?function(t,e){k.apply(t,R.call(e))}:function(t,e){for(var i=t.length,s=0;t[i++]=e[s++];);t.length=i-1}}}function at(t,e,s,n){var r,a,l,d,c,f,y,v=e&&e.ownerDocument,w=e?e.nodeType:9;if(s=s||[],"string"!=typeof t||!t||1!==w&&9!==w&&11!==w)return s;if(!n&&(u(e),e=e||p,g)){if(11!==w&&(c=$.exec(t)))if(r=c[1]){if(9===w){if(!(l=e.getElementById(r)))return s;if(l.id===r)return s.push(l),s}else if(v&&(l=v.getElementById(r))&&x(e,l)&&l.id===r)return s.push(l),s}else{if(c[2])return I.apply(s,e.getElementsByTagName(t)),s;if((r=c[3])&&i.getElementsByClassName&&e.getElementsByClassName)return I.apply(s,e.getElementsByClassName(r)),s}if(i.qsa&&!S[t+" "]&&(!m||!m.test(t))&&(1!==w||"object"!==e.nodeName.toLowerCase())){if(y=t,v=e,1===w&&(V.test(t)||Y.test(t))){for((v=tt.test(t)&&yt(e.parentNode)||e)===e&&i.scope||((d=e.getAttribute("id"))?d=d.replace(st,nt):e.setAttribute("id",d=b)),a=(f=o(t)).length;a--;)f[a]=(d?"#"+d:":scope")+" "+xt(f[a]);y=f.join(",")}try{return I.apply(s,v.querySelectorAll(y)),s}catch(e){S(t,!0)}finally{d===b&&e.removeAttribute("id")}}}return h(t.replace(z,"$1"),e,s,n)}function ht(){var t=[];return function e(i,n){return t.push(i+" ")>s.cacheLength&&delete e[t.shift()],e[i+" "]=n}}function lt(t){return t[b]=!0,t}function dt(t){var e=p.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ct(t,e){for(var i=t.split("|"),n=i.length;n--;)s.attrHandle[i[n]]=e}function ut(t,e){var i=e&&t,s=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(s)return s;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function pt(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ft(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function gt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ot(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function mt(t){return lt((function(e){return e=+e,lt((function(i,s){for(var n,r=t([],i.length,e),o=r.length;o--;)i[n=r[o]]&&(i[n]=!(s[n]=i[n]))}))}))}function yt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=at.support={},r=at.isXML=function(t){var e=t&&t.namespaceURI,i=t&&(t.ownerDocument||t).documentElement;return!X.test(e||i&&i.nodeName||"HTML")},u=at.setDocument=function(t){var e,n,o=t?t.ownerDocument||t:w;return o!=p&&9===o.nodeType&&o.documentElement?(f=(p=o).documentElement,g=!r(p),w!=p&&(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",rt,!1):n.attachEvent&&n.attachEvent("onunload",rt)),i.scope=dt((function(t){return f.appendChild(t).appendChild(p.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length})),i.attributes=dt((function(t){return t.className="i",!t.getAttribute("className")})),i.getElementsByTagName=dt((function(t){return t.appendChild(p.createComment("")),!t.getElementsByTagName("*").length})),i.getElementsByClassName=Q.test(p.getElementsByClassName),i.getById=dt((function(t){return f.appendChild(t).id=b,!p.getElementsByName||!p.getElementsByName(b).length})),i.getById?(s.filter.ID=function(t){var e=t.replace(et,it);return function(t){return t.getAttribute("id")===e}},s.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i=e.getElementById(t);return i?[i]:[]}}):(s.filter.ID=function(t){var e=t.replace(et,it);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},s.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i,s,n,r=e.getElementById(t);if(r){if((i=r.getAttributeNode("id"))&&i.value===t)return[r];for(n=e.getElementsByName(t),s=0;r=n[s++];)if((i=r.getAttributeNode("id"))&&i.value===t)return[r]}return[]}}),s.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,s=[],n=0,r=e.getElementsByTagName(t);if("*"===t){for(;i=r[n++];)1===i.nodeType&&s.push(i);return s}return r},s.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},y=[],m=[],(i.qsa=Q.test(p.querySelectorAll))&&(dt((function(t){var e;f.appendChild(t).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),t.querySelectorAll("[selected]").length||m.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+D+")"),t.querySelectorAll("[id~="+b+"-]").length||m.push("~="),(e=p.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||m.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),t.querySelectorAll(":checked").length||m.push(":checked"),t.querySelectorAll("a#"+b+"+*").length||m.push(".#.+[+~]"),t.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),dt((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=p.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&m.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),m.push(",.*:")}))),(i.matchesSelector=Q.test(v=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&dt((function(t){i.disconnectedMatch=v.call(t,"*"),v.call(t,"[s!='']:x"),y.push("!=",U)})),m=m.length&&new RegExp(m.join("|")),y=y.length&&new RegExp(y.join("|")),e=Q.test(f.compareDocumentPosition),x=e||Q.test(f.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,s=e&&e.parentNode;return t===s||!(!s||1!==s.nodeType||!(i.contains?i.contains(s):t.compareDocumentPosition&&16&t.compareDocumentPosition(s)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},P=e?function(t,e){if(t===e)return c=!0,0;var s=!t.compareDocumentPosition-!e.compareDocumentPosition;return s||(1&(s=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===s?t==p||t.ownerDocument==w&&x(w,t)?-1:e==p||e.ownerDocument==w&&x(w,e)?1:d?B(d,t)-B(d,e):0:4&s?-1:1)}:function(t,e){if(t===e)return c=!0,0;var i,s=0,n=t.parentNode,r=e.parentNode,o=[t],a=[e];if(!n||!r)return t==p?-1:e==p?1:n?-1:r?1:d?B(d,t)-B(d,e):0;if(n===r)return ut(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)a.unshift(i);for(;o[s]===a[s];)s++;return s?ut(o[s],a[s]):o[s]==w?-1:a[s]==w?1:0},p):p},at.matches=function(t,e){return at(t,null,null,e)},at.matchesSelector=function(t,e){if(u(t),i.matchesSelector&&g&&!S[e+" "]&&(!y||!y.test(e))&&(!m||!m.test(e)))try{var s=v.call(t,e);if(s||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return s}catch(t){S(e,!0)}return at(e,p,null,[t]).length>0},at.contains=function(t,e){return(t.ownerDocument||t)!=p&&u(t),x(t,e)},at.attr=function(t,e){(t.ownerDocument||t)!=p&&u(t);var n=s.attrHandle[e.toLowerCase()],r=n&&M.call(s.attrHandle,e.toLowerCase())?n(t,e,!g):void 0;return void 0!==r?r:i.attributes||!g?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},at.escape=function(t){return(t+"").replace(st,nt)},at.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},at.uniqueSort=function(t){var e,s=[],n=0,r=0;if(c=!i.detectDuplicates,d=!i.sortStable&&t.slice(0),t.sort(P),c){for(;e=t[r++];)e===t[r]&&(n=s.push(r));for(;n--;)t.splice(s[n],1)}return d=null,t},n=at.getText=function(t){var e,i="",s=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=n(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[s++];)i+=n(e);return i},s=at.selectors={cacheLength:50,createPseudo:lt,match:q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,it),t[3]=(t[3]||t[4]||t[5]||"").replace(et,it),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||at.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&at.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return q.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&W.test(i)&&(e=o(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,it).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=C[t+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+t+"("+N+"|$)"))&&C(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(s){var n=at.attr(s,t);return null==n?"!="===e:!e||(n+="","="===e?n===i:"!="===e?n!==i:"^="===e?i&&0===n.indexOf(i):"*="===e?i&&n.indexOf(i)>-1:"$="===e?i&&n.slice(-i.length)===i:"~="===e?(" "+n.replace(j," ")+" ").indexOf(i)>-1:"|="===e&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,s,n){var r="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===s&&0===n?function(t){return!!t.parentNode}:function(e,i,h){var l,d,c,u,p,f,g=r!==o?"nextSibling":"previousSibling",m=e.parentNode,y=a&&e.nodeName.toLowerCase(),v=!h&&!a,x=!1;if(m){if(r){for(;g;){for(u=e;u=u[g];)if(a?u.nodeName.toLowerCase()===y:1===u.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&v){for(x=(p=(l=(d=(c=(u=m)[b]||(u[b]={}))[u.uniqueID]||(c[u.uniqueID]={}))[t]||[])[0]===_&&l[1])&&l[2],u=p&&m.childNodes[p];u=++p&&u&&u[g]||(x=p=0)||f.pop();)if(1===u.nodeType&&++x&&u===e){d[t]=[_,p,x];break}}else if(v&&(x=p=(l=(d=(c=(u=e)[b]||(u[b]={}))[u.uniqueID]||(c[u.uniqueID]={}))[t]||[])[0]===_&&l[1]),!1===x)for(;(u=++p&&u&&u[g]||(x=p=0)||f.pop())&&((a?u.nodeName.toLowerCase()!==y:1!==u.nodeType)||!++x||(v&&((d=(c=u[b]||(u[b]={}))[u.uniqueID]||(c[u.uniqueID]={}))[t]=[_,x]),u!==e)););return(x-=n)===s||x%s==0&&x/s>=0}}},PSEUDO:function(t,e){var i,n=s.pseudos[t]||s.setFilters[t.toLowerCase()]||at.error("unsupported pseudo: "+t);return n[b]?n(e):n.length>1?(i=[t,t,"",e],s.setFilters.hasOwnProperty(t.toLowerCase())?lt((function(t,i){for(var s,r=n(t,e),o=r.length;o--;)t[s=B(t,r[o])]=!(i[s]=r[o])})):function(t){return n(t,0,i)}):n}},pseudos:{not:lt((function(t){var e=[],i=[],s=a(t.replace(z,"$1"));return s[b]?lt((function(t,e,i,n){for(var r,o=s(t,null,n,[]),a=t.length;a--;)(r=o[a])&&(t[a]=!(e[a]=r))})):function(t,n,r){return e[0]=t,s(e,null,r,i),e[0]=null,!i.pop()}})),has:lt((function(t){return function(e){return at(t,e).length>0}})),contains:lt((function(t){return t=t.replace(et,it),function(e){return(e.textContent||n(e)).indexOf(t)>-1}})),lang:lt((function(t){return K.test(t||"")||at.error("unsupported lang: "+t),t=t.replace(et,it).toLowerCase(),function(e){var i;do{if(i=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===f},focus:function(t){return t===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:gt(!1),disabled:gt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!s.pseudos.empty(t)},header:function(t){return Z.test(t.nodeName)},input:function(t){return J.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:mt((function(){return[0]})),last:mt((function(t,e){return[e-1]})),eq:mt((function(t,e,i){return[i<0?i+e:i]})),even:mt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:mt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:mt((function(t,e,i){for(var s=i<0?i+e:i>e?e:i;--s>=0;)t.push(s);return t})),gt:mt((function(t,e,i){for(var s=i<0?i+e:i;++s<e;)t.push(s);return t}))}},s.pseudos.nth=s.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[e]=pt(e);for(e in{submit:!0,reset:!0})s.pseudos[e]=ft(e);function vt(){}function xt(t){for(var e=0,i=t.length,s="";e<i;e++)s+=t[e].value;return s}function bt(t,e,i){var s=e.dir,n=e.next,r=n||s,o=i&&"parentNode"===r,a=E++;return e.first?function(e,i,n){for(;e=e[s];)if(1===e.nodeType||o)return t(e,i,n);return!1}:function(e,i,h){var l,d,c,u=[_,a];if(h){for(;e=e[s];)if((1===e.nodeType||o)&&t(e,i,h))return!0}else for(;e=e[s];)if(1===e.nodeType||o)if(d=(c=e[b]||(e[b]={}))[e.uniqueID]||(c[e.uniqueID]={}),n&&n===e.nodeName.toLowerCase())e=e[s]||e;else{if((l=d[r])&&l[0]===_&&l[1]===a)return u[2]=l[2];if(d[r]=u,u[2]=t(e,i,h))return!0}return!1}}function wt(t){return t.length>1?function(e,i,s){for(var n=t.length;n--;)if(!t[n](e,i,s))return!1;return!0}:t[0]}function _t(t,e,i,s,n){for(var r,o=[],a=0,h=t.length,l=null!=e;a<h;a++)(r=t[a])&&(i&&!i(r,s,n)||(o.push(r),l&&e.push(a)));return o}function Et(t,e,i,s,n,r){return s&&!s[b]&&(s=Et(s)),n&&!n[b]&&(n=Et(n,r)),lt((function(r,o,a,h){var l,d,c,u=[],p=[],f=o.length,g=r||function(t,e,i){for(var s=0,n=e.length;s<n;s++)at(t,e[s],i);return i}(e||"*",a.nodeType?[a]:a,[]),m=!t||!r&&e?g:_t(g,u,t,a,h),y=i?n||(r?t:f||s)?[]:o:m;if(i&&i(m,y,a,h),s)for(l=_t(y,p),s(l,[],a,h),d=l.length;d--;)(c=l[d])&&(y[p[d]]=!(m[p[d]]=c));if(r){if(n||t){if(n){for(l=[],d=y.length;d--;)(c=y[d])&&l.push(m[d]=c);n(null,y=[],l,h)}for(d=y.length;d--;)(c=y[d])&&(l=n?B(r,c):u[d])>-1&&(r[l]=!(o[l]=c))}}else y=_t(y===o?y.splice(f,y.length):y),n?n(null,o,y,h):I.apply(o,y)}))}function Ct(t){for(var e,i,n,r=t.length,o=s.relative[t[0].type],a=o||s.relative[" "],h=o?1:0,d=bt((function(t){return t===e}),a,!0),c=bt((function(t){return B(e,t)>-1}),a,!0),u=[function(t,i,s){var n=!o&&(s||i!==l)||((e=i).nodeType?d(t,i,s):c(t,i,s));return e=null,n}];h<r;h++)if(i=s.relative[t[h].type])u=[bt(wt(u),i)];else{if((i=s.filter[t[h].type].apply(null,t[h].matches))[b]){for(n=++h;n<r&&!s.relative[t[n].type];n++);return Et(h>1&&wt(u),h>1&&xt(t.slice(0,h-1).concat({value:" "===t[h-2].type?"*":""})).replace(z,"$1"),i,h<n&&Ct(t.slice(h,n)),n<r&&Ct(t=t.slice(n)),n<r&&xt(t))}u.push(i)}return wt(u)}return vt.prototype=s.filters=s.pseudos,s.setFilters=new vt,o=at.tokenize=function(t,e){var i,n,r,o,a,h,l,d=T[t+" "];if(d)return e?0:d.slice(0);for(a=t,h=[],l=s.preFilter;a;){for(o in i&&!(n=H.exec(a))||(n&&(a=a.slice(n[0].length)||a),h.push(r=[])),i=!1,(n=Y.exec(a))&&(i=n.shift(),r.push({value:i,type:n[0].replace(z," ")}),a=a.slice(i.length)),s.filter)!(n=q[o].exec(a))||l[o]&&!(n=l[o](n))||(i=n.shift(),r.push({value:i,type:o,matches:n}),a=a.slice(i.length));if(!i)break}return e?a.length:a?at.error(t):T(t,h).slice(0)},a=at.compile=function(t,e){var i,n=[],r=[],a=A[t+" "];if(!a){for(e||(e=o(t)),i=e.length;i--;)(a=Ct(e[i]))[b]?n.push(a):r.push(a);a=A(t,function(t,e){var i=e.length>0,n=t.length>0,r=function(r,o,a,h,d){var c,f,m,y=0,v="0",x=r&&[],b=[],w=l,E=r||n&&s.find.TAG("*",d),C=_+=null==w?1:Math.random()||.1,T=E.length;for(d&&(l=o==p||o||d);v!==T&&null!=(c=E[v]);v++){if(n&&c){for(f=0,o||c.ownerDocument==p||(u(c),a=!g);m=t[f++];)if(m(c,o||p,a)){h.push(c);break}d&&(_=C)}i&&((c=!m&&c)&&y--,r&&x.push(c))}if(y+=v,i&&v!==y){for(f=0;m=e[f++];)m(x,b,o,a);if(r){if(y>0)for(;v--;)x[v]||b[v]||(b[v]=L.call(h));b=_t(b)}I.apply(h,b),d&&!r&&b.length>0&&y+e.length>1&&at.uniqueSort(h)}return d&&(_=C,l=w),x};return i?lt(r):r}(r,n)),a.selector=t}return a},h=at.select=function(t,e,i,n){var r,h,l,d,c,u="function"==typeof t&&t,p=!n&&o(t=u.selector||t);if(i=i||[],1===p.length){if((h=p[0]=p[0].slice(0)).length>2&&"ID"===(l=h[0]).type&&9===e.nodeType&&g&&s.relative[h[1].type]){if(!(e=(s.find.ID(l.matches[0].replace(et,it),e)||[])[0]))return i;u&&(e=e.parentNode),t=t.slice(h.shift().value.length)}for(r=q.needsContext.test(t)?0:h.length;r--&&(l=h[r],!s.relative[d=l.type]);)if((c=s.find[d])&&(n=c(l.matches[0].replace(et,it),tt.test(h[0].type)&&yt(e.parentNode)||e))){if(h.splice(r,1),!(t=n.length&&xt(h)))return I.apply(i,n),i;break}}return(u||a(t,p))(n,e,!g,i,!e||tt.test(t)&&yt(e.parentNode)||e),i},i.sortStable=b.split("").sort(P).join("")===b,i.detectDuplicates=!!c,u(),i.sortDetached=dt((function(t){return 1&t.compareDocumentPosition(p.createElement("fieldset"))})),dt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ct("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),i.attributes&&dt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ct("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),dt((function(t){return null==t.getAttribute("disabled")}))||ct(D,(function(t,e,i){var s;if(!i)return!0===t[e]?e.toLowerCase():(s=t.getAttributeNode(e))&&s.specified?s.value:null})),at}(s);C.find=A,C.expr=A.selectors,C.expr[":"]=C.expr.pseudos,C.uniqueSort=C.unique=A.uniqueSort,C.text=A.getText,C.isXMLDoc=A.isXML,C.contains=A.contains,C.escapeSelector=A.escape;var S=function(t,e,i){for(var s=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&C(t).is(i))break;s.push(t)}return s},P=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},M=C.expr.match.needsContext;function O(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var L=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function k(t,e,i){return y(e)?C.grep(t,(function(t,s){return!!e.call(t,s,t)!==i})):e.nodeType?C.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?C.grep(t,(function(t){return d.call(e,t)>-1!==i})):C.filter(e,t,i)}C.filter=function(t,e,i){var s=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===s.nodeType?C.find.matchesSelector(s,t)?[s]:[]:C.find.matches(t,C.grep(e,(function(t){return 1===t.nodeType})))},C.fn.extend({find:function(t){var e,i,s=this.length,n=this;if("string"!=typeof t)return this.pushStack(C(t).filter((function(){for(e=0;e<s;e++)if(C.contains(n[e],this))return!0})));for(i=this.pushStack([]),e=0;e<s;e++)C.find(t,n[e],i);return s>1?C.uniqueSort(i):i},filter:function(t){return this.pushStack(k(this,t||[],!1))},not:function(t){return this.pushStack(k(this,t||[],!0))},is:function(t){return!!k(this,"string"==typeof t&&M.test(t)?C(t):t||[],!1).length}});var I,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(C.fn.init=function(t,e,i){var s,n;if(!t)return this;if(i=i||I,"string"==typeof t){if(!(s="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:R.exec(t))||!s[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(s[1]){if(e=e instanceof C?e[0]:e,C.merge(this,C.parseHTML(s[1],e&&e.nodeType?e.ownerDocument||e:x,!0)),L.test(s[1])&&C.isPlainObject(e))for(s in e)y(this[s])?this[s](e[s]):this.attr(s,e[s]);return this}return(n=x.getElementById(s[2]))&&(this[0]=n,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):y(t)?void 0!==i.ready?i.ready(t):t(C):C.makeArray(t,this)}).prototype=C.fn,I=C(x);var B=/^(?:parents|prev(?:Until|All))/,D={children:!0,contents:!0,next:!0,prev:!0};function N(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}C.fn.extend({has:function(t){var e=C(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(C.contains(this,e[t]))return!0}))},closest:function(t,e){var i,s=0,n=this.length,r=[],o="string"!=typeof t&&C(t);if(!M.test(t))for(;s<n;s++)for(i=this[s];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&C.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(r.length>1?C.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?d.call(C(t),this[0]):d.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(C.uniqueSort(C.merge(this.get(),C(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),C.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return S(t,"parentNode")},parentsUntil:function(t,e,i){return S(t,"parentNode",i)},next:function(t){return N(t,"nextSibling")},prev:function(t){return N(t,"previousSibling")},nextAll:function(t){return S(t,"nextSibling")},prevAll:function(t){return S(t,"previousSibling")},nextUntil:function(t,e,i){return S(t,"nextSibling",i)},prevUntil:function(t,e,i){return S(t,"previousSibling",i)},siblings:function(t){return P((t.parentNode||{}).firstChild,t)},children:function(t){return P(t.firstChild)},contents:function(t){return null!=t.contentDocument&&o(t.contentDocument)?t.contentDocument:(O(t,"template")&&(t=t.content||t),C.merge([],t.childNodes))}},(function(t,e){C.fn[t]=function(i,s){var n=C.map(this,e,i);return"Until"!==t.slice(-5)&&(s=i),s&&"string"==typeof s&&(n=C.filter(s,n)),this.length>1&&(D[t]||C.uniqueSort(n),B.test(t)&&n.reverse()),this.pushStack(n)}}));var F=/[^\x20\t\r\n\f]+/g;function G(t){return t}function U(t){throw t}function j(t,e,i,s){var n;try{t&&y(n=t.promise)?n.call(t).done(e).fail(i):t&&y(n=t.then)?n.call(t,e,i):e.apply(void 0,[t].slice(s))}catch(t){i.apply(void 0,[t])}}C.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return C.each(t.match(F)||[],(function(t,i){e[i]=!0})),e}(t):C.extend({},t);var e,i,s,n,r=[],o=[],a=-1,h=function(){for(n=n||t.once,s=e=!0;o.length;a=-1)for(i=o.shift();++a<r.length;)!1===r[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=r.length,i=!1);t.memory||(i=!1),e=!1,n&&(r=i?[]:"")},l={add:function(){return r&&(i&&!e&&(a=r.length-1,o.push(i)),function e(i){C.each(i,(function(i,s){y(s)?t.unique&&l.has(s)||r.push(s):s&&s.length&&"string"!==_(s)&&e(s)}))}(arguments),i&&!e&&h()),this},remove:function(){return C.each(arguments,(function(t,e){for(var i;(i=C.inArray(e,r,i))>-1;)r.splice(i,1),i<=a&&a--})),this},has:function(t){return t?C.inArray(t,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return n=o=[],r=i="",this},disabled:function(){return!r},lock:function(){return n=o=[],i||e||(r=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=[t,(i=i||[]).slice?i.slice():i],o.push(i),e||h()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!s}};return l},C.extend({Deferred:function(t){var e=[["notify","progress",C.Callbacks("memory"),C.Callbacks("memory"),2],["resolve","done",C.Callbacks("once memory"),C.Callbacks("once memory"),0,"resolved"],["reject","fail",C.Callbacks("once memory"),C.Callbacks("once memory"),1,"rejected"]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return C.Deferred((function(i){C.each(e,(function(e,s){var n=y(t[s[4]])&&t[s[4]];r[s[1]]((function(){var t=n&&n.apply(this,arguments);t&&y(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[s[0]+"With"](this,n?[t]:arguments)}))})),t=null})).promise()},then:function(t,i,n){var r=0;function o(t,e,i,n){return function(){var a=this,h=arguments,l=function(){var s,l;if(!(t<r)){if((s=i.apply(a,h))===e.promise())throw new TypeError("Thenable self-resolution");l=s&&("object"==typeof s||"function"==typeof s)&&s.then,y(l)?n?l.call(s,o(r,e,G,n),o(r,e,U,n)):(r++,l.call(s,o(r,e,G,n),o(r,e,U,n),o(r,e,G,e.notifyWith))):(i!==G&&(a=void 0,h=[s]),(n||e.resolveWith)(a,h))}},d=n?l:function(){try{l()}catch(s){C.Deferred.exceptionHook&&C.Deferred.exceptionHook(s,d.stackTrace),t+1>=r&&(i!==U&&(a=void 0,h=[s]),e.rejectWith(a,h))}};t?d():(C.Deferred.getStackHook&&(d.stackTrace=C.Deferred.getStackHook()),s.setTimeout(d))}}return C.Deferred((function(s){e[0][3].add(o(0,s,y(n)?n:G,s.notifyWith)),e[1][3].add(o(0,s,y(t)?t:G)),e[2][3].add(o(0,s,y(i)?i:U))})).promise()},promise:function(t){return null!=t?C.extend(t,n):n}},r={};return C.each(e,(function(t,s){var o=s[2],a=s[5];n[s[1]]=o.add,a&&o.add((function(){i=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),o.add(s[3].fire),r[s[0]]=function(){return r[s[0]+"With"](this===r?void 0:this,arguments),this},r[s[0]+"With"]=o.fireWith})),n.promise(r),t&&t.call(r,r),r},when:function(t){var e=arguments.length,i=e,s=Array(i),n=a.call(arguments),r=C.Deferred(),o=function(t){return function(i){s[t]=this,n[t]=arguments.length>1?a.call(arguments):i,--e||r.resolveWith(s,n)}};if(e<=1&&(j(t,r.done(o(i)).resolve,r.reject,!e),"pending"===r.state()||y(n[i]&&n[i].then)))return r.then();for(;i--;)j(n[i],o(i),r.reject);return r.promise()}});var z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;C.Deferred.exceptionHook=function(t,e){s.console&&s.console.warn&&t&&z.test(t.name)&&s.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},C.readyException=function(t){s.setTimeout((function(){throw t}))};var H=C.Deferred();function Y(){x.removeEventListener("DOMContentLoaded",Y),s.removeEventListener("load",Y),C.ready()}C.fn.ready=function(t){return H.then(t).catch((function(t){C.readyException(t)})),this},C.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--C.readyWait:C.isReady)||(C.isReady=!0,!0!==t&&--C.readyWait>0||H.resolveWith(x,[C]))}}),C.ready.then=H.then,"complete"===x.readyState||"loading"!==x.readyState&&!x.documentElement.doScroll?s.setTimeout(C.ready):(x.addEventListener("DOMContentLoaded",Y),s.addEventListener("load",Y));var V=function(t,e,i,s,n,r,o){var a=0,h=t.length,l=null==i;if("object"===_(i))for(a in n=!0,i)V(t,e,a,i[a],!0,r,o);else if(void 0!==s&&(n=!0,y(s)||(o=!0),l&&(o?(e.call(t,s),e=null):(l=e,e=function(t,e,i){return l.call(C(t),i)})),e))for(;a<h;a++)e(t[a],i,o?s:s.call(t[a],a,e(t[a],i)));return n?t:l?e.call(t):h?e(t[0],i):r},W=/^-ms-/,K=/-([a-z])/g;function q(t,e){return e.toUpperCase()}function X(t){return t.replace(W,"ms-").replace(K,q)}var J=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function Z(){this.expando=C.expando+Z.uid++}Z.uid=1,Z.prototype={cache:function(t){var e=t[this.expando];return e||(e={},J(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var s,n=this.cache(t);if("string"==typeof e)n[X(e)]=i;else for(s in e)n[X(s)]=e[s];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][X(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,s=t[this.expando];if(void 0!==s){if(void 0!==e){i=(e=Array.isArray(e)?e.map(X):(e=X(e))in s?[e]:e.match(F)||[]).length;for(;i--;)delete s[e[i]]}(void 0===e||C.isEmptyObject(s))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!C.isEmptyObject(e)}};var Q=new Z,$=new Z,tt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,et=/[A-Z]/g;function it(t,e,i){var s;if(void 0===i&&1===t.nodeType)if(s="data-"+e.replace(et,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(s))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:tt.test(t)?JSON.parse(t):t)}(i)}catch(t){}$.set(t,e,i)}else i=void 0;return i}C.extend({hasData:function(t){return $.hasData(t)||Q.hasData(t)},data:function(t,e,i){return $.access(t,e,i)},removeData:function(t,e){$.remove(t,e)},_data:function(t,e,i){return Q.access(t,e,i)},_removeData:function(t,e){Q.remove(t,e)}}),C.fn.extend({data:function(t,e){var i,s,n,r=this[0],o=r&&r.attributes;if(void 0===t){if(this.length&&(n=$.get(r),1===r.nodeType&&!Q.get(r,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(s=o[i].name).indexOf("data-")&&(s=X(s.slice(5)),it(r,s,n[s]));Q.set(r,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each((function(){$.set(this,t)})):V(this,(function(e){var i;if(r&&void 0===e)return void 0!==(i=$.get(r,t))||void 0!==(i=it(r,t))?i:void 0;this.each((function(){$.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){$.remove(this,t)}))}}),C.extend({queue:function(t,e,i){var s;if(t)return e=(e||"fx")+"queue",s=Q.get(t,e),i&&(!s||Array.isArray(i)?s=Q.access(t,e,C.makeArray(i)):s.push(i)),s||[]},dequeue:function(t,e){e=e||"fx";var i=C.queue(t,e),s=i.length,n=i.shift(),r=C._queueHooks(t,e);"inprogress"===n&&(n=i.shift(),s--),n&&("fx"===e&&i.unshift("inprogress"),delete r.stop,n.call(t,(function(){C.dequeue(t,e)}),r)),!s&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Q.get(t,i)||Q.access(t,i,{empty:C.Callbacks("once memory").add((function(){Q.remove(t,[e+"queue",i])}))})}}),C.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?C.queue(this[0],t):void 0===e?this:this.each((function(){var i=C.queue(this,t,e);C._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&C.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){C.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,s=1,n=C.Deferred(),r=this,o=this.length,a=function(){--s||n.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(i=Q.get(r[o],t+"queueHooks"))&&i.empty&&(s++,i.empty.add(a));return a(),n.promise(e)}});var st=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,nt=new RegExp("^(?:([+-])=|)("+st+")([a-z%]*)$","i"),rt=["Top","Right","Bottom","Left"],ot=x.documentElement,at=function(t){return C.contains(t.ownerDocument,t)},ht={composed:!0};ot.getRootNode&&(at=function(t){return C.contains(t.ownerDocument,t)||t.getRootNode(ht)===t.ownerDocument});var lt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&at(t)&&"none"===C.css(t,"display")};function dt(t,e,i,s){var n,r,o=20,a=s?function(){return s.cur()}:function(){return C.css(t,e,"")},h=a(),l=i&&i[3]||(C.cssNumber[e]?"":"px"),d=t.nodeType&&(C.cssNumber[e]||"px"!==l&&+h)&&nt.exec(C.css(t,e));if(d&&d[3]!==l){for(h/=2,l=l||d[3],d=+h||1;o--;)C.style(t,e,d+l),(1-r)*(1-(r=a()/h||.5))<=0&&(o=0),d/=r;d*=2,C.style(t,e,d+l),i=i||[]}return i&&(d=+d||+h||0,n=i[1]?d+(i[1]+1)*i[2]:+i[2],s&&(s.unit=l,s.start=d,s.end=n)),n}var ct={};function ut(t){var e,i=t.ownerDocument,s=t.nodeName,n=ct[s];return n||(e=i.body.appendChild(i.createElement(s)),n=C.css(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),ct[s]=n,n)}function pt(t,e){for(var i,s,n=[],r=0,o=t.length;r<o;r++)(s=t[r]).style&&(i=s.style.display,e?("none"===i&&(n[r]=Q.get(s,"display")||null,n[r]||(s.style.display="")),""===s.style.display&&lt(s)&&(n[r]=ut(s))):"none"!==i&&(n[r]="none",Q.set(s,"display",i)));for(r=0;r<o;r++)null!=n[r]&&(t[r].style.display=n[r]);return t}C.fn.extend({show:function(){return pt(this,!0)},hide:function(){return pt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){lt(this)?C(this).show():C(this).hide()}))}});var ft,gt,mt=/^(?:checkbox|radio)$/i,yt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,vt=/^$|^module$|\/(?:java|ecma)script/i;ft=x.createDocumentFragment().appendChild(x.createElement("div")),(gt=x.createElement("input")).setAttribute("type","radio"),gt.setAttribute("checked","checked"),gt.setAttribute("name","t"),ft.appendChild(gt),m.checkClone=ft.cloneNode(!0).cloneNode(!0).lastChild.checked,ft.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!ft.cloneNode(!0).lastChild.defaultValue,ft.innerHTML="<option></option>",m.option=!!ft.lastChild;var xt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function bt(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&O(t,e)?C.merge([t],i):i}function wt(t,e){for(var i=0,s=t.length;i<s;i++)Q.set(t[i],"globalEval",!e||Q.get(e[i],"globalEval"))}xt.tbody=xt.tfoot=xt.colgroup=xt.caption=xt.thead,xt.th=xt.td,m.option||(xt.optgroup=xt.option=[1,"<select multiple='multiple'>","</select>"]);var _t=/<|&#?\w+;/;function Et(t,e,i,s,n){for(var r,o,a,h,l,d,c=e.createDocumentFragment(),u=[],p=0,f=t.length;p<f;p++)if((r=t[p])||0===r)if("object"===_(r))C.merge(u,r.nodeType?[r]:r);else if(_t.test(r)){for(o=o||c.appendChild(e.createElement("div")),a=(yt.exec(r)||["",""])[1].toLowerCase(),h=xt[a]||xt._default,o.innerHTML=h[1]+C.htmlPrefilter(r)+h[2],d=h[0];d--;)o=o.lastChild;C.merge(u,o.childNodes),(o=c.firstChild).textContent=""}else u.push(e.createTextNode(r));for(c.textContent="",p=0;r=u[p++];)if(s&&C.inArray(r,s)>-1)n&&n.push(r);else if(l=at(r),o=bt(c.appendChild(r),"script"),l&&wt(o),i)for(d=0;r=o[d++];)vt.test(r.type||"")&&i.push(r);return c}var Ct=/^([^.]*)(?:\.(.+)|)/;function Tt(){return!0}function At(){return!1}function St(t,e){return t===function(){try{return x.activeElement}catch(t){}}()==("focus"===e)}function Pt(t,e,i,s,n,r){var o,a;if("object"==typeof e){for(a in"string"!=typeof i&&(s=s||i,i=void 0),e)Pt(t,a,i,s,e[a],r);return t}if(null==s&&null==n?(n=i,s=i=void 0):null==n&&("string"==typeof i?(n=s,s=void 0):(n=s,s=i,i=void 0)),!1===n)n=At;else if(!n)return t;return 1===r&&(o=n,n=function(t){return C().off(t),o.apply(this,arguments)},n.guid=o.guid||(o.guid=C.guid++)),t.each((function(){C.event.add(this,e,n,s,i)}))}function Mt(t,e,i){i?(Q.set(t,e,!1),C.event.add(t,e,{namespace:!1,handler:function(t){var s,n,r=Q.get(this,e);if(1&t.isTrigger&&this[e]){if(r.length)(C.event.special[e]||{}).delegateType&&t.stopPropagation();else if(r=a.call(arguments),Q.set(this,e,r),s=i(this,e),this[e](),r!==(n=Q.get(this,e))||s?Q.set(this,e,!1):n={},r!==n)return t.stopImmediatePropagation(),t.preventDefault(),n&&n.value}else r.length&&(Q.set(this,e,{value:C.event.trigger(C.extend(r[0],C.Event.prototype),r.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===Q.get(t,e)&&C.event.add(t,e,Tt)}C.event={global:{},add:function(t,e,i,s,n){var r,o,a,h,l,d,c,u,p,f,g,m=Q.get(t);if(J(t))for(i.handler&&(i=(r=i).handler,n=r.selector),n&&C.find.matchesSelector(ot,n),i.guid||(i.guid=C.guid++),(h=m.events)||(h=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(e){return void 0!==C&&C.event.triggered!==e.type?C.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(F)||[""]).length;l--;)p=g=(a=Ct.exec(e[l])||[])[1],f=(a[2]||"").split(".").sort(),p&&(c=C.event.special[p]||{},p=(n?c.delegateType:c.bindType)||p,c=C.event.special[p]||{},d=C.extend({type:p,origType:g,data:s,handler:i,guid:i.guid,selector:n,needsContext:n&&C.expr.match.needsContext.test(n),namespace:f.join(".")},r),(u=h[p])||((u=h[p]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(t,s,f,o)||t.addEventListener&&t.addEventListener(p,o)),c.add&&(c.add.call(t,d),d.handler.guid||(d.handler.guid=i.guid)),n?u.splice(u.delegateCount++,0,d):u.push(d),C.event.global[p]=!0)},remove:function(t,e,i,s,n){var r,o,a,h,l,d,c,u,p,f,g,m=Q.hasData(t)&&Q.get(t);if(m&&(h=m.events)){for(l=(e=(e||"").match(F)||[""]).length;l--;)if(p=g=(a=Ct.exec(e[l])||[])[1],f=(a[2]||"").split(".").sort(),p){for(c=C.event.special[p]||{},u=h[p=(s?c.delegateType:c.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=u.length;r--;)d=u[r],!n&&g!==d.origType||i&&i.guid!==d.guid||a&&!a.test(d.namespace)||s&&s!==d.selector&&("**"!==s||!d.selector)||(u.splice(r,1),d.selector&&u.delegateCount--,c.remove&&c.remove.call(t,d));o&&!u.length&&(c.teardown&&!1!==c.teardown.call(t,f,m.handle)||C.removeEvent(t,p,m.handle),delete h[p])}else for(p in h)C.event.remove(t,p+e[l],i,s,!0);C.isEmptyObject(h)&&Q.remove(t,"handle events")}},dispatch:function(t){var e,i,s,n,r,o,a=new Array(arguments.length),h=C.event.fix(t),l=(Q.get(this,"events")||Object.create(null))[h.type]||[],d=C.event.special[h.type]||{};for(a[0]=h,e=1;e<arguments.length;e++)a[e]=arguments[e];if(h.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,h)){for(o=C.event.handlers.call(this,h,l),e=0;(n=o[e++])&&!h.isPropagationStopped();)for(h.currentTarget=n.elem,i=0;(r=n.handlers[i++])&&!h.isImmediatePropagationStopped();)h.rnamespace&&!1!==r.namespace&&!h.rnamespace.test(r.namespace)||(h.handleObj=r,h.data=r.data,void 0!==(s=((C.event.special[r.origType]||{}).handle||r.handler).apply(n.elem,a))&&!1===(h.result=s)&&(h.preventDefault(),h.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,h),h.result}},handlers:function(t,e){var i,s,n,r,o,a=[],h=e.delegateCount,l=t.target;if(h&&l.nodeType&&!("click"===t.type&&t.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==t.type||!0!==l.disabled)){for(r=[],o={},i=0;i<h;i++)void 0===o[n=(s=e[i]).selector+" "]&&(o[n]=s.needsContext?C(n,this).index(l)>-1:C.find(n,this,null,[l]).length),o[n]&&r.push(s);r.length&&a.push({elem:l,handlers:r})}return l=this,h<e.length&&a.push({elem:l,handlers:e.slice(h)}),a},addProp:function(t,e){Object.defineProperty(C.Event.prototype,t,{enumerable:!0,configurable:!0,get:y(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[C.expando]?t:new C.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return mt.test(e.type)&&e.click&&O(e,"input")&&Mt(e,"click",Tt),!1},trigger:function(t){var e=this||t;return mt.test(e.type)&&e.click&&O(e,"input")&&Mt(e,"click"),!0},_default:function(t){var e=t.target;return mt.test(e.type)&&e.click&&O(e,"input")&&Q.get(e,"click")||O(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},C.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},C.Event=function(t,e){if(!(this instanceof C.Event))return new C.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Tt:At,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&C.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[C.expando]=!0},C.Event.prototype={constructor:C.Event,isDefaultPrevented:At,isPropagationStopped:At,isImmediatePropagationStopped:At,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Tt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Tt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Tt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},C.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},C.event.addProp),C.each({focus:"focusin",blur:"focusout"},(function(t,e){C.event.special[t]={setup:function(){return Mt(this,t,St),!1},trigger:function(){return Mt(this,t),!0},_default:function(e){return Q.get(e.target,t)},delegateType:e}})),C.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){C.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,s=this,n=t.relatedTarget,r=t.handleObj;return n&&(n===s||C.contains(s,n))||(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}})),C.fn.extend({on:function(t,e,i,s){return Pt(this,t,e,i,s)},one:function(t,e,i,s){return Pt(this,t,e,i,s,1)},off:function(t,e,i){var s,n;if(t&&t.preventDefault&&t.handleObj)return s=t.handleObj,C(t.delegateTarget).off(s.namespace?s.origType+"."+s.namespace:s.origType,s.selector,s.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=At),this.each((function(){C.event.remove(this,t,i,e)}))}});var Ot=/<script|<style|<link/i,Lt=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function It(t,e){return O(t,"table")&&O(11!==e.nodeType?e:e.firstChild,"tr")&&C(t).children("tbody")[0]||t}function Rt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Bt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Dt(t,e){var i,s,n,r,o,a;if(1===e.nodeType){if(Q.hasData(t)&&(a=Q.get(t).events))for(n in Q.remove(e,"handle events"),a)for(i=0,s=a[n].length;i<s;i++)C.event.add(e,n,a[n][i]);$.hasData(t)&&(r=$.access(t),o=C.extend({},r),$.set(e,o))}}function Nt(t,e){var i=e.nodeName.toLowerCase();"input"===i&&mt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function Ft(t,e,i,s){e=h(e);var n,r,o,a,l,d,c=0,u=t.length,p=u-1,f=e[0],g=y(f);if(g||u>1&&"string"==typeof f&&!m.checkClone&&Lt.test(f))return t.each((function(n){var r=t.eq(n);g&&(e[0]=f.call(this,n,r.html())),Ft(r,e,i,s)}));if(u&&(r=(n=Et(e,t[0].ownerDocument,!1,t,s)).firstChild,1===n.childNodes.length&&(n=r),r||s)){for(a=(o=C.map(bt(n,"script"),Rt)).length;c<u;c++)l=n,c!==p&&(l=C.clone(l,!0,!0),a&&C.merge(o,bt(l,"script"))),i.call(t[c],l,c);if(a)for(d=o[o.length-1].ownerDocument,C.map(o,Bt),c=0;c<a;c++)l=o[c],vt.test(l.type||"")&&!Q.access(l,"globalEval")&&C.contains(d,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?C._evalUrl&&!l.noModule&&C._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},d):w(l.textContent.replace(kt,""),l,d))}return t}function Gt(t,e,i){for(var s,n=e?C.filter(e,t):t,r=0;null!=(s=n[r]);r++)i||1!==s.nodeType||C.cleanData(bt(s)),s.parentNode&&(i&&at(s)&&wt(bt(s,"script")),s.parentNode.removeChild(s));return t}C.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var s,n,r,o,a=t.cloneNode(!0),h=at(t);if(!(m.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||C.isXMLDoc(t)))for(o=bt(a),s=0,n=(r=bt(t)).length;s<n;s++)Nt(r[s],o[s]);if(e)if(i)for(r=r||bt(t),o=o||bt(a),s=0,n=r.length;s<n;s++)Dt(r[s],o[s]);else Dt(t,a);return(o=bt(a,"script")).length>0&&wt(o,!h&&bt(t,"script")),a},cleanData:function(t){for(var e,i,s,n=C.event.special,r=0;void 0!==(i=t[r]);r++)if(J(i)){if(e=i[Q.expando]){if(e.events)for(s in e.events)n[s]?C.event.remove(i,s):C.removeEvent(i,s,e.handle);i[Q.expando]=void 0}i[$.expando]&&(i[$.expando]=void 0)}}}),C.fn.extend({detach:function(t){return Gt(this,t,!0)},remove:function(t){return Gt(this,t)},text:function(t){return V(this,(function(t){return void 0===t?C.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Ft(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||It(this,t).appendChild(t)}))},prepend:function(){return Ft(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=It(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Ft(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Ft(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(C.cleanData(bt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return C.clone(this,t,e)}))},html:function(t){return V(this,(function(t){var e=this[0]||{},i=0,s=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Ot.test(t)&&!xt[(yt.exec(t)||["",""])[1].toLowerCase()]){t=C.htmlPrefilter(t);try{for(;i<s;i++)1===(e=this[i]||{}).nodeType&&(C.cleanData(bt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Ft(this,arguments,(function(e){var i=this.parentNode;C.inArray(this,t)<0&&(C.cleanData(bt(this)),i&&i.replaceChild(e,this))}),t)}}),C.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){C.fn[t]=function(t){for(var i,s=[],n=C(t),r=n.length-1,o=0;o<=r;o++)i=o===r?this:this.clone(!0),C(n[o])[e](i),l.apply(s,i.get());return this.pushStack(s)}}));var Ut=new RegExp("^("+st+")(?!px)[a-z%]+$","i"),jt=/^--/,zt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=s),e.getComputedStyle(t)},Ht=function(t,e,i){var s,n,r={};for(n in e)r[n]=t.style[n],t.style[n]=e[n];for(n in s=i.call(t),e)t.style[n]=r[n];return s},Yt=new RegExp(rt.join("|"),"i"),Vt=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g");function Wt(t,e,i){var s,n,r,o,a=jt.test(e),h=t.style;return(i=i||zt(t))&&(o=i.getPropertyValue(e)||i[e],a&&(o=o.replace(Vt,"$1")),""!==o||at(t)||(o=C.style(t,e)),!m.pixelBoxStyles()&&Ut.test(o)&&Yt.test(e)&&(s=h.width,n=h.minWidth,r=h.maxWidth,h.minWidth=h.maxWidth=h.width=o,o=i.width,h.width=s,h.minWidth=n,h.maxWidth=r)),void 0!==o?o+"":o}function Kt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(d){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ot.appendChild(l).appendChild(d);var t=s.getComputedStyle(d);i="1%"!==t.top,h=12===e(t.marginLeft),d.style.right="60%",o=36===e(t.right),n=36===e(t.width),d.style.position="absolute",r=12===e(d.offsetWidth/3),ot.removeChild(l),d=null}}function e(t){return Math.round(parseFloat(t))}var i,n,r,o,a,h,l=x.createElement("div"),d=x.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,C.extend(m,{boxSizingReliable:function(){return t(),n},pixelBoxStyles:function(){return t(),o},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),h},scrollboxSize:function(){return t(),r},reliableTrDimensions:function(){var t,e,i,n;return null==a&&(t=x.createElement("table"),e=x.createElement("tr"),i=x.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="border:1px solid",e.style.height="1px",i.style.height="9px",i.style.display="block",ot.appendChild(t).appendChild(e).appendChild(i),n=s.getComputedStyle(e),a=parseInt(n.height,10)+parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10)===e.offsetHeight,ot.removeChild(t)),a}}))}();var qt=["Webkit","Moz","ms"],Xt=x.createElement("div").style,Jt={};function Zt(t){return C.cssProps[t]||Jt[t]||(t in Xt?t:Jt[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=qt.length;i--;)if((t=qt[i]+e)in Xt)return t}(t)||t)}var Qt=/^(none|table(?!-c[ea]).+)/,$t={position:"absolute",visibility:"hidden",display:"block"},te={letterSpacing:"0",fontWeight:"400"};function ee(t,e,i){var s=nt.exec(e);return s?Math.max(0,s[2]-(i||0))+(s[3]||"px"):e}function ie(t,e,i,s,n,r){var o="width"===e?1:0,a=0,h=0;if(i===(s?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(h+=C.css(t,i+rt[o],!0,n)),s?("content"===i&&(h-=C.css(t,"padding"+rt[o],!0,n)),"margin"!==i&&(h-=C.css(t,"border"+rt[o]+"Width",!0,n))):(h+=C.css(t,"padding"+rt[o],!0,n),"padding"!==i?h+=C.css(t,"border"+rt[o]+"Width",!0,n):a+=C.css(t,"border"+rt[o]+"Width",!0,n));return!s&&r>=0&&(h+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-r-h-a-.5))||0),h}function se(t,e,i){var s=zt(t),n=(!m.boxSizingReliable()||i)&&"border-box"===C.css(t,"boxSizing",!1,s),r=n,o=Wt(t,e,s),a="offset"+e[0].toUpperCase()+e.slice(1);if(Ut.test(o)){if(!i)return o;o="auto"}return(!m.boxSizingReliable()&&n||!m.reliableTrDimensions()&&O(t,"tr")||"auto"===o||!parseFloat(o)&&"inline"===C.css(t,"display",!1,s))&&t.getClientRects().length&&(n="border-box"===C.css(t,"boxSizing",!1,s),(r=a in t)&&(o=t[a])),(o=parseFloat(o)||0)+ie(t,e,i||(n?"border":"content"),r,s,o)+"px"}function ne(t,e,i,s,n){return new ne.prototype.init(t,e,i,s,n)}C.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Wt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,s){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,r,o,a=X(e),h=jt.test(e),l=t.style;if(h||(e=Zt(a)),o=C.cssHooks[e]||C.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(n=o.get(t,!1,s))?n:l[e];"string"==(r=typeof i)&&(n=nt.exec(i))&&n[1]&&(i=dt(t,e,n),r="number"),null!=i&&i==i&&("number"!==r||h||(i+=n&&n[3]||(C.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,s))||(h?l.setProperty(e,i):l[e]=i))}},css:function(t,e,i,s){var n,r,o,a=X(e);return jt.test(e)||(e=Zt(a)),(o=C.cssHooks[e]||C.cssHooks[a])&&"get"in o&&(n=o.get(t,!0,i)),void 0===n&&(n=Wt(t,e,s)),"normal"===n&&e in te&&(n=te[e]),""===i||i?(r=parseFloat(n),!0===i||isFinite(r)?r||0:n):n}}),C.each(["height","width"],(function(t,e){C.cssHooks[e]={get:function(t,i,s){if(i)return!Qt.test(C.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?se(t,e,s):Ht(t,$t,(function(){return se(t,e,s)}))},set:function(t,i,s){var n,r=zt(t),o=!m.scrollboxSize()&&"absolute"===r.position,a=(o||s)&&"border-box"===C.css(t,"boxSizing",!1,r),h=s?ie(t,e,s,a,r):0;return a&&o&&(h-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(r[e])-ie(t,e,"border",!1,r)-.5)),h&&(n=nt.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=C.css(t,e)),ee(0,i,h)}}})),C.cssHooks.marginLeft=Kt(m.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Wt(t,"marginLeft"))||t.getBoundingClientRect().left-Ht(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),C.each({margin:"",padding:"",border:"Width"},(function(t,e){C.cssHooks[t+e]={expand:function(i){for(var s=0,n={},r="string"==typeof i?i.split(" "):[i];s<4;s++)n[t+rt[s]+e]=r[s]||r[s-2]||r[0];return n}},"margin"!==t&&(C.cssHooks[t+e].set=ee)})),C.fn.extend({css:function(t,e){return V(this,(function(t,e,i){var s,n,r={},o=0;if(Array.isArray(e)){for(s=zt(t),n=e.length;o<n;o++)r[e[o]]=C.css(t,e[o],!1,s);return r}return void 0!==i?C.style(t,e,i):C.css(t,e)}),t,e,arguments.length>1)}}),C.Tween=ne,ne.prototype={constructor:ne,init:function(t,e,i,s,n,r){this.elem=t,this.prop=i,this.easing=n||C.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=s,this.unit=r||(C.cssNumber[i]?"":"px")},cur:function(){var t=ne.propHooks[this.prop];return t&&t.get?t.get(this):ne.propHooks._default.get(this)},run:function(t){var e,i=ne.propHooks[this.prop];return this.options.duration?this.pos=e=C.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):ne.propHooks._default.set(this),this}},ne.prototype.init.prototype=ne.prototype,ne.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=C.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){C.fx.step[t.prop]?C.fx.step[t.prop](t):1!==t.elem.nodeType||!C.cssHooks[t.prop]&&null==t.elem.style[Zt(t.prop)]?t.elem[t.prop]=t.now:C.style(t.elem,t.prop,t.now+t.unit)}}},ne.propHooks.scrollTop=ne.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},C.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},C.fx=ne.prototype.init,C.fx.step={};var re,oe,ae=/^(?:toggle|show|hide)$/,he=/queueHooks$/;function le(){oe&&(!1===x.hidden&&s.requestAnimationFrame?s.requestAnimationFrame(le):s.setTimeout(le,C.fx.interval),C.fx.tick())}function de(){return s.setTimeout((function(){re=void 0})),re=Date.now()}function ce(t,e){var i,s=0,n={height:t};for(e=e?1:0;s<4;s+=2-e)n["margin"+(i=rt[s])]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function ue(t,e,i){for(var s,n=(pe.tweeners[e]||[]).concat(pe.tweeners["*"]),r=0,o=n.length;r<o;r++)if(s=n[r].call(i,e,t))return s}function pe(t,e,i){var s,n,r=0,o=pe.prefilters.length,a=C.Deferred().always((function(){delete h.elem})),h=function(){if(n)return!1;for(var e=re||de(),i=Math.max(0,l.startTime+l.duration-e),s=1-(i/l.duration||0),r=0,o=l.tweens.length;r<o;r++)l.tweens[r].run(s);return a.notifyWith(t,[l,s,i]),s<1&&o?i:(o||a.notifyWith(t,[l,1,0]),a.resolveWith(t,[l]),!1)},l=a.promise({elem:t,props:C.extend({},e),opts:C.extend(!0,{specialEasing:{},easing:C.easing._default},i),originalProperties:e,originalOptions:i,startTime:re||de(),duration:i.duration,tweens:[],createTween:function(e,i){var s=C.Tween(t,l.opts,e,i,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(s),s},stop:function(e){var i=0,s=e?l.tweens.length:0;if(n)return this;for(n=!0;i<s;i++)l.tweens[i].run(1);return e?(a.notifyWith(t,[l,1,0]),a.resolveWith(t,[l,e])):a.rejectWith(t,[l,e]),this}}),d=l.props;for(function(t,e){var i,s,n,r,o;for(i in t)if(n=e[s=X(i)],r=t[i],Array.isArray(r)&&(n=r[1],r=t[i]=r[0]),i!==s&&(t[s]=r,delete t[i]),(o=C.cssHooks[s])&&"expand"in o)for(i in r=o.expand(r),delete t[s],r)i in t||(t[i]=r[i],e[i]=n);else e[s]=n}(d,l.opts.specialEasing);r<o;r++)if(s=pe.prefilters[r].call(l,t,d,l.opts))return y(s.stop)&&(C._queueHooks(l.elem,l.opts.queue).stop=s.stop.bind(s)),s;return C.map(d,ue,l),y(l.opts.start)&&l.opts.start.call(t,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),C.fx.timer(C.extend(h,{elem:t,anim:l,queue:l.opts.queue})),l}C.Animation=C.extend(pe,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return dt(i.elem,t,nt.exec(e),i),i}]},tweener:function(t,e){y(t)?(e=t,t=["*"]):t=t.match(F);for(var i,s=0,n=t.length;s<n;s++)i=t[s],pe.tweeners[i]=pe.tweeners[i]||[],pe.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var s,n,r,o,a,h,l,d,c="width"in e||"height"in e,u=this,p={},f=t.style,g=t.nodeType&&lt(t),m=Q.get(t,"fxshow");for(s in i.queue||(null==(o=C._queueHooks(t,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,u.always((function(){u.always((function(){o.unqueued--,C.queue(t,"fx").length||o.empty.fire()}))}))),e)if(n=e[s],ae.test(n)){if(delete e[s],r=r||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!m||void 0===m[s])continue;g=!0}p[s]=m&&m[s]||C.style(t,s)}if((h=!C.isEmptyObject(e))||!C.isEmptyObject(p))for(s in c&&1===t.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(l=m&&m.display)&&(l=Q.get(t,"display")),"none"===(d=C.css(t,"display"))&&(l?d=l:(pt([t],!0),l=t.style.display||l,d=C.css(t,"display"),pt([t]))),("inline"===d||"inline-block"===d&&null!=l)&&"none"===C.css(t,"float")&&(h||(u.done((function(){f.display=l})),null==l&&(d=f.display,l="none"===d?"":d)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",u.always((function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]}))),h=!1,p)h||(m?"hidden"in m&&(g=m.hidden):m=Q.access(t,"fxshow",{display:l}),r&&(m.hidden=!g),g&&pt([t],!0),u.done((function(){for(s in g||pt([t]),Q.remove(t,"fxshow"),p)C.style(t,s,p[s])}))),h=ue(g?m[s]:0,s,u),s in m||(m[s]=h.start,g&&(h.end=h.start,h.start=0))}],prefilter:function(t,e){e?pe.prefilters.unshift(t):pe.prefilters.push(t)}}),C.speed=function(t,e,i){var s=t&&"object"==typeof t?C.extend({},t):{complete:i||!i&&e||y(t)&&t,duration:t,easing:i&&e||e&&!y(e)&&e};return C.fx.off?s.duration=0:"number"!=typeof s.duration&&(s.duration in C.fx.speeds?s.duration=C.fx.speeds[s.duration]:s.duration=C.fx.speeds._default),null!=s.queue&&!0!==s.queue||(s.queue="fx"),s.old=s.complete,s.complete=function(){y(s.old)&&s.old.call(this),s.queue&&C.dequeue(this,s.queue)},s},C.fn.extend({fadeTo:function(t,e,i,s){return this.filter(lt).css("opacity",0).show().end().animate({opacity:e},t,i,s)},animate:function(t,e,i,s){var n=C.isEmptyObject(t),r=C.speed(e,i,s),o=function(){var e=pe(this,C.extend({},t),r);(n||Q.get(this,"finish"))&&e.stop(!0)};return o.finish=o,n||!1===r.queue?this.each(o):this.queue(r.queue,o)},stop:function(t,e,i){var s=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,n=null!=t&&t+"queueHooks",r=C.timers,o=Q.get(this);if(n)o[n]&&o[n].stop&&s(o[n]);else for(n in o)o[n]&&o[n].stop&&he.test(n)&&s(o[n]);for(n=r.length;n--;)r[n].elem!==this||null!=t&&r[n].queue!==t||(r[n].anim.stop(i),e=!1,r.splice(n,1));!e&&i||C.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=Q.get(this),s=i[t+"queue"],n=i[t+"queueHooks"],r=C.timers,o=s?s.length:0;for(i.finish=!0,C.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<o;e++)s[e]&&s[e].finish&&s[e].finish.call(this);delete i.finish}))}}),C.each(["toggle","show","hide"],(function(t,e){var i=C.fn[e];C.fn[e]=function(t,s,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(ce(e,!0),t,s,n)}})),C.each({slideDown:ce("show"),slideUp:ce("hide"),slideToggle:ce("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){C.fn[t]=function(t,i,s){return this.animate(e,t,i,s)}})),C.timers=[],C.fx.tick=function(){var t,e=0,i=C.timers;for(re=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||C.fx.stop(),re=void 0},C.fx.timer=function(t){C.timers.push(t),C.fx.start()},C.fx.interval=13,C.fx.start=function(){oe||(oe=!0,le())},C.fx.stop=function(){oe=null},C.fx.speeds={slow:600,fast:200,_default:400},C.fn.delay=function(t,e){return t=C.fx&&C.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,i){var n=s.setTimeout(e,t);i.stop=function(){s.clearTimeout(n)}}))},function(){var t=x.createElement("input"),e=x.createElement("select").appendChild(x.createElement("option"));t.type="checkbox",m.checkOn=""!==t.value,m.optSelected=e.selected,(t=x.createElement("input")).value="t",t.type="radio",m.radioValue="t"===t.value}();var fe,ge=C.expr.attrHandle;C.fn.extend({attr:function(t,e){return V(this,C.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){C.removeAttr(this,t)}))}}),C.extend({attr:function(t,e,i){var s,n,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===t.getAttribute?C.prop(t,e,i):(1===r&&C.isXMLDoc(t)||(n=C.attrHooks[e.toLowerCase()]||(C.expr.match.bool.test(e)?fe:void 0)),void 0!==i?null===i?void C.removeAttr(t,e):n&&"set"in n&&void 0!==(s=n.set(t,i,e))?s:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(s=n.get(t,e))?s:null==(s=C.find.attr(t,e))?void 0:s)},attrHooks:{type:{set:function(t,e){if(!m.radioValue&&"radio"===e&&O(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,s=0,n=e&&e.match(F);if(n&&1===t.nodeType)for(;i=n[s++];)t.removeAttribute(i)}}),fe={set:function(t,e,i){return!1===e?C.removeAttr(t,i):t.setAttribute(i,i),i}},C.each(C.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=ge[e]||C.find.attr;ge[e]=function(t,e,s){var n,r,o=e.toLowerCase();return s||(r=ge[o],ge[o]=n,n=null!=i(t,e,s)?o:null,ge[o]=r),n}}));var me=/^(?:input|select|textarea|button)$/i,ye=/^(?:a|area)$/i;function ve(t){return(t.match(F)||[]).join(" ")}function xe(t){return t.getAttribute&&t.getAttribute("class")||""}function be(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(F)||[]}C.fn.extend({prop:function(t,e){return V(this,C.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[C.propFix[t]||t]}))}}),C.extend({prop:function(t,e,i){var s,n,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&C.isXMLDoc(t)||(e=C.propFix[e]||e,n=C.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(s=n.set(t,i,e))?s:t[e]=i:n&&"get"in n&&null!==(s=n.get(t,e))?s:t[e]},propHooks:{tabIndex:{get:function(t){var e=C.find.attr(t,"tabindex");return e?parseInt(e,10):me.test(t.nodeName)||ye.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(C.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),C.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){C.propFix[this.toLowerCase()]=this})),C.fn.extend({addClass:function(t){var e,i,s,n,r,o;return y(t)?this.each((function(e){C(this).addClass(t.call(this,e,xe(this)))})):(e=be(t)).length?this.each((function(){if(s=xe(this),i=1===this.nodeType&&" "+ve(s)+" "){for(r=0;r<e.length;r++)n=e[r],i.indexOf(" "+n+" ")<0&&(i+=n+" ");o=ve(i),s!==o&&this.setAttribute("class",o)}})):this},removeClass:function(t){var e,i,s,n,r,o;return y(t)?this.each((function(e){C(this).removeClass(t.call(this,e,xe(this)))})):arguments.length?(e=be(t)).length?this.each((function(){if(s=xe(this),i=1===this.nodeType&&" "+ve(s)+" "){for(r=0;r<e.length;r++)for(n=e[r];i.indexOf(" "+n+" ")>-1;)i=i.replace(" "+n+" "," ");o=ve(i),s!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(t,e){var i,s,n,r,o=typeof t,a="string"===o||Array.isArray(t);return y(t)?this.each((function(i){C(this).toggleClass(t.call(this,i,xe(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(i=be(t),this.each((function(){if(a)for(r=C(this),n=0;n<i.length;n++)s=i[n],r.hasClass(s)?r.removeClass(s):r.addClass(s);else void 0!==t&&"boolean"!==o||((s=xe(this))&&Q.set(this,"__className__",s),this.setAttribute&&this.setAttribute("class",s||!1===t?"":Q.get(this,"__className__")||""))})))},hasClass:function(t){var e,i,s=0;for(e=" "+t+" ";i=this[s++];)if(1===i.nodeType&&(" "+ve(xe(i))+" ").indexOf(e)>-1)return!0;return!1}});var we=/\r/g;C.fn.extend({val:function(t){var e,i,s,n=this[0];return arguments.length?(s=y(t),this.each((function(i){var n;1===this.nodeType&&(null==(n=s?t.call(this,i,C(this).val()):t)?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=C.map(n,(function(t){return null==t?"":t+""}))),(e=C.valHooks[this.type]||C.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))}))):n?(e=C.valHooks[n.type]||C.valHooks[n.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(we,""):null==i?"":i:void 0}}),C.extend({valHooks:{option:{get:function(t){var e=C.find.attr(t,"value");return null!=e?e:ve(C.text(t))}},select:{get:function(t){var e,i,s,n=t.options,r=t.selectedIndex,o="select-one"===t.type,a=o?null:[],h=o?r+1:n.length;for(s=r<0?h:o?r:0;s<h;s++)if(((i=n[s]).selected||s===r)&&!i.disabled&&(!i.parentNode.disabled||!O(i.parentNode,"optgroup"))){if(e=C(i).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var i,s,n=t.options,r=C.makeArray(e),o=n.length;o--;)((s=n[o]).selected=C.inArray(C.valHooks.option.get(s),r)>-1)&&(i=!0);return i||(t.selectedIndex=-1),r}}}}),C.each(["radio","checkbox"],(function(){C.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=C.inArray(C(t).val(),e)>-1}},m.checkOn||(C.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),m.focusin="onfocusin"in s;var _e=/^(?:focusinfocus|focusoutblur)$/,Ee=function(t){t.stopPropagation()};C.extend(C.event,{trigger:function(t,e,i,n){var r,o,a,h,l,d,c,u,f=[i||x],g=p.call(t,"type")?t.type:t,m=p.call(t,"namespace")?t.namespace.split("."):[];if(o=u=a=i=i||x,3!==i.nodeType&&8!==i.nodeType&&!_e.test(g+C.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),l=g.indexOf(":")<0&&"on"+g,(t=t[C.expando]?t:new C.Event(g,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),e=null==e?[t]:C.makeArray(e,[t]),c=C.event.special[g]||{},n||!c.trigger||!1!==c.trigger.apply(i,e))){if(!n&&!c.noBubble&&!v(i)){for(h=c.delegateType||g,_e.test(h+g)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(i.ownerDocument||x)&&f.push(a.defaultView||a.parentWindow||s)}for(r=0;(o=f[r++])&&!t.isPropagationStopped();)u=o,t.type=r>1?h:c.bindType||g,(d=(Q.get(o,"events")||Object.create(null))[t.type]&&Q.get(o,"handle"))&&d.apply(o,e),(d=l&&o[l])&&d.apply&&J(o)&&(t.result=d.apply(o,e),!1===t.result&&t.preventDefault());return t.type=g,n||t.isDefaultPrevented()||c._default&&!1!==c._default.apply(f.pop(),e)||!J(i)||l&&y(i[g])&&!v(i)&&((a=i[l])&&(i[l]=null),C.event.triggered=g,t.isPropagationStopped()&&u.addEventListener(g,Ee),i[g](),t.isPropagationStopped()&&u.removeEventListener(g,Ee),C.event.triggered=void 0,a&&(i[l]=a)),t.result}},simulate:function(t,e,i){var s=C.extend(new C.Event,i,{type:t,isSimulated:!0});C.event.trigger(s,null,e)}}),C.fn.extend({trigger:function(t,e){return this.each((function(){C.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return C.event.trigger(t,e,i,!0)}}),m.focusin||C.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=function(t){C.event.simulate(e,t.target,C.event.fix(t))};C.event.special[e]={setup:function(){var s=this.ownerDocument||this.document||this,n=Q.access(s,e);n||s.addEventListener(t,i,!0),Q.access(s,e,(n||0)+1)},teardown:function(){var s=this.ownerDocument||this.document||this,n=Q.access(s,e)-1;n?Q.access(s,e,n):(s.removeEventListener(t,i,!0),Q.remove(s,e))}}}));var Ce=s.location,Te={guid:Date.now()},Ae=/\?/;C.parseXML=function(t){var e,i;if(!t||"string"!=typeof t)return null;try{e=(new s.DOMParser).parseFromString(t,"text/xml")}catch(t){}return i=e&&e.getElementsByTagName("parsererror")[0],e&&!i||C.error("Invalid XML: "+(i?C.map(i.childNodes,(function(t){return t.textContent})).join("\n"):t)),e};var Se=/\[\]$/,Pe=/\r?\n/g,Me=/^(?:submit|button|image|reset|file)$/i,Oe=/^(?:input|select|textarea|keygen)/i;function Le(t,e,i,s){var n;if(Array.isArray(e))C.each(e,(function(e,n){i||Se.test(t)?s(t,n):Le(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,s)}));else if(i||"object"!==_(e))s(t,e);else for(n in e)Le(t+"["+n+"]",e[n],i,s)}C.param=function(t,e){var i,s=[],n=function(t,e){var i=y(e)?e():e;s[s.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!C.isPlainObject(t))C.each(t,(function(){n(this.name,this.value)}));else for(i in t)Le(i,t[i],e,n);return s.join("&")},C.fn.extend({serialize:function(){return C.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=C.prop(this,"elements");return t?C.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!C(this).is(":disabled")&&Oe.test(this.nodeName)&&!Me.test(t)&&(this.checked||!mt.test(t))})).map((function(t,e){var i=C(this).val();return null==i?null:Array.isArray(i)?C.map(i,(function(t){return{name:e.name,value:t.replace(Pe,"\r\n")}})):{name:e.name,value:i.replace(Pe,"\r\n")}})).get()}});var ke=/%20/g,Ie=/#.*$/,Re=/([?&])_=[^&]*/,Be=/^(.*?):[ \t]*([^\r\n]*)$/gm,De=/^(?:GET|HEAD)$/,Ne=/^\/\//,Fe={},Ge={},Ue="*/".concat("*"),je=x.createElement("a");function ze(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var s,n=0,r=e.toLowerCase().match(F)||[];if(y(i))for(;s=r[n++];)"+"===s[0]?(s=s.slice(1)||"*",(t[s]=t[s]||[]).unshift(i)):(t[s]=t[s]||[]).push(i)}}function He(t,e,i,s){var n={},r=t===Ge;function o(a){var h;return n[a]=!0,C.each(t[a]||[],(function(t,a){var l=a(e,i,s);return"string"!=typeof l||r||n[l]?r?!(h=l):void 0:(e.dataTypes.unshift(l),o(l),!1)})),h}return o(e.dataTypes[0])||!n["*"]&&o("*")}function Ye(t,e){var i,s,n=C.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:s||(s={}))[i]=e[i]);return s&&C.extend(!0,t,s),t}je.href=Ce.href,C.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ce.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ce.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ue,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":C.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Ye(Ye(t,C.ajaxSettings),e):Ye(C.ajaxSettings,t)},ajaxPrefilter:ze(Fe),ajaxTransport:ze(Ge),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var i,n,r,o,a,h,l,d,c,u,p=C.ajaxSetup({},e),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?C(f):C.event,m=C.Deferred(),y=C.Callbacks("once memory"),v=p.statusCode||{},b={},w={},_="canceled",E={readyState:0,getResponseHeader:function(t){var e;if(l){if(!o)for(o={};e=Be.exec(r);)o[e[1].toLowerCase()+" "]=(o[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=o[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return l?r:null},setRequestHeader:function(t,e){return null==l&&(t=w[t.toLowerCase()]=w[t.toLowerCase()]||t,b[t]=e),this},overrideMimeType:function(t){return null==l&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(l)E.always(t[E.status]);else for(e in t)v[e]=[v[e],t[e]];return this},abort:function(t){var e=t||_;return i&&i.abort(e),T(0,e),this}};if(m.promise(E),p.url=((t||p.url||Ce.href)+"").replace(Ne,Ce.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(F)||[""],null==p.crossDomain){h=x.createElement("a");try{h.href=p.url,h.href=h.href,p.crossDomain=je.protocol+"//"+je.host!=h.protocol+"//"+h.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=C.param(p.data,p.traditional)),He(Fe,p,e,E),l)return E;for(c in(d=C.event&&p.global)&&0==C.active++&&C.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!De.test(p.type),n=p.url.replace(Ie,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(ke,"+")):(u=p.url.slice(n.length),p.data&&(p.processData||"string"==typeof p.data)&&(n+=(Ae.test(n)?"&":"?")+p.data,delete p.data),!1===p.cache&&(n=n.replace(Re,"$1"),u=(Ae.test(n)?"&":"?")+"_="+Te.guid+++u),p.url=n+u),p.ifModified&&(C.lastModified[n]&&E.setRequestHeader("If-Modified-Since",C.lastModified[n]),C.etag[n]&&E.setRequestHeader("If-None-Match",C.etag[n])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&E.setRequestHeader("Content-Type",p.contentType),E.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ue+"; q=0.01":""):p.accepts["*"]),p.headers)E.setRequestHeader(c,p.headers[c]);if(p.beforeSend&&(!1===p.beforeSend.call(f,E,p)||l))return E.abort();if(_="abort",y.add(p.complete),E.done(p.success),E.fail(p.error),i=He(Ge,p,e,E)){if(E.readyState=1,d&&g.trigger("ajaxSend",[E,p]),l)return E;p.async&&p.timeout>0&&(a=s.setTimeout((function(){E.abort("timeout")}),p.timeout));try{l=!1,i.send(b,T)}catch(t){if(l)throw t;T(-1,t)}}else T(-1,"No Transport");function T(t,e,o,h){var c,u,x,b,w,_=e;l||(l=!0,a&&s.clearTimeout(a),i=void 0,r=h||"",E.readyState=t>0?4:0,c=t>=200&&t<300||304===t,o&&(b=function(t,e,i){for(var s,n,r,o,a=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),void 0===s&&(s=t.mimeType||e.getResponseHeader("Content-Type"));if(s)for(n in a)if(a[n]&&a[n].test(s)){h.unshift(n);break}if(h[0]in i)r=h[0];else{for(n in i){if(!h[0]||t.converters[n+" "+h[0]]){r=n;break}o||(o=n)}r=r||o}if(r)return r!==h[0]&&h.unshift(r),i[r]}(p,E,o)),!c&&C.inArray("script",p.dataTypes)>-1&&C.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),b=function(t,e,i,s){var n,r,o,a,h,l={},d=t.dataTypes.slice();if(d[1])for(o in t.converters)l[o.toLowerCase()]=t.converters[o];for(r=d.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!h&&s&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),h=r,r=d.shift())if("*"===r)r=h;else if("*"!==h&&h!==r){if(!(o=l[h+" "+r]||l["* "+r]))for(n in l)if((a=n.split(" "))[1]===r&&(o=l[h+" "+a[0]]||l["* "+a[0]])){!0===o?o=l[n]:!0!==l[n]&&(r=a[0],d.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+h+" to "+r}}}return{state:"success",data:e}}(p,b,E,c),c?(p.ifModified&&((w=E.getResponseHeader("Last-Modified"))&&(C.lastModified[n]=w),(w=E.getResponseHeader("etag"))&&(C.etag[n]=w)),204===t||"HEAD"===p.type?_="nocontent":304===t?_="notmodified":(_=b.state,u=b.data,c=!(x=b.error))):(x=_,!t&&_||(_="error",t<0&&(t=0))),E.status=t,E.statusText=(e||_)+"",c?m.resolveWith(f,[u,_,E]):m.rejectWith(f,[E,_,x]),E.statusCode(v),v=void 0,d&&g.trigger(c?"ajaxSuccess":"ajaxError",[E,p,c?u:x]),y.fireWith(f,[E,_]),d&&(g.trigger("ajaxComplete",[E,p]),--C.active||C.event.trigger("ajaxStop")))}return E},getJSON:function(t,e,i){return C.get(t,e,i,"json")},getScript:function(t,e){return C.get(t,void 0,e,"script")}}),C.each(["get","post"],(function(t,e){C[e]=function(t,i,s,n){return y(i)&&(n=n||s,s=i,i=void 0),C.ajax(C.extend({url:t,type:e,dataType:n,data:i,success:s},C.isPlainObject(t)&&t))}})),C.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),C._evalUrl=function(t,e,i){return C.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){C.globalEval(t,e,i)}})},C.fn.extend({wrapAll:function(t){var e;return this[0]&&(y(t)&&(t=t.call(this[0])),e=C(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return y(t)?this.each((function(e){C(this).wrapInner(t.call(this,e))})):this.each((function(){var e=C(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=y(t);return this.each((function(i){C(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){C(this).replaceWith(this.childNodes)})),this}}),C.expr.pseudos.hidden=function(t){return!C.expr.pseudos.visible(t)},C.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},C.ajaxSettings.xhr=function(){try{return new s.XMLHttpRequest}catch(t){}};var Ve={0:200,1223:204},We=C.ajaxSettings.xhr();m.cors=!!We&&"withCredentials"in We,m.ajax=We=!!We,C.ajaxTransport((function(t){var e,i;if(m.cors||We&&!t.crossDomain)return{send:function(n,r){var o,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)a[o]=t.xhrFields[o];for(o in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)a.setRequestHeader(o,n[o]);e=function(t){return function(){e&&(e=i=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(Ve[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=e(),i=a.onerror=a.ontimeout=e("error"),void 0!==a.onabort?a.onabort=i:a.onreadystatechange=function(){4===a.readyState&&s.setTimeout((function(){e&&i()}))},e=e("abort");try{a.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),C.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),C.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return C.globalEval(t),t}}}),C.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),C.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(s,n){e=C("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),x.head.appendChild(e[0])},abort:function(){i&&i()}}}));var Ke,qe=[],Xe=/(=)\?(?=&|$)|\?\?/;C.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=qe.pop()||C.expando+"_"+Te.guid++;return this[t]=!0,t}}),C.ajaxPrefilter("json jsonp",(function(t,e,i){var n,r,o,a=!1!==t.jsonp&&(Xe.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Xe.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=y(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Xe,"$1"+n):!1!==t.jsonp&&(t.url+=(Ae.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return o||C.error(n+" was not called"),o[0]},t.dataTypes[0]="json",r=s[n],s[n]=function(){o=arguments},i.always((function(){void 0===r?C(s).removeProp(n):s[n]=r,t[n]&&(t.jsonpCallback=e.jsonpCallback,qe.push(n)),o&&y(r)&&r(o[0]),o=r=void 0})),"script"})),m.createHTMLDocument=((Ke=x.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ke.childNodes.length),C.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(m.createHTMLDocument?((s=(e=x.implementation.createHTMLDocument("")).createElement("base")).href=x.location.href,e.head.appendChild(s)):e=x),r=!i&&[],(n=L.exec(t))?[e.createElement(n[1])]:(n=Et([t],e,r),r&&r.length&&C(r).remove(),C.merge([],n.childNodes)));var s,n,r},C.fn.load=function(t,e,i){var s,n,r,o=this,a=t.indexOf(" ");return a>-1&&(s=ve(t.slice(a)),t=t.slice(0,a)),y(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),o.length>0&&C.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done((function(t){r=arguments,o.html(s?C("<div>").append(C.parseHTML(t)).find(s):t)})).always(i&&function(t,e){o.each((function(){i.apply(this,r||[t.responseText,e,t])}))}),this},C.expr.pseudos.animated=function(t){return C.grep(C.timers,(function(e){return t===e.elem})).length},C.offset={setOffset:function(t,e,i){var s,n,r,o,a,h,l=C.css(t,"position"),d=C(t),c={};"static"===l&&(t.style.position="relative"),a=d.offset(),r=C.css(t,"top"),h=C.css(t,"left"),("absolute"===l||"fixed"===l)&&(r+h).indexOf("auto")>-1?(o=(s=d.position()).top,n=s.left):(o=parseFloat(r)||0,n=parseFloat(h)||0),y(e)&&(e=e.call(t,i,C.extend({},a))),null!=e.top&&(c.top=e.top-a.top+o),null!=e.left&&(c.left=e.left-a.left+n),"using"in e?e.using.call(t,c):d.css(c)}},C.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){C.offset.setOffset(this,t,e)}));var e,i,s=this[0];return s?s.getClientRects().length?(e=s.getBoundingClientRect(),i=s.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,s=this[0],n={top:0,left:0};if("fixed"===C.css(s,"position"))e=s.getBoundingClientRect();else{for(e=this.offset(),i=s.ownerDocument,t=s.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===C.css(t,"position");)t=t.parentNode;t&&t!==s&&1===t.nodeType&&((n=C(t).offset()).top+=C.css(t,"borderTopWidth",!0),n.left+=C.css(t,"borderLeftWidth",!0))}return{top:e.top-n.top-C.css(s,"marginTop",!0),left:e.left-n.left-C.css(s,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===C.css(t,"position");)t=t.offsetParent;return t||ot}))}}),C.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;C.fn[t]=function(s){return V(this,(function(t,s,n){var r;if(v(t)?r=t:9===t.nodeType&&(r=t.defaultView),void 0===n)return r?r[e]:t[s];r?r.scrollTo(i?r.pageXOffset:n,i?n:r.pageYOffset):t[s]=n}),t,s,arguments.length)}})),C.each(["top","left"],(function(t,e){C.cssHooks[e]=Kt(m.pixelPosition,(function(t,i){if(i)return i=Wt(t,e),Ut.test(i)?C(t).position()[e]+"px":i}))})),C.each({Height:"height",Width:"width"},(function(t,e){C.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,s){C.fn[s]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),a=i||(!0===n||!0===r?"margin":"border");return V(this,(function(e,i,n){var r;return v(e)?0===s.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===n?C.css(e,i,a):C.style(e,i,n,a)}),e,o?n:void 0,o)}}))})),C.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){C.fn[e]=function(t){return this.on(e,t)}})),C.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,s){return this.on(e,t,i,s)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),C.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){C.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var Je=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;C.proxy=function(t,e){var i,s,n;if("string"==typeof e&&(i=t[e],e=t,t=i),y(t))return s=a.call(arguments,2),n=function(){return t.apply(e||this,s.concat(a.call(arguments)))},n.guid=t.guid=t.guid||C.guid++,n},C.holdReady=function(t){t?C.readyWait++:C.ready(!0)},C.isArray=Array.isArray,C.parseJSON=JSON.parse,C.nodeName=O,C.isFunction=y,C.isWindow=v,C.camelCase=X,C.type=_,C.now=Date.now,C.isNumeric=function(t){var e=C.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},C.trim=function(t){return null==t?"":(t+"").replace(Je,"$1")},void 0===(i=function(){return C}.apply(e,[]))||(t.exports=i);var Ze=s.jQuery,Qe=s.$;return C.noConflict=function(t){return s.$===C&&(s.$=Qe),t&&s.jQuery===C&&(s.jQuery=Ze),C},void 0===n&&(s.jQuery=s.$=C),C}))},379:t=>{"use strict";var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var r={},o=[],a=0;a<t.length;a++){var h=t[a],l=s.base?h[0]+s.base:h[0],d=r[l]||0,c="".concat(l," ").concat(d);r[l]=d+1;var u=i(c),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==u)e[u].references++,e[u].updater(p);else{var f=n(p,s);s.byIndex=a,e.splice(a,0,{identifier:c,updater:f,references:1})}o.push(c)}return o}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var r=s(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<r.length;o++){var a=i(r[o]);e[a].references--}for(var h=s(t,n),l=0;l<r.length;l++){var d=i(r[l]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}r=h}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nc=void 0,(()=>{"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=function(t){return t&&t.Math==Math&&t},s=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||function(){return this}()||Function("return this")(),n={},r=function(t){try{return!!t()}catch(t){return!0}},o=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),a=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),h=a,l=Function.prototype.call,d=h?l.bind(l):function(){return l.apply(l,arguments)},c={},u={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,f=p&&!u.call({1:2},1);c.f=f?function(t){var e=p(this,t);return!!e&&e.enumerable}:u;var g,m,y=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},v=a,x=Function.prototype,b=x.bind,w=x.call,_=v&&b.bind(w,w),E=v?function(t){return t&&_(t)}:function(t){return t&&function(){return w.apply(t,arguments)}},C=E,T=C({}.toString),A=C("".slice),S=function(t){return A(T(t),8,-1)},P=r,M=S,O=Object,L=E("".split),k=P((function(){return!O("z").propertyIsEnumerable(0)}))?function(t){return"String"==M(t)?L(t,""):O(t)}:O,I=function(t){return null==t},R=I,B=TypeError,D=function(t){if(R(t))throw B("Can't call method on "+t);return t},N=k,F=D,G=function(t){return N(F(t))},U="object"==typeof document&&document.all,j={all:U,IS_HTMLDDA:void 0===U&&void 0!==U},z=j.all,H=j.IS_HTMLDDA?function(t){return"function"==typeof t||t===z}:function(t){return"function"==typeof t},Y=H,V=j.all,W=j.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:Y(t)||t===V}:function(t){return"object"==typeof t?null!==t:Y(t)},K=s,q=H,X=function(t){return q(t)?t:void 0},J=function(t,e){return arguments.length<2?X(K[t]):K[t]&&K[t][e]},Z=E({}.isPrototypeOf),Q=s,$=J("navigator","userAgent")||"",tt=Q.process,et=Q.Deno,it=tt&&tt.versions||et&&et.version,st=it&&it.v8;st&&(m=(g=st.split("."))[0]>0&&g[0]<4?1:+(g[0]+g[1])),!m&&$&&(!(g=$.match(/Edge\/(\d+)/))||g[1]>=74)&&(g=$.match(/Chrome\/(\d+)/))&&(m=+g[1]);var nt=m,rt=r,ot=!!Object.getOwnPropertySymbols&&!rt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&nt&&nt<41})),at=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ht=J,lt=H,dt=Z,ct=Object,ut=at?function(t){return"symbol"==typeof t}:function(t){var e=ht("Symbol");return lt(e)&&dt(e.prototype,ct(t))},pt=String,ft=H,gt=TypeError,mt=function(t){if(ft(t))return t;throw gt(function(t){try{return pt(t)}catch(t){return"Object"}}(t)+" is not a function")},yt=I,vt=d,xt=H,bt=W,wt=TypeError,_t={exports:{}},Et=s,Ct=Object.defineProperty,Tt=function(t,e){try{Ct(Et,t,{value:e,configurable:!0,writable:!0})}catch(i){Et[t]=e}return e},At=Tt,St="__core-js_shared__",Pt=s[St]||At(St,{}),Mt=Pt;(_t.exports=function(t,e){return Mt[t]||(Mt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.3",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Ot=D,Lt=Object,kt=E({}.hasOwnProperty),It=Object.hasOwn||function(t,e){return kt(Lt(Ot(t)),e)},Rt=E,Bt=0,Dt=Math.random(),Nt=Rt(1..toString),Ft=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Nt(++Bt+Dt,36)},Gt=s,Ut=_t.exports,jt=It,zt=Ft,Ht=ot,Yt=at,Vt=Ut("wks"),Wt=Gt.Symbol,Kt=Wt&&Wt.for,qt=Yt?Wt:Wt&&Wt.withoutSetter||zt,Xt=function(t){if(!jt(Vt,t)||!Ht&&"string"!=typeof Vt[t]){var e="Symbol."+t;Ht&&jt(Wt,t)?Vt[t]=Wt[t]:Vt[t]=Yt&&Kt?Kt(e):qt(e)}return Vt[t]},Jt=d,Zt=W,Qt=ut,$t=TypeError,te=Xt("toPrimitive"),ee=function(t,e){if(!Zt(t)||Qt(t))return t;var i,s,n=(s=t[te],yt(s)?void 0:mt(s));if(n){if(void 0===e&&(e="default"),i=Jt(n,t,e),!Zt(i)||Qt(i))return i;throw $t("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var i,s;if("string"===e&&xt(i=t.toString)&&!bt(s=vt(i,t)))return s;if(xt(i=t.valueOf)&&!bt(s=vt(i,t)))return s;if("string"!==e&&xt(i=t.toString)&&!bt(s=vt(i,t)))return s;throw wt("Can't convert object to primitive value")}(t,e)},ie=ut,se=function(t){var e=ee(t,"string");return ie(e)?e:e+""},ne=W,re=s.document,oe=ne(re)&&ne(re.createElement),ae=!o&&!r((function(){return 7!=Object.defineProperty((t="div",oe?re.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),he=o,le=d,de=c,ce=y,ue=G,pe=se,fe=It,ge=ae,me=Object.getOwnPropertyDescriptor;n.f=he?me:function(t,e){if(t=ue(t),e=pe(e),ge)try{return me(t,e)}catch(t){}if(fe(t,e))return ce(!le(de.f,t,e),t[e])};var ye={},ve=o&&r((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xe=W,be=String,we=TypeError,_e=function(t){if(xe(t))return t;throw we(be(t)+" is not an object")},Ee=o,Ce=ae,Te=ve,Ae=_e,Se=se,Pe=TypeError,Me=Object.defineProperty,Oe=Object.getOwnPropertyDescriptor;ye.f=Ee?Te?function(t,e,i){if(Ae(t),e=Se(e),Ae(i),"function"==typeof t&&"prototype"===e&&"value"in i&&"writable"in i&&!i.writable){var s=Oe(t,e);s&&s.writable&&(t[e]=i.value,i={configurable:"configurable"in i?i.configurable:s.configurable,enumerable:"enumerable"in i?i.enumerable:s.enumerable,writable:!1})}return Me(t,e,i)}:Me:function(t,e,i){if(Ae(t),e=Se(e),Ae(i),Ce)try{return Me(t,e,i)}catch(t){}if("get"in i||"set"in i)throw Pe("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var Le=ye,ke=y,Ie=o?function(t,e,i){return Le.f(t,e,ke(1,i))}:function(t,e,i){return t[e]=i,t},Re={exports:{}},Be=o,De=It,Ne=Function.prototype,Fe=Be&&Object.getOwnPropertyDescriptor,Ge=De(Ne,"name"),Ue={EXISTS:Ge,PROPER:Ge&&"something"===function(){}.name,CONFIGURABLE:Ge&&(!Be||Be&&Fe(Ne,"name").configurable)},je=H,ze=Pt,He=E(Function.toString);je(ze.inspectSource)||(ze.inspectSource=function(t){return He(t)});var Ye,Ve,We,Ke=ze.inspectSource,qe=H,Xe=s.WeakMap,Je=qe(Xe)&&/native code/.test(String(Xe)),Ze=_t.exports,Qe=Ft,$e=Ze("keys"),ti={},ei=Je,ii=s,si=E,ni=W,ri=Ie,oi=It,ai=Pt,hi=ti,li="Object already initialized",di=ii.TypeError,ci=ii.WeakMap;if(ei||ai.state){var ui=ai.state||(ai.state=new ci),pi=si(ui.get),fi=si(ui.has),gi=si(ui.set);Ye=function(t,e){if(fi(ui,t))throw di(li);return e.facade=t,gi(ui,t,e),e},Ve=function(t){return pi(ui,t)||{}},We=function(t){return fi(ui,t)}}else{var mi=function(t){return $e[t]||($e[t]=Qe(t))}("state");hi[mi]=!0,Ye=function(t,e){if(oi(t,mi))throw di(li);return e.facade=t,ri(t,mi,e),e},Ve=function(t){return oi(t,mi)?t[mi]:{}},We=function(t){return oi(t,mi)}}var yi={set:Ye,get:Ve,has:We,enforce:function(t){return We(t)?Ve(t):Ye(t,{})},getterFor:function(t){return function(e){var i;if(!ni(e)||(i=Ve(e)).type!==t)throw di("Incompatible receiver, "+t+" required");return i}}},vi=r,xi=H,bi=It,wi=o,_i=Ue.CONFIGURABLE,Ei=Ke,Ci=yi.enforce,Ti=yi.get,Ai=Object.defineProperty,Si=wi&&!vi((function(){return 8!==Ai((function(){}),"length",{value:8}).length})),Pi=String(String).split("String"),Mi=Re.exports=function(t,e,i){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!bi(t,"name")||_i&&t.name!==e)&&(wi?Ai(t,"name",{value:e,configurable:!0}):t.name=e),Si&&i&&bi(i,"arity")&&t.length!==i.arity&&Ai(t,"length",{value:i.arity});try{i&&bi(i,"constructor")&&i.constructor?wi&&Ai(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=Ci(t);return bi(s,"source")||(s.source=Pi.join("string"==typeof e?e:"")),t};Function.prototype.toString=Mi((function(){return xi(this)&&Ti(this).source||Ei(this)}),"toString");var Oi=H,Li=ye,ki=Re.exports,Ii=Tt,Ri={},Bi=Math.ceil,Di=Math.floor,Ni=Math.trunc||function(t){var e=+t;return(e>0?Di:Bi)(e)},Fi=Ni,Gi=function(t){var e=+t;return e!=e||0===e?0:Fi(e)},Ui=Gi,ji=Math.max,zi=Math.min,Hi=Gi,Yi=Math.min,Vi=G,Wi=function(t){return(e=t.length)>0?Yi(Hi(e),9007199254740991):0;var e},Ki=function(t){return function(e,i,s){var n,r=Vi(e),o=Wi(r),a=function(t,e){var i=Ui(t);return i<0?ji(i+e,0):zi(i,e)}(s,o);if(t&&i!=i){for(;o>a;)if((n=r[a++])!=n)return!0}else for(;o>a;a++)if((t||a in r)&&r[a]===i)return t||a||0;return!t&&-1}},qi={includes:Ki(!0),indexOf:Ki(!1)},Xi=It,Ji=G,Zi=qi.indexOf,Qi=ti,$i=E([].push),ts=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Ri.f=Object.getOwnPropertyNames||function(t){return function(t,e){var i,s=Ji(t),n=0,r=[];for(i in s)!Xi(Qi,i)&&Xi(s,i)&&$i(r,i);for(;e.length>n;)Xi(s,i=e[n++])&&(~Zi(r,i)||$i(r,i));return r}(t,ts)};var es={};es.f=Object.getOwnPropertySymbols;var is=J,ss=Ri,ns=es,rs=_e,os=E([].concat),as=is("Reflect","ownKeys")||function(t){var e=ss.f(rs(t)),i=ns.f;return i?os(e,i(t)):e},hs=It,ls=as,ds=n,cs=ye,us=r,ps=H,fs=/#|\.prototype\./,gs=function(t,e){var i=ys[ms(t)];return i==xs||i!=vs&&(ps(e)?us(e):!!e)},ms=gs.normalize=function(t){return String(t).replace(fs,".").toLowerCase()},ys=gs.data={},vs=gs.NATIVE="N",xs=gs.POLYFILL="P",bs=gs,ws=s,_s=n.f,Es=Ie,Cs=function(t,e,i,s){s||(s={});var n=s.enumerable,r=void 0!==s.name?s.name:e;if(Oi(i)&&ki(i,r,s),s.global)n?t[e]=i:Ii(e,i);else{try{s.unsafe?t[e]&&(n=!0):delete t[e]}catch(t){}n?t[e]=i:Li.f(t,e,{value:i,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t},Ts=Tt,As=function(t,e,i){for(var s=ls(e),n=cs.f,r=ds.f,o=0;o<s.length;o++){var a=s[o];hs(t,a)||i&&hs(i,a)||n(t,a,r(e,a))}},Ss=bs,Ps=function(t,e){var i,s,n,r,o,a=t.target,h=t.global,l=t.stat;if(i=h?ws:l?ws[a]||Ts(a,{}):(ws[a]||{}).prototype)for(s in e){if(r=e[s],n=t.dontCallGetSet?(o=_s(i,s))&&o.value:i[s],!Ss(h?s:a+(l?".":"#")+s,t.forced)&&void 0!==n){if(typeof r==typeof n)continue;As(r,n)}(t.sham||n&&n.sham)&&Es(r,"sham",!0),Cs(i,s,r,t)}},Ms=s;Ps({global:!0,forced:Ms.globalThis!==Ms},{globalThis:Ms});var Os={};Os[Xt("toStringTag")]="z";var Ls="[object z]"===String(Os),ks=H,Is=S,Rs=Xt("toStringTag"),Bs=Object,Ds="Arguments"==Is(function(){return arguments}()),Ns=Ls?Is:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Bs(t),Rs))?i:Ds?Is(e):"Object"==(s=Is(e))&&ks(e.callee)?"Arguments":s},Fs=Ns,Gs=String,Us=D,js=E("".replace),zs="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Hs=RegExp("^"+zs+zs+"*"),Ys=RegExp(zs+zs+"*$"),Vs=function(t){return function(e){var i=function(t){if("Symbol"===Fs(t))throw TypeError("Cannot convert a Symbol value to a string");return Gs(t)}(Us(e));return 1&t&&(i=js(i,Hs,"")),2&t&&(i=js(i,Ys,"")),i}},Ws={start:Vs(1),end:Vs(2),trim:Vs(3)},Ks=Ue.PROPER,qs=r,Xs="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Js=function(t){return qs((function(){return!!Xs[t]()||"âÂá "!=="âÂá "[t]()||Ks&&Xs[t].name!==t}))},Zs=Ws.start,Qs=Js("trimStart")?function(){return Zs(this)}:"".trimStart;Ps({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==Qs},{trimLeft:Qs}),Ps({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==Qs},{trimStart:Qs});var $s=s,tn=E,en=function(t,e){return tn($s[t].prototype[e])};en("String","trimLeft");var sn=Ws.end,nn=Js("trimEnd")?function(){return sn(this)}:"".trimEnd;if(Ps({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==nn},{trimRight:nn}),Ps({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==nn},{trimEnd:nn}),en("String","trimRight"),"undefined"!=typeof globalThis&&void 0===globalThis.console&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))}),"performance"in globalThis==0&&(globalThis.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in globalThis.performance==0){var rn=Date.now();performance.timing&&performance.timing.navigationStart&&(rn=performance.timing.navigationStart),globalThis.performance.now=function(){return Date.now()-rn}}function on(t){return t.charAt(0).toUpperCase()+t.slice(1)}function an(t){return"string"==typeof t&&(t=t.trim()),!isNaN(t)&&/[+-]?([0-9]*[.])?[0-9]+/.test(t)}function hn(t){var e=t.trim();return"true"===e||"false"===e}function ln(t){for(var e="",i=0;i<t.length;)e+=t.charCodeAt(i++).toString(16);return e}function dn(t){return/^data:(.+);base64,(.+)$/.test(t)}var cn=Object.freeze({__proto__:null,capitalize:on,isNumeric:an,isBoolean:hn,toHex:ln,isDataUrl:dn});const un=["ms","MS","moz","webkit","o"];function pn(t,e){if(t in(e=e||globalThis))return e[t];var i,s=on(t);return un.some((function(t){var n=t+s;return i=n in e?e[n]:void 0})),i}function fn(t,e,i){if(!(t in(i=i||globalThis))){var s=on(t);return un.some((function(t){var n=t+s;if(n in i)return i[n]=e,!0})),!1}i[t]=e}var gn=Object.freeze({__proto__:null,prefixed:pn,setPrefixed:fn});const mn=Math.PI/180,yn=(Math.PI,2*Math.PI),vn=.5*Math.PI;function xn(t){return 0==(t&t-1)}function bn(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function wn(t){return t*mn}function _n(t,e,i){return t<e?e:t>i?i:+t}function En(t,e){return~~(Math.random()*(e-t))+t}function Cn(t,e){return Math.random()*(e-t)+t}function Tn(t,e,i=2){return Math.abs(t-e)<Math.pow(10,-i)/2}function An(t,e){var i=Array.prototype.indexOf.call(t,e);return-1!==i&&Array.prototype.splice.call(t,i,1),t}var Sn=Object.freeze({__proto__:null,remove:An,random:function(t){return t[En(0,t.length)]},weightedRandom:function(t){return t[function(t,e){return~~(Math.pow(Math.random(),2)*(e-t))+t}(0,t.length)]}});const Pn=/^.*(\\|\/|\:)/,Mn=/\.[^\.]*$/;function On(t){return t.replace(Pn,"").replace(Mn,"")}function Ln(t){return t.substring(t.lastIndexOf(".")+1,t.length)}var kn=Object.freeze({__proto__:null,getBasename:On,getExtension:Ln});function In(t,e,...i){return setTimeout(t.bind(e),.01,...i)}function Rn(t,e,i){var s,n=globalThis.performance.now();return"boolean"!=typeof i&&(i=!1),function(){var r=globalThis.performance.now(),o=r-n,a=arguments;if(!(o<e))return n=r,t.apply(null,a);!1===i&&(clearTimeout(s),s=setTimeout((function(){return n=r,t.apply(null,a)}),o))}}var Bn=Object.freeze({__proto__:null,defer:In,throttle:Rn}),Dn=new class{constructor(){this.objectClass={},this.instance_counter=0}register(t,e,i=!1){if(void 0===e)throw new Error("Cannot register object '"+t+"', invalid class");this.objectClass[t]={class:e,pool:i?[]:void 0}}pull(t){for(var e=new Array(arguments.length),i=0;i<arguments.length;i++)e[i]=arguments[i];var s=this.objectClass[t];if(s){var n,r=s.class,o=s.pool;return o&&(n=o.pop())?(e.shift(),"function"==typeof n.onResetEvent&&n.onResetEvent.apply(n,e),this.instance_counter--):(e[0]=r,n=new(r.bind.apply(r,e)),o&&(n.className=t)),n}throw new Error("Cannot instantiate object of type '"+t+"'")}purge(){for(var t in this.objectClass)this.objectClass[t]&&(this.objectClass[t].pool=[]);this.instance_counter=0}push(t,e=!0){if(!this.poolable(t)){if(!0===e)throw new Error("me.pool: object "+t+" cannot be recycled");return!1}return this.objectClass[t.className].pool.push(t),this.instance_counter++,!0}exists(t){return t in this.objectClass}poolable(t){var e=t.className;return void 0!==e&&"function"==typeof t.onResetEvent&&e in this.objectClass&&void 0!==this.objectClass[e].pool}getInstanceCount(){return this.instance_counter}};class Nn{constructor(t=0,e=0){this.onResetEvent(t,e)}onResetEvent(t=0,e=0){return this.x=t,this.y=e,this}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e){return this._set(this.x*t,this.y*(void 0!==e?e:t))}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y))}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new Nn(_n(this.x,t,e),_n(this.y,t,e))}clampSelf(t,e){return this._set(_n(this.x,t,e),_n(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new Nn(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new Nn(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new Nn(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var n=this.x-i,r=this.y-s,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-r*a+i,n*a+r*o+s)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}moveTowards(t,e){var i=Math.atan2(t.y-this.y,t.x-this.x),s=this.distance(t);return 0===s||e>=0&&s<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(_n(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dot(t)/t.length2())}projectN(t){return this.scale(this.dot(t))}clone(){return Dn.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}function Fn(t){return"0123456789ABCDEF".charAt(t-t%16>>4)+"0123456789ABCDEF".charAt(t%16)}function Gn(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}const Un=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,jn=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,zn=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Hn=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,Yn=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;var Vn=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach((function(t){Vn.set(t[0],t[1])}));class Wn{constructor(t=0,e=0,i=0,s=1){this.onResetEvent(t,e,i,s)}onResetEvent(t=0,e=0,i=0,s=1){return void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,s)}get r(){return~~(255*this.glArray[0])}set r(t){this.glArray[0]=_n(~~t||0,0,255)/255}get g(){return~~(255*this.glArray[1])}set g(t){this.glArray[1]=_n(~~t||0,0,255)/255}get b(){return~~(255*this.glArray[2])}set b(t){this.glArray[2]=_n(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t){this.glArray[3]=void 0===t?1:_n(+t,0,1)}setColor(t,e,i,s=1){return this.r=t,this.g=e,this.b=i,this.alpha=s,this}setHSV(t,e,i){var s,n,r,o=Math.floor(6*t),a=6*t-o,h=i*(1-e),l=i*(1-a*e),d=i*(1-(1-a)*e);switch(o%6){case 0:s=i,n=d,r=h;break;case 1:s=l,n=i,r=h;break;case 2:s=h,n=i,r=d;break;case 3:s=h,n=l,r=i;break;case 4:s=d,n=h,r=i;break;case 5:s=i,n=h,r=l}return this.setColor(255*s,255*n,255*r)}setHSL(t,e,i){var s,n,r;if(0===e)s=n=r=i;else{var o=i<.5?i*(1+e):i+e-i*e,a=2*i-o;s=Gn(a,o,t+1/3),n=Gn(a,o,t),r=Gn(a,o,t-1/3)}return this.setColor(255*s,255*n,255*r)}clone(){return Dn.pull("Color").copy(this)}copy(t){return t instanceof Wn?(this.glArray.set(t.glArray),this):this.parseCSS(t)}add(t){return this.glArray[0]=_n(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=_n(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=_n(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=_n(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=_n(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=_n(t,0,1),this.glArray[0]=_n(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=_n(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=_n(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(En(t,e),En(t,e),En(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return Vn.has(t)?this.setColor.apply(this,Vn.get(t)):this.parseRGB(t)}parseRGB(t){var e=Un.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){var i;if(i=Yn.exec(t))return this.setColor(parseInt(i[!1===e?1:2],16),parseInt(i[!1===e?2:3],16),parseInt(i[!1===e?3:4],16),(_n(parseInt(i[!1===e?4:1],16),0,255)/255).toFixed(1));if(i=Hn.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=zn.exec(t)){var s=i[!1===e?1:2],n=i[!1===e?2:3],r=i[!1===e?3:4],o=i[!1===e?4:1];return this.setColor(parseInt(s+s,16),parseInt(n+n,16),parseInt(r+r,16),(_n(parseInt(o+o,16),0,255)/255).toFixed(1))}if(i=jn.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toUint32(t=1){return((255*t&255)<<24)+((255&this.r)<<16)+((255&this.g)<<8)+(255&this.b)}toArray(){return this.glArray}toHex(){return"#"+Fn(this.r)+Fn(this.g)+Fn(this.b)}toHex8(t=this.alpha){return"#"+Fn(this.r)+Fn(this.g)+Fn(this.b)+Fn(255*t)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(t=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+t+")"}}class Kn{constructor(...t){this.onResetEvent(...t)}onResetEvent(){void 0===this.val&&(this.val=new Float32Array(16)),arguments.length&&arguments[0]instanceof Kn?this.copy(arguments[0]):16===arguments.length?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,s,n,r,o,a,h,l,d,c,u,p,f,g){var m=this.val;return m[0]=t,m[1]=e,m[2]=i,m[3]=s,m[4]=n,m[5]=r,m[6]=o,m[7]=a,m[8]=h,m[9]=l,m[10]=d,m[11]=c,m[12]=u,m[13]=p,m[14]=f,m[15]=g,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){var e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){var e=this.val,i=t.val,s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],h=e[5],l=e[6],d=e[7],c=e[8],u=e[9],p=e[10],f=e[11],g=e[12],m=e[13],y=e[14],v=e[15],x=i[0],b=i[1],w=i[2],_=i[3];return e[0]=x*s+b*a+w*c+_*g,e[1]=x*n+b*h+w*u+_*m,e[2]=x*r+b*l+w*p+_*y,e[3]=x*o+b*d+w*f+_*v,x=i[4],b=i[5],w=i[6],_=i[7],e[4]=x*s+b*a+w*c+_*g,e[5]=x*n+b*h+w*u+_*m,e[6]=x*r+b*l+w*p+_*y,e[7]=x*o+b*d+w*f+_*v,x=i[8],b=i[9],w=i[10],_=i[11],e[8]=x*s+b*a+w*c+_*g,e[9]=x*n+b*h+w*u+_*m,e[10]=x*r+b*l+w*p+_*y,e[11]=x*o+b*d+w*f+_*v,x=i[12],b=i[13],w=i[14],_=i[15],e[12]=x*s+b*a+w*c+_*g,e[13]=x*n+b*h+w*u+_*m,e[14]=x*r+b*l+w*p+_*y,e[15]=x*o+b*d+w*f+_*v,this}transpose(){var t=this.val,e=t[1],i=t[2],s=t[3],n=t[6],r=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=n,t[11]=t[14],t[12]=s,t[13]=r,t[14]=o,this}invert(){var t=this.val,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],d=t[9],c=t[10],u=t[11],p=t[12],f=t[13],g=t[14],m=t[15],y=e*o-i*r,v=e*a-s*r,x=e*h-n*r,b=i*a-s*o,w=i*h-n*o,_=s*h-n*a,E=l*f-d*p,C=l*g-c*p,T=l*m-u*p,A=d*g-c*f,S=d*m-u*f,P=c*m-u*g,M=y*P-v*S+x*A+b*T-w*C+_*E;return M?(M=1/M,t[0]=(o*P-a*S+h*A)*M,t[1]=(s*S-i*P-n*A)*M,t[2]=(f*_-g*w+m*b)*M,t[3]=(c*w-d*_-u*b)*M,t[4]=(a*T-r*P-h*C)*M,t[5]=(e*P-s*T+n*C)*M,t[6]=(g*x-p*_-m*v)*M,t[7]=(l*_-c*x+u*v)*M,t[8]=(r*S-o*T+h*E)*M,t[9]=(i*T-e*S-n*E)*M,t[10]=(p*w-f*x+m*y)*M,t[11]=(d*x-l*w-u*y)*M,t[12]=(o*C-r*A-a*E)*M,t[13]=(e*A-i*C+s*E)*M,t[14]=(f*v-p*b-g*y)*M,t[15]=(l*b-d*v+c*y)*M,this):null}apply(t){var e=this.val,i=t.x,s=t.y,n=void 0!==t.z?t.z:1,r=e[3]*i+e[7]*s+e[11]*n+e[15]||1;return t.x=(e[0]*i+e[4]*s+e[8]*n+e[12])/r,t.y=(e[1]*i+e[5]*s+e[9]*n+e[13])/r,void 0!==t.z&&(t.z=(e[2]*i+e[6]*s+e[10]*n+e[14])/r),t}applyInverse(t){var e=Dn.pull("Matrix3d",this).invert();return e.apply(t),Dn.push(e),t}ortho(t,e,i,s,n,r){var o=this.val,a=1/(t-e),h=1/(i-s),l=1/(n-r);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*l,o[11]=0,o[12]=(t+e)*a,o[13]=(s+i)*h,o[14]=(r+n)*l,o[15]=1,this}scale(t,e,i){var s=this.val,n=t,r=void 0===e?n:e,o=void 0===i?0:i;return s[0]=s[0]*n,s[1]=s[1]*n,s[2]=s[2]*n,s[3]=s[3]*n,s[4]=s[4]*r,s[5]=s[5]*r,s[6]=s[6]*r,s[7]=s[7]*r,s[8]=s[8]*o,s[9]=s[9]*o,s[10]=s[10]*o,s[11]=s[11]*o,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){if(0!==t){var i,s,n,r,o,a,h,l,d,c,u,p,f,g,m,y,v,x,b,w,_,E,C,T,A=this.val,S=e.x,P=e.y,M=e.z,O=Math.sqrt(S*S+P*P+M*M);if(O<1e-6)return null;S*=O=1/O,P*=O,M*=O,i=Math.sin(t),n=1-(s=Math.cos(t)),r=A[0],o=A[1],a=A[2],h=A[3],l=A[4],d=A[5],c=A[6],u=A[7],p=A[8],f=A[9],g=A[10],m=A[11],y=S*S*n+s,v=P*S*n+M*i,x=M*S*n-P*i,b=S*P*n-M*i,w=P*P*n+s,_=M*P*n+S*i,E=S*M*n+P*i,C=P*M*n-S*i,T=M*M*n+s,A[0]=r*y+l*v+p*x,A[1]=o*y+d*v+f*x,A[2]=a*y+c*v+g*x,A[3]=h*y+u*v+m*x,A[4]=r*b+l*w+p*_,A[5]=o*b+d*w+f*_,A[6]=a*b+c*w+g*_,A[7]=h*b+u*w+m*_,A[8]=r*E+l*C+p*T,A[9]=o*E+d*C+f*T,A[10]=a*E+c*C+g*T,A[11]=h*E+u*C+m*T}return this}translate(){var t,e,i,s=this.val;return arguments.length>1?(t=arguments[0],e=arguments[1],i=void 0===arguments[2]?0:arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=void 0===arguments[0].z?0:arguments[0].z),s[12]=s[0]*t+s[4]*e+s[8]*i+s[12],s[13]=s[1]*t+s[5]*e+s[9]*i+s[13],s[14]=s[2]*t+s[6]*e+s[10]*i+s[14],s[15]=s[3]*t+s[7]*e+s[11]*i+s[15],this}isIdentity(){var t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return Dn.pull("Matrix3d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}class qn{constructor(...t){this.onResetEvent(...t)}onResetEvent(){return void 0===this.val&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof qn?this.copy(arguments[0]):arguments.length&&arguments[0]instanceof Kn?this.fromMat3d(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity(),this}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){var t=this.val;return 9===arguments.length?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):6===arguments.length&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}copy(t){return this.val.set(t.val),this}fromMat3d(t){var e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){var e=t.val,i=this.val,s=i[0],n=i[1],r=i[3],o=i[4],a=e[0],h=e[1],l=e[3],d=e[4],c=e[6],u=e[7];return i[0]=s*a+r*h,i[1]=n*a+o*h,i[3]=s*l+r*d,i[4]=n*l+o*d,i[6]+=s*c+r*u,i[7]+=n*c+o*u,this}transpose(){var t=this.val,e=t[1],i=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=s,this}invert(){var t=this.val,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],d=l*r-o*h,c=o*a-l*n,u=h*n-r*a,p=e*d+i*c+s*u;return t[0]=d/p,t[1]=(s*h-l*i)/p,t[2]=(o*i-s*r)/p,t[3]=c/p,t[4]=(l*e-s*a)/p,t[5]=(s*n-o*e)/p,t[6]=u/p,t[7]=(i*a-h*e)/p,t[8]=(r*e-i*n)/p,this}apply(t){var e=this.val,i=t.x,s=t.y,n=void 0!==t.z?t.z:1;return t.x=i*e[0]+s*e[3]+n*e[6],t.y=i*e[1]+s*e[4]+n*e[7],void 0!==t.z&&(t.z=i*e[2]+s*e[5]+n*e[8]),t}applyInverse(t){var e=this.val,i=t.x,s=t.y,n=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*n*i+-e[3]*n*s+(e[7]*e[3]-e[6]*e[4])*n,t.y=e[0]*n*s+-e[1]*n*i+(-e[7]*e[0]+e[6]*e[1])*n,t}scale(t,e){var i=this.val,s=t,n=void 0===e?s:e;return i[0]*=s,i[1]*=s,i[3]*=n,i[4]*=n,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(0!==t){var e=this.val,i=e[0],s=e[1],n=e[2],r=e[3],o=e[4],a=e[5],h=Math.sin(t),l=Math.cos(t);e[0]=l*i+h*r,e[1]=l*s+h*o,e[2]=l*n+h*a,e[3]=l*r-h*i,e[4]=l*o-h*s,e[5]=l*a-h*n}return this}translate(){var t,e,i=this.val;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),i[6]+=i[0]*t+i[3]*e,i[7]+=i[1]*t+i[4]*e,this}isIdentity(){var t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return Dn.pull("Matrix2d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}var Xn={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,s,r,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new n(s,r||t,o),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,n=[];if(0===this._eventsCount)return n;for(s in t=this._events)e.call(t,s)&&n.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,r=s.length,o=new Array(r);n<r;n++)o[n]=s[n].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,n,r,o){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,s),!0;case 4:return d.fn.call(d.context,e,s,n),!0;case 5:return d.fn.call(d.context,e,s,n,r),!0;case 6:return d.fn.call(d.context,e,s,n,r,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];d.fn.apply(d.context,h)}else{var u,p=d.length;for(l=0;l<p;l++)switch(d[l].once&&this.removeListener(t,d[l].fn,void 0,!0),c){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,e);break;case 3:d[l].fn.call(d[l].context,e,s);break;case 4:d[l].fn.call(d[l].context,e,s,n);break;default:if(!h)for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];d[l].fn.apply(d[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,s,n){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||n&&!a.once||s&&a.context!==s||o(this,r);else{for(var h=0,l=[],d=a.length;h<d;h++)(a[h].fn!==e||n&&!a[h].once||s&&a[h].context!==s)&&l.push(a[h]);l.length?this._events[r]=1===l.length?l[0]:l:o(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(Xn);var Jn=new(0,Xn.exports);const Zn="dom_ready",Qn="me.boot",$n="me.state.onPause",tr="me.state.onResume",er="me.state.onStop",ir="me.state.onRestart",sr="me.state.onChange",nr="me.video.onInit",rr="me.game.onInit",or="me.game.onReset",ar="me.game.beforeUpdate",hr="me.game.afterUpdate",lr="me.game.onUpdate",dr="me.game.beforeDraw",cr="me.game.afterDraw",ur="me.game.onLevelLoaded",pr="me.loader.onload",fr="me.loader.onProgress",gr="me.input.keydown",mr="me.input.keyup",yr="gamepad.connected",vr="gamepad.disconnected",xr="gamepad.update",br="me.event.pointermove",wr="me.event.pointerlockChange",_r="globalThis.onresize",Er="canvas.onresize",Cr="viewport.onresize",Tr="globalThis.orientationchange",Ar="globalThis.onscroll",Sr="viewport.onchange",Pr="renderer.contextlost",Mr="renderer.contextrestored";function Or(t,...e){return Jn.emit(t,...e)}function Lr(t,e,i){return Jn.on(t,e,i)}function kr(t,e,i){return Jn.once(t,e,i)}function Ir(t,e){return Jn.off(t,e)}var Rr=Object.freeze({__proto__:null,DOM_READY:Zn,BOOT:Qn,STATE_PAUSE:$n,STATE_RESUME:tr,STATE_STOP:er,STATE_RESTART:ir,STATE_CHANGE:sr,VIDEO_INIT:nr,GAME_INIT:rr,GAME_RESET:or,GAME_BEFORE_UPDATE:ar,GAME_AFTER_UPDATE:hr,GAME_UPDATE:lr,GAME_BEFORE_DRAW:dr,GAME_AFTER_DRAW:cr,LEVEL_LOADED:ur,LOADER_COMPLETE:pr,LOADER_PROGRESS:fr,KEYDOWN:gr,KEYUP:mr,GAMEPAD_CONNECTED:yr,GAMEPAD_DISCONNECTED:vr,GAMEPAD_UPDATE:xr,POINTERMOVE:br,POINTERLOCKCHANGE:wr,DRAGSTART:"me.game.dragstart",DRAGEND:"me.game.dragend",WINDOW_ONRESIZE:_r,CANVAS_ONRESIZE:Er,VIEWPORT_ONRESIZE:Cr,WINDOW_ONORIENTATION_CHANGE:Tr,WINDOW_ONSCROLL:Ar,VIEWPORT_ONCHANGE:Sr,ONCONTEXT_LOST:Pr,ONCONTEXT_RESTORED:Mr,emit:Or,on:Lr,once:kr,off:Ir}),Br={};let Dr=!1;try{Dr="undefined"!=typeof globalThis&&void 0!==globalThis.localStorage}catch(t){Dr=!1}function Nr(t){return"add"===t||"remove"===t}Lr(Qn,(()=>{if(!0===Dr){var t=globalThis.localStorage.getItem("me.save");"string"==typeof t&&t.length>0&&(JSON.parse(t)||[]).forEach((function(t){Br[t]=JSON.parse(globalThis.localStorage.getItem("me.save."+t))}))}}));var Fr={add(t){var e=Fr;Object.keys(t).forEach((function(i){var s;Nr(i)||(s=i,Object.defineProperty(e,s,{configurable:!0,enumerable:!0,get:()=>Br[s],set(t){Br[s]=t,!0===Dr&&globalThis.localStorage.setItem("me.save."+s,JSON.stringify(t))}}),i in Br||(e[i]=t[i]))})),!0===Dr&&globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Br)))},remove(t){Nr(t)||void 0!==Br[t]&&(delete Br[t],!0===Dr&&(globalThis.localStorage.removeItem("me.save."+t),globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Br)))))}};let Gr=!1,Ur=!1;function jr(){if(!Ur){if(void 0!==globalThis.document&&!globalThis.document.body)return setTimeout(jr,13);void 0!==globalThis.document&&"function"==typeof globalThis.document.removeEventListener&&globalThis.document.removeEventListener("DOMContentLoaded",jr,!1),"function"==typeof globalThis.removeEventListener&&globalThis.removeEventListener("load",jr,!1),Or(Zn),Ur=!0}}const zr=void 0!==globalThis.navigator?globalThis.navigator.userAgent:"",Hr=/iPhone|iPad|iPod/i.test(zr),Yr=/Android/i.test(zr),Vr=/Android 2/i.test(zr),Wr=/Linux/i.test(zr),Kr=/CrOS/.test(zr),qr=/Windows Phone/i.test(zr),Xr=/BlackBerry/i.test(zr),Jr=/Kindle|Silk.*Mobile Safari/i.test(zr),Zr=void 0!==globalThis.ejecta,Qr=/MicroMessenger/i.test(zr),$r=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name,to=/Mobi/i.test(zr)||Hr||Yr||qr||Xr||Jr||!1;let eo=!1,io=!1,so=!0,no={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function ro(t){return t.preventDefault(),"function"==typeof globalThis.scroll&&globalThis.scroll(0,0),!1}function oo(t){Mo=t.accelerationIncludingGravity.x,Oo=t.accelerationIncludingGravity.y,Lo=t.accelerationIncludingGravity.z}function ao(t){ko=t.gamma,Io=t.beta,Ro=t.alpha}let ho=Object.freeze({__proto__:null,ua:zr,iOS:Hr,android:Yr,android2:Vr,linux:Wr,chromeOS:Kr,wp:qr,BlackBerry:Xr,Kindle:Jr,ejecta:Zr,isWeixin:Qr,nodeJS:$r,isMobile:to});const lo=!!("ontouchstart"in globalThis),co=!!globalThis.PointerEvent,uo=lo||co,po=uo?co?globalThis.navigator.maxTouchPoints||1:10:1,fo=void 0!==globalThis.document&&"onwheel"in globalThis.document.createElement("div"),go=void 0!==globalThis.document&&void 0!==globalThis.document.pointerLockElement,mo=!!globalThis.DeviceOrientationEvent,yo="undefined"!=typeof screen&&void 0!==screen.orientation,vo=!!globalThis.DeviceMotionEvent,xo=void 0!==globalThis.document&&(pn("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);!0===xo&&(globalThis.document.exitFullscreen=pn("cancelFullScreen",globalThis.document)||pn("exitFullscreen",globalThis.document));const bo=!(!globalThis.AudioContext&&!globalThis.webkitAudioContext),wo=void 0!==globalThis.Audio,_o=bo||wo,Eo=function(){try{return!!globalThis.localStorage}catch(t){return!1}}(),Co=function(){try{return void 0!==globalThis.OffscreenCanvas&&null!==new globalThis.OffscreenCanvas(0,0).getContext("2d")}catch(t){return!1}}(),To="function"==typeof globalThis.atob,Ao=void 0!==globalThis.navigator&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",So=globalThis.devicePixelRatio||1,Po=ho.isMobile;let Mo=0,Oo=0,Lo=0,ko=0,Io=0,Ro=0;function Bo(t){!function(t){Ur?t.call(globalThis,[]):(kr(Zn,t,globalThis),Gr||("undefined"!=typeof process&&"node"===process.release.name||void 0!==globalThis.document&&"complete"===globalThis.document.readyState?globalThis.setTimeout(jr,0):(void 0!==globalThis.document&&"function"==typeof globalThis.document.addEventListener&&globalThis.document.addEventListener("DOMContentLoaded",jr,!1),globalThis.addEventListener("load",jr,!1)),Gr=!0))}(t)}function Do(t){let e=co?"pointermove":lo?"touchmove":"mousemove";!1!==t?!1===so&&(globalThis.document.removeEventListener(e,ro),so=!0):!0===so&&(globalThis.document.addEventListener(e,ro,{passive:!1}),so=!1)}function No(){return!(!xo||!pn("fullscreenElement",document)&&!document.mozFullScreenElement)}function Fo(){const t="portrait",e="landscape";let i=globalThis.screen;if(!0===yo){let t=pn("orientation",i);if(void 0!==t&&"string"==typeof t.type)return t.type;if("string"==typeof t)return t}return"number"==typeof globalThis.orientation?90===Math.abs(globalThis.orientation)?e:t:globalThis.outerWidth>globalThis.outerHeight?e:t}function Go(t){let e=Uo(t);return null!==e.parentNode&&(e=e.parentNode),e}function Uo(t){let e=null;return"undefined"!==t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE&&(e=t)),e||(e=document.body),e}function jo(t){return"object"==typeof t&&t!==document.body&&void 0!==t.getBoundingClientRect?t.getBoundingClientRect():(no.width=no.right=globalThis.innerWidth,no.height=no.bottom=globalThis.innerHeight,no)}function zo(t){return jo(Go(t))}function Ho(t){let e=!1;try{let i=document.createElement("canvas"),s={stencil:!0,failIfMajorPerformanceCaveat:t.failIfMajorPerformanceCaveat};e=!(!globalThis.WebGLRenderingContext||!i.getContext("webgl",s)&&!i.getContext("experimental-webgl",s))}catch(t){e=!1}return e}function Yo(t){return t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0?"highp":t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function Vo(){"function"==typeof globalThis.focus&&globalThis.focus()}var Wo=Object.freeze({__proto__:null,onDeviceRotate:ao,platform:ho,touchEvent:lo,pointerEvent:co,touch:uo,maxTouchPoints:po,wheel:fo,hasPointerLockSupport:go,hasDeviceOrientation:mo,screenOrientation:yo,hasAccelerometer:vo,hasFullscreenSupport:xo,hasWebAudio:bo,hasHTML5Audio:wo,sound:_o,localStorage:Eo,offscreenCanvas:Co,nativeBase64:To,language:Ao,devicePixelRatio:So,isMobile:Po,get accelerationX(){return Mo},get accelerationY(){return Oo},get accelerationZ(){return Lo},get gamma(){return ko},get beta(){return Io},get alpha(){return Ro},pauseOnBlur:!0,resumeOnFocus:!0,autoFocus:!0,stopOnBlur:!1,onReady:Bo,enableSwipe:Do,isFullscreen:No,requestFullscreen:function(t){xo&&!No()&&((t=t||wc()).requestFullscreen=pn("requestFullscreen",t)||t.mozRequestFullScreen,t.requestFullscreen())},exitFullscreen:function(){xo&&No()&&document.exitFullscreen()},getScreenOrientation:Fo,lockOrientation:function(t){let e=globalThis.screen;if(void 0!==e){let i=pn("lockOrientation",e);if(void 0!==i)return i(t)}return!1},unlockOrientation:function(){let t=globalThis.screen;if(void 0!==t){let e=pn("unlockOrientation",t);if(void 0!==e)return e()}return!1},isPortrait:function(){return Fo().includes("portrait")},isLandscape:function(){return Fo().includes("landscape")},getStorage:function(t="local"){if("local"===t)return Fr;throw new Error("storage type "+t+" not supported")},getParentElement:Go,getElement:Uo,getElementBounds:jo,getParentBounds:zo,isWebGLSupported:Ho,getMaxShaderPrecision:Yo,focus:Vo,watchAccelerometer:function(){return vo&&!eo&&(DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(globalThis.addEventListener("devicemotion",oo,!1),eo=!0)})).catch(console.error):(globalThis.addEventListener("devicemotion",oo,!1),eo=!0)),eo},unwatchAccelerometer:function(){eo&&(globalThis.removeEventListener("devicemotion",oo,!1),eo=!1)},watchDeviceOrientation:function(){return mo&&!io&&("function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(globalThis.addEventListener("deviceorientation",ao,!1),io=!0)})).catch(console.error):(globalThis.addEventListener("deviceorientation",ao,!1),io=!0)),io},unwatchDeviceOrientation:function(){io&&(globalThis.removeEventListener("deviceorientation",ao,!1),io=!1)},vibrate:function(t){void 0!==globalThis.navigator&&"function"==typeof globalThis.navigator.vibrate&&globalThis.navigator.vibrate(t)}});const Ko={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function qo(t,e,i){var s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s));return s}function Xo(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;"+t:t}function Jo(t){return(t=(t=(t=t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/(\\n\s+)|(\s+\\n)/g,"")).replace(/(\\r|\\n)+/g,"")).replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}class Zo{constructor(t,e,i,s){this.gl=t,this.vertex=Xo(Jo(e),s||Yo(this.gl)),this.fragment=Xo(Jo(i),s||Yo(this.gl)),this.attributes=function(t,e){for(var i,s={},n=/attribute\s+\w+\s+(\w+)/g,r=0;i=n.exec(e.vertex);)s[i[1]]=r++;return s}(this.gl,this),this.program=function(t,e,i,s){var n=qo(t,t.VERTEX_SHADER,e),r=qo(t,t.FRAGMENT_SHADER,i),o=t.createProgram();for(var a in t.attachShader(o,n),t.attachShader(o,r),s)t.bindAttribLocation(o,s[a],a);if(t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var h="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+t.getProgramParameter(o,t.VALIDATE_STATUS)+"\ngl.getError()"+t.getError()+"\ngl.getProgramInfoLog()"+t.getProgramInfoLog(o);throw t.deleteProgram(o),o=null,new Error(h)}return t.useProgram(o),t.deleteShader(n),t.deleteShader(r),o}(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=function(t,e){var i,s={},n=/uniform\s+(\w+)\s+(\w+)/g,r={},o={},a={};return[e.vertex,e.fragment].forEach((function(t){for(;i=n.exec(t);)r[i[2]]=i[1]})),Object.keys(r).forEach((function(i){var s=r[i];a[i]=t.getUniformLocation(e.program,i),o[i]={get:function(t){return function(){return a[t]}}(i),set:function(e,i,s){return 0===i.indexOf("mat")?function(i){t[s](a[e],!1,i)}:function(i){var n=s;i.length&&"v"!==s.slice(-1)&&(n+="v"),t[n](a[e],i)}}(i,s,"uniform"+Ko[s])}})),Object.defineProperties(s,o),s}(this.gl,this),Lr(Pr,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){var e=this.attributes[t];return void 0!==e?e:-1}setUniform(t,e){var i=this.uniforms;if(void 0===i[t])throw new Error("undefined ("+t+") uniform for shader "+this);"object"==typeof e&&"function"==typeof e.toArray?i[t]=e.toArray():i[t]=e}setVertexAttributes(t,e,i){for(var s=0;s<e.length;++s){var n=e[s],r=this.getAttribLocation(n.name);-1!==r?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,n.size,n.type,n.normalized,i,n.offset)):t.disableVertexAttribArray(s)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class Qo{constructor(t,e){this.vertexSize=t,this.quadSize=e,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(t=this.quadSize){return this.vertexCount+t>=this.maxVertex}resize(){this.maxVertex<<=1;var t=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(t),this}push(t,e,i,s,n){var r=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(),this.bufferF32[r+0]=t,this.bufferF32[r+1]=e,void 0!==i&&(this.bufferF32[r+2]=i,this.bufferF32[r+3]=s),void 0!==n&&(this.bufferU32[r+4]=n),this.vertexCount++,this}toFloat32(t,e){return void 0!==e?this.bufferF32.subarray(t,e):this.bufferF32}toUint32(t,e){return void 0!==e?this.bufferU32.subarray(t,e):this.bufferU32}length(){return this.vertexCount}isEmpty(){return 0===this.vertexCount}}var $o=[new Nn,new Nn,new Nn,new Nn];class ta{constructor(t){this.init(t)}init(t){var e=t.gl;this.currentTextureUnit=-1,this.boundTextures=[],this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.viewMatrix=t.currentTransform,this.activeShader=null,this.mode=e.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.primitiveShader=new Zo(this.gl,"// Current vertex point\nattribute vec2 aVertex;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\n// Vertex color\nuniform vec4 uColor;\n\n// Fragment color\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(uColor.rgb * uColor.a, uColor.a);\n}\n","varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n"),this.quadShader=new Zo(this.gl,"attribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n     gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n","uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n"),this.addAttribute("aVertex",2,e.FLOAT,!1,0*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aRegion",2,e.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aColor",4,e.UNSIGNED_BYTE,!0,4*Float32Array.BYTES_PER_ELEMENT),this.vertexBuffer=new Qo(this.vertexSize,6),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,this.vertexBuffer.buffer,e.STREAM_DRAW),Lr(Er,((t,e)=>{this.flush(),this.setViewport(0,0,t,e)}))}reset(){this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.renderer.getCanvas().width,this.renderer.getCanvas().height),this.clearColor(0,0,0,0);for(var t=0;t<this.renderer.maxTextures;t++){var e=this.getTexture2D(t);void 0!==e&&this.deleteTexture2D(e)}this.currentTextureUnit=-1,this.useShader(this.quadShader)}addAttribute(t,e,i,s,n){switch(this.attributes.push({name:t,size:e,type:i,normalized:s,offset:n}),i){case this.gl.BYTE:this.vertexByteSize+=e*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=e*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=e*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=e*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=e*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=e*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=e*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setViewport(t,e,i,s){this.gl.viewport(t,e,i,s)}createTexture2D(t,e,i,s="no-repeat",n,r,o,a=!0,h=!0){var l=this.gl,d=xn(n||e.width)&&xn(r||e.height),c=l.createTexture(),u=0===s.search(/^repeat(-x)?$/)&&(d||this.renderer.WebGLVersion>1)?l.REPEAT:l.CLAMP_TO_EDGE,p=0===s.search(/^repeat(-y)?$/)&&(d||this.renderer.WebGLVersion>1)?l.REPEAT:l.CLAMP_TO_EDGE;return this.bindTexture2D(c,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,p),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,i),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),n||r||o?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,n,r,o,l.RGBA,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,e),d&&!1!==h&&l.generateMipmap(l.TEXTURE_2D),c}deleteTexture2D(t){this.gl.deleteTexture(t),this.unbindTexture2D(t)}getTexture2D(t){return this.boundTextures[t]}bindTexture2D(t,e){var i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}unbindTexture2D(t,e){return void 0===e&&(e=this.boundTextures.indexOf(t)),-1!==e&&(delete this.boundTextures[e],e===this.currentTextureUnit&&(this.currentTextureUnit=-1)),e}uploadTexture(t,e,i,s,n=!1){var r=this.renderer.cache.getUnit(t),o=this.boundTextures[r];return void 0===o||n?this.createTexture2D(r,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,s,t.premultipliedAlpha):this.bindTexture2D(o,r),this.currentTextureUnit}setProjection(t){this.activeShader.setUniform("uProjectionMatrix",t)}useShader(t){this.activeShader!==t&&(this.flush(),this.activeShader=t,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),this.activeShader.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize))}addQuad(t,e,i,s,n,r,o,a,h,l){if(!(this.color.alpha<1/255)){this.useShader(this.quadShader),this.vertexBuffer.isFull(6)&&this.flush();var d=this.uploadTexture(t);this.quadShader.setUniform("uSampler",d);var c=this.viewMatrix,u=$o[0].set(e,i),p=$o[1].set(e+s,i),f=$o[2].set(e,i+n),g=$o[3].set(e+s,i+n);c.isIdentity()||(c.apply(u),c.apply(p),c.apply(f),c.apply(g)),this.vertexBuffer.push(u.x,u.y,r,o,l),this.vertexBuffer.push(p.x,p.y,a,o,l),this.vertexBuffer.push(f.x,f.y,r,h,l),this.vertexBuffer.push(f.x,f.y,r,h,l),this.vertexBuffer.push(p.x,p.y,a,o,l),this.vertexBuffer.push(g.x,g.y,a,h,l)}}flush(t=this.mode){var e=this.vertexBuffer,i=e.vertexCount;if(i>0){var s=this.gl,n=e.vertexSize;this.renderer.WebGLVersion>1?s.bufferData(s.ARRAY_BUFFER,e.toFloat32(),s.STREAM_DRAW,0,i*n):s.bufferData(s.ARRAY_BUFFER,e.toFloat32(0,i*n),s.STREAM_DRAW),s.drawArrays(t,0,i),e.clear()}}drawVertices(t,e,i=e.length){this.useShader(this.primitiveShader),this.primitiveShader.setUniform("uColor",this.color);for(var s=this.viewMatrix,n=this.vertexBuffer,r=s.isIdentity(),o=0;o<i;o++)r||s.apply(e[o]),n.push(e[o].x,e[o].y);this.flush(t)}clear(t=0){var e=this.gl;e.clearColor(0,0,0,t),e.clear(e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}clearColor(t=0,e=0,i=0,s=0){var n=this.gl;n.clearColor(t,e,i,s),n.clear(n.COLOR_BUFFER_BIT)}}var ea={exports:{}};function ia(t,e,i){i=i||2;var s,n,r,o,a,h,l,d=e&&e.length,c=d?e[0]*i:t.length,u=sa(t,0,c,i,!0),p=[];if(!u||u.next===u.prev)return p;if(d&&(u=function(t,e,i,s){var n,r,o,a=[];for(n=0,r=e.length;n<r;n++)(o=sa(t,e[n]*s,n<r-1?e[n+1]*s:t.length,s,!1))===o.next&&(o.steiner=!0),a.push(fa(o));for(a.sort(da),n=0;n<a.length;n++)i=ca(a[n],i);return i}(t,e,u,i)),t.length>80*i){s=r=t[0],n=o=t[1];for(var f=i;f<c;f+=i)(a=t[f])<s&&(s=a),(h=t[f+1])<n&&(n=h),a>r&&(r=a),h>o&&(o=h);l=0!==(l=Math.max(r-s,o-n))?32767/l:0}return ra(u,p,i,s,n,l,0),p}function sa(t,e,i,s,n){var r,o;if(n===Sa(t,e,i,s)>0)for(r=e;r<i;r+=s)o=Ca(r,t[r],t[r+1],o);else for(r=i-s;r>=e;r-=s)o=Ca(r,t[r],t[r+1],o);return o&&va(o,o.next)&&(Ta(o),o=o.next),o}function na(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!va(s,s.next)&&0!==ya(s.prev,s,s.next))s=s.next;else{if(Ta(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function ra(t,e,i,s,n,r,o){if(t){!o&&r&&function(t,e,i,s){var n=t;do{0===n.z&&(n.z=pa(n.x,n.y,e,i,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,s,n,r,o,a,h,l=1;do{for(i=t,t=null,r=null,o=0;i;){for(o++,s=i,a=0,e=0;e<l&&(a++,s=s.nextZ);e++);for(h=l;a>0||h>0&&s;)0!==a&&(0===h||!s||i.z<=s.z)?(n=i,i=i.nextZ,a--):(n=s,s=s.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;i=s}r.nextZ=null,l*=2}while(o>1)}(n)}(t,s,n,r);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?aa(t,s,n,r):oa(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),Ta(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?ra(t=ha(na(t),e,i),e,i,s,n,r,2):2===o&&la(t,e,i,s,n,r):ra(na(t),e,i,s,n,r,1);break}}}function oa(t){var e=t.prev,i=t,s=t.next;if(ya(e,i,s)>=0)return!1;for(var n=e.x,r=i.x,o=s.x,a=e.y,h=i.y,l=s.y,d=n<r?n<o?n:o:r<o?r:o,c=a<h?a<l?a:l:h<l?h:l,u=n>r?n>o?n:o:r>o?r:o,p=a>h?a>l?a:l:h>l?h:l,f=s.next;f!==e;){if(f.x>=d&&f.x<=u&&f.y>=c&&f.y<=p&&ga(n,a,r,h,o,l,f.x,f.y)&&ya(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function aa(t,e,i,s){var n=t.prev,r=t,o=t.next;if(ya(n,r,o)>=0)return!1;for(var a=n.x,h=r.x,l=o.x,d=n.y,c=r.y,u=o.y,p=a<h?a<l?a:l:h<l?h:l,f=d<c?d<u?d:u:c<u?c:u,g=a>h?a>l?a:l:h>l?h:l,m=d>c?d>u?d:u:c>u?c:u,y=pa(p,f,e,i,s),v=pa(g,m,e,i,s),x=t.prevZ,b=t.nextZ;x&&x.z>=y&&b&&b.z<=v;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==n&&x!==o&&ga(a,d,h,c,l,u,x.x,x.y)&&ya(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==n&&b!==o&&ga(a,d,h,c,l,u,b.x,b.y)&&ya(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=y;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==n&&x!==o&&ga(a,d,h,c,l,u,x.x,x.y)&&ya(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==n&&b!==o&&ga(a,d,h,c,l,u,b.x,b.y)&&ya(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function ha(t,e,i){var s=t;do{var n=s.prev,r=s.next.next;!va(n,r)&&xa(n,s,s.next,r)&&_a(n,r)&&_a(r,n)&&(e.push(n.i/i|0),e.push(s.i/i|0),e.push(r.i/i|0),Ta(s),Ta(s.next),s=t=r),s=s.next}while(s!==t);return na(s)}function la(t,e,i,s,n,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ma(o,a)){var h=Ea(o,a);return o=na(o,o.next),h=na(h,h.next),ra(o,e,i,s,n,r,0),void ra(h,e,i,s,n,r,0)}a=a.next}o=o.next}while(o!==t)}function da(t,e){return t.x-e.x}function ca(t,e){var i=function(t,e){var i,s=e,n=t.x,r=t.y,o=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){var a=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=n&&a>o&&(o=a,i=s.x<s.next.x?s:s.next,a===n))return i}s=s.next}while(s!==e);if(!i)return null;var h,l=i,d=i.x,c=i.y,u=1/0;s=i;do{n>=s.x&&s.x>=d&&n!==s.x&&ga(r<c?n:o,r,d,c,r<c?o:n,r,s.x,s.y)&&(h=Math.abs(r-s.y)/(n-s.x),_a(s,t)&&(h<u||h===u&&(s.x>i.x||s.x===i.x&&ua(i,s)))&&(i=s,u=h)),s=s.next}while(s!==l);return i}(t,e);if(!i)return e;var s=Ea(i,t);return na(s,s.next),na(i,i.next)}function ua(t,e){return ya(t.prev,t,e.prev)<0&&ya(e.next,t,t.next)<0}function pa(t,e,i,s,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function fa(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ga(t,e,i,s,n,r,o,a){return(n-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(s-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(n-o)*(s-a)}function ma(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&xa(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(_a(t,e)&&_a(e,t)&&function(t,e){var i=t,s=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&n<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)&&(ya(t.prev,t,e.prev)||ya(t,e.prev,e))||va(t,e)&&ya(t.prev,t,t.next)>0&&ya(e.prev,e,e.next)>0)}function ya(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function va(t,e){return t.x===e.x&&t.y===e.y}function xa(t,e,i,s){var n=wa(ya(t,e,i)),r=wa(ya(t,e,s)),o=wa(ya(i,s,t)),a=wa(ya(i,s,e));return n!==r&&o!==a||!(0!==n||!ba(t,i,e))||!(0!==r||!ba(t,s,e))||!(0!==o||!ba(i,t,s))||!(0!==a||!ba(i,e,s))}function ba(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function wa(t){return t>0?1:t<0?-1:0}function _a(t,e){return ya(t.prev,t,t.next)<0?ya(t,e,t.next)>=0&&ya(t,t.prev,e)>=0:ya(t,e,t.prev)<0||ya(t,t.next,e)<0}function Ea(t,e){var i=new Aa(t.i,t.x,t.y),s=new Aa(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,s.next=i,i.prev=s,r.next=s,s.prev=r,s}function Ca(t,e,i,s){var n=new Aa(t,e,i);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function Ta(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Aa(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sa(t,e,i,s){for(var n=0,r=e,o=i-s;r<i;r+=s)n+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return n}ea.exports=ia,ea.exports.default=ia,ia.deviation=function(t,e,i,s){var n=e&&e.length,r=n?e[0]*i:t.length,o=Math.abs(Sa(t,0,r,i));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,d=a<h-1?e[a+1]*i:t.length;o-=Math.abs(Sa(t,l,d,i))}var c=0;for(a=0;a<s.length;a+=3){var u=s[a]*i,p=s[a+1]*i,f=s[a+2]*i;c+=Math.abs((t[u]-t[f])*(t[p+1]-t[u+1])-(t[u]-t[p])*(t[f+1]-t[u+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},ia.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,n=0;n<t.length;n++){for(var r=0;r<t[n].length;r++)for(var o=0;o<e;o++)i.vertices.push(t[n][r][o]);n>0&&(s+=t[n-1].length,i.holes.push(s))}return i};class Pa{constructor(t,e,i){this.pos=Dn.pull("Vector2d"),this._bounds,this.points=[],this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(t,e,i)}onResetEvent(t,e,i){this.setShape(t,e,i)}setShape(t,e,i){return this.pos.set(t,e),this.setVertices(i),this}setVertices(t){if(!Array.isArray(t))return this;if(t[0]instanceof Nn)this.points=t;else if(this.points.length=0,"object"==typeof t[0])t.forEach((t=>{this.points.push(Dn.pull("Vector2d",t.x,t.y))}));else for(var e=0;e<t.length;e+=2)this.points.push(Dn.pull("Vector2d",t[e],t[e+1]));return this.recalc(),this.updateBounds(),this}transform(t){for(var e=this.points,i=e.length,s=0;s<i;s++)t.apply(e[s]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(t,e){if(0!==t){for(var i=this.points,s=i.length,n=0;n<s;n++)i[n].rotate(t,e);this.recalc(),this.updateBounds()}return this}scale(t,e){e=void 0!==e?e:t;for(var i=this.points,s=i.length,n=0;n<s;n++)i[n].scale(t,e);return this.recalc(),this.updateBounds(),this}scaleV(t){return this.scale(t.x,t.y)}recalc(){var t,e=this.edges,i=this.normals,s=this.indices,n=this.points,r=n.length;if(r<3)throw new Error("Requires at least 3 points");for(t=0;t<r;t++)void 0===e[t]&&(e[t]=Dn.pull("Vector2d")),e[t].copy(n[(t+1)%r]).sub(n[t]),void 0===i[t]&&(i[t]=Dn.pull("Vector2d")),i[t].copy(e[t]).perp().normalize();return e.length=r,i.length=r,s.length=0,this}getIndices(){return 0===this.indices.length&&(this.indices=ea.exports(this.points.flatMap((t=>[t.x,t.y])))),this.indices}isConvex(){var t,e,i,s,n=0,r=this.points,o=r.length;if(o<3)return null;for(t=0;t<o;t++)if(i=(t+2)%o,s=(r[e=(t+1)%o].x-r[t].x)*(r[i].y-r[e].y),(s-=(r[e].y-r[t].y)*(r[i].x-r[e].x))<0?n|=1:s>0&&(n|=2),3===n)return!1;return 0!==n||null}translate(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}shift(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x=t,this.pos.y=e,this.updateBounds()}contains(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);for(var i=!1,s=this.pos.x,n=this.pos.y,r=this.points,o=r.length,a=0,h=o-1;a<o;h=a++){var l=r[a].y+n,d=r[a].x+s,c=r[h].y+n,u=r[h].x+s;l>e!=c>e&&t<(u-d)*(e-l)/(c-l)+d&&(i=!i)}return i}getBounds(){return void 0===this._bounds&&(this._bounds=Dn.pull("Bounds")),this._bounds}updateBounds(){var t=this.getBounds();return t.update(this.points),t.translate(this.pos),t}clone(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new Pa(this.pos.x,this.pos.y,t)}}class Ma extends Pa{constructor(t,e,i,s){super(t,e,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",i,0),Dn.pull("Vector2d",i,s),Dn.pull("Vector2d",0,s)]),this.shapeType="Rectangle"}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){var n=i;return this.pos.set(t,e),4===arguments.length&&((n=this.points)[0].set(0,0),n[1].set(i,0),n[2].set(i,s),n[3].set(0,s)),this.setVertices(n),this}get left(){return this.pos.x}get right(){var t=this.width;return this.pos.x+t||t}get top(){return this.pos.y}get bottom(){var t=this.height;return this.pos.y+t||t}get width(){return this.points[2].x}set width(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.pos.x+this.width/2:this.width}set centerX(t){this.pos.x=t-this.width/2}get centerY(){return isFinite(this.height)?this.pos.y+this.height/2:this.height}set centerY(t){this.pos.y=t-this.height/2}centerOn(t,e){return this.centerX=t,this.centerY=e,this}resize(t,e){return this.width=t,this.height=e,this}scale(t,e=t){return this.width*=t,this.height*=e,this}clone(){return new Ma(this.pos.x,this.pos.y,this.width,this.height)}copy(t){return this.setShape(t.pos.x,t.pos.y,t.width,t.height)}union(t){var e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this}overlaps(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}contains(){var t,e,i,s,n=arguments[0];return 2===arguments.length?(t=e=n,i=s=arguments[1]):n instanceof Ma?(t=n.left,e=n.right,i=n.top,s=n.bottom):(t=e=n.x,i=s=n.y),t>=this.left&&e<=this.right&&i>=this.top&&s<=this.bottom}equals(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom}isFinite(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return Dn.pull("Polygon",this.pos.x,this.pos.y,this.points)}}class Oa extends Ma{constructor(t,e,i,s,n=20){super(t,e,i,s),this.radius=n}onResetEvent(t,e,i,s,n){super.setShape(t,e,i,s),this.radius=n}get radius(){return this._radius}set radius(t){this.width<2*t&&(t=this.width/2),this.height<2*t&&(t=this.height/2),this._radius=t}copy(t){return super.setShape(t.pos.x,t.pos.y,t.width,t.height),this.radius=t.radius,this}contains(){var t,e,i,s,n=arguments[0];if(2===arguments.length)t=n,e=arguments[1];else{if(n instanceof Ma)return super.contains(n);t=n.x,e=n.y}if(t<this.left||t>=this.right||e<this.top||e>=this.bottom)return!1;if(t>=this.left+this.radius&&t<=this.right-this.radius||e>=this.top+this.radius&&e<=this.bottom-this.radius)return!0;var r=Math.max(0,Math.min(this.radius,this.width/2)),o=Math.max(0,Math.min(this.radius,this.height/2));if(t<this.left+r&&e<this.top+o)i=t-this.left-r,s=e-this.top-o;else if(t>this.right-r&&e<this.top+o)i=t-this.right+r,s=e-this.top-o;else if(t>this.right-r&&e>this.bottom-o)i=t-this.right+r,s=e-this.bottom+o;else{if(!(t<this.left+r&&e>this.bottom-o))return!1;i=t-this.left-r,s=e-this.bottom+o}return i*i+s*s<=r*o}equals(t){return super.equals(t)&&this.radius===t.radius}clone(){return new Oa(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}class La{constructor(t,e,i,s){this.pos=Dn.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=Dn.pull("Vector2d"),this.radiusSq=Dn.pull("Vector2d"),this.ratio=Dn.pull("Vector2d"),this.shapeType="Ellipse",this.setShape(t,e,i,s)}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){var n=i/2,r=s/2;this.pos.set(t,e),this.radius=Math.max(n,r),this.ratio.set(n/this.radius,r/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var o=this.radius*this.radius;return this.radiusSq.set(o,o).scaleV(this.ratio),this.getBounds().setMinMax(t,e,t+i,t+s),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}rotate(t,e){return this.pos.rotate(t,e),this.getBounds().shift(this.pos),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}scale(t,e){return e=void 0!==e?e:t,this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*t,2*this.radiusV.y*e)}scaleV(t){return this.scale(t.x,t.y)}transform(t){return this}translate(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}contains(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y,t*t/this.radiusSq.x+e*e/this.radiusSq.y<=1}getBounds(){return void 0===this._bounds&&(this._bounds=Dn.pull("Bounds")),this._bounds}clone(){return new La(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}}class ka extends Pa{contains(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;var i=this.points[0],s=this.points[1];return(e-i.y)*(s.x-i.x)==(s.y-i.y)*(t-i.x)}recalc(){var t=this.edges,e=this.normals,i=this.indices,s=this.points;if(2!==s.length)throw new Error("Requires exactly 2 points");return void 0===t[0]&&(t[0]=Dn.pull("Vector2d")),t[0].copy(s[1]).sub(s[0]),void 0===e[0]&&(e[0]=Dn.pull("Vector2d")),e[0].copy(t[0]).perp().normalize(),i.length=0,this}clone(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new ka(this.pos.x,this.pos.y,t)}}class Ia{constructor(t){this._center=new Nn,this.onResetEvent(t)}onResetEvent(t){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==t&&this.update(t)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,s){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=s}get x(){return this.min.x}set x(t){var e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){var e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}update(t){this.add(t,!0)}add(t,e=!1){!0===e&&this.clear();for(var i=0;i<t.length;i++){var s=t[i];s.x>this.max.x&&(this.max.x=s.x),s.x<this.min.x&&(this.min.x=s.x),s.y>this.max.y&&(this.max.y=s.y),s.y<this.min.y&&(this.min.y=s.y)}}addBounds(t,e=!1){!0===e&&this.clear(),t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y)}addPoint(t,e){void 0!==e&&"function"==typeof t.rotate&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,s,n){var r=Dn.pull("Vector2d");this.addPoint(r.set(t,e),n),this.addPoint(r.set(i,e),n),this.addPoint(r.set(t,s),n),this.addPoint(r.set(i,s),n),Dn.push(r)}contains(){var t,e,i,s,n=arguments[0];return 2===arguments.length?(t=e=n,i=s=arguments[1]):n instanceof Ia?(t=n.min.x,e=n.max.x,i=n.min.y,s=n.max.y):(t=e=n.x,i=s=n.y),t>=this.min.x&&e<=this.max.x&&i>=this.min.y&&s<=this.max.y}overlaps(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);var i=this.max.x-this.min.x,s=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+s}clone(){var t=new Ia;return t.addBounds(this),t}toPolygon(){return Dn.pull("Polygon",this.x,this.y,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height),Dn.pull("Vector2d",0,this.height)])}}class Ra{constructor(){this.points=[],this.arcResolution=5,this.vertices=[]}beginPath(){this.points.forEach((t=>{Dn.push(t)})),this.points.length=0}closePath(){var t=this.points;t.length>1&&!t[t.length-1].equals(t[0])&&t.push(Dn.pull("Vector2d",t[0].x,t[0].y))}triangulatePath(){var t=0,e=this.points,i=this.vertices,s=ea.exports(e.flatMap((t=>[t.x,t.y])));for(t=0;t<s.length;t++)void 0===i[t]&&(i[t]=Dn.pull("Vector2d")),i[t].set(e[s[t]].x,e[s[t]].y);for(;i.length>s.length;)Dn.push(i[i.length-1]),i.length-=1;return i}moveTo(t,e){this.points.push(Dn.pull("Vector2d",t,e))}lineTo(t,e){this.points.push(Dn.pull("Vector2d",t,e))}arc(t,e,i,s,n,r=!1){var o=this.points;if(s!==n){var a=r?Math.abs(s-n)>=yn:Math.abs(n-s)>=yn;(s%=yn)<0&&(s+=yn),(n%=yn)<0&&(n+=yn),s>=n&&(n+=yn);var h=n-s,l=1;r&&(l=-1,h=yn-h),a&&(h=yn);for(var d=h*i/this.arcResolution,c=h/d,u=s,p=0;p<d;p++)o.push(Dn.pull("Vector2d",t+i*Math.cos(u),e+i*Math.sin(u))),u+=l*c;o.push(Dn.pull("Vector2d",t+i*Math.cos(n),e+i*Math.sin(n)))}}arcTo(t,e,i,s,n){var r=this.points,o=[r[r.length-1].x-t,r[r.length-1].y-e],a=[i-t,s-e],h=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)),l=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));o[0]/=h,o[1]/=h,a[0]/=l,a[1]/=l;var d=Math.atan2(o[1],o[0])-Math.atan2(a[1],a[0]),c=n/Math.tan(d/2),u=[t+o[0]*c,e+o[1]*c],p=[t+a[0]*c,e+a[1]*c];r.push(Dn.pull("Vector2d",u[0],u[1]));var f=[(o[0]+a[0])/2,(o[1]+a[1])/2],g=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2));f[0]/=g,f[1]/=g;var m=Math.sqrt(Math.pow(n,2)+Math.pow(c,2)),y=[t+m*f[0],e+m*f[1]],v=Math.atan2(u[1]-y[1],u[0]-y[0]),x=Math.atan2(p[1]-y[1],p[0]-y[0]);this.arc(y[0],y[1],n,v,x)}ellipse(t,e,i,s,n,r,o,a=!1){var h=this.points;if(r!==o){var l=a?Math.abs(r-o)>=yn:Math.abs(o-r)>=yn;(r%=yn)<0&&(r+=yn),(o%=yn)<0&&(o+=yn),r>=o&&(o+=yn);var d=o-r,c=1;a&&(c=-1,d=yn-d),l&&(d=yn);for(var u=(d*i+d*s)/2/this.arcResolution,p=d/u,f=r,g=Math.cos(n),m=Math.sin(n),y=0;y<u;y++){var v=i*Math.cos(f),x=s*Math.sin(f),b=t+v*g-x*m,w=e+v*m+x*g;h.push(Dn.pull("Vector2d",b,w)),f+=c*p}}}rect(t,e,i,s){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+s),this.lineTo(t,e+s),this.lineTo(t,e)}roundRect(t,e,i,s,n){this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.arcTo(t+i,e,t+i,e+n,n),this.lineTo(t+i,e+s-n),this.arcTo(t+i,e+s,t+i-n,e+s,n),this.lineTo(t+n,e+s),this.arcTo(t,e+s,t,e+s-n,n),this.lineTo(t,e+n),this.arcTo(t,e,t+n,e,n)}}class Ba{constructor(t=0,e=0){this.x=t,this.y=e}onResetEvent(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}equals(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}clone(){return new Ba(this.x,this.y)}}class Da{constructor(t){this.settings=t,this.isContextValid=!0,this.path2D=new Ra,this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",void 0!==globalThis.canvas?this.canvas=globalThis.canvas:void 0!==this.settings.canvas?this.canvas=this.settings.canvas:this.canvas=bc(this.settings.width,this.settings.height),this.currentColor=new Wn(0,0,0,1),this.currentTint=new Wn(255,255,255,1),this.projectionMatrix=new Kn,this.uvOffset=0,Lr(or,(()=>{xc.reset()}))}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height,this.clearMask()}getCanvas(){return this.canvas}getContext(){return this.context}getBlendMode(){return this.currentBlendMode}getContext2d(t,e){if(null==t)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===t.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof e&&(e=!0);var i=t.getContext("2d",{alpha:e});return i.canvas||(i.canvas=t),this.setAntiAlias(i,this.settings.antiAlias),i}getWidth(){return this.getCanvas().width}getHeight(){return this.getCanvas().height}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.getWidth()&&t.right>=0&&t.top<=this.getHeight()&&t.bottom>=0}resize(t,e){var i=this.getCanvas();t===i.width&&e===i.height||(i.width=t,i.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,Or(Er,t,e))}setAntiAlias(t,e){var i=t.canvas;fn("imageSmoothingEnabled",!0===e,t),!0!==e?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){if(t instanceof Oa)this.strokeRoundRect(t.left,t.top,t.width,t.height,t.radius,e);else if(t instanceof Ma||t instanceof Ia)this.strokeRect(t.left,t.top,t.width,t.height,e);else if(t instanceof ka||t instanceof Pa)this.strokePolygon(t,e);else if(t instanceof La)this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e);else{if(!(t instanceof Ba))throw new Error("Invalid geometry for fill/stroke");this.strokePoint(t.x,t.y)}}fill(t){this.stroke(t,!0)}tint(t,e,i){var s=bc(t.width,t.height,!0),n=this.getContext2d(s);return n.save(),n.fillStyle=e instanceof Wn?e.toRGB():e,n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation=i||"multiply",n.drawImage(t,0,0),n.globalCompositeOperation="destination-atop",n.drawImage(t,0,0),n.restore(),s}setMask(t){}clearMask(){}setTint(t,e=t.alpha){this.currentTint.copy(t),this.currentTint.alpha*=e}clearTint(){this.currentTint.setColor(255,255,255,1)}drawFont(){}}var Na,Fa={};Na=Fa,function(){var e=function(){this.init()};e.prototype={init:function(){var t=this||i;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||i;if(t=parseFloat(t),e.ctx||d(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,i.ctx.currentTime);for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var n=e._howls[s]._getSoundIds(),r=0;r<n.length;r++){var o=e._howls[s]._soundById(n[r]);o&&o._node&&(o._node.volume=o._volume*t)}return e}return e._volume},mute:function(t){var e=this||i;e.ctx||d(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,i.ctx.currentTime);for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var n=e._howls[s]._getSoundIds(),r=0;r<n.length;r++){var o=e._howls[s]._soundById(n[r]);o&&o._node&&(o._node.muted=!!t||o._muted)}return e},stop:function(){for(var t=this||i,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||i,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,d()),t},codecs:function(t){return(this||i)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||i;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||i,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var s=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",r=n.match(/OPR\/([0-6].)/g),o=r&&parseInt(r[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),h=n.match(/Version\/(.*?) /),l=a&&h&&parseInt(h[1],10)<15;return t._codecs={mp3:!(o||!s&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!s,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||i;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var s=new Audio;s._unlocked=!0,t._releaseHtml5Audio(s)}catch(i){t.noAudio=!0;break}for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),o=0;o<r.length;o++){var a=t._howls[n]._soundById(r[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var h=t.ctx.createBufferSource();h.buffer=t._scratchBuffer,h.connect(t.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),h.onended=function(){h.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||i;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||i;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&i.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var s=0;s<t._howls[e]._sounds.length;s++)if(!t._howls[e]._sounds[s]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&i.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var i=new e,s=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(t){var e=this;return i.ctx||d(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=i.usingWebAudio&&!e._html5,void 0!==i.ctx&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(i.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var s=0;s<t._src.length;s++){var r,a;if(t._format&&t._format[s])r=t._format[s];else{if("string"!=typeof(a=t._src[s])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(a))||(r=/\.([^.]+)$/.exec(a.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&i.codecs(r)){e=t._src[s];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new n(t),t._webAudio&&o(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var s=this,n=null;if("number"==typeof t)n=t,t=null;else{if("string"==typeof t&&"loaded"===s._state&&!s._sprite[t])return null;if(void 0===t&&(t="__default",!s._playLock)){for(var r=0,o=0;o<s._sounds.length;o++)s._sounds[o]._paused&&!s._sounds[o]._ended&&(r++,n=s._sounds[o]._id);1===r?t=null:n=null}}var a=n?s._soundById(n):s._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),"loaded"!==s._state){a._sprite=t,a._ended=!1;var h=a._id;return s._queue.push({event:"play",action:function(){s.play(h)}}),h}if(n&&!a._paused)return e||s._loadQueue("play"),a._id;s._webAudio&&i._autoResume();var l=Math.max(0,a._seek>0?a._seek:s._sprite[t][0]/1e3),d=Math.max(0,(s._sprite[t][0]+s._sprite[t][1])/1e3-l),c=1e3*d/Math.abs(a._rate),u=s._sprite[t][0]/1e3,p=(s._sprite[t][0]+s._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var f=function(){a._paused=!1,a._seek=l,a._start=u,a._stop=p,a._loop=!(!a._loop&&!s._sprite[t][2])};if(!(l>=p)){var g=a._node;if(s._webAudio){var m=function(){s._playLock=!1,f(),s._refreshBuffer(a);var t=a._muted||s._muted?0:a._volume;g.gain.setValueAtTime(t,i.ctx.currentTime),a._playStart=i.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,l,86400):g.bufferSource.noteGrainOn(0,l,d):a._loop?g.bufferSource.start(0,l,86400):g.bufferSource.start(0,l,d),c!==1/0&&(s._endTimers[a._id]=setTimeout(s._ended.bind(s,a),c)),e||setTimeout((function(){s._emit("play",a._id),s._loadQueue()}),0)};"running"===i.state&&"interrupted"!==i.ctx.state?m():(s._playLock=!0,s.once("resume",m),s._clearTimer(a._id))}else{var y=function(){g.currentTime=l,g.muted=a._muted||s._muted||i._muted||g.muted,g.volume=a._volume*i.volume(),g.playbackRate=a._rate;try{var n=g.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(s._playLock=!0,f(),n.then((function(){s._playLock=!1,g._unlocked=!0,e?s._loadQueue():s._emit("play",a._id)})).catch((function(){s._playLock=!1,s._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(s._playLock=!1,f(),s._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void s._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?s._endTimers[a._id]=setTimeout(s._ended.bind(s,a),c):(s._endTimers[a._id]=function(){s._ended(a),g.removeEventListener("ended",s._endTimers[a._id],!1)},g.addEventListener("ended",s._endTimers[a._id],!1))}catch(t){s._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=s._src,g.load());var v=window&&window.ejecta||!g.readyState&&i._navigator.isCocoonJS;if(g.readyState>=3||v)y();else{s._playLock=!0,s._state="loading";var x=function(){s._state="loaded",y(),g.removeEventListener(i._canPlayEvent,x,!1)};g.addEventListener(i._canPlayEvent,x,!1),s._clearTimer(a._id)}}return a._id}s._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),s=0;s<i.length;s++){e._clearTimer(i[s]);var n=e._soundById(i[s]);if(n&&!n._paused&&(n._seek=e.seek(i[s]),n._rateSeek=0,n._paused=!0,e._stopFade(i[s]),n._node))if(e._webAudio){if(!n._node.bufferSource)continue;void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),e._cleanBuffer(n._node)}else isNaN(n._node.duration)&&n._node.duration!==1/0||n._node.pause();arguments[1]||e._emit("pause",n?n._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var s=i._getSoundIds(t),n=0;n<s.length;n++){i._clearTimer(s[n]);var r=i._soundById(s[n]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,i._stopFade(s[n]),r._node&&(i._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),i._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&i._clearSound(r._node))),e||i._emit("stop",r._id))}return i},mute:function(t,e){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"mute",action:function(){s.mute(t,e)}}),s;if(void 0===e){if("boolean"!=typeof t)return s._muted;s._muted=t}for(var n=s._getSoundIds(e),r=0;r<n.length;r++){var o=s._soundById(n[r]);o&&(o._muted=t,o._interval&&s._stopFade(o._id),s._webAudio&&o._node?o._node.gain.setValueAtTime(t?0:o._volume,i.ctx.currentTime):o._node&&(o._node.muted=!!i._muted||t),s._emit("mute",o._id))}return s},volume:function(){var t,e,s,n=this,r=arguments;if(0===r.length)return n._volume;if(1===r.length||2===r.length&&void 0===r[1]){var o=n._getSoundIds(),a=o.indexOf(r[0]);a>=0?e=parseInt(r[0],10):t=parseFloat(r[0])}else r.length>=2&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(s=e?n._soundById(e):n._sounds[0])?s._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,r)}}),n;void 0===e&&(n._volume=t),e=n._getSoundIds(e);for(var h=0;h<e.length;h++)(s=n._soundById(e[h]))&&(s._volume=t,r[2]||n._stopFade(e[h]),n._webAudio&&s._node&&!s._muted?s._node.gain.setValueAtTime(t,i.ctx.currentTime):s._node&&!s._muted&&(s._node.volume=t*i.volume()),n._emit("volume",s._id));return n},fade:function(t,e,s,n){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(t,e,s,n)}}),r;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),s=parseFloat(s),r.volume(t,n);for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var h=r._soundById(o[a]);if(h){if(n||r._stopFade(o[a]),r._webAudio&&!h._muted){var l=i.ctx.currentTime,d=l+s/1e3;h._volume=t,h._node.gain.setValueAtTime(t,l),h._node.gain.linearRampToValueAtTime(e,d)}r._startFadeInterval(h,t,e,s,o[a],void 0===n)}}return r},_startFadeInterval:function(t,e,i,s,n,r){var o=this,a=e,h=i-e,l=Math.abs(h/.01),d=Math.max(4,l>0?s/l:s),c=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var n=(Date.now()-c)/s;c=Date.now(),a+=h*n,a=Math.round(100*a)/100,a=h<0?Math.max(i,a):Math.min(i,a),o._webAudio?t._volume=a:o.volume(a,t._id,!0),r&&(o._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,o.volume(i,t._id),o._emit("fade",t._id))}),d)},_stopFade:function(t){var e=this,s=e._soundById(t);return s&&s._interval&&(e._webAudio&&s._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(s._interval),s._interval=null,e.volume(s._fadeTo,t),s._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t,e,i,s=this,n=arguments;if(0===n.length)return s._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(i=s._soundById(parseInt(n[0],10)))&&i._loop;t=n[0],s._loop=t}else 2===n.length&&(t=n[0],e=parseInt(n[1],10));for(var r=s._getSoundIds(e),o=0;o<r.length;o++)(i=s._soundById(r[o]))&&(i._loop=t,s._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,s.playing(r[o])&&(s.pause(r[o],!0),s.play(r[o],!0)))));return s},rate:function(){var t,e,s,n=this,r=arguments;if(0===r.length)e=n._sounds[0]._id;else if(1===r.length){var o=n._getSoundIds(),a=o.indexOf(r[0]);a>=0?e=parseInt(r[0],10):t=parseFloat(r[0])}else 2===r.length&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if("number"!=typeof t)return(s=n._soundById(e))?s._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,r)}}),n;void 0===e&&(n._rate=t),e=n._getSoundIds(e);for(var h=0;h<e.length;h++)if(s=n._soundById(e[h])){n.playing(e[h])&&(s._rateSeek=n.seek(e[h]),s._playStart=n._webAudio?i.ctx.currentTime:s._playStart),s._rate=t,n._webAudio&&s._node&&s._node.bufferSource?s._node.bufferSource.playbackRate.setValueAtTime(t,i.ctx.currentTime):s._node&&(s._node.playbackRate=t);var l=n.seek(e[h]),d=(n._sprite[s._sprite][0]+n._sprite[s._sprite][1])/1e3-l,c=1e3*d/Math.abs(s._rate);!n._endTimers[e[h]]&&s._paused||(n._clearTimer(e[h]),n._endTimers[e[h]]=setTimeout(n._ended.bind(n,s),c)),n._emit("rate",s._id)}return n},seek:function(){var t,e,s=this,n=arguments;if(0===n.length)s._sounds.length&&(e=s._sounds[0]._id);else if(1===n.length){var r=s._getSoundIds(),o=r.indexOf(n[0]);o>=0?e=parseInt(n[0],10):s._sounds.length&&(e=s._sounds[0]._id,t=parseFloat(n[0]))}else 2===n.length&&(t=parseFloat(n[0]),e=parseInt(n[1],10));if(void 0===e)return 0;if("number"==typeof t&&("loaded"!==s._state||s._playLock))return s._queue.push({event:"seek",action:function(){s.seek.apply(s,n)}}),s;var a=s._soundById(e);if(a){if(!("number"==typeof t&&t>=0)){if(s._webAudio){var h=s.playing(e)?i.ctx.currentTime-a._playStart:0,l=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(l+h*Math.abs(a._rate))}return a._node.currentTime}var d=s.playing(e);d&&s.pause(e,!0),a._seek=t,a._ended=!1,s._clearTimer(e),s._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=t);var c=function(){d&&s.play(e,!0),s._emit("seek",e)};if(d&&!s._webAudio){var u=function(){s._playLock?setTimeout(u,0):c()};setTimeout(u,0)}else c()}return s},playing:function(t){var e=this;if("number"==typeof t){var i=e._soundById(t);return!!i&&!i._paused}for(var s=0;s<e._sounds.length;s++)if(!e._sounds[s]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,s=e._soundById(t);return s&&(i=e._sprite[s._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,s=0;s<e.length;s++)e[s]._paused||t.stop(e[s]._id),t._webAudio||(t._clearSound(e[s]._node),e[s]._node.removeEventListener("error",e[s]._errorFn,!1),e[s]._node.removeEventListener(i._canPlayEvent,e[s]._loadFn,!1),e[s]._node.removeEventListener("ended",e[s]._endFn,!1),i._releaseHtml5Audio(e[s]._node)),delete e[s]._node,t._clearTimer(e[s]._id);var n=i._howls.indexOf(t);n>=0&&i._howls.splice(n,1);var o=!0;for(s=0;s<i._howls.length;s++)if(i._howls[s]._src===t._src||t._src.indexOf(i._howls[s]._src)>=0){o=!1;break}return r&&o&&delete r[t._src],i.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,s){var n=this["_on"+t];return"function"==typeof e&&n.push(s?{id:i,fn:e,once:s}:{id:i,fn:e}),this},off:function(t,e,i){var s=this,n=s["_on"+t],r=0;if("number"==typeof e&&(i=e,e=null),e||i)for(r=0;r<n.length;r++){var o=i===n[r].id;if(e===n[r].fn&&o||!e&&o){n.splice(r,1);break}}else if(t)s["_on"+t]=[];else{var a=Object.keys(s);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(s[a[r]])&&(s[a[r]]=[])}return s},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var s=this,n=s["_on"+t],r=n.length-1;r>=0;r--)n[r].id&&n[r].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(s,n[r].fn),0),n[r].once&&s.off(t,n[r].fn,n[r].id));return s._loadQueue(t),s},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,s=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!(!t._loop&&!e._sprite[s][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=i.ctx.currentTime;var r=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),r)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),i._autoSuspend()),e._webAudio||n||e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new n(t)},_drain:function(){var t=this,e=t._pool,i=0,s=0;if(!(t._sounds.length<e)){for(s=0;s<t._sounds.length;s++)t._sounds[s]._ended&&i++;for(s=t._sounds.length-1;s>=0;s--){if(i<=e)return;t._sounds[s]._ended&&(t._webAudio&&t._sounds[s]._node&&t._sounds[s]._node.disconnect(0),t._sounds.splice(s,1),i--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=i.ctx.createBufferSource(),t._node.bufferSource.buffer=r[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,i.ctx.currentTime),this},_cleanBuffer:function(t){var e=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=i._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(t){this._parent=t,this.init()};n.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++i._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,s=i._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),t._node.gain.setValueAtTime(s,i.ctx.currentTime),t._node.paused=!0,t._node.connect(i.masterGain)):i.noAudio||(t._node=i._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(i._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=s*i.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++i._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(i._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var r={},o=function(t){var e=t._src;if(r[e])return t._duration=r[e].duration,void l(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),s=new Uint8Array(i.length),n=0;n<i.length;++n)s[n]=i.charCodeAt(n);h(s.buffer,t)}else{var o=new XMLHttpRequest;o.open(t._xhr.method,e,!0),o.withCredentials=t._xhr.withCredentials,o.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){o.setRequestHeader(e,t._xhr.headers[e])})),o.onload=function(){var e=(o.status+"")[0];"0"===e||"2"===e||"3"===e?h(o.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete r[e],t.load())},a(o)}},a=function(t){try{t.send()}catch(e){t.onerror()}},h=function(t,e){var s=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(t){t&&e._sounds.length>0?(r[e._src]=t,l(e,t)):s()};"undefined"!=typeof Promise&&1===i.ctx.decodeAudioData.length?i.ctx.decodeAudioData(t).then(n).catch(s):i.ctx.decodeAudioData(t,n,s)},l=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},d=function(){if(i.usingWebAudio){try{"undefined"!=typeof AudioContext?i.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch(t){i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),e=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),s=e?parseInt(e[1],10):null;if(t&&s&&s<9){var n=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!n&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};Na.Howler=i,Na.Howl=s,void 0!==t?(t.HowlerGlobal=e,t.Howler=i,t.Howl=s,t.Sound=n):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=i,window.Howl=s,window.Sound=n)}(),function(){var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var i=e._howls.length-1;i>=0;i--)e._howls[i].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,i){var s=this;return s.ctx&&s.ctx.listener?(e="number"!=typeof e?s._pos[1]:e,i="number"!=typeof i?s._pos[2]:i,"number"!=typeof t?s._pos:(s._pos=[t,e,i],void 0!==s.ctx.listener.positionX?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s)):s},HowlerGlobal.prototype.orientation=function(t,e,i,s,n,r){var o=this;if(!o.ctx||!o.ctx.listener)return o;var a=o._orientation;return e="number"!=typeof e?a[1]:e,i="number"!=typeof i?a[2]:i,s="number"!=typeof s?a[3]:s,n="number"!=typeof n?a[4]:n,r="number"!=typeof r?a[5]:r,"number"!=typeof t?a:(o._orientation=[t,e,i,s,n,r],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(r,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(t,e,i,s,n,r),o)},Howl.prototype.init=(t=Howl.prototype.init,function(e){var i=this;return i._orientation=e.orientation||[1,0,0],i._stereo=e.stereo||null,i._pos=e.pos||null,i._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},i._onstereo=e.onstereo?[{fn:e.onstereo}]:[],i._onpos=e.onpos?[{fn:e.onpos}]:[],i._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(t,i)}}),s;var n=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0]}for(var r=s._getSoundIds(i),o=0;o<r.length;o++){var a=s._soundById(r[o]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,n),"spatial"===n?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),s._emit("stereo",a._id)}}return s},Howl.prototype.pos=function(t,i,s,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(t,i,s,n)}}),r;if(i="number"!=typeof i?0:i,s="number"!=typeof s?-.5:s,void 0===n){if("number"!=typeof t)return r._pos;r._pos=[t,i,s]}for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var h=r._soundById(o[a]);if(h){if("number"!=typeof t)return h._pos;h._pos=[t,i,s],h._node&&(h._panner&&!h._panner.pan||e(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(t,i,s)),r._emit("pos",h._id)}}return r},Howl.prototype.orientation=function(t,i,s,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(t,i,s,n)}}),r;if(i="number"!=typeof i?r._orientation[1]:i,s="number"!=typeof s?r._orientation[2]:s,void 0===n){if("number"!=typeof t)return r._orientation;r._orientation=[t,i,s]}for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var h=r._soundById(o[a]);if(h){if("number"!=typeof t)return h._orientation;h._orientation=[t,i,s],h._node&&(h._panner||(h._pos||(h._pos=r._pos||[0,0,-.5]),e(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,s)),r._emit("orientation",h._id)}}return r},Howl.prototype.pannerAttr=function(){var t,i,s,n=this,r=arguments;if(!n._webAudio)return n;if(0===r.length)return n._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(s=n._soundById(parseInt(r[0],10)))?s._pannerAttr:n._pannerAttr;t=r[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),n._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:n._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:n._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:n._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:n._panningModel})}else 2===r.length&&(t=r[0],i=parseInt(r[1],10));for(var o=n._getSoundIds(i),a=0;a<o.length;a++)if(s=n._soundById(o[a])){var h=s._pannerAttr;h={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:h.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:h.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:h.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:h.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:h.panningModel};var l=s._panner;l?(l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=h.maxDistance,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor,l.panningModel=h.panningModel):(s._pos||(s._pos=n._pos||[0,0,-.5]),e(s,"spatial"))}return n},Sound.prototype.init=function(t){return function(){var e=this,i=e._parent;e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,t.call(this),e._stereo?i.stereo(e._stereo):e._pos&&i.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,i=e._parent;return e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,e._stereo?i.stereo(e._stereo):e._pos?i.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,i._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}();let Ga={},Ua=null,ja=0,za=[],Ha=function(t,e){if(ja++>3)throw new Error("melonJS: failed loading "+t);Ga[t].load()};function Ya(){return!Fa.Howler.noAudio}function Va(t,e,i,s){var n=[];if(0===za.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(!0===dn(t.src))n.push(t.src);else for(var r=0;r<za.length;r++)n.push(t.src+t.name+"."+za[r]+Vd.nocache);return Ga[t.name]=new Fa.Howl({src:n,volume:Fa.Howler.volume(),html5:!0===e,xhrWithCredentials:Vd.withCredentials,onloaderror(){Ha.call(this,t.name,s)},onload(){ja=0,i&&i()}}),1}function Wa(t,e=!1,i,s){var n=Ga[t];if(n&&void 0!==n){var r=n.play();return"boolean"==typeof e&&n.loop(e,r),n.volume("number"==typeof s?_n(s,0,1):Fa.Howler.volume(),r),"function"==typeof i&&(!0===e?n.on("end",i,r):n.once("end",i,r)),r}throw new Error("audio clip "+t+" does not exist")}function Ka(){null!==Ua&&Ga[Ua].pause()}function qa(){null!==Ua&&Ga[Ua].play()}function Xa(t,e,i){i=void 0===i||!!i;var s=Ga[t];if(!s||void 0===s)throw new Error("audio clip "+t+" does not exist");s.mute(i,e)}function Ja(){Fa.Howler.mute(!0)}function Za(){Fa.Howler.mute(!1)}function Qa(t){return t in Ga&&(Ga[t].unload(),delete Ga[t],!0)}function $a(){for(var t in Ga)Ga.hasOwnProperty(t)&&Qa(t)}var th=Object.freeze({__proto__:null,stopOnAudioError:!0,init:function(t="mp3"){return za=t.split(","),!Fa.Howler.noAudio},hasFormat:function(t){return Ya()&&Fa.Howler.codecs(t)},hasAudio:Ya,enable:function(){Za()},disable:function(){Ja()},load:Va,play:Wa,fade:function(t,e,i,s,n){var r=Ga[t];if(!r||void 0===r)throw new Error("audio clip "+t+" does not exist");r.fade(e,i,s,n)},seek:function(t,...e){var i=Ga[t];if(i&&void 0!==i)return i.seek(...e);throw new Error("audio clip "+t+" does not exist")},rate:function(t,...e){var i=Ga[t];if(i&&void 0!==i)return i.rate(...e);throw new Error("audio clip "+t+" does not exist")},stop:function(t,e){if(void 0!==t){var i=Ga[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.stop(e),i.off("end",void 0,e)}else Fa.Howler.stop()},pause:function(t,e){var i=Ga[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.pause(e)},resume:function(t,e){var i=Ga[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.play(e)},playTrack:function(t,e){return Ua=t,Wa(Ua,!0,null,e)},stopTrack:function(){null!==Ua&&(Ga[Ua].stop(),Ua=null)},pauseTrack:Ka,resumeTrack:qa,getCurrentTrack:function(){return Ua},setVolume:function(t){Fa.Howler.volume(t)},getVolume:function(){return Fa.Howler.volume()},mute:Xa,unmute:function(t,e){Xa(t,e,!1)},muteAll:Ja,unmuteAll:Za,muted:function(){return Fa.Howler._muted},unload:Qa,unloadAll:$a});class eh extends Nn{constructor(t=0,e=0,i){if(super(t,e),void 0===i)throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){return this.setMuted(t,e),void 0!==i&&this.setCallback(i.onUpdate,i.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);this._y=e&&"y"in e?e.y:t}_set(t,e){var i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e){return this._set(this._x*t,this._y*(void 0!==e?e:t))}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new eh(_n(this.x,t,e),_n(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(_n(this._x,t,e),_n(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new eh(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new eh(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new eh(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var n=this._x-i,r=this._y-s,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-r*a+i,n*a+r*o+s)}dot(t){return this._x*t.x+this._y*t.y}cross(t){return this._x*t.y-this._y*t.x}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e)}moveTowards(t,e){var i=Math.atan2(t.y-this._y,t.x-this._x),s=this.distance(t);return 0===s||e>=0&&s<=e*e?t:(this._x+=Math.cos(i)*e,this._y+=Math.sin(i)*e,this)}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return Dn.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return Dn.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class ih{constructor(t=0,e=0,i=0){this.onResetEvent(t,e,i)}onResetEvent(t=0,e=0,i=0){return this.x=t,this.y=e,this.z=i,this}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||void 0!==i&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e,i){return e=void 0!==e?e:t,this._set(this.x*t,this.y*e,this.z*(i||1))}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new ih(_n(this.x,t,e),_n(this.y,t,e),_n(this.z,t,e))}clampSelf(t,e){return this._set(_n(this.x,t,e),_n(this.y,t,e),_n(this.z,t,e))}minV(t){var e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){var e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new ih(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new ih(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new ih(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(){var t,e,i;return arguments.length>=2?(t=arguments[0],e=arguments[1],i=arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=arguments[0].z),void 0===i&&(i=this.z),this.x===t&&this.y===e&&this.z===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var n=this.x-i,r=this.y-s,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-r*a+i,n*a+r*o+s,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*(void 0!==t.z?t.z:this.z)}cross(t){var e=this.x,i=this.y,s=this.z,n=t.x,r=t.y,o=t.z;return this.x=i*o-s*r,this.y=s*n-e*o,this.z=e*r-i*n,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}moveTowards(t,e){var i=Math.atan2(t.y-this.y,t.x-this.x),s=this.x-t.x,n=this.y-t.y,r=Math.sqrt(s*s+n*n);return 0===r||e>=0&&r<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){var e=this.x-t.x,i=this.y-t.y,s=this.z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}angle(t){return Math.acos(_n(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){var e=this.dot(t)/t.length2();return this.scale(e,e,e)}projectN(t){var e=this.dot(t)/t.length2();return this.scale(e,e,e)}clone(){return Dn.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class sh extends ih{constructor(t=0,e=0,i=0,s){if(super(t,e,i),void 0===s)throw new Error("undefined `onUpdate` callback");this.setCallback(s.onUpdate,s.scope)}onResetEvent(t=0,e=0,i=0,s){return this.setMuted(t,e,i),void 0!==s&&this.setCallback(s.onUpdate,s.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);this._y=e&&"y"in e?e.y:t}get z(){return this._z}set z(t){var e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);this._z=e&&"z"in e?e.z:t}_set(t,e,i){var s=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return s&&"x"in s&&"y"in s&&"z"in s?(this._x=s.x,this._y=s.y,this._z=s.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e,i){return e=void 0!==e?e:t,this._set(this._x*t,this._y*e,this._z*(i||1))}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new sh(_n(this._x,t,e),_n(this._y,t,e),_n(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(_n(this._x,t,e),_n(this._y,t,e),_n(this._z,t,e))}minV(t){var e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){var e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new sh(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new sh(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new sh(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var n=this.x-i,r=this.y-s,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-r*a+i,n*a+r*o+s,this.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}cross(t){var e=this._x,i=this._y,s=this._z,n=t.x,r=t.y,o=t.z;return this._set(i*o-s*r,s*n-e*o,e*r-i*n)}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e,this._z+(t.z-this._z)*e)}moveTowards(t,e){var i=Math.atan2(t.y-this._y,t.x-this._x),s=this._x-t.x,n=this._y-t.y,r=Math.sqrt(s*s+n*n);return 0===r||e>=0&&r<=e*e?t:this._set(this._x+Math.cos(i)*e,this._y+Math.sin(i)*e,this._z)}distance(t){var e=this._x-t.x,i=this._y-t.y,s=this._z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}clone(){return Dn.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return Dn.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}var nh={},rh={},oh={},ah={},hh={},lh={},dh=function(t,e,i){e=e||t.keyCode||t.button;var s=lh[e];if(Or(gr,s,e,!s||!oh[s]),s){if(!oh[s]){var n=void 0!==i?i:e;ah[s][n]||(nh[s]++,ah[s][n]=!0)}return!hh[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},ch=function(t,e,i){e=e||t.keyCode||t.button;var s=lh[e];if(Or(mr,s,e),s){var n=void 0!==i?i:e;return ah[s][n]=void 0,nh[s]>0&&nh[s]--,oh[s]=!1,!hh[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},uh=null;function ph(){null===uh&&!1===to&&"function"==typeof(uh=globalThis).addEventListener&&(uh.addEventListener("keydown",dh,!1),uh.addEventListener("keyup",ch,!1))}function fh(t,e,i){!0===e?dh({},t,i):ch({},t,i)}function gh(t){return lh[t]}var mh=new Nn;class yh extends Ia{constructor(t=0,e=0,i=1,s=1){super(),this.setMinMax(t,e,t+i,e+s),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(t,e=0,i=0,s=0,n=0,r=1){this.event=t,this.pageX=e,this.pageY=i,this.clientX=s,this.clientY=n,Xh(this.pageX,this.pageY,mh),this.gameScreenX=this.x=mh.x,this.gameScreenY=this.y=mh.y,this.isNormalized=void 0!==globalThis.PointerEvent&&!(t instanceof globalThis.PointerEvent),this.locked=qh,this.movementX=t.movementX||0,this.movementY=t.movementY||0,"wheel"===t.type?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=r,this.isPrimary=void 0===t.isPrimary||t.isPrimary,this.button=t.button||0,this.type=t.type,void 0!==Bl.viewport&&Bl.viewport.localToWorld(this.gameScreenX,this.gameScreenY,mh),this.gameWorldX=mh.x,this.gameWorldY=mh.y,!1===this.isNormalized?(this.width=t.width||1,this.height=t.height||1):"number"==typeof t.radiusX?(this.width=2*t.radiusX||1,this.height=2*t.radiusY||1):this.width=this.height=1}}var vh,xh=[],bh=new Map,wh=!1,_h=0,Eh=[];const Ch=["wheel"],Th=["pointermove","mousemove","touchmove"],Ah=["pointerdown","mousedown","touchstart"],Sh=["pointerup","mouseup","touchend"],Ph=["pointercancel","mousecancel","touchcancel"],Mh=["pointerenter","mouseenter","touchenter"],Oh=["pointerover","mouseover","touchover"],Lh=["pointerleave","mouseleave","touchleave"],kh=[Ch[0],Th[0],Ah[0],Sh[0],Ph[0],Mh[0],Oh[0],Lh[0]],Ih=[Ch[0],Th[1],Ah[1],Sh[1],Ph[1],Mh[1],Oh[1],Lh[1]],Rh=[Th[2],Ah[2],Sh[2],Ph[2],Mh[2],Oh[2],Lh[2]],Bh={wheel:Ch,pointermove:Th,pointerdown:Ah,pointerup:Sh,pointercancel:Ph,pointerenter:Mh,pointerover:Oh,pointerleave:Lh};var Dh=[];function Nh(){if(!wh){vh=new Ma(0,0,1,1);for(var t=0;t<po;t++)xh.push(new yh);var e;null===Wh&&(Wh=xc.getCanvas()),Eh=co?kh:Ih,uo&&!co&&(Eh=Eh.concat(Rh)),function(t,e){for(var i=0;i<t.length;i++)-1===Th.indexOf(t[i])&&Wh.addEventListener(t[i],e,{passive:!1===dl})}(Eh,Yh),void 0===Vh&&(Vh=~~(1e3/Sc.maxfps)),Vo(),Wh.addEventListener(Eh[2],(function(){Vo()}),{passive:!1===dl});var i=Gh(Eh,Th);if(Vh<17)for(e=0;e<i.length;e++)-1!==Eh.indexOf(i[e])&&Wh.addEventListener(i[e],Hh,{passive:!0});else for(e=0;e<i.length;e++)-1!==Eh.indexOf(i[e])&&Wh.addEventListener(i[e],Rn(Hh,Vh,!1),{passive:!0});Jh(Wh),go&&document.addEventListener("pointerlockchange",(()=>{qh=document.pointerLockElement===wc(),Or(wr,qh)}),!0),wh=!0}}function Fh(t,e){for(var i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return e[i]}function Gh(t,e){for(var i=[],s=0;s<e.length;s++)-1!==t.indexOf(e[s])&&i.push(e[s]);return i}function Uh(t,e,i,s){var n;if(t.callbacks[e]){t.pointerId=s;for(var r=t.callbacks[e].length-1;r>=0&&(n=t.callbacks[e][r]);r--)if(!1===n(i))return!0}return!1}function jh(t){for(var e=!1;t.length>0;){var i=t.pop();if(xh.push(i),!0===i.isNormalized&&void 0!==i.event.timeStamp){if(i.event.timeStamp<_h)continue;_h=i.event.timeStamp}vh.setShape(i.gameWorldX,i.gameWorldY,i.width,i.height),Th.includes(i.type)&&(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY,Or(br,i));for(var s,n=Bl.world.broadphase.retrieve(vh,Ml.prototype._sortReverseZ),r=(n=n.concat([Bl.viewport])).length;s=n[--r];){if(bh.has(s)&&!0!==s.isKinematic){var o,a=bh.get(s),h=a.region,l=h.ancestor,d=h.getBounds();if(!0===h.isFloating?(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY):(i.gameX=i.gameLocalX=i.gameWorldX,i.gameY=i.gameLocalY=i.gameWorldY),void 0!==l){var c=l.getBounds();i.gameLocalX=i.gameX-c.x,i.gameLocalY=i.gameY-c.y}var u=i.gameX,p=i.gameY;if(void 0!==h.currentTransform&&!h.currentTransform.isIdentity()){var f=h.currentTransform.applyInverse(Dn.pull("Vector2d",u,p));u=f.x,p=f.y,Dn.push(f)}switch(o=d.contains(u,p),i.type){case Th[0]:case Th[1]:case Th[2]:case Th[3]:if(a.pointerId!==i.pointerId||o){if(null===a.pointerId&&o&&Uh(a,Fh(Eh,Mh),i,i.pointerId)){e=!0;break}}else if(Uh(a,Fh(Eh,Lh),i,null)){e=!0;break}if(o&&Uh(a,i.type,i,i.pointerId)){e=!0;break}break;case Sh[0]:case Sh[1]:case Sh[2]:case Sh[3]:if(a.pointerId===i.pointerId&&o&&Uh(a,i.type,i,null)){e=!0;break}break;case Ph[0]:case Ph[1]:case Ph[2]:case Ph[3]:if(a.pointerId===i.pointerId&&Uh(a,i.type,i,null)){e=!0;break}break;default:if(o&&Uh(a,i.type,i,i.pointerId)){e=!0;break}}}if(!0===e)break}}return e}function zh(t){var e;if(lo&&t.changedTouches)for(var i=0,s=t.changedTouches.length;i<s;i++){var n=t.changedTouches[i];(e=xh.pop()).setEvent(t,n.pageX,n.pageY,n.clientX,n.clientY,n.identifier),Dh.push(e)}else(e=xh.pop()).setEvent(t,t.pageX,t.pageY,t.clientX,t.clientY,t.pointerId),Dh.push(e);return!1===t.isPrimary||(Dh[0].isPrimary=!0,Object.assign(Kh,Dh[0])),Dh}function Hh(t){jh(zh(t))}function Yh(t){zh(t);var e=Dh[0].button;(jh(Dh)||"wheel"===t.type)&&t.preventDefault();var i=Kh.bind[e];i&&fh(i,Ah.includes(t.type),e+1)}var Vh,Wh=null,Kh=new yh(0,0,1,1),qh=!1;function Xh(t,e,i){i=i||Dn.pull("Vector2d");var s=jo(xc.getCanvas()),n=globalThis.devicePixelRatio||1;t-=s.left+(globalThis.pageXOffset||0),e-=s.top+(globalThis.pageYOffset||0);var r=vc;return 1===r.x&&1===r.y||(t/=r.x,e/=r.y),i.set(t*n,e*n)}function Jh(t,e){t.style["touch-action"]=e||"none"}function Zh(t,e,i){if(Nh(),-1===kh.indexOf(t))throw new Error("invalid event type : "+t);if(void 0===e)throw new Error("registerPointerEvent: region for "+toString(e)+" event is undefined ");var s=Gh(Eh,Bh[t]);bh.has(e)||bh.set(e,{region:e,callbacks:{},pointerId:null});for(var n=bh.get(e),r=0;r<s.length;r++)t=s[r],n.callbacks[t]?n.callbacks[t].push(i):n.callbacks[t]=[i]}function Qh(t,e,i){if(-1===kh.indexOf(t))throw new Error("invalid event type : "+t);var s=Gh(Eh,Bh[t]),n=bh.get(e);if(void 0!==n){for(var r=0;r<s.length;r++)if(t=s[r],n.callbacks[t]){if(void 0!==i)An(n.callbacks[t],i);else for(;n.callbacks[t].length>0;)n.callbacks[t].pop();0===n.callbacks[t].length&&delete n.callbacks[t]}0===Object.keys(n.callbacks).length&&bh.delete(e)}}function $h(t){if(bh.has(t))for(var e=0;e<kh.length;e++)Qh(kh[e],t)}var tl=.1;function el(t,e,i){return t>0?i===this.GAMEPAD.BUTTONS.L2?Math.max(0,t-2e4)/111070:(t-1)/131070:(65536+t)/131070+.5}var il=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,sl=/^0+/;function nl(t,e){var i=t.replace(il,(function(t,e,i){return"000".slice(e.length-1)+e+"-"+"000".slice(i.length-1)+i+"-"})),s=t.replace(il,(function(t,e,i){return e.replace(sl,"")+"-"+i.replace(sl,"")+"-"}));e.analog=e.analog||e.buttons.map((function(){return-1})),e.normalize_fn=e.normalize_fn||function(t){return t},al.set(i,e),al.set(s,e)}var rl,ol={},al=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:function(t,e,i){return i===this.GAMEPAD.BUTTONS.L2||i===this.GAMEPAD.BUTTONS.R2?(t+1)/2:t}}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:el}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:el}]].forEach((function(t){nl(t[0],t[1])}));var hl=function(){var t=navigator.getGamepads();Object.keys(ol).forEach((function(e){var i=t[e];if(i){var s=null;"standard"!==i.mapping&&(s=al.get(i.id));var n=ol[e];Object.keys(n.buttons).forEach((function(t){var r=n.buttons[t],o=t,a=-1;if(!(s&&(o=s.buttons[t],a=s.analog[t],o<0&&a<0))){var h=i.buttons[o]||{};if(s&&a>=0){var l=s.normalize_fn(i.axes[a],-1,+t);h={value:l,pressed:h.pressed||Math.abs(l)>=tl}}Or(xr,e,"buttons",+t,h),!r.pressed&&h.pressed?fh(r.keyCode,!0,o+256):r.pressed&&!h.pressed&&fh(r.keyCode,!1,o+256),r.value=h.value,r.pressed=h.pressed}})),Object.keys(n.axes).forEach((function(t){var r=n.axes[t],o=t;if(!(s&&(o=s.axes[t])<0)){var a=i.axes[o];if(void 0!==a){s&&(a=s.normalize_fn(a,+t,-1));var h=Math.sign(a)||1;if(0!==r[h].keyCode){var l=Math.abs(a)>=tl+Math.abs(r[h].threshold);Or(xr,e,"axes",+t,a),!r[h].pressed&&l?(r[-h].pressed&&(fh(r[-h].keyCode,!1,o+256),r[-h].value=0,r[-h].pressed=!1),fh(r[h].keyCode,!0,o+256)):!r[h].pressed&&!r[-h].pressed||l||fh(r[h=r[h].pressed?h:-h].keyCode,!1,o+256),r[h].value=a,r[h].pressed=l}}}}))}}))};globalThis.navigator&&"function"==typeof globalThis.navigator.getGamepads&&(globalThis.addEventListener("gamepadconnected",(function(t){Or(yr,t.gamepad)}),!1),globalThis.addEventListener("gamepaddisconnected",(function(t){Or(vr,t.gamepad)}),!1));var ll=nl,dl=!0,cl=Object.freeze({__proto__:null,preventDefault:dl,get pointerEventTarget(){return Wh},pointer:Kh,get locked(){return qh},get throttlingInterval(){return Vh},globalToLocal:Xh,setTouchAction:Jh,bindPointer:function(){var t=arguments.length<2?Kh.LEFT:arguments[0],e=arguments.length<2?arguments[0]:arguments[1];if(Nh(),!gh(e))throw new Error("no action defined for keycode "+e);Kh.bind[t]=e},unbindPointer:function(t){Kh.bind[void 0===t?Kh.LEFT:t]=null},registerPointerEvent:Zh,releasePointerEvent:Qh,releaseAllPointerEvents:$h,requestPointerLock:function(){return!!go&&(wc().requestPointerLock(),!0)},exitPointerLock:function(){return!!go&&(document.exitPointerLock(),!0)},get keyBoardEventTarget(){return uh},KEY:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},initKeyboardEvent:ph,isKeyPressed:function(t){return!(!nh[t]||oh[t]||(rh[t]&&(oh[t]=!0),0))},keyStatus:function(t){return nh[t]>0},triggerKeyEvent:fh,bindKey:function(t,e,i,s=dl){lh[t]=e,hh[t]=s,nh[e]=0,rh[e]=i||!1,oh[e]=!1,ah[e]={}},getBindingKey:gh,unlockKey:function(t){oh[t]=!1},unbindKey:function(t){var e=lh[t];nh[e]=0,rh[e]=!1,ah[e]={},lh[t]=null,hh[t]=null},GAMEPAD:{AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}},bindGamepad:function(t,e,i){if(!gh(i))throw new Error("no action defined for keycode "+i);void 0===rl&&"function"==typeof navigator.getGamepads&&(rl=Lr(ar,hl)),ol[t]||(ol[t]={axes:{},buttons:{}});var s={keyCode:i,value:0,pressed:!1,threshold:e.threshold},n=ol[t][e.type];if("buttons"===e.type)n[e.code]=s;else if("axes"===e.type){var r=Math.sign(e.threshold)||1;n[e.code]||(n[e.code]={});var o=n[e.code];o[r]=s,o[-r]||(o[-r]={keyCode:0,value:0,pressed:!1,threshold:-r})}},unbindGamepad:function(t,e){if(!ol[t])throw new Error("no bindings for gamepad "+t);ol[t].buttons[e]={}},setGamepadDeadzone:function(t){tl=t},setGamepadMapping:ll});class ul extends Ma{constructor(t,e,i,s){super(t,e,i,s),this.isRenderable=!0,this.isKinematic=!0,this.body=void 0,void 0===this.currentTransform&&(this.currentTransform=Dn.pull("Matrix2d")),this.currentTransform.identity(),this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.anchorPoint instanceof eh?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=Dn.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.blendMode="normal",this.name="",this.pos instanceof sh?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=Dn.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.isDirty=!1,this._flip={x:!1,y:!1},this._inViewport=!1,this.setOpacity(1)}get isFloating(){return!0===this.floating||void 0!==this.ancestor&&!0===this.ancestor.floating}get tint(){return void 0===this._tint&&(this._tint=Dn.pull("Color",255,255,255,1)),this._tint}set tint(t){void 0===this._tint&&(this._tint=Dn.pull("Color",255,255,255,1)),t instanceof Wn?this._tint.copy(t):this._tint.parseCSS(t)}get inViewport(){return this._inViewport}set inViewport(t){this._inViewport!==t&&(this._inViewport=t,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,t))}get isFlippedX(){return!0===this._flip.x}get isFlippedY(){return!0===this._flip.y}getBounds(){return void 0===this._bounds&&(super.getBounds(),this.isFinite()?this._bounds.setMinMax(this.pos.x,this.pos.y,this.pos.x+this.width,this.pos.y+this.height):this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(t){"number"==typeof t&&(this.alpha=_n(t,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(t=!0){return this._flip.x=!!t,this.isDirty=!0,this}flipY(t=!0){return this._flip.y=!!t,this.isDirty=!0,this}transform(t){return this.currentTransform.multiply(t),this.updateBoundsPos(this.pos.x,this.pos.y),this.isDirty=!0,this}angleTo(t){var e,i,s=this.getBounds();if(t instanceof ul){var n=t.getBounds();e=n.centerX-s.centerX,i=n.centerY-s.centerY}else e=t.x-s.centerX,i=t.y-s.centerY;return Math.atan2(i,e)}distanceTo(t){var e,i,s=this.getBounds();if(t instanceof ul){var n=t.getBounds();e=s.centerX-n.centerX,i=s.centerY-n.centerY}else e=s.centerX-t.x,i=s.centerY-t.y;return Math.sqrt(e*e+i*i)}lookAt(t){var e;e=t instanceof ul?t.pos:t;var i=this.angleTo(e);return this.rotate(i),this}rotate(t,e){return isNaN(t)||(this.currentTransform.rotate(t,e),this.isDirty=!0),this}scale(t,e){return this.currentTransform.scale(t,e),super.scale(t,e),this.isDirty=!0,this}scaleV(t){return this.scale(t.x,t.y),this}update(t){return this.isDirty}updateBounds(){return super.updateBounds(),this.updateBoundsPos(this.pos.x,this.pos.y),this.getBounds()}updateBoundsPos(t,e){var i=this.getBounds();i.shift(t,e),void 0!==this.anchorPoint&&i.isFinite()&&i.translate(-this.anchorPoint.x*i.width,-this.anchorPoint.y*i.height),this.ancestor instanceof Ml&&!0!==this.floating&&i.translate(this.ancestor.getAbsolutePosition()),this.isDirty=!0}getAbsolutePosition(){return void 0===this._absPos&&(this._absPos=Dn.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),this.ancestor instanceof Ml&&!0!==this.floating&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(t,e){this.anchorPoint.setMuted(t,e),this.updateBoundsPos(this.pos.x,this.pos.y)}preDraw(t){var e=this.getBounds(),i=e.width*this.anchorPoint.x,s=e.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var n=this._flip.x?this.centerX-i:0,r=this._flip.y?this.centerY-s:0;t.translate(n,r),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-n,-r)}void 0!==this.mask&&(t.translate(this.pos.x,this.pos.y),t.setMask(this.mask),t.translate(-this.pos.x,-this.pos.y)),!0!==this.autoTransform||this.currentTransform.isIdentity()||(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-i,-s),t.setTint(this.tint,this.getOpacity()),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){}postDraw(t){t.clearTint(),void 0!==this.mask&&t.clearMask(),t.restore(),this.isDirty=!1}onCollision(t,e){return!1}destroy(){Dn.push(this.currentTransform),this.currentTransform=void 0,Dn.push(this.anchorPoint),this.anchorPoint=void 0,Dn.push(this.pos),this.pos=void 0,void 0!==this._absPos&&(Dn.push(this._absPos),this._absPos=void 0),Dn.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(Dn.push(this.mask),this.mask=void 0),void 0!==this._tint&&(Dn.push(this._tint),this._tint=void 0),this.ancestor=void 0,void 0!==this.body&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),$h(this),this.onDestroyEvent.apply(this,arguments)}onDestroyEvent(){}}for(var pl=[],fl=0;fl<10;fl++)pl.push(new Nn);for(var gl=[],ml=0;ml<5;ml++)gl.push([]);function yl(t,e,i){for(var s=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=t.length,o=0;o<r;o++){var a=t[o].dot(e);a<s&&(s=a),a>n&&(n=a)}i[0]=s,i[1]=n}function vl(t,e,i,s,n,r){var o=gl.pop(),a=gl.pop(),h=pl.pop().copy(e).sub(t),l=h.dot(n);if(yl(i,n,o),yl(s,n,a),a[0]+=l,a[1]+=l,o[0]>a[1]||a[0]>o[1])return pl.push(h),gl.push(o),gl.push(a),!0;if(r){var d=0;if(o[0]<a[0])if(r.aInB=!1,o[1]<a[1])d=o[1]-a[0],r.bInA=!1;else{var c=o[1]-a[0],u=a[1]-o[0];d=c<u?c:-u}else if(r.bInA=!1,o[1]>a[1])d=o[0]-a[1],r.aInB=!1;else{var p=o[1]-a[0],f=a[1]-o[0];d=p<f?p:-f}var g=Math.abs(d);g<r.overlap&&(r.overlap=g,r.overlapN.copy(n),d<0&&r.overlapN.negateSelf())}return pl.push(h),gl.push(o),gl.push(a),!1}function xl(t,e){var i=t.length2(),s=e.dot(t);return s<0?-1:s>i?1:0}function bl(t,e,i,s,n){for(var r=pl.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),o=s.radius,a=o*o,h=e.points,l=e.edges,d=l.length,c=pl.pop(),u=pl.pop(),p=pl.pop(),f=0,g=0;g<d;g++){var m=g===d-1?0:g+1,y=0===g?d-1:g-1,v=0,x=null;c.copy(l[g]),p.copy(r).sub(h[g]),n&&p.length2()>a&&(n.aInB=!1);var b=xl(c,p),w=!0;if(-1===b){var _=null;if(d>1&&(c.copy(l[y]),1!==(b=xl(c,_=pl.pop().copy(r).sub(h[y])))&&(w=!1)),w){if((f=p.length())>o)return pl.push(r),pl.push(c),pl.push(u),pl.push(p),_&&pl.push(_),!1;n&&(n.bInA=!1,x=p.normalize(),v=o-f)}_&&pl.push(_)}else if(1===b){if(d>1&&(c.copy(l[m]),p.copy(r).sub(h[m]),-1!==(b=xl(c,p))&&(w=!1)),w){if((f=p.length())>o)return pl.push(r),pl.push(c),pl.push(u),pl.push(p),!1;n&&(n.bInA=!1,x=p.normalize(),v=o-f)}}else{u.copy(e.normals[g]),f=p.dot(u);var E=Math.abs(f);if((1===d||f>0)&&E>o)return pl.push(r),pl.push(c),pl.push(u),pl.push(p),!1;n&&(x=u,v=o-f,(f>=0||v<2*o)&&(n.bInA=!1))}x&&n&&Math.abs(v)<Math.abs(n.overlap)&&(n.overlap=v,n.overlapN.copy(x))}return n&&(n.a=t,n.b=i,n.overlapV.copy(n.overlapN).scale(n.overlap)),pl.push(r),pl.push(c),pl.push(u),pl.push(p),!0}var wl=Object.freeze({__proto__:null,testPolygonPolygon:function(t,e,i,s,n){var r,o=e.points,a=e.normals,h=a.length,l=s.points,d=s.normals,c=d.length,u=pl.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(e.pos),p=pl.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos);for(r=0;r<h;r++)if(vl(u,p,o,l,a[r],n))return pl.push(u),pl.push(p),!1;for(r=0;r<c;r++)if(vl(u,p,o,l,d[r],n))return pl.push(u),pl.push(p),!1;return n&&(n.a=t,n.b=i,n.overlapV.copy(n.overlapN).scale(n.overlap)),pl.push(u),pl.push(p),!0},testEllipseEllipse:function(t,e,i,s,n){var r=pl.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),o=e.radius,a=s.radius,h=o+a,l=h*h,d=r.length2();if(d>l)return pl.push(r),!1;if(n){var c=Math.sqrt(d);n.a=t,n.b=i,n.overlap=h-c,n.overlapN.copy(r.normalize()),n.overlapV.copy(r).scale(n.overlap),n.aInB=o<=a&&c<=a-o,n.bInA=a<=o&&c<=o-a}return pl.push(r),!0},testPolygonEllipse:bl,testEllipsePolygon:function(t,e,i,s,n){var r=bl(i,s,t,e,n);if(r&&n){var o=n.a,a=n.aInB;n.overlapN.negateSelf(),n.overlapV.negateSelf(),n.a=n.b,n.b=o,n.aInB=n.bInA,n.bInA=a}return r}});let _l={pos:new Nn(0,0),ancestor:{_absPos:new Nn(0,0),getAbsolutePosition:function(){return this._absPos}}},El=new class{constructor(){this.a=null,this.b=null,this.overlapN=new Nn,this.overlapV=new Nn,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}};function Cl(t,e){return!0!==t.isKinematic&&!0!==e.isKinematic&&"object"==typeof t.body&&"object"==typeof e.body&&!(!0===t.body.isStatic&&!0===e.body.isStatic)&&0!=(t.body.collisionMask&e.body.collisionType)&&0!=(t.body.collisionType&e.body.collisionMask)}var Tl={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},rayCast:(t,e)=>function(t,e=[]){for(var i,s=0,n=Bl.world.broadphase.retrieve(t),r=n.length;i=n[--r];)if(i.body&&t.getBounds().overlaps(i.getBounds())){var o=i.body.shapes.length;if(0===i.body.shapes.length)continue;var a=t,h=0;do{var l=i.body.getShape(h);wl["test"+a.shapeType+l.shapeType].call(this,_l,a,i,l)&&(e[s]=i,s++),h++}while(h<o)}return e.length=s,e}(t,e)};class Al{constructor(t,e,i){if(this.ancestor=t,void 0===this.bounds&&(this.bounds=Dn.pull("Bounds")),void 0===this.shapes&&(this.shapes=[]),this.collisionMask=Tl.types.ALL_OBJECT,this.collisionType=Tl.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=Dn.pull("Vector2d")),this.vel.set(0,0),void 0===this.force&&(this.force=Dn.pull("Vector2d")),this.force.set(0,0),void 0===this.friction&&(this.friction=Dn.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=Dn.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,"function"==typeof i&&(this.onBodyUpdate=i),this.bounds.clear(),void 0!==e)if(Array.isArray(e))for(var s=0;s<e.length;s++)this.addShape(e[s]);else this.addShape(e);this.ancestor.isKinematic=!1}setStatic(t=!0){this.isStatic=!0===t}addShape(t){if(t instanceof Ma||t instanceof Ia){var e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof La?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof Pa?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):t instanceof Ba?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addPoint(t)):this.fromJSON(t);return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){var s=this.getShape(e);s instanceof Pa?s.setShape(0,0,t):this.shapes[e]=Dn.pull("Polygon",0,0,t),this.bounds.add(this.shapes[e].points,i),"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){var i=t;if(void 0!==e&&(i=t[e]),void 0===i)throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(var s=0;s<i.length;s++)this.addVertices(i[s].shape,s);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),An(this.shapes,t);for(var e=0;e<this.shapes.length;e++)this.addShape(this.shapes[e]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=Tl.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(void 0!==t){if(void 0===Tl.types[t])throw new Error("Invalid value for the collisionType property");this.collisionType=Tl.types[t]}}respondToCollision(t){var e=t.overlapV;if(this.ancestor.pos.sub(e),0!==e.x&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==e.y&&(this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){var i=!0===this.falling?1:!0===this.jumping?-1:0;this.falling=e.y>=i,this.jumping=e.y<=-i}}forEach(t,e){var i=this,s=0,n=this.shapes,r=n.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<r;)t.call(i,n[s],s,n),s++}contains(){var t,e;if(2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.getBounds().contains(t,e))for(var i,s=this.shapes.length;s--,i=this.shapes[s];)if(i.contains(t,e))return!0;return!1}rotate(t,e=this.getBounds().center){return this.bounds.clear(),this.forEach((i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds()),i instanceof La?this.bounds.translate(i.getBounds().x,i.getBounds().y):this.bounds.translate(i.pos)})),this}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t=0,e=0){this.friction.x=t,this.friction.y=e}update(t){var e=Sc.tick;if(0!==this.force.x&&(this.vel.x+=this.force.x*e),0!==this.force.y&&(this.vel.y+=this.force.y*e),this.friction.x>0){var i=this.friction.x*e,s=this.vel.x+i,n=this.vel.x-i;this.vel.x=s<0?s:n>0?n:0}if(this.friction.y>0){var r=this.friction.y*e,o=this.vel.y+r,a=this.vel.y-r;this.vel.y=o<0?o:a>0?a:0}return 0!==this.vel.y&&(this.vel.y=_n(this.vel.y,-this.maxVel.y,this.maxVel.y)),0!==this.vel.x&&(this.vel.x=_n(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=!this.falling&&this.jumping,this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y}destroy(){Dn.push(this.bounds),Dn.push(this.vel),Dn.push(this.force),Dn.push(this.friction),Dn.push(this.maxVel),this.shapes.forEach((t=>{Dn.push(t,!1)})),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}var Sl=function(t,e){this.removeChildNow(t,e)},Pl=0;class Ml extends ul{constructor(t=0,e=0,i=Bl.viewport.width,s=Bl.viewport.height,n=!1){super(t,e,i,s),this.pendingSort=null,this.root=n,this.children=void 0,this.sortOn=Bl.sortOn,this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(t){},this.enableChildBoundsUpdate=!1,this.backgroundColor=Dn.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),!0===this.root&&Lr(Er,this.updateBounds.bind(this,!0))}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var t,e=this.getChildren(),i=e.length;i>=0;t=e[--i])t&&!0!==t.isPersistent&&this.removeChildNow(t);void 0!==this.currentTransform&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(t,e){return t.ancestor instanceof Ml?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=Ac.createGUID(t.id)),t.ancestor=this,this.getChildren().push(t),void 0!==t.pos&&("number"==typeof e?t.pos.z=e:!0===this.autoDepth&&(t.pos.z=this.getChildren().length)),!0===this.autoSort&&this.sort(),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.isAttachedToRoot()&&Bl.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),t.body instanceof Al&&Bl.world.addBody(t.body),this.onChildChange.call(this,this.getChildren().length-1),t}addChildAt(t,e){if(e>=0&&e<this.getChildren().length)return t.ancestor instanceof Ml?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=Ac.createGUID()),t.ancestor=this,this.getChildren().splice(e,0,t),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.isAttachedToRoot()&&Bl.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),t.body instanceof Al&&Bl.world.addBody(t.body),this.onChildChange.call(this,e),t;throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")}forEach(t,e){var i=this,s=0,n=this.getChildren(),r=n.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<r;)t.call(i,n[s],s,n),s++}swapChildren(t,e){var i=this.getChildIndex(t),s=this.getChildIndex(e);if(-1===i||-1===s)throw new Error(t+" Both the supplied childs must be a child of the caller "+this);var n=t.pos.z;t.pos.z=e.pos.z,e.pos.z=n,this.getChildren()[i]=e,this.getChildren()[s]=t,this.isDirty=!0}getChildAt(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")}getChildIndex(t){return this.getChildren().indexOf(t)}getNextChild(t){var e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)}hasChild(t){return this===t.ancestor}getChildByProp(t,e){var i=[];return this.forEach((s=>{!function(t,s){var n=t[s];e instanceof RegExp&&"string"==typeof n?e.test(n)&&i.push(t):n===e&&i.push(t)}(s,t),s instanceof Ml&&(i=i.concat(s.getChildByProp(t,e)))})),i}getChildByType(t){var e=[];return this.forEach((i=>{i instanceof t&&e.push(i),i instanceof Ml&&(e=e.concat(i.getChildByType(t)))})),e}getChildByName(t){return this.getChildByProp("name",t)}getChildByGUID(t){var e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null}getChildren(){return void 0===this.children&&(this.children=[]),this.children}updateBounds(t=!1){super.updateBounds();var e=this.getBounds();return!0!==t&&!0!==this.enableChildBoundsUpdate||this.forEach((t=>{t.isRenderable&&t.getBounds().isFinite()&&e.addBounds(t.getBounds())})),e}isAttachedToRoot(){if(!0===this.root)return!0;for(var t=this.ancestor;t;){if(!0===t.root)return!0;t=t.ancestor}return!1}updateBoundsPos(t,e){return super.updateBoundsPos(t,e),this.forEach((i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)})),this.getBounds()}onActivateEvent(){this.forEach((t=>{"function"==typeof t.onActivateEvent&&t.onActivateEvent()}))}removeChild(t,e){if(!this.hasChild(t))throw new Error("Child is not mine.");Ac.function.defer(Sl,this,t,e)}removeChildNow(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent(),t.body instanceof Al&&Bl.world.removeBody(t.body),e||!1===Dn.push(t,!1)&&"function"==typeof t.destroy&&t.destroy();var i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),!0===this.isAttachedToRoot()&&Bl.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,i)}}setChildsProperty(t,e,i){this.forEach((s=>{!0===i&&s instanceof Ml&&s.setChildsProperty(t,e,i),s[t]=e}))}moveUp(t){var e=this.getChildIndex(t);e-1>=0&&(this.swapChildren(t,this.getChildAt(e-1)),this.isDirty=!0)}moveDown(t){var e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&(this.swapChildren(t,this.getChildAt(e+1)),this.isDirty=!0)}moveToTop(t){var e=this.getChildIndex(t);if(e>0){var i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(t){var e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(t){this.pendingSort||(!0===t&&this.forEach((e=>{e instanceof Ml&&e.sort(t)})),this.pendingSort=Ac.function.defer((function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,Bl.repaint()}),this))}onDeactivateEvent(){this.forEach((t=>{"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent()}))}_sortZ(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0}_sortReverseZ(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0}_sortX(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z||e.pos.x-t.pos.x:t.pos?-1/0:1/0}_sortY(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z||e.pos.y-t.pos.y:t.pos?-1/0:1/0}destroy(){this.reset(),super.destroy(arguments)}update(t){for(var e,i=!1,s=sd.isPaused(),n=this.getChildren(),r=n.length;r--,e=n[r];)s&&!e.updateWhenPaused||(e.isRenderable?((i=Pl>0||e.floating)&&Pl++,e.inViewport=!1,sd.current().cameras.forEach((function(t){t.isVisible(e,i)&&(e.inViewport=!0)})),this.isDirty|=(e.inViewport||e.alwaysUpdate)&&e.update(t),Pl>0&&Pl--):this.isDirty|=e.update(t));return super.update(t)}draw(t,e){var i=!1,s=this.getBounds();this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===s.isFinite()&&t.clipRect(s.left,s.top,s.width,s.height),t.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&t.clearColor(this.backgroundColor);for(var n,r=this.getChildren(),o=r.length;n=r[--o];)n.isRenderable&&(i=!0===n.floating,(n.inViewport||i)&&(i&&(t.save(),t.resetTransform()),n.preDraw(t),n.draw(t,e),n.postDraw(t),i&&t.restore(),this.drawCount++))}}var Ol=[];function Ll(t,e,i=4,s=4,n=0){if(Ol.length>0){var r=Ol.pop();return r.world=t,r.bounds=e,r.max_objects=i,r.max_levels=s,r.level=n,r}return new Il(t,e,i,s,n)}var kl=new Nn;class Il{constructor(t,e,i=4,s=4,n=0){this.world=t,this.bounds=e,this.max_objects=i,this.max_levels=s,this.level=n,this.bounds=e,this.objects=[],this.nodes=[]}split(){this.level;var t=this.bounds.width/2,e=this.bounds.height/2,i=this.bounds.left,s=this.bounds.top;this.nodes[0]=Ll(this.world,this.bounds,{left:i+t,top:s,width:t,height:e},this.max_objects,this.max_levels),this.nodes[1]=Ll(this.world,this.bounds,{left:i,top:s,width:t,height:e},this.max_objects,this.max_levels),this.nodes[2]=Ll(this.world,this.bounds,{left:i,top:s+e,width:t,height:e},this.max_objects,this.max_levels),this.nodes[3]=Ll(this.world,this.bounds,{left:i+t,top:s+e,width:t,height:e},this.max_objects,this.max_levels)}getIndex(t){var e,i=t.getBounds(),s=-1,n=(e=!0===t.isFloating?this.world.app.viewport.localToWorld(i.left,i.top,kl):kl.set(t.left,t.top)).x,r=e.y,o=i.width,a=i.height,h=this.bounds.left+this.bounds.width/2,l=this.bounds.top+this.bounds.height/2,d=r<l&&r+a<l,c=r>l;return n<h&&n+o<h?d?s=1:c&&(s=2):n>h&&(d?s=0:c&&(s=3)),s}insertContainer(t){for(var e,i=t.children.length;i--,e=t.children[i];)!0!==e.isKinematic&&(e instanceof Ml?("rootContainer"!==e.name&&this.insert(e),this.insertContainer(e)):"function"==typeof e.getBounds&&this.insert(e))}insert(t){var e=-1;if(this.nodes.length>0&&-1!==(e=this.getIndex(t)))this.nodes[e].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();for(var i=0;i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i+=1}}retrieve(t,e){var i=this.objects;if(this.nodes.length>0){var s=this.getIndex(t);if(-1!==s)i=i.concat(this.nodes[s].retrieve(t));else for(var n=0;n<this.nodes.length;n+=1)i=i.concat(this.nodes[n].retrieve(t))}return"function"==typeof e&&i.sort(e),i}remove(t){var e=!1;if(void 0===t.getBounds)return!1;if(this.nodes.length>0){var i=this.getIndex(t);-1!==i&&(e=An(this.nodes[i],t))&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1)}return!1===e&&-1!==this.objects.indexOf(t)&&(An(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(var t=0;t<this.nodes.length;t+=1){var e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(var e=0;e<this.nodes.length;e++)this.nodes[e].clear(),i=this.nodes[e],Ol.push(i);var i;this.nodes.length=0,void 0!==t&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}class Rl extends Ml{constructor(t=0,e=0,i=1/0,s=1/0){super(t,e,i,s,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=null,this.fps=60,this.gravity=new Nn(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new Il(this,this.getBounds().clone(),Tl.maxChildren,Tl.maxDepth),Lr(or,this.reset,this),Lr(ur,(()=>{this.broadphase.clear(this.getBounds())}))}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(t){return this.bodies.add(t),this}removeBody(t){return this.bodies.delete(t),this}bodyApplyGravity(t){if(!t.ignoreGravity&&0!==t.gravityScale){var e=this.gravity;t.force.x+=t.mass*e.x*t.gravityScale,t.force.y+=t.mass*e.y*t.gravityScale}}update(t){var e=sd.isPaused();return this.broadphase.clear(),this.broadphase.insertContainer(this),this.bodies.forEach((i=>{if(!i.isStatic){var s=i.ancestor;e&&!s.updateWhenPaused||!s.inViewport&&!s.alwaysUpdate||(this.bodyApplyGravity(i),!0===i.update(t)&&(s.isDirty=!0),function(t,e=El){for(var i,s=Bl.world.broadphase.retrieve(t),n=s.length;i=s[--n];)if(i!==t&&Cl(t,i)&&t.body.getBounds().overlaps(i.body.getBounds())){var r=t.body.shapes.length,o=i.body.shapes.length;if(0===r||0===o)continue;var a=0;do{var h=t.body.getShape(a),l=0;do{var d=i.body.getShape(l);!0===wl["test"+h.shapeType+d.shapeType].call(this,t,h,i,d,e.clear())&&(e.indexShapeA=a,e.indexShapeB=l,t.onCollision&&!1!==t.onCollision(e,i)&&!1===t.body.isStatic&&t.body.respondToCollision.call(t.body,e),i.onCollision&&!1!==i.onCollision(e,t)&&!1===i.body.isStatic&&i.body.respondToCollision.call(i.body,e)),l++}while(l<o);a++}while(a<r)}}(s),i.force.set(0,0))}})),super.update(t)}}let Bl=new class{constructor(){this.viewport=null,this.world=null,this.mergeGroup=!0,this.sortOn="z",this.lastUpdate=0,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0}init(){this.world=new Rl,this.world.app=this,this.lastUpdate=globalThis.performance.now(),Or(rr,this)}reset(){var t=sd.get();void 0!==t&&(this.viewport=t.cameras.get("default")),Or(or),this.updateFrameRate()}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/Sc.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=10*this.stepSize,this.isAlwaysDirty=Sc.maxfps>this.world.fps}getParentContainer(t){return t.ancestor}repaint(){this.isDirty=!0}update(t,e){if(++this.frameCounter%this.frameRate==0){for(this.frameCounter=0,Or(ar,t),this.accumulator+=Sc.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=Sc.interpolation?Sc.getDelta():this.stepSize,this.accumulatorUpdateDelta=Sc.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||Sc.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),!0!==sd.isPaused()&&Or(lr,t),this.isDirty=e.update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,Sc.interpolation){this.accumulator=0;break}Or(hr,this.lastUpdate)}}draw(t){!0===xc.isContextValid&&(this.isDirty||this.isAlwaysDirty)&&(Or(dr,globalThis.performance.now()),xc.clear(),t.draw(xc),this.isDirty=!1,xc.flush(),Or(cr,globalThis.performance.now()))}};Lr(Qn,(()=>{Bl.init()}));const Dl=Math.min,Nl=Math.max;var Fl,Gl=new Nn;class Ul extends ul{constructor(t,e,i,s){super(t,e,i-t,s-e),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=Dn.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new Kn,this.invCurrentTransform=new qn,this.offset=new Nn,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,s),this._updateProjectionMatrix(),Lr(or,this.reset,this),Lr(Er,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(t){var e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=Dl(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=Nl(t.x-this.deadzone.pos.x,this.bounds.left)),e}_followV(t){var e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=Dl(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=Nl(t.y-this.deadzone.pos.y,this.bounds.top)),e}reset(t=0,e=0){this.pos.x=t,this.pos.y=e,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(t,e){void 0===this.deadzone&&(this.deadzone=new Ma(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-.25*e)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(t,e){return super.resize(t,e),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),Or(Cr,this.width,this.height,this),this}setBounds(t,e,i,s){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,s+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(t,e,i){if(t instanceof ul)this.target=t.pos;else{if(!(t instanceof Nn||t instanceof ih||t instanceof eh||t instanceof sh))throw new Error("invalid target for me.Camera2d.follow");this.target=t}this.follow_axis=void 0===e?this.AXIS.BOTH:e,this.smoothFollow=!1,this.damping="number"!=typeof i?1:_n(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)}moveTo(t,e){var i=this.pos.x,s=this.pos.y;this.pos.x=_n(t,this.bounds.left,this.bounds.width),this.pos.y=_n(e,this.bounds.top,this.bounds.height),i===this.pos.x&&s===this.pos.y||(this.isDirty=!0)}updateTarget(){if(this.target){switch(Gl.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:Gl.x=this._followH(this.target);break;case this.AXIS.VERTICAL:Gl.y=this._followV(this.target);break;case this.AXIS.BOTH:Gl.x=this._followH(this.target),Gl.y=this._followV(this.target)}if(!this.pos.equals(Gl)){if(!0===this.smoothFollow&&this.damping<1){if(Tn(Gl.x,this.pos.x,2)&&Tn(Gl.y,this.pos.y,2))return void this.pos.setV(Gl);this.pos.lerp(Gl,this.damping)}else this.pos.setV(Gl);this.isDirty=!0}}}update(t){return this.updateTarget(t),this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),!0===this.isDirty&&Or(Sr,this.pos),null==this._fadeIn.tween&&null==this._fadeOut.tween||(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(t)}shake(t,e,i,s,n){0!==this._shake.duration&&!0!==n||(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete="function"==typeof s?s:void 0)}fadeOut(t,e=1e3,i){this._fadeOut.color=Dn.pull("Color").copy(t),this._fadeOut.tween=Dn.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(t,e=1e3,i){this._fadeIn.color=Dn.pull("Color").copy(t);var s=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=Dn.pull("Tween",this._fadeIn.color).to({alpha:s},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(t){var e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)}isVisible(t,e=t.floating){return!0===e||!0===t.floating?xc.overlaps(t.getBounds()):t.getBounds().overlaps(this)}localToWorld(t,e,i){return(i=i||Dn.pull("Vector2d")).set(t,e).add(this.pos).sub(Bl.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(t,e,i){return(i=i||Dn.pull("Vector2d")).set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(Bl.world.pos)}drawFX(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,Dn.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,Dn.push(this._fadeOut.color),this._fadeOut.color=null))}draw(t,e){var i=this.pos.x+this.offset.x,s=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-s),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t,this),e.draw(t,this),this.drawFX(t),e.postDraw(t,this),this.postDraw(t),e.currentTransform.translate(i,s)}}var jl={cameras:[]};class zl{constructor(t){this.cameras=new Map,this.lights=new Map,this.ambientLight=new Wn(0,0,0,0),this.settings=Object.assign(jl,t||{})}reset(){if(this.settings.cameras.forEach((t=>{this.cameras.set(t.name,t)})),!1===this.cameras.has("default")){if(void 0===Fl){var t=xc.getWidth(),e=xc.getHeight();Fl=new Ul(0,0,t,e)}this.cameras.set("default",Fl)}Bl.reset(),this.onResetEvent.apply(this,arguments)}update(t){var e=Bl.world.update(t);return this.cameras.forEach((function(i){!0===i.update(t)&&(e=!0)})),this.lights.forEach((i=>{!0===i.update(t)&&(e=!0)})),e}draw(t){this.cameras.forEach((e=>{e.draw(t,Bl.world),0!==this.ambientLight.alpha&&(t.save(),this.lights.forEach((e=>{t.setMask(e.getVisibleArea(),!0)})),t.setColor(this.ambientLight),t.fillRect(0,0,e.width,e.height),t.clearMask(),t.restore()),this.lights.forEach((e=>{e.preDraw(t,Bl.world),e.draw(t,Bl.world),e.postDraw(t,Bl.world)}))}))}destroy(){this.cameras.clear(),this.lights.forEach((t=>{t.destroy()})),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){"function"==typeof this.settings.onResetEvent&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){"function"==typeof this.settings.onDestroyEvent&&this.settings.onDestroyEvent.apply(this,arguments)}}class Hl extends ul{constructor(t,e,i,s){super(t,e,i,s),this.barHeight=s,this.anchorPoint.set(0,0),Lr(fr,this.onProgressUpdate,this),Lr(Cr,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(t){this.progress=~~(t*this.width),this.isDirty=!0}draw(t,e){t.setColor("black"),t.fillRect(this.pos.x,e.centerY,t.getWidth(),this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,e.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Ir(fr,this.onProgressUpdate),Ir(Cr,this.resize)}}class Yl extends zl{onResetEvent(){Bl.world.backgroundColor.parseCSS("#202020"),Bl.world.addChild(new Hl(0,xc.getHeight()/2,xc.getWidth(),8),1),Vd.load({name:"melonjs_logo",type:"image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII="},(()=>{Bl.world.addChild(new Wd(xc.getWidth()/2,xc.getHeight()/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)}))}onDestroyEvent(){Vd.unload({name:"melonjs_logo",type:"image"})}}var Vl=-1,Wl=-1,Kl=!1,ql={},Xl={color:"",duration:0},Jl=null,Zl=null,Ql=0;function $l(){-1===Wl&&-1!==Vl&&(Wl=globalThis.requestAnimationFrame(td))}function td(t){var e=ql[Vl].stage;Bl.update(t,e),Bl.draw(e),-1!==Wl&&(Wl=globalThis.requestAnimationFrame(td))}function ed(){globalThis.cancelAnimationFrame(Wl),Wl=-1}function id(t){ed(),ql[Vl]&&ql[Vl].stage.destroy(),ql[t]&&(ql[Vl=t].stage.reset.apply(ql[Vl].stage,Zl),$l(),Or(sr),Jl&&Jl(),Bl.repaint())}Lr(Qn,(()=>{sd.set(sd.LOADING,new Yl),sd.set(sd.DEFAULT,new zl),Lr(nr,(()=>{sd.change(sd.DEFAULT,!0)})),"function"==typeof globalThis.addEventListener&&(globalThis.addEventListener("blur",(()=>{sd.pause(!0)}),!1),globalThis.addEventListener("focus",(()=>{sd.resume(!0),Vo()}),!1)),void 0!==globalThis.document&&"function"==typeof globalThis.document.addEventListener&&globalThis.document.addEventListener("visibilitychange",(()=>{"visible"===globalThis.document.visibilityState?sd.resume(!0):sd.pause(!0)}),!1)}));var sd={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(t=!1){Vl!==this.LOADING&&this.isRunning()&&(ed(),!0===t&&t(),Ql=globalThis.performance.now(),Or(er))},pause(t=!1){Vl===this.LOADING||this.isPaused()||(Kl=!0,!0===t&&Ka(),Ql=globalThis.performance.now(),Or($n))},restart(t=!1){this.isRunning()||($l(),!0===t&&qa(),Ql=globalThis.performance.now()-Ql,Bl.repaint(),Or(ir,Ql))},resume(t=!1){this.isPaused()&&(Kl&&-1!==Vl&&(Kl=!1),!0===t&&qa(),Ql=globalThis.performance.now()-Ql,Or(tr,Ql))},isRunning:()=>-1!==Wl,isPaused:()=>Kl,set(t,e,i=!1){if(!(e instanceof zl))throw new Error(e+" is not an instance of me.Stage");ql[t]={},ql[t].stage=e,ql[t].transition=!0,!0===i&&this.change(t)},get:(t=Vl)=>void 0!==ql[t]?ql[t].stage:void 0,current(){return this.get()},transition(t,e,i){"fade"===t&&(Xl.color=e,Xl.duration=i)},setTransition(t,e){ql[t].transition=e},change(t,e){if(void 0===ql[t])throw new Error("Undefined Stage for state '"+t+"'");this.isCurrent(t)||(Zl=null,arguments.length>1&&(Zl=Array.prototype.slice.call(arguments,1)),Xl.duration&&ql[t].transition?(Jl=()=>{Bl.viewport.fadeOut(Xl.color,Xl.duration)},Bl.viewport.fadeIn(Xl.color,Xl.duration,(function(){In(id,this,t)}))):!0===e?id(t):In(id,this,t))},isCurrent:t=>Vl===t};function nd(t,e,i){var s;if("string"!=typeof i)return i;switch(e){case"int":case"float":i=Number(i);break;case"bool":i="true"===i;break;default:if(!i||hn(i))i=!i||"true"===i;else if(an(i))i=Number(i);else if(0===i.search(/^json:/i)){s=i.split(/^json:/i)[1];try{i=JSON.parse(s)}catch(t){throw new Error("Unable to parse JSON: "+s)}}else if(0===i.search(/^eval:/i)){s=i.split(/^eval:/i)[1];try{i=Function("'use strict';return ("+s+")")()}catch(t){throw new Error("Unable to evaluate: "+s)}}else((s=i.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(s=i.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(i="#"+s[2]+s[1]);0===t.search(/^(ratio|anchorPoint)$/)&&"number"==typeof i&&(i={x:i,y:i})}return i}function rd(t,e,i){switch(i=i||"none",e=e||"none"){case"csv":return function(t){for(var e=t.replace("\n","").trim().split(","),i=[],s=0;s<e.length;s++)i.push(+e[s]);return i}(t);case"base64":var s=function(t,e){var i,s,n;e=e||1;var r=globalThis.atob(t.replace(/[^A-Za-z0-9\+\/\=]/g,"")),o=new Uint32Array(r.length/e);for(i=0,n=r.length/e;i<n;i++)for(o[i]=0,s=e-1;s>=0;--s)o[i]+=r.charCodeAt(i*e+s)<<(s<<3);return o}(t,4);return"none"===i?s:function(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}();case"none":return t;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+e)}}function od(t,e){var i=e.nodeName;switch(i){case"data":var s=ad(e);s.text=s.text||s.chunk.text,s.encoding=s.encoding||"xml",t.data=rd(s.text,s.encoding,s.compression),t.encoding="none";break;case"imagelayer":case"layer":case"objectgroup":case"group":var n=ad(e);n.type="layer"===i?"tilelayer":i,n.image&&(n.image=n.image.source),t.layers=t.layers||[],t.layers.push(n);break;case"animation":t.animation=ad(e).frames;break;case"frame":case"object":var r=i+"s";t[r]=t[r]||[],t[r].push(ad(e));break;case"tile":var o=ad(e);o.image&&(o.imagewidth=o.image.width,o.imageheight=o.image.height,o.image=o.image.source),t.tiles=t.tiles||{},t.tiles[o.id]=o;break;case"tileset":var a=ad(e);a.image&&(a.imagewidth=a.image.width,a.imageheight=a.image.height,a.image=a.image.source),t.tilesets=t.tilesets||[],t.tilesets.push(a);break;case"polygon":case"polyline":t[i]=[];for(var h,l=ad(e).points.split(" "),d=0;d<l.length;d++)h=l[d].split(","),t[i].push({x:+h[0],y:+h[1]});break;case"properties":t.properties=ad(e);break;case"property":var c=ad(e),u=void 0!==c.value?c.value:c.text;t[c.name]=nd(c.name,c.type||"string",u);break;default:t[i]=ad(e)}}function ad(t){var e={},i="";if(1===t.nodeType&&function(t,e){if(e.attributes&&e.attributes.length>0)for(var i=0;i<e.attributes.length;i++){var s=e.attributes.item(i);void 0!==s.name?t[s.name]=s.value:t[s.nodeName]=s.nodeValue}}(e,t),t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var n=t.childNodes.item(s);switch(n.nodeType){case 1:od(e,n);break;case 3:i+=n.nodeValue.trim()}}return i&&(e.text=i),e}function hd(t,e){var i=e.properties,s=e.propertytypes;if(void 0!==i)for(var n in i)if(i.hasOwnProperty(n)){var r="string",o=n,a=i[n];void 0!==i[n].name&&(o=i[n].name),void 0!==s?r=s[n]:void 0!==i[n].type&&(r=i[n].type),void 0!==i[n].value&&(a=i[n].value),t[o]=nd(o,r,a)}}const ld=536870911;class dd extends Ia{constructor(t,e,i,s){var n,r;if(super(),s.isCollection){var o=s.getTileImage(i&ld);n=o.width,r=o.height}else n=s.tilewidth,r=s.tileheight;this.setMinMax(0,0,n,r),this.tileset=s,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=0!=(2147483648&this.tileId),this.flippedY=0!=(1073741824&this.tileId),this.flippedAD=0!=(536870912&this.tileId),this.flipped=this.flippedX||this.flippedY||this.flippedAD,!0===this.flipped&&(null===this.currentTransform&&(this.currentTransform=new qn),this.setTileTransform(this.currentTransform.identity())),this.tileId&=ld}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){var e,i=this.tileset;if(i.animations.has(this.tileId)){var s=[],n=[];i.animations.get(this.tileId).frames.forEach((function(t){n.push(t.tileid),s.push({name:""+t.tileid,delay:t.duration})})),(e=i.texture.createAnimationFromName(n,t)).addAnimation(this.tileId-i.firstgid,s),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(!0===i.isCollection){var r=i.getTileImage(this.tileId);(e=new Wd(0,0,Object.assign({image:r}))).anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),void 0!==t.rotation&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else(e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t)).anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}class cd extends Da{constructor(t){super(t),this.context=this.getContext2d(this.getCanvas(),this.settings.transparent),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new dc,!1===this.settings.textureSeamFix||this.settings.antiAlias||(this.uvOffset=1),this.getCanvas().addEventListener("contextlost",(t=>{t.preventDefault(),this.isContextValid=!1,Or(Pr,this)}),!1),this.getCanvas().addEventListener("contextrestored",(()=>{this.isContextValid=!0,Or(Mr,this)}),!1)}reset(){super.reset(),this.clearColor(this.currentColor,!0!==this.settings.transparent)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(t="normal",e){switch(e=e||this.getContext(),this.currentBlendMode=t,t){case"screen":e.globalCompositeOperation="screen";break;case"lighter":case"additive":e.globalCompositeOperation="lighter";break;case"multiply":e.globalCompositeOperation="multiply";break;default:e.globalCompositeOperation="source-over",this.currentBlendMode="normal"}}clear(){if(!1===this.settings.transparent){var t=this.getCanvas();this.getContext().clearRect(0,0,t.width,t.height)}}clearColor(t="#000000",e=!1){var i=this.getCanvas(),s=this.getContext();this.save(),this.resetTransform(),s.globalAlpha=1,s.globalCompositeOperation=!0===e?"copy":"source-over",s.fillStyle=t instanceof Wn?t.toRGBA():t,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(t,e,i,s){this.getContext().clearRect(t,e,i,s)}createPattern(t,e){return this.getContext().createPattern(t,e)}drawImage(t,e,i,s,n,r,o,a,h){if(!(this.getGlobalAlpha()<1/255)){var l=this.getContext();void 0===s?(s=a=t.width,n=h=t.height,r=e,o=i,e=0,i=0):void 0===r&&(r=e,o=i,a=s,h=n,s=t.width,n=t.height,e=0,i=0),!1===this.settings.subPixel&&(r=~~r,o=~~o);var d=t,c=this.currentTint.toArray();1===c[0]&&1===c[1]&&1===c[2]||(d=this.cache.tint(t,this.currentTint.toRGB())),l.drawImage(d,e,i,s,n,r,o,a,h)}}drawPattern(t,e,i,s,n){if(!(this.getGlobalAlpha()<1/255)){var r=this.getContext(),o=r.fillStyle;r.fillStyle=t,r.fillRect(e,i,s,n),r.fillStyle=o}}strokeArc(t,e,i,s,n,r,o=!1){if(!(this.getGlobalAlpha()<1/255)){var a=this.getContext();a.translate(t,e),a.beginPath(),a.arc(0,0,i,s,n,r||!1),a[!0===o?"fill":"stroke"](),a.translate(-t,-e)}}fillArc(t,e,i,s,n,r){this.strokeArc(t,e,i,s,n,r||!1,!0)}strokeEllipse(t,e,i,s,n=!1){if(!(this.getGlobalAlpha()<1/255)){var r=this.getContext(),o=t-i,a=t+i,h=e-s,l=e+s,d=.551784*i,c=.551784*s,u=t-d,p=t+d,f=e-c,g=e+c;r.beginPath(),r.moveTo(t,h),r.bezierCurveTo(p,h,a,f,a,e),r.bezierCurveTo(a,g,p,l,t,l),r.bezierCurveTo(u,l,o,g,o,e),r.bezierCurveTo(o,f,u,h,t,h),r[!0===n?"fill":"stroke"](),r.closePath()}}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!0)}strokeLine(t,e,i,s){if(!(this.getGlobalAlpha()<1/255)){var n=this.getContext();n.beginPath(),n.moveTo(t,e),n.lineTo(i,s),n.stroke()}}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){if(!(this.getGlobalAlpha()<1/255)){var i,s=this.getContext();this.translate(t.pos.x,t.pos.y),s.beginPath(),s.moveTo(t.points[0].x,t.points[0].y);for(var n=1;n<t.points.length;n++)i=t.points[n],s.lineTo(i.x,i.y);s.lineTo(t.points[0].x,t.points[0].y),s[!0===e?"fill":"stroke"](),s.closePath(),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,n=!1){this.getGlobalAlpha()<1/255||this.getContext()[!0===n?"fillRect":"strokeRect"](t,e,i,s)}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,n,r=!1){if(!(this.getGlobalAlpha()<1/255)){var o=this.getContext();o.beginPath(),o.roundRect(t,e,i,s,n),o[!0===r?"fill":"stroke"]()}}fillRoundRect(t,e,i,s,n){this.strokeRoundRect(t,e,i,s,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}getFontContext(){return this.getContext()}save(){this.getContext().save()}restore(){this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height}rotate(t){this.getContext().rotate(t)}scale(t,e){this.getContext().scale(t,e)}setColor(t){var e=this.getContext();e.strokeStyle=e.fillStyle=t instanceof Wn?t.toRGBA():t}setGlobalAlpha(t){this.getContext().globalAlpha=this.currentColor.glArray[3]=t}getGlobalAlpha(){return this.getContext().globalAlpha}setLineWidth(t){this.getContext().lineWidth=t}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=t.toArray(),i=e[0],s=e[1],n=e[3],r=e[4],o=e[6],a=e[7];!1===this.settings.subPixel&&(o|=0,a|=0),this.getContext().transform(i,s,n,r,o,a)}translate(t,e){!1===this.settings.subPixel?this.getContext().translate(~~t,~~e):this.getContext().translate(t,e)}clipRect(t,e,i,s){var n=this.getCanvas();if(0!==t||0!==e||i!==n.width||s!==n.height){var r=this.currentScissor;if(r[0]!==t||r[1]!==e||r[2]!==i||r[3]!==s){var o=this.getContext();o.beginPath(),o.rect(t,e,i,s),o.clip(),r[0]=t,r[1]=e,r[2]=i,r[3]=s}}}setMask(t,e=!1){var i=this.getContext();if(0===this.maskLevel&&(i.save(),i.beginPath()),t instanceof Oa)i.roundRect(t.top,t.left,t.width,t.height,t.radius);else if(t instanceof Ma||t instanceof Ia)i.rect(t.top,t.left,t.width,t.height);else if(t instanceof La){const e=t.pos.x,l=t.pos.y,d=t.radiusV.x,c=t.radiusV.y,u=e-d,p=e+d,f=l-c,g=l+c;var s=.551784*d,n=.551784*c,r=e-s,o=e+s,a=l-n,h=l+n;i.moveTo(e,f),i.bezierCurveTo(o,f,p,a,p,l),i.bezierCurveTo(p,h,o,g,e,g),i.bezierCurveTo(r,g,u,h,u,l),i.bezierCurveTo(u,a,r,f,e,f)}else{const e=t.pos.x,s=t.pos.y;var l;i.moveTo(e+t.points[0].x,s+t.points[0].y);for(var d=1;d<t.points.length;d++)l=t.points[d],i.lineTo(e+l.x,s+l.y)}this.maskLevel++,!0===e?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}class ud extends ul{constructor(t,e,i,s,n,r,o){super(0,0,0,0),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||s,this.orientation=n,this.tilesets=r,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(var a=0;a<this.tilesets.length;a++){var h=this.tilesets.getTilesetByIndex(a);this.maxTileSize.width=Math.max(this.maxTileSize.width,h.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,h.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.class=e.class,this.pos.z=o,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;var l=void 0!==e.visible?+e.visible:1;this.setOpacity(l?+e.opacity:0),"string"==typeof e.tintcolor&&this.tint.parseHex(e.tintcolor,!0),"isometric"===this.orientation?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),hd(this,e),void 0===this.preRender&&(this.preRender=Bl.world.preRender),this.setRenderer(t.getRenderer()),function(t,e){var i=0;!function(t){t.layerData=new Array(t.cols);for(var e=0;e<t.cols;e++){t.layerData[e]=new Array(t.rows);for(var i=0;i<t.rows;i++)t.layerData[e][i]=null}}(t);for(var s=0;s<t.rows;s++)for(var n=0;n<t.cols;n++){var r=e[i++];0!==r&&(t.layerData[n][s]=t.getTileById(r,n,s))}}(this,rd(e.data,e.encoding,e.compression))}onActivateEvent(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets)for(var t=this.tilesets.tilesets,e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1),this.getBounds().addBounds(this.getRenderer().getBounds(),!0),this.getBounds().shift(this.pos),!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new cd({canvas:bc(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),function(t,e){for(var i=0;i<t.rows;i++)for(var s=0;s<t.cols;s++){var n=t.layerData[s][i];n instanceof dd&&t.getRenderer().drawTile(e,s,i,n)}}(this,this.canvasRenderer))}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(t){this.renderer=t}getRenderer(){return this.renderer}getTileId(t,e){var i=this.getTile(t,e);return i?i.tileId:null}getTile(t,e){var i=null;if(this.contains(t,e)){var s=this.getRenderer().pixelToTileCoords(t,e,Dn.pull("Vector2d"));i=this.cellAt(s.x,s.y),Dn.push(s)}return i}setTile(t,e,i){return this.layerData[e][i]=t,t}getTileById(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new dd(e,i,t,this.tileset)}cellAt(t,e,i){var s=~~t,n=~~e,r=this.getRenderer();return!1===i||s>=0&&s<r.cols&&n>=0&&n<r.rows?this.layerData[s][n]:null}clearTile(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight)}update(t){if(this.isAnimated){for(var e=!1,i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}return!1}draw(t,e){if(this.preRender){var i=Math.min(e.width,this.width),s=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,s,e.pos.x,e.pos.y,i,s)}else this.getRenderer().drawTileLayer(t,this,e)}}class pd{constructor(t,e,i,s){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=s,this.bounds=new Ia}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){var e=t instanceof ud?Dn.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,s){}drawTileLayer(t,e,i){}}class fd extends pd{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return"orthogonal"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){return(i||new Nn).set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){return(i||new Nn).set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,s){var n=s.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,s)}drawTileLayer(t,e,i){var s=1,n=1,r=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),Dn.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,Dn.pull("Vector2d")).ceilSelf();switch(o.x=o.x>this.cols?this.cols:o.x,o.y=o.y>this.rows?this.rows:o.y,e.renderorder){case"right-up":o.y=r.y+(r.y=o.y)-o.y,n=-1;break;case"left-down":o.x=r.x+(r.x=o.x)-o.x,s=-1;break;case"left-up":o.x=r.x+(r.x=o.x)-o.x,o.y=r.y+(r.y=o.y)-o.y,s=-1,n=-1}for(var a=r.y;a!==o.y;a+=n)for(var h=r.x;h!==o.x;h+=s){var l=e.cellAt(h,a,!1);l&&this.drawTile(t,h,a,l)}Dn.push(r),Dn.push(o)}}class gd extends pd{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return"isometric"===t.orientation&&super.canRender(t)}getBounds(t){var e=t instanceof ud?Dn.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){return(i||new Nn).set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){return(i||new Nn).set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){var e=t.x/this.hTilewidth,i=t.y/this.tileheight,s=Dn.pull("Vector2d");this.tileToPixelCoords(e,i,s),t.x=s.x,t.y=s.y,Dn.push(s)}drawTile(t,e,i,s){var n=s.tileset;n.drawTile(t,(this.cols-1)*n.tilewidth+(e-i)*n.tilewidth>>1,-n.tilewidth+(e+i)*n.tileheight>>2,s)}drawTileLayer(t,e,i){var s=e.tileset,n=this.pixelToTileCoords(i.pos.x-s.tilewidth,i.pos.y-s.tileheight,Dn.pull("Vector2d")).floorSelf(),r=this.pixelToTileCoords(i.pos.x+i.width+s.tilewidth,i.pos.y+i.height+s.tileheight,Dn.pull("Vector2d")).ceilSelf(),o=this.tileToPixelCoords(r.x,r.y,Dn.pull("Vector2d")),a=this.tileToPixelCoords(n.x,n.y,Dn.pull("Vector2d"));a.x-=this.hTilewidth,a.y+=this.tileheight;var h=a.y-i.pos.y>this.hTileheight,l=i.pos.x-a.x<this.hTilewidth;h&&(l?(n.x--,a.x-=this.hTilewidth):(n.y--,a.x+=this.hTilewidth),a.y-=this.hTileheight);for(var d=h^l,c=n.clone(),u=2*a.y;u-2*this.tileheight<2*o.y;u+=this.tileheight){c.setV(n);for(var p=a.x;p<o.x;p+=this.tilewidth){var f=e.cellAt(c.x,c.y);if(f){var g=(s=f.tileset).tileoffset;s.drawTile(t,g.x+p,g.y+u/2-s.tileheight,f)}c.x++,c.y--}d?(n.y++,a.x-=this.hTilewidth,d=!1):(n.x++,a.x+=this.hTilewidth,d=!0)}Dn.push(c),Dn.push(n),Dn.push(r),Dn.push(o),Dn.push(a)}}const md=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],yd=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class vd extends pd{constructor(t){super(t.cols,t.rows,-2&t.tilewidth,-2&t.tileheight),this.hexsidelength=t.hexsidelength||0,this.staggerX="x"===t.staggeraxis,this.staggerEven="even"===t.staggerindex,this.sidelengthx=0,this.sidelengthy=0,"hexagonal"===t.orientation&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new Nn,new Nn,new Nn,new Nn]}canRender(t){return"hexagonal"===t.orientation&&super.canRender(t)}getBounds(t){var e=t instanceof ud?Dn.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&1&t^this.staggerEven}doStaggerY(t){return!this.staggerX&&1&t^this.staggerEven}topLeft(t,e,i){var s=i||new Nn;return this.staggerX?1&t^this.staggerEven?s.set(t-1,e):s.set(t-1,e-1):1&e^this.staggerEven?s.set(t,e-1):s.set(t-1,e-1),s}topRight(t,e,i){var s=i||new Nn;return this.staggerX?1&t^this.staggerEven?s.set(t+1,e):s.set(t+1,e-1):1&e^this.staggerEven?s.set(t+1,e-1):s.set(t,e-1),s}bottomLeft(t,e,i){var s=i||new Nn;return this.staggerX?1&t^this.staggerEven?s.set(t-1,e+1):s.set(t-1,e):1&e^this.staggerEven?s.set(t,e+1):s.set(t-1,e+1),s}bottomRight(t,e,i){var s=i||new Nn;return this.staggerX?1&t^this.staggerEven?s.set(t+1,e+1):s.set(t+1,e):1&e^this.staggerEven?s.set(t+1,e+1):s.set(t,e+1),s}pixelToTileCoords(t,e,i){var s=i||new Nn;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;var n,r,o,a,h=Dn.pull("Vector2d",Math.floor(t/(2*this.columnwidth)),Math.floor(e/(2*this.rowheight))),l=Dn.pull("Vector2d",t-h.x*(2*this.columnwidth),e-h.y*(2*this.rowheight));this.staggerX?(h.x=2*h.x,this.staggerEven&&++h.x):(h.y=2*h.y,this.staggerEven&&++h.y),this.staggerX?(o=(n=this.sidelengthx/2)+this.columnwidth,a=this.tileheight/2,this.centers[0].set(n,a),this.centers[1].set(o,a-this.rowheight),this.centers[2].set(o,a+this.rowheight),this.centers[3].set(o+this.columnwidth,a)):(r=this.sidelengthy/2,o=this.tilewidth/2,a=r+this.rowheight,this.centers[0].set(o,r),this.centers[1].set(o-this.columnwidth,a),this.centers[2].set(o+this.columnwidth,a),this.centers[3].set(o,a+this.rowheight));for(var d=0,c=Number.MAX_VALUE,u=0;u<4;++u){var p=this.centers[u].sub(l).length2();p<c&&(c=p,d=u)}var f=this.staggerX?md:yd;return s.set(h.x+f[d].x,h.y+f[d].y),Dn.push(h),Dn.push(l),s}tileToPixelCoords(t,e,i){var s=Math.floor(t),n=Math.floor(e),r=i||new Nn;return this.staggerX?(r.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(s)&&(r.y+=this.rowheight),r.x=s*this.columnwidth):(r.x=s*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(r.x+=this.columnwidth),r.y=n*this.rowheight),r}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,s){var n=s.tileset,r=this.tileToPixelCoords(e,i,Dn.pull("Vector2d"));n.drawTile(t,n.tileoffset.x+r.x,n.tileoffset.y+r.y+(this.tileheight-n.tileheight),s),Dn.push(r)}drawTileLayer(t,e,i){var s,n=this.pixelToTileCoords(i.pos.x,i.pos.y,Dn.pull("Vector2d"));n.sub(e.pos);var r=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,Dn.pull("Vector2d")),o=n.clone(),a=r.clone(),h=i.pos.y-r.y<this.sideoffsety,l=i.pos.x-r.x<this.sideoffsetx;h&&n.y--,l&&n.x--;var d=e.cols,c=e.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),r=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y);for(var u=this.doStaggerX(n.x+e.pos.x);r.y<i.bottom&&n.y<c;){for(o.setV(n),a.setV(r);a.x<i.right&&o.x<d;o.x+=2)(s=e.cellAt(o.x,o.y,!1))&&s.tileset.drawTile(t,a.x,a.y,s),a.x+=this.tilewidth+this.sidelengthx;u?(n.x-=1,n.y+=1,r.x-=this.columnwidth,u=!1):(n.x+=1,r.x+=this.columnwidth,u=!0),r.y+=this.rowheight}Dn.push(o),Dn.push(a)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),r=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y),this.doStaggerY(n.y)&&(r.x-=this.columnwidth);r.y<i.bottom&&n.y<c;n.y++){for(o.setV(n),a.setV(r),this.doStaggerY(n.y)&&(a.x+=this.columnwidth);a.x<i.right&&o.x<d;o.x++)(s=e.cellAt(o.x,o.y,!1))&&s.tileset.drawTile(t,a.x,a.y,s),a.x+=this.tilewidth+this.sidelengthx;r.y+=this.rowheight}Dn.push(o),Dn.push(a)}Dn.push(n),Dn.push(r)}}class xd extends vd{canRender(t){return"staggered"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){var s=i||new Nn,n=t,r=e;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:r-=this.staggerEven?this.sideoffsety:0;var o=Dn.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(r/this.tileheight));this.staggerX?(o.x=2*o.x,this.staggerEven&&++o.x):(o.y=2*o.y,this.staggerEven&&++o.y);var a=Dn.pull("Vector2d",n-o.x*this.tilewidth,r-o.y*this.tileheight),h=a.x*(this.tileheight/this.tilewidth);return this.sideoffsety-h>a.y&&(o=this.topLeft(o.x,o.y,o)),-this.sideoffsety+h>a.y&&(o=this.topRight(o.x,o.y,o)),this.sideoffsety+h<a.y&&(o=this.bottomLeft(o.x,o.y,o)),3*this.sideoffsety-h<a.y&&(o=this.bottomRight(o.x,o.y,o)),(s=this.tileToPixelCoords(o.x,o.y,s)).set(t-s.x,e-s.y),s.set(s.x-this.tilewidth/2,s.y*(this.tilewidth/this.tileheight)),s.div(this.tilewidth/Math.sqrt(2)).rotate(wn(-45)).add(o),Dn.push(o),Dn.push(a),s}}class bd{constructor(t){var e=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,void 0!==t.source){var i=t.source,s=Ln(i);if(("tsx"===s||"json"===s)&&!(t=Vd.getTMX(On(i))))throw new Error(i+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new Nn,this.isAnimated=!1,this.isCollection=!1,this.class=t.class,this.animations=new Map,this._lastUpdate=0;var n=t.tiles;for(e in n)if(n.hasOwnProperty(e)){if("animation"in n[e]&&(this.isAnimated=!0,this.animations.set(n[+e].animation[0].tileid,{dt:0,idx:0,frames:n[+e].animation,cur:n[+e].animation[0]})),"properties"in n[e])if(Array.isArray(n[e].properties)){var r={};for(var o in n[e].properties)r[n[e].properties[o].name]=n[e].properties[o].value;this.setTileProperty(+n[e].id+this.firstgid,r)}else this.setTileProperty(+e+this.firstgid,n[e].properties);if("image"in n[e]){var a=Vd.getImage(n[e].image);if(!a)throw new Error("melonJS: '"+n[e].image+"' file for tile '"+(+e+this.firstgid)+"' not found!");this.imageCollection[+e+this.firstgid]=a}}this.isCollection=this.imageCollection.length>0;var h=t.tileoffset;h&&(this.tileoffset.x=+h.x,this.tileoffset.y=+h.y);var l=t.tileproperties;if(l)for(e in l)l.hasOwnProperty(e)&&this.setTileProperty(+e+this.firstgid,l[e]);if(!1===this.isCollection){if(this.image=Vd.getImage(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=xc.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var d=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),c=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%d>0&&++c,this.lastgid=this.firstgid+(d*c-1||0),t.tilecount&&this.lastgid-this.firstgid+1!=+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){var e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){var e=0,i=Sc.getTime(),s=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach((function(i){for(i.dt+=t,e=i.cur.duration;i.dt>=e;)i.dt-=e,i.idx=(i.idx+1)%i.frames.length,i.cur=i.frames[i.idx],e=i.cur.duration,s=!0}))),s}drawTile(t,e,i,s){if(s.flipped&&(t.save(),t.translate(e,i),t.transform(s.currentTransform),e=i=0),!0===this.isCollection)t.drawImage(this.imageCollection[s.tileId],0,0,s.width,s.height,e,i,s.width,s.height);else{var n=this.atlas[this.getViewTileId(s.tileId)].offset;t.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}s.flipped&&t.restore()}}class wd{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){var e=-1;t&=536870911;for(var i=0,s=this.tilesets.length;i<s;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(-1!==e)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}class _d{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.class=void 0!==e.class?e.class:e.type,this.text=void 0,this.rotation=wn(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(t.tilesets):void 0!==e.ellipse?this.isEllipse=!0:void 0!==e.point?this.isPoint=!0:void 0!==e.polygon?(this.points=e.polygon,this.isPolygon=!0):void 0!==e.polyline&&(this.points=e.polyline,this.isPolyLine=!0),void 0!==e.text?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,hd(this.text,e)):(hd(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){var e=t.getTilesetByGid(this.gid);!1===e.isCollection&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new dd(this.x,this.y,this.gid,e)}parseTMXShapes(){var t=0,e=[];if(!0===this.isEllipse)e.push(Dn.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPoint)e.push(Dn.pull("Point",this.x,this.y));else if(!0===this.isPolygon){var i=Dn.pull("Polygon",0,0,this.points);if(!1===i.isConvex())throw new Error("collision polygones in Tiled should be defined as Convex");e.push(i.rotate(this.rotation))}else if(!0===this.isPolyLine){var s,n,r=this.points,o=r.length-1;for(t=0;t<o;t++)s=Dn.pull("Vector2d",r[t].x,r[t].y),n=Dn.pull("Vector2d",r[t+1].x,r[t+1].y),0!==this.rotation&&(s=s.rotate(this.rotation),n=n.rotate(this.rotation)),e.push(Dn.pull("Line",0,0,[s,n]))}else e.push(Dn.pull("Polygon",0,0,[Dn.pull("Vector2d"),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height),Dn.pull("Vector2d",0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(t=0;t<e.length;t++)"function"==typeof e[t].toIso&&e[t].toIso();return e}getObjectPropertyByName(t){return this[t]}}class Ed{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.class=e.class,this.z=i,this.objects=[];var s=void 0===e.visible||e.visible;this.opacity=!0===s?_n(+e.opacity||1,0,1):0,hd(this,e),e.objects&&e.objects.forEach((e=>{e.tintcolor=this.tintcolor,this.objects.push(new _d(t,e,i))})),e.layers&&e.layers.forEach((e=>{var s=new ud(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);s.setRenderer(t.getRenderer()),this.width=Math.max(this.width,s.width),this.height=Math.max(this.height,s.height),this.objects.push(s)}))}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}class Cd{constructor(t,e){if(this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=e.version,this.tiledversion=e.tiledversion,this.class=e.class,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===e.editor,this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,hd(this,e),this.initialized=!1,1===this.infinite)throw new Error("Tiled Infinite Map not supported!")}getRenderer(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=function(t){switch(t.orientation){case"orthogonal":return new fd(t);case"isometric":return new gd(t);case"hexagonal":return new vd(t);case"staggered":return new xd(t);default:throw new Error(t.orientation+" type TMX Tile Map not supported!")}}(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(!0!==this.initialized){var e=0;this.tilesets||(this.tilesets=new wd),void 0!==t.tilesets&&t.tilesets.forEach((t=>{this.tilesets.add(function(t){return new bd(t)}(t))})),this.background_image&&this.layers.push(Dn.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach((t=>{switch(t.type){case"imagelayer":this.layers.push(function(t,e,i){hd(e.properties,e);var s=Dn.pull("ImageLayer",+e.offsetx||+e.x||0,+e.offsety||+e.y||0,Object.assign({name:e.name,image:e.image,ratio:Dn.pull("Vector2d",+e.parallaxx||1,+e.parallaxy||1),tint:void 0!==e.tintcolor?Dn.pull("Color").parseHex(e.tintcolor,!0):void 0,z:i},e.properties)),n=void 0===e.visible||e.visible;return s.setOpacity(n?+e.opacity:0),s}(0,t,e++));break;case"tilelayer":this.layers.push(function(t,e,i){return new ud(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i)}(this,t,e++));break;case"objectgroup":case"group":this.objectGroups.push(function(t,e,i){return new Ed(t,e,i)}(this,t,e++))}})),this.initialized=!0}}addTo(t,e,i){var s=t.autoSort,n=t.autoDepth,r=this.getBounds();function o(e,i){Bl.viewport.setBounds(0,0,Math.max(r.width,e),Math.max(r.height,i)),t.pos.set(Math.max(0,~~((e-r.width)/2)),Math.max(0,~~((i-r.height)/2)),t.pos.z)}t.autoSort=!1,t.autoDepth=!1,this.backgroundcolor&&t.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach((function(e){t.addChild(e)})),this.getObjects(e).forEach((function(e){t.addChild(e)})),t.resize(this.bounds.width,this.bounds.height),t.sort(!0),!0===i&&(Ir(Cr,o),o(Bl.viewport.width,Bl.viewport.height),Lr(Cr,o,this)),t.autoSort=s,t.autoDepth=n}getObjects(t){var e,i=[],s=!1;this.readMapObjects(this.data);for(var n=0;n<this.objectGroups.length;n++){var r=this.objectGroups[n];s=r.name.toLowerCase().includes("collision"),!1===t&&((e=new Ml(0,0,this.width,this.height)).anchorPoint.set(0,0),e.name=r.name,e.pos.z=r.z,e.setOpacity(r.opacity),e.autoSort=!1,e.autoDepth=!1);for(var o=0;o<r.objects.length;o++){var a,h,l=r.objects[o];void 0===l.anchorPoint&&(l.anchorPoint={x:0,y:0}),void 0!==l.tintcolor&&(l.tint=Dn.pull("Color"),l.tint.parseHex(l.tintcolor,!0)),l instanceof ud?a=l:"object"==typeof l.text?(void 0===l.text.anchorPoint&&(l.text.anchorPoint=l.anchorPoint),(a=!0===l.text.bitmap?Dn.pull("BitmapText",l.x,l.y,l.text):Dn.pull("Text",l.x,l.y,l.text)).pos.z=l.z):"object"==typeof l.tile?(void 0===(h=l.shapes)&&(h=Dn.pull("Polygon",0,0,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height)])),(a=l.tile.getRenderable(l)).body=new Al(a,h),a.body.setStatic(!0),a.pos.setMuted(l.x,l.y,l.z)):(void 0!==l.name&&""!==l.name?a=Dn.pull(l.name,l.x,l.y,l):(a=Dn.pull("Renderable",l.x,l.y,l.width,l.height),void 0===(h=l.shapes)&&(h=Dn.pull("Polygon",0,0,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height)])),a.anchorPoint.set(0,0),a.name=l.name,a.type=l.type,a.class=l.class||l.type,a.id=l.id,a.body=new Al(a,h),a.body.setStatic(!0),a.resize(a.body.getBounds().width,a.body.getBounds().height)),a.pos.z=l.z),s&&!l.name&&a.body&&(a.body.collisionType=Tl.types.WORLD_SHAPE,a.body.isStatic=!0),!1!==t?(!0===a.isRenderable&&(a.setOpacity(a.getOpacity()*r.opacity),a.renderable instanceof ul&&a.renderable.setOpacity(a.renderable.getOpacity()*r.opacity)),i.push(a)):e.addChild(a)}!1===t&&e.children.length>0&&(e.autoSort=!0,e.autoDepth=!0,i.push(e))}return i}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}var Td={},Ad=[],Sd=0;function Pd(t,e,i){e.container.reset(),Bl.reset(),Td[Md.getCurrentLevelId()]&&Td[Md.getCurrentLevelId()].destroy(),Sd=Ad.indexOf(t),function(t,e,i,s){var n=Td[t];Ac.resetGUID(t,n.nextobjectid),e.anchorPoint.set(0,0),n.addTo(e,i,s)}(t,e.container,e.flatten,e.setViewportBounds),Or(ur,t),e.onLoaded(t),i&&sd.restart()}var Md={add(t,e,i){if("tmx"===t)return null==Td[e]&&(Td[e]=new Cd(e,Vd.getTMX(e)),Ad.push(e),i&&i(),!0);throw new Error("no level loader defined for format "+t)},load(t,e){if(e=Object.assign({container:Bl.world,onLoaded:Bl.onLevelLoaded,flatten:Bl.mergeGroup,setViewportBounds:!0},e||{}),void 0===Td[t])throw new Error("level "+t+" not found");if(!(Td[t]instanceof Cd))throw new Error("no level loader defined");return sd.isRunning()?(sd.stop(),Ac.function.defer(Pd,this,t,e,!0)):Pd(t,e),!0},getCurrentLevelId:()=>Ad[Sd],getCurrentLevel(){return Td[this.getCurrentLevelId()]},reload(t){return this.load(this.getCurrentLevelId(),t)},next(t){return Sd+1<Ad.length&&this.load(Ad[Sd+1],t)},previous(t){return Sd-1>=0&&this.load(Ad[Sd-1],t)},levelCount:()=>Ad.length},Od={},Ld={},kd={},Id={},Rd={},Bd=0,Dd=0,Nd=0;function Fd(t){if(Dd===Bd){if("function"!=typeof t&&!Vd.onload)throw new Error("no load callback defined");clearTimeout(Nd);var e=t||Vd.onload;setTimeout((function(){e(),Or(pr)}),300)}else Nd=setTimeout((()=>{Fd(t)}),100)}function Gd(t,e,i){Od[t.name]=new Image,"function"==typeof e&&(Od[t.name].onload=e),"function"==typeof i&&(Od[t.name].onerror=i),"string"==typeof Vd.crossOrigin&&(Od[t.name].crossOrigin=Vd.crossOrigin),Od[t.name].src=t.src+Vd.nocache}function Ud(t,e,i){!0===dn(t.src)&&(t.src.startsWith("url(")||(t.src="url("+t.src+")"));var s=new FontFace(t.name,t.src);s.load().then((()=>{document.fonts.add(s),document.body.style.fontFamily=t.name,"function"==typeof e&&e()}),(function(){"function"==typeof i&&i(t.name)}))}function jd(t,e,i){function s(e){Ld[t.name]=e,"tmx"===t.type&&Md.add(t.type,t.name)}if(t.data)return s(t.data),void("function"==typeof e&&e());var n=new XMLHttpRequest,r=Ln(t.src);n.overrideMimeType&&("json"===r?n.overrideMimeType("application/json"):n.overrideMimeType("text/xml")),n.open("GET",t.src+Vd.nocache,!0),n.withCredentials=Vd.withCredentials,n.ontimeout=i,n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status&&n.responseText){var o=null;switch(r){case"xml":case"tmx":case"tsx":if(zr.match(/msie/i)||!n.responseXML){if(!globalThis.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");o=(new DOMParser).parseFromString(n.responseText,"text/xml")}else o=n.responseXML;var a=ad(o);switch(r){case"tmx":o=a.map;break;case"tsx":o=a.tilesets[0]}break;case"json":o=JSON.parse(n.responseText);break;default:throw new Error("TMX file format "+r+"not supported !")}s(o),"function"==typeof e&&e()}else"function"==typeof i&&i(t.name)},n.send()}function zd(t,e,i){var s=new XMLHttpRequest;s.overrideMimeType&&s.overrideMimeType("application/json"),s.open("GET",t.src+Vd.nocache,!0),s.withCredentials=Vd.withCredentials,s.ontimeout=i,s.onreadystatechange=function(){4===s.readyState&&(200===s.status||0===s.status&&s.responseText?(Id[t.name]=JSON.parse(s.responseText),"function"==typeof e&&e()):"function"==typeof i&&i(t.name))},s.send()}function Hd(t,e,i){var s=new XMLHttpRequest;s.open("GET",t.src+Vd.nocache,!0),s.withCredentials=Vd.withCredentials,s.responseType="arraybuffer",s.onerror=i,s.onload=function(){var i=s.response;if(i){for(var n=new Uint8Array(i),r=[],o=0;o<n.byteLength;o++)r[o]=String.fromCharCode(n[o]);kd[t.name]=r.join(""),"function"==typeof e&&e()}},s.send()}function Yd(t,e,i){var s=document.createElement("script");s.src=t.src,s.type="text/javascript","string"==typeof Vd.crossOrigin&&(s.crossOrigin=Vd.crossOrigin),s.defer=!0,"function"==typeof e&&(s.onload=()=>{e()}),"function"==typeof i&&(s.onerror=()=>{i(t.name)}),document.getElementsByTagName("body")[0].appendChild(s)}var Vd={nocache:"",onload:void 0,onProgress:void 0,crossOrigin:void 0,withCredentials:!1,onResourceLoaded(t){var e=++Dd/Bd;this.onProgress&&this.onProgress(e,t),Or(fr,e,t)},onLoadingError(t){throw new Error("Failed loading resource "+t.src)},setNocache(t){this.nocache=t?"?"+~~(1e7*Math.random()):""},setBaseURL(t,e){"*"!==t?Rd[t]=e:(Rd.audio=e,Rd.binary=e,Rd.image=e,Rd.json=e,Rd.js=e,Rd.tmx=e,Rd.tsx=e)},preload(t,e,i=!0){for(var s=0;s<t.length;s++)Bd+=this.load(t[s],this.onResourceLoaded.bind(this,t[s]),this.onLoadingError.bind(this,t[s]));void 0!==e&&(this.onload=e),!0===i&&sd.change(sd.LOADING),Fd(e)},load(t,e,i){switch(void 0!==Rd[t.type]&&(t.src=Rd[t.type]+t.src),t.type){case"binary":return Hd.call(this,t,e,i),1;case"image":return Gd.call(this,t,e,i),1;case"json":return zd.call(this,t,e,i),1;case"js":return Yd.call(this,t,e,i),1;case"tmx":case"tsx":return jd.call(this,t,e,i),1;case"audio":return Va(t,!!t.stream,e,i),1;case"fontface":return Ud.call(this,t,e,i),1;default:throw new Error("load : unknown or invalid resource type : "+t.type)}},unload(t){switch(t.type){case"binary":return t.name in kd&&(delete kd[t.name],!0);case"image":return t.name in Od&&(delete Od[t.name],!0);case"json":return t.name in Id&&(delete Id[t.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return t.name in Ld&&(delete Ld[t.name],!0);case"audio":return Qa(t.name);default:throw new Error("unload : unknown or invalid resource type : "+t.type)}},unloadAll(){var t;for(t in kd)kd.hasOwnProperty(t)&&this.unload({name:t,type:"binary"});for(t in Od)Od.hasOwnProperty(t)&&this.unload({name:t,type:"image"});for(t in Ld)Ld.hasOwnProperty(t)&&this.unload({name:t,type:"tmx"});for(t in Id)Id.hasOwnProperty(t)&&this.unload({name:t,type:"json"});$a()},getTMX:t=>(t=""+t)in Ld?Ld[t]:null,getBinary:t=>(t=""+t)in kd?kd[t]:null,getImage:t=>(t=On(""+t))in Od?Od[t]:null,getJSON:t=>(t=""+t)in Id?Id[t]:null};class Wd extends ul{constructor(t,e,i){if(super(t,e,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=Dn.pull("Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:"default",length:0,offset:Dn.pull("Vector2d"),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof qd){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,void 0!==i.region){var s=this.source.getRegion(i.region);if(!s)throw new Error("Texture - region for "+i.region+" not found");this.setRegion(s),this.current.width=i.framewidth||s.width,this.current.height=i.frameheight||s.height}}else{if(this.image="object"==typeof i.image?i.image:Vd.getImage(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.current.width=i.framewidth=i.framewidth||this.image.width,this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=xc.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas()}void 0!==i.atlas&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),this.width=this.current.width,this.height=this.current.height,void 0!==i.flipX&&this.flipX(!!i.flipX),void 0!==i.flipY&&this.flipY(!!i.flipY),void 0!==i.rotation&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),void 0!==i.tint&&(i.tint instanceof Wn?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),"string"==typeof i.name&&(this.name=i.name),void 0!==i.z&&(this.pos.z=i.z),0!==this.addAnimation("default",null)&&this.setCurrentAnimation("default"),this.autoTransform=!0}isFlickering(){return this._flicker.isFlickering}flicker(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this}addAnimation(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};var s=0;if("object"!=typeof this.textureAtlas)return 0;null==e&&(e=[],Object.keys(this.textureAtlas).forEach((function(t,i){e[i]=i})));for(var n=0,r=e.length;n<r;n++){var o,a=e[n],h=(o="number"==typeof a||"string"==typeof a?{name:a,delay:i||this.animationspeed}:a).name;if("number"==typeof h)void 0!==this.textureAtlas[h]&&(this.anim[t].frames[n]=Object.assign({},this.textureAtlas[h],o),s++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[h]],o),s++}}return this.anim[t].length=s,s}setCurrentAnimation(t,e,i){if(!this.anim[t])throw new Error("animation id '"+t+"' not defined");return this.current.name=t,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof e?this.setCurrentAnimation.bind(this,e,null,!0):"function"==typeof e?e:void 0,this.setAnimationFrame(this.current.idx),i||(this.dt=0),this.isDirty=!0,this}reverseAnimation(t){return void 0!==t&&void 0!==this.anim[t]?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(t){return this.current.name===t}setRegion(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle=t.angle,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.set(this._flip.x&&!0===t.trimmed?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&!0===t.trimmed?1-t.anchorPoint.y:t.anchorPoint.y),this.isDirty=!0,this}setAnimationFrame(t){return this.current.idx=(t||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(t){return this.anim[this.current.name].frames[t]}update(t){if(!this.animationpause&&this.current&&this.current.length>0){var e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;var i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(t)}destroy(){Dn.push(this.offset),this.offset=void 0,super.destroy()}draw(t,e){if(!this._flicker.isFlickering||(this._flicker.state=!this._flicker.state,this._flicker.state)){var i=this.current,s=this.pos.x,n=this.pos.y,r=i.width,o=i.height,a=i.offset,h=this.offset;0!==i.angle&&(t.translate(-s,-n),t.rotate(i.angle),s-=o,r=i.height,o=i.width),t.drawImage(this.image,h.x+a.x,h.y+a.y,r,o,s,n,r,o)}}}function Kd(t,e,i="default",s="no-repeat"){return{meta:{app:"melonJS",size:{w:t,h:e},repeat:s,image:"default"},frames:[{filename:i,frame:{x:0,y:0,w:t,h:e}}]}}class qd{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==t)for(var s in t=Array.isArray(t)?t:[t]){var n=t[s];if(void 0!==n.meta){if(n.meta.app.includes("texturepacker")||n.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",void 0===e){var r=Vd.getImage(n.meta.image);if(!r)throw new Error("Atlas texture '"+r+"' not found");this.sources.set(n.meta.image,r)}else this.sources.set(n.meta.image||"default","string"==typeof e?Vd.getImage(e):e);this.repeat="no-repeat"}else if(n.meta.app.includes("ShoeBox")){if(!n.meta.exporter||!n.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof e?Vd.getImage(e):e)}else n.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=n.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof e?Vd.getImage(e):e));this.atlases.set(n.meta.image||"default",this.parse(n))}else void 0!==n.framewidth&&void 0!==n.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==e&&(n.image="string"==typeof e?Vd.getImage(e):e),this.atlases.set("default",this.parseFromSpriteSheet(n)),this.sources.set("default",n.image))}if(0===this.atlases.length)throw new Error("texture atlas format not supported");!1!==i&&this.sources.forEach((t=>{i instanceof dc?i.set(t,this):xc.cache.set(t,this)}))}parse(t){var e={};return t.frames.forEach((i=>{if(i.hasOwnProperty("filename")){var s,n,r=i.frame,o=i.spriteSourceSize&&i.sourceSize&&i.pivot;o&&(s=i.sourceSize.w*i.pivot.x-(i.trimmed?i.spriteSourceSize.x:0),n=i.sourceSize.h*i.pivot.y-(i.trimmed?i.spriteSourceSize.y:0)),e[i.filename]={name:i.filename,texture:t.meta.image||"default",offset:new Nn(r.x,r.y),anchorPoint:o?new Nn(s/r.w,n/r.h):null,trimmed:!!i.trimmed,width:r.w,height:r.h,angle:!0===i.rotated?-vn:0},this.addUVs(e,i.filename,t.meta.size.w,t.meta.size.h)}})),e}parseFromSpriteSheet(t){var e={},i=t.image,s=t.spacing||0,n=t.margin||0,r=i.width,o=i.height,a=Dn.pull("Vector2d",~~((r-n+s)/(t.framewidth+s)),~~((o-n+s)/(t.frameheight+s)));if(r%(t.framewidth+s)!=0||o%(t.frameheight+s)!=0){var h=a.x*(t.framewidth+s),l=a.y*(t.frameheight+s);h-r!==s&&l-o!==s&&(r=h,o=l,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(t.framewidth+s)+"x"+(t.frameheight+s)+", truncating effective size to "+r+"x"+o))}for(var d=0,c=a.x*a.y;d<c;d++){var u=""+d;e[u]={name:u,texture:"default",offset:new Nn(n+(s+t.framewidth)*(d%a.x),n+(s+t.frameheight)*~~(d/a.x)),anchorPoint:t.anchorPoint||null,trimmed:!1,width:t.framewidth,height:t.frameheight,angle:0},this.addUVs(e,u,r,o)}return Dn.push(a),e}getAtlas(t){return"string"==typeof t?this.atlases.get(t):this.atlases.values().next().value}getFormat(){return this.format}getTexture(t){return"object"==typeof t&&"string"==typeof t.texture?this.sources.get(t.texture):this.sources.values().next().value}addRegion(t,e,i,s,n){!0===xc.settings.verbose&&console.warn("Adding texture region",t,"for texture",this);var r=this.getTexture(),o=this.getAtlas(),a=r.width,h=r.height;return o[t]={name:t,offset:new Nn(e,i),width:s,height:n,angle:0},this.addUVs(o,t,a,h),o[t]}getRegion(t,e){var i;return"string"==typeof e?i=this.getAtlas(e)[t]:this.atlases.forEach((function(e){void 0!==e[t]&&(i=e[t])})),i}getUVs(t){var e=this.getRegion(t);if(void 0===e){var i=t.split(","),s=+i[0],n=+i[1],r=+i[2],o=+i[3];e=this.addRegion(t,s,n,r,o)}return e.uvs}addUVs(t,e,i,s){if(xc instanceof cc){var n=t[e].offset,r=t[e].width,o=t[e].height;t[e].uvs=new Float32Array([n.x/i,n.y/s,(n.x+r)/i,(n.y+o)/s]),t[n.x+","+n.y+","+i+","+s]=t[e]}return t[e].uvs}createSpriteFromName(t,e,i=!1){return Dn.pull(!0===i?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){for(var i,s=[],n={},r=0,o=0,a=0;a<t.length;++a){if(null==(i=this.getRegion(t[a])))throw new Error("Texture - region for "+t[a]+" not found");s[a]=i,n[t[a]]=a,r=Math.max(i.width,r),o=Math.max(i.height,o)}return new Wd(0,0,Object.assign({image:this,framewidth:r,frameheight:o,margin:0,spacing:0,atlas:s,atlasIndices:n},e||{}))}}var Xd={},Jd={},Zd={},Qd=t&&t.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(n=2&r[0]?s.return:r[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,r[1])).done)return n;switch(s=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],s=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},$d=t&&t.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},tc=t&&t.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,n,r=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return o};Object.defineProperty(Zd,"__esModule",{value:!0}),Zd.Multimap=void 0;var ec=function(){function t(t,e){var i,s;if(this.size_=0,this.map=new Map,this.operator=t,e)try{for(var n=$d(e),r=n.next();!r.done;r=n.next()){var o=tc(r.value,2),a=o[0],h=o[1];this.put(a,h)}}catch(t){i={error:t}}finally{try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}return this}return Object.defineProperty(t.prototype,"size",{get:function(){return this.size_},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=this.map.get(t);return e?this.operator.clone(e):this.operator.create()},t.prototype.put=function(t,e){var i=this.map.get(t);return i||(i=this.operator.create()),!!this.operator.add(e,i)&&(this.map.set(t,i),this.size_++,!0)},t.prototype.putAll=function(e,i){var s,n,r,o,a=0;if(i){var h=e,l=i;try{for(var d=$d(l),c=d.next();!c.done;c=d.next()){var u=c.value;this.put(h,u),a++}}catch(t){s={error:t}}finally{try{c&&!c.done&&(n=d.return)&&n.call(d)}finally{if(s)throw s.error}}}else{if(!(e instanceof t))throw new TypeError("unexpected arguments");try{for(var p=$d(e.entries()),f=p.next();!f.done;f=p.next()){var g=tc(f.value,2);h=g[0],u=g[1],this.put(h,u),a++}}catch(t){r={error:t}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}}return a>0},t.prototype.has=function(t){return this.map.has(t)},t.prototype.hasEntry=function(t,e){return this.operator.has(e,this.get(t))},t.prototype.delete=function(t){return this.size_-=this.operator.size(this.get(t)),this.map.delete(t)},t.prototype.deleteEntry=function(t,e){var i=this.get(t);return!!this.operator.delete(e,i)&&(this.map.set(t,i),this.size_--,!0)},t.prototype.clear=function(){this.map.clear(),this.size_=0},t.prototype.keys=function(){return this.map.keys()},t.prototype.entries=function(){var t=this;return function(){var e,i,s,n,r,o,a,h,l,d,c,u,p,f;return Qd(this,(function(g){switch(g.label){case 0:g.trys.push([0,11,12,13]),e=$d(t.map.entries()),i=e.next(),g.label=1;case 1:if(i.done)return[3,10];s=tc(i.value,2),n=s[0],r=s[1],g.label=2;case 2:g.trys.push([2,7,8,9]),p=void 0,o=$d(r),a=o.next(),g.label=3;case 3:return a.done?[3,6]:(h=a.value,[4,[n,h]]);case 4:g.sent(),g.label=5;case 5:return a=o.next(),[3,3];case 6:return[3,9];case 7:return l=g.sent(),p={error:l},[3,9];case 8:try{a&&!a.done&&(f=o.return)&&f.call(o)}finally{if(p)throw p.error}return[7];case 9:return i=e.next(),[3,1];case 10:return[3,13];case 11:return d=g.sent(),c={error:d},[3,13];case 12:try{i&&!i.done&&(u=e.return)&&u.call(e)}finally{if(c)throw c.error}return[7];case 13:return[2]}}))}()},t.prototype.values=function(){var t=this;return function(){var e,i,s,n,r;return Qd(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),e=$d(t.entries()),i=e.next(),o.label=1;case 1:return i.done?[3,4]:[4,tc(i.value,2)[1]];case 2:o.sent(),o.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return s=o.sent(),n={error:s},[3,7];case 6:try{i&&!i.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}return[7];case 7:return[2]}}))}()},t.prototype.forEach=function(t,e){var i,s;try{for(var n=$d(this.entries()),r=n.next();!r.done;r=n.next()){var o=tc(r.value,2),a=o[0],h=o[1];t.call(void 0===e?this:e,h,a,this)}}catch(t){i={error:t}}finally{try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}},t.prototype[Symbol.iterator]=function(){return this.entries()},t.prototype.asMap=function(){var t,e,i=new Map;try{for(var s=$d(this.keys()),n=s.next();!n.done;n=s.next()){var r=n.value;i.set(r,this.operator.clone(this.get(r)))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return i},t}();Zd.Multimap=ec;var ic,sc=t&&t.__extends||(ic=function(t,e){return ic=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},ic(t,e)},function(t,e){function i(){this.constructor=t}ic(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(Jd,"__esModule",{value:!0}),Jd.ArrayMultimap=void 0;var nc=function(t){function e(e){return t.call(this,new rc,e)||this}return sc(e,t),Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"ArrayMultimap"},enumerable:!1,configurable:!0}),e}(Zd.Multimap);Jd.ArrayMultimap=nc;var rc=function(){function t(){}return t.prototype.create=function(){return[]},t.prototype.clone=function(t){return t.slice()},t.prototype.add=function(t,e){return e.push(t),!0},t.prototype.size=function(t){return t.length},t.prototype.delete=function(t,e){var i=e.indexOf(t);return i>-1&&(e.splice(i,1),!0)},t.prototype.has=function(t,e){return e.includes(t)},t}(),oc={},ac=t&&t.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(oc,"__esModule",{value:!0}),oc.SetMultimap=void 0;var hc=function(t){function e(e){return t.call(this,new lc,e)||this}return ac(e,t),Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"SetMultimap"},enumerable:!1,configurable:!0}),e}(Zd.Multimap);oc.SetMultimap=hc;var lc=function(){function t(){}return t.prototype.create=function(){return new Set},t.prototype.clone=function(t){return new Set(t)},t.prototype.add=function(t,e){var i=e.size;return e.add(t),i!==e.size},t.prototype.size=function(t){return t.size},t.prototype.delete=function(t,e){return e.delete(t)},t.prototype.has=function(t,e){return e.has(t)},t}();!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SetMultimap=t.ArrayMultimap=void 0;var e=Jd;Object.defineProperty(t,"ArrayMultimap",{enumerable:!0,get:function(){return e.ArrayMultimap}});var i=oc;Object.defineProperty(t,"SetMultimap",{enumerable:!0,get:function(){return i.SetMultimap}})}(Xd);class dc{constructor(t){this.cache=new Xd.ArrayMultimap,this.tinted=new Map,this.units=new Map,this.max_size=t||1/0,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.length=0}validate(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}get(t,e){var i;return void 0===e?i=this.cache.get(t)[0]:this.cache.forEach(((s,n)=>{var r=s.getAtlas();n===t&&r[0].width===e.framewidth&&r[0].height===e.frameheight&&(i=s)})),void 0===i&&(e||(e=Kd(t.width,t.height,t.src?On(t.src):void 0)),i=new qd(e,t,!1),this.set(t,i)),i}delete(t){this.cache.has(t)||this.cache.delete(t)}tint(t,e){var i=this.tinted.get(t);return void 0===i&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,xc.tint(t,e,"multiply")),i.get(e)}set(t,e){var i=t.width,s=t.height;if(!(1!==xc.WebGLVersion||xn(i)&&xn(s))){var n=void 0!==t.src?t.src:t;console.warn("[Texture] "+n+" is not a POT texture ("+i+"x"+s+")")}return this.cache.put(t,e)}getUnit(t){return this.units.has(t)||(this.validate(),this.units.set(t,this.length++)),this.units.get(t)}}class cc extends Da{constructor(t){super(t),this.WebGLVersion=1,this.GPUVendor=null,this.GPURenderer=null,this.context=this.gl=this.getContextGL(this.getCanvas(),t.transparent),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new qn,this.currentCompositor=null,this.compositors=new Map;var e=new(this.settings.compositor||ta)(this);this.compositors.set("default",e),this.setCompositor(e),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);var i=this.gl.getExtension("WEBGL_debug_renderer_info");null!==i&&(this.GPUVendor=this.gl.getParameter(i.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(i.UNMASKED_RENDERER_WEBGL)),this.cache=new dc(this.maxTextures),this.getCanvas().addEventListener("webglcontextlost",(t=>{t.preventDefault(),this.isContextValid=!1,Or(Pr,this)}),!1),this.getCanvas().addEventListener("webglcontextrestored",(()=>{this.reset(),this.isContextValid=!0,Or(Mr,this)}),!1)}reset(){super.reset(),this.compositors.forEach((t=>{!1===this.isContextValid?t.init(this):t.reset()})),this.gl.disable(this.gl.SCISSOR_TEST),void 0!==this.fontContext2D&&this.createFontTexture(this.cache)}setCompositor(t="default"){if("string"==typeof t&&(t=this.compositors.get(t)),void 0===t)throw new Error("Invalid WebGL Compositor");this.currentCompositor!==t&&(null!==this.currentCompositor&&this.currentCompositor.flush(),this.currentCompositor=t)}resetTransform(){this.currentTransform.identity()}createFontTexture(t){if(void 0===this.fontTexture){var e=this.getCanvas(),i=e.width,s=e.height;1===this.WebGLVersion&&(xn(i)||(i=bn(e.width)),xn(s)||(s=bn(e.height)));var n=bc(i,s,!0);this.fontContext2D=this.getContext2d(n),this.fontTexture=new qd(Kd(e.width,e.height,"fontTexture"),n,t),this.currentCompositor.uploadTexture(this.fontTexture,0,0,0)}else t.set(this.fontContext2D.canvas,this.fontTexture)}createPattern(t,e){if(!(1!==xc.WebGLVersion||xn(t.width)&&xn(t.height))){var i=void 0!==t.src?t.src:t;throw new Error("[WebGL Renderer] "+i+" is not a POT texture ("+t.width+"x"+t.height+")")}var s=new qd(Kd(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(s),s}flush(){this.currentCompositor.flush()}setProjection(t){super.setProjection(t),this.currentCompositor.setProjection(t)}clear(){this.currentCompositor.clear(this.settings.transparent?0:1)}clearColor(t="#000000",e=!1){var i;if(t instanceof Wn)i=t.toArray();else{var s=Dn.pull("me.Color");i=s.parseCSS(t).toArray(),Dn.push(s)}this.currentCompositor.clearColor(i[0],i[1],i[2],!0===e?1:i[3])}clearRect(t,e,i,s){this.save(),this.clipRect(t,e,i,s),this.clearColor(),this.restore()}drawFont(t){var e=this.getFontContext();this.currentCompositor.uploadTexture(this.fontTexture,0,0,0,!0);var i=this.fontTexture.getUVs(t.left+","+t.top+","+t.width+","+t.height);this.currentCompositor.addQuad(this.fontTexture,t.left,t.top,t.width,t.height,i[0],i[1],i[2],i[3],this.currentTint.toUint32(this.getGlobalAlpha())),e.clearRect(t.left,t.top,t.width,t.height)}drawImage(t,e,i,s,n,r,o,a,h){void 0===s?(s=a=t.width,n=h=t.height,r=e,o=i,e=0,i=0):void 0===r&&(r=e,o=i,a=s,h=n,s=t.width,n=t.height,e=0,i=0),!1===this.settings.subPixel&&(r|=0,o|=0);var l=this.cache.get(t),d=l.getUVs(e+","+i+","+s+","+n);this.currentCompositor.addQuad(l,r,o,a,h,d[0],d[1],d[2],d[3],this.currentTint.toUint32(this.getGlobalAlpha()))}drawPattern(t,e,i,s,n){var r=t.getUVs("0,0,"+s+","+n);this.currentCompositor.addQuad(t,e,i,s,n,r[0],r[1],r[2],r[3],this.currentTint.toUint32(this.getGlobalAlpha()))}getContextGL(t,e=!1){if(null==t)throw new Error("You must pass a canvas element in order to create a GL context");var i,s={alpha:e,antialias:this.settings.antiAlias,depth:!1,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!!e&&this.settings.premultipliedAlpha,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat};if(!1===this.settings.preferWebGL1&&(i=t.getContext("webgl2",s))&&(this.WebGLVersion=2),i||(this.WebGLVersion=1,i=t.getContext("webgl",s)||t.getContext("experimental-webgl",s)),!i)throw new Error("A WebGL context could not be created.");return i}getContext(){return this.gl}setBlendMode(t="normal",e=this.gl){if(this.currentBlendMode!==t)switch(this.flush(),e.enable(e.BLEND),this.currentBlendMode=t,t){case"screen":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":e.blendFunc(e.ONE,e.ONE);break;case"multiply":e.blendFunc(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal"}}getFontContext(){return void 0===this.fontContext2D&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D}restore(){if(0!==this._matrixStack.length){var t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),this.setBlendMode(this._blendStack.pop()),Dn.push(t),Dn.push(e)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height)}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t,e){super.setAntiAlias(t,e)}setGlobalAlpha(t){this.currentColor.alpha=t}getGlobalAlpha(){return this.currentColor.alpha}setColor(t){var e=this.currentColor.alpha;this.currentColor.copy(t),this.currentColor.alpha*=e}setLineWidth(t){this.getContext().lineWidth(t)}strokeArc(t,e,i,s,n,r=!1,o=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.arc(t,e,i,s,n,r),!1===o?this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points):(this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())))}fillArc(t,e,i,s,n,r=!1){this.strokeArc(t,e,i,s,n,r,!0)}strokeEllipse(t,e,i,s,n=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.ellipse(t,e,i,s,0,0,360),this.path2D.closePath(),!1===n?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()))}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!1)}strokeLine(t,e,i,s){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.moveTo(t,e),this.path2D.lineTo(i,s),this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points))}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){if(!(this.getGlobalAlpha()<1/255)){var i;this.translate(t.pos.x,t.pos.y),this.path2D.beginPath(),this.path2D.moveTo(t.points[0].x,t.points[0].y);for(var s=1;s<t.points.length;s++)i=t.points[s],this.path2D.lineTo(i.x,i.y);this.path2D.lineTo(t.points[0].x,t.points[0].y),this.path2D.closePath(),!1===e?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,n=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.rect(t,e,i,s),!1===n?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()))}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,n,r=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.roundRect(t,e,i,s,n),!1===r?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):(this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())))}fillRoundRect(t,e,i,s,n){this.strokeRoundRect(t,e,i,s,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=this.currentTransform;if(e.multiply(t),!1===this.settings.subPixel){var i=e.toArray();i[6]|=0,i[7]|=0}}translate(t,e){var i=this.currentTransform;if(i.translate(t,e),!1===this.settings.subPixel){var s=i.toArray();s[6]|=0,s[7]|=0}}clipRect(t,e,i,s){var n=this.getCanvas(),r=this.gl;if(0!==t||0!==e||i!==n.width||s!==n.height){var o=this.currentScissor;if(r.isEnabled(r.SCISSOR_TEST)&&o[0]===t&&o[1]===e&&o[2]===i&&o[3]===s)return;this.flush(),r.enable(this.gl.SCISSOR_TEST),r.scissor(t+this.currentTransform.tx,n.height-s-e-this.currentTransform.ty,i,s),o[0]=t,o[1]=e,o[2]=i,o[3]=s}else r.disable(r.SCISSOR_TEST)}setMask(t,e=!1){var i=this.gl;this.flush(),0===this.maskLevel&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(t),this.flush(),i.colorMask(!0,!0,!0,!0),!0===e?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}var uc=1,pc=0,fc=0,gc={parent:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",transparent:!1,premultipliedAlpha:!0,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0};function mc(){var t=xc.settings,e=1,i=1;if(t.autoScale){var s=1/0,n=1/0;if(globalThis.getComputedStyle){var r=globalThis.getComputedStyle(xc.getCanvas(),null);s=parseInt(r.maxWidth,10)||1/0,n=parseInt(r.maxHeight,10)||1/0}var o=zo(wc()),a=Math.min(s,o.width),h=Math.min(n,o.height),l=a/h;if("fill-min"===t.scaleMethod&&l>uc||"fill-max"===t.scaleMethod&&l<uc||"flex-width"===t.scaleMethod){var d=Math.min(s,fc*l);e=i=a/d,xc.resize(Math.floor(d),fc)}else if("fill-min"===t.scaleMethod&&l<uc||"fill-max"===t.scaleMethod&&l>uc||"flex-height"===t.scaleMethod){var c=Math.min(n,pc*(h/a));e=i=h/c,xc.resize(pc,Math.floor(c))}else"flex"===t.scaleMethod?xc.resize(Math.floor(a),Math.floor(h)):"stretch"===t.scaleMethod?(e=a/pc,i=h/fc):e=i=l<uc?a/pc:h/fc;_c(e,i)}else _c(t.scale,t.scale)}let yc=null,vc=new Nn(1,1),xc=null;function bc(t,e,i=!1){var s;if(0===t||0===e)throw new Error("width or height was zero, Canvas could not be initialized !");return!0===Co&&!0===i?void 0===(s=new globalThis.OffscreenCanvas(0,0)).style&&(s.style={}):s=document.createElement("canvas"),s.width=t,s.height=e,s}function wc(){return yc}function _c(t,e){var i=xc.getCanvas(),s=xc.getContext(),n=xc.settings,r=So,o=n.zoomX=i.width*t*r,a=n.zoomY=i.height*e*r;vc.set(t*r,e*r),i.style.width=o/r+"px",i.style.height=a/r+"px",xc.setAntiAlias(s,n.antiAlias),xc.setBlendMode(n.blendMode,s),Bl.repaint()}var Ec=Object.freeze({__proto__:null,CANVAS:0,WEBGL:1,AUTO:2,get parent(){return yc},scaleRatio:vc,get renderer(){return xc},init:function(t,e,i){if(!hu)throw new Error("me.video.init() called before engine initialization.");(gc=Object.assign(gc,i||{})).width=t,gc.height=e,gc.transparent=!!gc.transparent,gc.antiAlias=!!gc.antiAlias,gc.failIfMajorPerformanceCaveat=!!gc.failIfMajorPerformanceCaveat,gc.subPixel=!!gc.subPixel,gc.verbose=!!gc.verbose,-1!==gc.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)?gc.autoScale="auto"===gc.scale||!0:(gc.scaleMethod="fit",gc.autoScale="auto"===gc.scale||!1),!1!==gc.consoleHeader&&console.log("melonJS 2 (v"+au+") | http://melonjs.org");var s=Ac.getUriFragment();!0===s.webgl||!0===s.webgl1||!0===s.webgl2?(gc.renderer=1,!0===s.webgl1&&(gc.preferWebGL1=!0)):!0===s.canvas&&(gc.renderer=0),gc.scale=gc.autoScale?1:+gc.scale||1,vc.set(gc.scale,gc.scale),uc=t/e,pc=t,fc=e,gc.zoomX=t*vc.x,gc.zoomY=e*vc.y,globalThis.addEventListener("resize",Ac.function.throttle((function(t){Or(_r,t)}),100),!1),globalThis.addEventListener("orientationchange",(function(t){Or(Tr,t)}),!1),globalThis.addEventListener("onmozorientationchange",(function(t){Or(Tr,t)}),!1),!0===yo&&(globalThis.screen.orientation.onchange=function(t){Or(Tr,t)}),globalThis.addEventListener("scroll",Ac.function.throttle((function(t){Or(Ar,t)}),100),!1),Lr(_r,mc,this),Lr(Tr,mc,this);try{switch(gc.renderer){case 2:case 1:xc=function(t){try{if(Ho(t))return new cc(t)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new cd(t)}(gc);break;default:xc=new cd(gc)}}catch(t){return console(t.message),!1}if(yc=Uo(void 0!==gc.parent?gc.parent:document.body),yc.appendChild(xc.getCanvas()),ho.isMobile&&Do(!1),mc(),"MutationObserver"in globalThis&&new MutationObserver(mc.bind(this)).observe(yc,{attributes:!1,childList:!0,subtree:!0}),!1!==gc.consoleHeader){var n=xc instanceof cd?"CANVAS":"WebGL"+xc.WebGLVersion,r=bo?"Web Audio":"HTML5 Audio",o="string"==typeof xc.GPURenderer?" ("+xc.GPURenderer+")":"";console.log(n+" renderer"+o+" | "+r+" | pixel ratio "+So+" | "+(ho.nodeJS?"node.js":ho.isMobile?"mobile":"desktop")+" | "+Fo()+" | "+Ao),console.log("resolution: requested "+t+"x"+e+", got "+xc.getWidth()+"x"+xc.getHeight())}return Or(nr),!0},createCanvas:bc,getParent:wc,scale:_c}),Cc="",Tc=0,Ac={agent:gn,array:Sn,file:kn,string:cn,function:Bn,getPixels:function(t){if(t instanceof HTMLImageElement){var e=cd.getContext2d(bc(t.width,t.height));return e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height)}return t.getContext("2d").getImageData(0,0,t.width,t.height)},checkVersion:function(t,e=au){for(var i=t.split("."),s=e.split("."),n=Math.min(i.length,s.length),r=0,o=0;o<n&&!(r=+i[o]-+s[o]);o++);return r||i.length-s.length},getUriFragment:function(t){var e={};if(void 0===t){if(void 0===globalThis.document)return e;var i=globalThis.document.location;if(!i||!i.hash)return e;t=i.hash}else{var s=t.indexOf("#");if(-1===s)return e;t=t.slice(s,t.length)}return t.slice(1).split("&").filter((function(t){return""!==t})).forEach((function(t){var i=t.split("="),s=i.shift(),n=i.join("=");e[s]=n||!0})),e},resetGUID:function(t,e=0){Cc=ln(t.toString().toUpperCase()),Tc=e},createGUID:function(t=1){return Tc+=t,Cc+"-"+(t||Tc)}};const Sc=new class{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,Lr(Qn,(()=>{this.reset(),this.now=this.last=0,Lr(ar,this.update.bind(this))})),Lr(tr,(()=>{this.reset()})),Lr(ir,(()=>{this.reset()})),Lr(sr,(()=>{this.reset()}))}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:!0===i||!0,args:s}),this.timerId}setInterval(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:!0===i||!0,args:s}),this.timerId}clearTimeout(t){Ac.function.defer(this.clearTimer.bind(this),this,t)}clearInterval(t){Ac.function.defer(this.clearTimer.bind(this),this,t)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10==0&&(this.fps=_n(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(t){this.last=this.now,this.now=t,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(t){for(var e=0,i=this.timers.length;e<i;e++)if(this.timers[e].timerId===t){this.timers.splice(e,1);break}}updateTimers(){for(var t=0,e=this.timers.length;t<e;t++){var i=this.timers[t];i.pauseable&&sd.isPaused()||(i.elapsed+=this.delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),!0===i.repeat?i.elapsed-=i.delay:this.clearTimeout(i.timerId))}}};var Pc,Mc=0,Oc=["ms","moz","webkit","o"],Lc=globalThis.requestAnimationFrame,kc=globalThis.cancelAnimationFrame;for(Pc=0;Pc<Oc.length&&!Lc;++Pc)Lc=globalThis[Oc[Pc]+"RequestAnimationFrame"];for(Pc=0;Pc<Oc.length&&!kc;++Pc)kc=globalThis[Oc[Pc]+"CancelAnimationFrame"]||globalThis[Oc[Pc]+"CancelRequestAnimationFrame"];Lc&&kc||(Lc=function(t){var e=globalThis.performance.now(),i=Math.max(0,1e3/Sc.maxfps-(e-Mc)),s=globalThis.setTimeout((function(){t(e+i)}),i);return Mc=e+i,s},kc=function(t){globalThis.clearTimeout(t)},globalThis.requestAnimationFrame=Lc,globalThis.cancelAnimationFrame=kc),(()=>{function t(t,e,i,s,n){if(![t,e,i,s].every((t=>Number.isFinite(t))))return;let r,o,a,h;if(4===(n=function(t){const e=typeof t;return"undefined"===e||null===t?[0]:"function"===e?[NaN]:"object"===e?"function"==typeof t[Symbol.iterator]?[...t].map((t=>{const e=typeof t;return"undefined"===e||null===t?0:"function"===e?NaN:"object"===e?c(t):u(t)})):[c(t)]:[u(t)]}(n)).length)r=p(n[0]),o=p(n[1]),a=p(n[2]),h=p(n[3]);else if(3===n.length)r=p(n[0]),o=p(n[1]),h=p(n[1]),a=p(n[2]);else if(2===n.length)r=p(n[0]),a=p(n[0]),o=p(n[1]),h=p(n[1]);else{if(1!==n.length)throw new Error(n.length+" is not a valid size for radii sequence.");r=p(n[0]),o=p(n[0]),a=p(n[0]),h=p(n[0])}const l=[r,o,a,h],d=l.find((({x:t,y:e})=>t<0||e<0));if(!l.some((({x:t,y:e})=>!Number.isFinite(t)||!Number.isFinite(e)))){if(d)throw new Error("Radius value "+d+" is negative.");!function(t){const[e,n,r,o]=t,a=[Math.abs(i)/(e.x+n.x),Math.abs(s)/(n.y+r.y),Math.abs(i)/(r.x+o.x),Math.abs(s)/(e.y+o.y)],h=Math.min(...a);h<=1&&t.forEach((t=>{t.x*=h,t.y*=h}))}(l),i<0&&s<0?(this.moveTo(t-r.x,e),this.ellipse(t+i+o.x,e-o.y,o.x,o.y,0,1.5*-Math.PI,-Math.PI),this.ellipse(t+i+a.x,e+s+a.y,a.x,a.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-h.x,e+s+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(t-r.x,e-r.y,r.x,r.y,0,0,-Math.PI/2)):i<0?(this.moveTo(t-r.x,e),this.ellipse(t+i+o.x,e+o.y,o.x,o.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+i+a.x,e+s-a.y,a.x,a.y,0,-Math.PI,1.5*-Math.PI,1),this.ellipse(t-h.x,e+s-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(t-r.x,e+r.y,r.x,r.y,0,0,-Math.PI/2,1)):s<0?(this.moveTo(t+r.x,e),this.ellipse(t+i-o.x,e-o.y,o.x,o.y,0,Math.PI/2,0,1),this.ellipse(t+i-a.x,e+s+a.y,a.x,a.y,0,0,-Math.PI/2,1),this.ellipse(t+h.x,e+s+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+r.x,e-r.y,r.x,r.y,0,-Math.PI,1.5*-Math.PI,1)):(this.moveTo(t+r.x,e),this.ellipse(t+i-o.x,e+o.y,o.x,o.y,0,-Math.PI/2,0),this.ellipse(t+i-a.x,e+s-a.y,a.x,a.y,0,0,Math.PI/2),this.ellipse(t+h.x,e+s-h.y,h.x,h.y,0,Math.PI/2,Math.PI),this.ellipse(t+r.x,e+r.y,r.x,r.y,0,Math.PI,1.5*Math.PI)),this.closePath(),this.moveTo(t,e)}function c(t){const{x:e,y:i,z:s,w:n}=t;return{x:e,y:i,z:s,w:n}}function u(t){return+t}function p(t){const e=u(t);return Number.isFinite(e)?{x:e,y:e}:Object(t)===t?{x:u(t.x||0),y:u(t.y||0)}:{x:NaN,y:NaN}}}globalThis.CanvasRenderingContext2D&&void 0===globalThis.Path2D.prototype.roundRect&&(globalThis.Path2D.prototype.roundRect=t),globalThis.CanvasRenderingContext2D&&void 0===globalThis.CanvasRenderingContext2D.prototype.roundRect&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=t),globalThis.OffscreenCanvasRenderingContext2D&&void 0===globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=t)})();let Ic={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Ic.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Ic.Bounce.In(2*t):.5*Ic.Bounce.Out(2*t-1)+.5}}},Rc={Linear:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s),r=Rc.Utils.Linear;return e<0?r(t[0],t[1],s):e>1?r(t[i],t[i-1],i-s):r(t[n],t[n+1>i?i:n+1],s-n)},Bezier:function(t,e){var i,s=0,n=t.length-1,r=Math.pow,o=Rc.Utils.Bernstein;for(i=0;i<=n;i++)s+=r(1-e,n-i)*r(e,i)*t[i]*o(n,i);return s},CatmullRom:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s),r=Rc.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(s=i*(1+e))),r(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],s-n)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):r(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],s-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=Rc.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,s=1;if(t[e])return t[e];for(i=e;i>1;i--)s*=i;return t[e]=s,s}}(),CatmullRom:function(t,e,i,s,n){var r=.5*(i-t),o=.5*(s-e),a=n*n;return(2*e-2*i+r+o)*(n*a)+(-3*e+3*i-2*r-o)*a+r*n+e}}};class Bc{constructor(t){this.setProperties(t)}onResetEvent(t){this.setProperties(t)}setProperties(t){for(var e in this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Ic.Linear.None,this._interpolationFunction=Rc.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=Bl.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1,t)"object"!=typeof t&&(this._valuesStart[e]=parseFloat(t[e]))}_resumeCallback(t){this._startTime&&(this._startTime+=t)}onActivateEvent(){Lr(tr,this._resumeCallback,this)}onDeactivateEvent(){Ir(tr,this._resumeCallback)}to(t,e){return this._valuesEnd=t,void 0!==e&&("number"==typeof e?this._duration=e:"object"==typeof e&&(e.duration&&(this._duration=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this}start(t=Sc.getTime()){for(var e in this._onStartCallbackFired=!1,Bl.world.addChild(this),this._startTime=t+this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==0&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this}stop(){return Bl.world.removeChildNow(this),this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}yoyo(t){return this._yoyo=t,this}easing(t){if("function"!=typeof t)throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(){return this._chainedTweens=arguments,this}onStart(t){return this._onStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}update(t){this._tweenTimeTracker=Bl.lastUpdate>this._tweenTimeTracker?Bl.lastUpdate:this._tweenTimeTracker+t;var e,i=this._tweenTimeTracker;if(i<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);var s=(i-this._startTime)/this._duration;s=s>1?1:s;var n=this._easingFunction(s);for(e in this._valuesEnd){var r=this._valuesStart[e]||0,o=this._valuesEnd[e];o instanceof Array?this._object[e]=this._interpolationFunction(o,n):("string"==typeof o&&(o=r+parseFloat(o)),"number"==typeof o&&(this._object[e]=r+(o-r)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,n),1===s){if(this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var a=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=a}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=i+this._delayTime,!0}Bl.world.removeChildNow(this),null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object);for(var h=0,l=this._chainedTweens.length;h<l;h++)this._chainedTweens[h].start(i);return!1}return!0}static get Easing(){return Ic}static get Interpolation(){return Rc}}var Dc={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d"};class Nc{constructor(t,e,i=Dc){i=Object.assign(Dc,i||{}),this.canvas=bc(t,e,i.offscreenCanvas),this.context=this.canvas.getContext("2d",{willReadFrequently:i.willReadFrequently}),this.setAntiAlias(i.antiAlias)}onResetEvent(t,e){this.clear(),this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(t=!1){var e=this.canvas;fn("imageSmoothingEnabled",t,this.context),void 0!==e.style&&(!0!==t?(e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-o-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor"):e.style["image-rendering"]="auto")}resize(t,e){this.canvas.width=Math.round(t),this.canvas.height=Math.round(e)}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function Fc(t,e,i=!1){t.font=e.font,t.fillStyle=e.fillStyle.toRGBA(),!0===i&&(t.strokeStyle=e.strokeStyle.toRGBA(),t.lineWidth=e.lineWidth),t.textAlign=e.textAlign,t.textBaseline=e.textBaseline}class Gc extends Ia{constructor(t){super(),this.ancestor=t,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof Hc?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(t,e){if(this.ancestor instanceof Hc)return e.measureText(t).width;for(var i=t.split(""),s=0,n=null,r=0;r<i.length;r++){var o=i[r].charCodeAt(0),a=this.ancestor.fontData.glyphs[o];if(void 0!==a){var h=n&&n.kerning?n.getKerning(o):0;s+=(a.xadvance+h)*this.ancestor.fontScale.x,n=a}}return s}measureText(t,e){var i;i=Array.isArray(t)?t:(""+t).split("\n"),void 0!==e&&(e.save(),Fc(e,this.ancestor)),this.width=this.height=0;for(var s=0;s<i.length;s++)this.width=Math.max(this.lineWidth(i[s].trimEnd(),e),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor("right"===this.ancestor.textAlign?this.ancestor.pos.x-this.width:"center"===this.ancestor.textAlign?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(0===this.ancestor.textBaseline.search(/^(top|hanging)$/)?this.ancestor.pos.y:"middle"===this.ancestor.textBaseline?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),void 0!==e&&e.restore(),this}wordWrap(t,e,i){var s,n="",r=[];Array.isArray(t)&&(t=t.join(" ")),s=t.replace(/[\r\n]+/g," ").split(" "),void 0!==i&&(i.save(),Fc(i,this.ancestor));for(let t=0;t<s.length;t++){var o=s[t];this.lineWidth(n+o+" ",i)<e?n+=o+" ":(r.push(n+"\n"),n=o+" ")}return r.push(n),void 0!==i&&i.restore(),r}}const Uc=["ex","em","pt","px"],jc=[12,24,.75,1];var zc=function(t,e){return!0===e.offScreenCanvas?e.canvasTexture.context:(void 0===t&&(t=xc),t.getFontContext())};class Hc extends ul{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.onResetEvent(t,e,i)}onResetEvent(t,e,i){void 0!==i.fillStyle?i.fillStyle instanceof Wn?this.fillStyle=i.fillStyle:this.fillStyle=Dn.pull("Color").parseCSS(i.fillStyle):this.fillStyle=Dn.pull("Color",0,0,0),void 0!==i.strokeStyle?i.strokeStyle instanceof Wn?this.strokeStyle=i.strokeStyle:this.strokeStyle=Dn.pull("Color").parseCSS(i.strokeStyle):this.strokeStyle=Dn.pull("Color",0,0,0),this.lineWidth=i.lineWidth||1,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.offScreenCanvas=!1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontSize=10,void 0!==i.anchorPoint?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),void 0!==i.floating&&(this.floating=!!i.floating),this.setFont(i.font,i.size),!0===i.bold&&this.bold(),!0===i.italic&&this.italic(),!0===i.offScreenCanvas&&(this.offScreenCanvas=!0,this.canvasTexture=Dn.pull("CanvasTexture",2,2,{offscreenCanvas:!0})),this.metrics=new Gc(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(t,e=10){var i=t.split(",").map((function(t){return t=t.trim(),/(^".*"$)|(^'.*'$)/.test(t)?t:'"'+t+'"'}));if("number"==typeof e)this.fontSize=e,e+="px";else{var s=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(s[1]),s[2]?this.fontSize*=jc[Uc.indexOf(s[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this}setText(t=""){var e=this.getBounds();if(this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n")),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,zc(xc,this))),e.addBounds(this.metrics.measureText(this._text,zc(xc,this)),!0),!0===this.offScreenCanvas){var i=Math.ceil(this.metrics.width),s=Math.ceil(this.metrics.height);xc instanceof cc&&(this.glTextureUnit=xc.cache.getUnit(xc.cache.get(this.canvasTexture.canvas)),xc.currentCompositor.unbindTexture2D(null,this.glTextureUnit),1===xc.WebGLVersion&&(i=bn(this.metrics.width),s=bn(this.metrics.height))),(this.canvasTexture.width<i||this.canvasTexture.height<s)&&this.canvasTexture.resize(i,s),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y,!1)}return this.isDirty=!0,this}measureText(t,e=this._text){return this.metrics.measureText(e,zc(t,this))}draw(t,e,i=this.pos.x,s=this.pos.y,n=!1){void 0===this.ancestor?(this.pos.x===i&&this.pos.y===s||(this.pos.x=i,this.pos.y=s,this.isDirty=!0),this.setText(e),i=this.metrics.x,s=this.metrics.y,t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())):(i=this.pos.x,s=this.pos.y),!1===t.settings.subPixel&&(i=~~i,s=~~s),!0===this.offScreenCanvas?t.drawImage(this.canvasTexture.canvas,i,s):t.drawFont(this._drawFont(t.getFontContext(),this._text,i,s,n)),void 0===this.ancestor&&t.restore()}drawStroke(t,e,i,s){this.draw(t,e,i,s,!0)}_drawFont(t,e,i,s,n=!1){Fc(t,this,n);for(var r=0;r<e.length;r++){var o=e[r].trimEnd();t[n?"strokeText":"fillText"](o,i,s),s+=this.metrics.lineHeight()}return this.metrics}destroy(){!0===this.offScreenCanvas&&(xc instanceof cc&&(xc.currentCompositor.deleteTexture2D(xc.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),xc.cache.delete(this.canvasTexture.canvas),Dn.push(this.canvasTexture),this.canvasTexture=void 0),Dn.push(this.fillStyle),Dn.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class Yc extends ul{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=Dn.pull("Vector2d",1,1),this.fontImage="object"==typeof i.font?i.font:Vd.getImage(i.font),"string"!=typeof i.fontData?this.fontData=Dn.pull("BitmapTextData",Vd.getBinary(i.font)):this.fontData=Dn.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:Vd.getBinary(i.fontData)),void 0!==i.floating&&(this.floating=!!i.floating),void 0!==i.fillStyle&&(this.fillStyle=i.fillStyle),void 0!==i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new Gc(this),"number"==typeof i.size&&1!==i.size&&this.resize(i.size),this.setText(i.text)}set(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this}setText(t=""){return this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n"),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.getBounds().addBounds(this.metrics.measureText(this._text),!0),this}get fillStyle(){return this.tint}set fillStyle(t){t instanceof Wn?this.tint.copy(t):this.tint.parseCSS(t)}resize(t){return this.fontScale.set(t,t),this.getBounds().addBounds(this.metrics.measureText(this._text),!0),this.isDirty=!0,this}measureText(t=this._text){return this.metrics.measureText(t)}draw(t,e,i,s){var n=t.globalAlpha();void 0===this.ancestor?(this.setText(e),t.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,s=this.pos.y);for(var r=i,o=this.metrics.lineHeight(),a=0,h=0;h<this._text.length;h++){i=r;var l=this._text[h].trimEnd(),d=this.metrics.lineWidth(l);switch(this.textAlign){case"right":i-=d;break;case"center":i-=.5*d}switch(this.textBaseline){case"middle":s-=.5*o;break;case"ideographic":case"alphabetic":case"bottom":s-=o}!0===this.isDirty&&void 0===this.ancestor&&(0===h&&(this.pos.y=s),a<d&&(a=d,this.pos.x=i));for(var c=null,u=0,p=l.length;u<p;u++){var f=l.charCodeAt(u),g=this.fontData.glyphs[f];if(void 0!==g){var m=g.width,y=g.height,v=c&&c.kerning?c.getKerning(f):0,x=this.fontScale.x,b=this.fontScale.y;0!==m&&0!==y&&t.drawImage(this.fontImage,g.x,g.y,m,y,i+g.xoffset*x,s+g.yoffset*b,m*x,y*b),i+=(g.xadvance+v)*x,c=g}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(f))}s+=o}void 0===this.ancestor&&t.setGlobalAlpha(n),this.isDirty=!1}destroy(){Dn.push(this.fontScale),this.fontScale=void 0,Dn.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class Vc{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){var e=this.kerning[t>>>9];if(e)return e[511&t]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});var i=this.kerning[t>>>9];void 0===i&&(this.kerning[t>>>9]={},i=this.kerning[t>>>9]),i[511&t]=e}}const Wc=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function Kc(t,e){var i=t.match(e);if(!i)throw new Error("Could not find pattern "+e+" in string: "+t);return i[0].split("=")[1]}class qc{constructor(t){this.onResetEvent(t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");var e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");var s=i[0].split("=")[1].split(",");this.padTop=parseFloat(s[0]),this.padLeft=parseFloat(s[1]),this.padBottom=parseFloat(s[2]),this.padRight=parseFloat(s[3]),this.lineHeight=parseFloat(Kc(e[1],/lineHeight\=\d+/g));var n,r=parseFloat(Kc(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,a=null;for(n=4;n<e.length;n++){var h=e[n],l=h.split(/=|\s+/);if(h&&!/^kernings/.test(h))if(/^kerning\s/.test(h)){var d=parseFloat(l[2]),c=parseFloat(l[4]),u=parseFloat(l[6]);null!=(a=this.glyphs[d])&&a.setKerning(c,u)}else{a=new Vc;var p=parseFloat(l[2]);a.id=p,a.x=parseFloat(l[4]),a.y=parseFloat(l[6]),a.width=parseFloat(l[8]),a.height=parseFloat(l[10]),a.xoffset=parseFloat(l[12]),a.yoffset=parseFloat(l[14]),a.xadvance=parseFloat(l[16]),a.width>0&&a.height>0&&(this.descent=Math.min(r+a.yoffset,this.descent)),this.glyphs[p]=a}}this.descent+=this.padBottom,function(t){var e=" ".charCodeAt(0),i=t[e];i||((i=new Vc).id=e,i.xadvance=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)if(e[i]>32)return t[e[i]];return null}(t).xadvance,t[e]=i)}(this.glyphs);var f=null;for(n=0;n<Wc.length;n++){var g=Wc[n];if(f=this.glyphs[g.charCodeAt(0)])break}if(f)this.capHeight=f.height;else for(var m in this.glyphs)if(this.glyphs.hasOwnProperty(m)){if(0===(a=this.glyphs[m]).height||0===a.width)continue;this.capHeight=Math.max(this.capHeight,a.height)}this.capHeight-=o}}class Xc extends ul{constructor(t,e,i){super(0,0,1/0,1/0),this.color=Dn.pull("Color").parseCSS(e),this.onResetEvent(t,e,i)}onResetEvent(t,e,i=0){this.name=t,this.pos.z=i,this.floating=!0,this.color.parseCSS(e)}draw(t,e){t.save(),t.clipRect(0,0,e.width,e.height),t.clearColor(this.color),t.restore()}destroy(){Dn.push(this.color),this.color=void 0,super.destroy()}}class Jc extends Wd{constructor(t,e,i){super(t,e,i),this.floating=!0,this.offset.set(t,e),this.ratio=Dn.pull("Vector2d",1,1),void 0!==i.ratio&&(an(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),void 0===i.anchorPoint?this.anchorPoint.set(0,0):"number"==typeof i.anchorPoint?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",Lr(Mr,this.createPattern,this)}get repeat(){return this._repeat}set repeat(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(Bl.viewport.width,Bl.viewport.height),this.createPattern()}onActivateEvent(){Lr(Sr,this.updateLayer,this),Lr(Cr,this.resize,this),kr(ur,(()=>{this.updateLayer(Bl.viewport.pos)})),!0!==this.ancestor.root&&this.updateLayer(Bl.viewport.pos)}resize(t,e){return super.resize(this.repeatX?1/0:t,this.repeatY?1/0:e)}createPattern(){this._pattern=xc.createPattern(this.image,this._repeat)}updateLayer(t){var e=this.ratio.x,i=this.ratio.y;if(0!==e||0!==i){var s=this.width,n=this.height,r=Bl.viewport.bounds.width,o=Bl.viewport.bounds.height,a=this.anchorPoint.x,h=this.anchorPoint.y,l=a*(e-1)*(r-Bl.viewport.width)+this.offset.x-e*t.x,d=h*(i-1)*(o-Bl.viewport.height)+this.offset.y-i*t.y;this.repeatX?this.pos.x=l%s:this.pos.x=l,this.repeatY?this.pos.y=d%n:this.pos.y=d,this.isDirty=!0}}preDraw(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint)}draw(t,e){var i=this.width,s=this.height,n=e.bounds.width,r=e.bounds.height,o=this.anchorPoint.x,a=this.anchorPoint.y,h=this.pos.x,l=this.pos.y;0===this.ratio.x&&0===this.ratio.y&&(h+=o*(n-i),l+=a*(r-s)),t.translate(h,l),t.drawPattern(this._pattern,0,0,2*e.width,2*e.height)}onDeactivateEvent(){Ir(Sr,this.updateLayer),Ir(Cr,this.resize)}destroy(){Dn.push(this.ratio),this.ratio=void 0,Ir(Mr,this.createPattern),super.destroy()}}class Zc extends Wd{constructor(t,e,i){if(super(t,e,i),"number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(t){super.width=this.nss_width=t}get height(){return super.height}set height(t){super.height=this.nss_height=t}draw(t){var e=this.current,i=this.pos.x,s=this.pos.y,n=e.width,r=e.height,o=e.offset,a=this.offset;0!==e.angle&&(t.translate(-i,-s),t.rotate(e.angle),i-=r,n=e.height,r=e.width);var h=a.x+o.x,l=a.y+o.y,d=this.insetx||n/4,c=this.insety||r/4;t.drawImage(this.image,h,l,d,c,i,s,d,c),t.drawImage(this.image,h+n-d,l,d,c,i+this.nss_width-d,s,d,c),t.drawImage(this.image,h,l+r-c,d,c,i,s+this.nss_height-c,d,c),t.drawImage(this.image,h+n-d,l+r-c,d,c,i+this.nss_width-d,s+this.nss_height-c,d,c);var u=n-(d<<1),p=r-(c<<1),f=this.nss_width-(d<<1),g=this.nss_height-(c<<1);t.drawImage(this.image,h+d,l,u,c,i+d,s,f,c),t.drawImage(this.image,h+d,l+r-c,u,c,i+d,s+this.nss_height-c,f,c),t.drawImage(this.image,h,l+c,d,p,i,s+c,d,g),t.drawImage(this.image,h+n-d,l+c,d,p,i+this.nss_width-d,s+c,d,g),t.drawImage(this.image,h+d,l+c,u,p,i+d,s+c,f,g)}}class Qc extends Wd{constructor(t,e,i){super(t,e,i),this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.hover=!1,this.holdTimeout=null,this.released=!0,this.floating=!0,this.isKinematic=!1}clicked(t){if(0===t.button&&this.isClickable)return this.dirty=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&Sc.clearTimeout(this.holdTimeout),this.holdTimeout=Sc.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick(t)}onClick(t){return!1}enter(t){return this.hover=!0,this.dirty=!0,this.onOver(t)}onOver(t){}leave(t){return this.hover=!1,this.dirty=!0,this.release(t),this.onOut(t)}onOut(t){}release(t){if(!1===this.released)return this.released=!0,this.dirty=!0,Sc.clearTimeout(this.holdTimeout),this.onRelease(t)}onRelease(){return!1}hold(){Sc.clearTimeout(this.holdTimeout),this.dirty=!0,this.released||this.onHold()}onHold(){}onActivateEvent(){Zh("pointerdown",this,this.clicked.bind(this)),Zh("pointerup",this,this.release.bind(this)),Zh("pointercancel",this,this.release.bind(this)),Zh("pointerenter",this,this.enter.bind(this)),Zh("pointerleave",this,this.leave.bind(this))}onDeactivateEvent(){Qh("pointerdown",this),Qh("pointerup",this),Qh("pointercancel",this),Qh("pointerenter",this),Qh("pointerleave",this),Sc.clearTimeout(this.holdTimeout)}}class $c extends Wd{constructor(t,e,i){super(t,e,i),this.name=i.name,this.type=i.type,this.id=i.id;var s=i.shapes;void 0===s&&(s=Dn.pull("Polygon",0,0,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height)])),this.body=new Al(this,s),this.body.collisionType=Tl.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Tl.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class tu extends ul{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(function(t){void 0!==i[t]&&(this.triggerSettings[t]=i[t])}.bind(this));var s=i.shapes;void 0===s&&(s=Dn.pull("Polygon",0,0,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height)])),this.body=new Al(this,s),this.body.collisionType=Tl.types.ACTION_OBJECT,this.body.setCollisionMask(Tl.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){return"string"==typeof this.triggerSettings.container&&(this.triggerSettings.container=Bl.world.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){Md.load(this.gotolevel,this.getTriggerSettings()),Bl.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){var t=this.getTriggerSettings();if("level"!==t.event)throw new Error("Trigger invalid type");this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,Bl.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):Md.load(this.gotolevel,t)}onCollision(t,e){return"Trigger"===this.name&&this.triggerEvent.apply(this),!1}}class eu extends ul{constructor(t,e,i,s=i,n="#FFF",r=.7){super(t,e,2*i,2*s),this.color=Dn.pull("Color").parseCSS(n),this.radiusX=i,this.radiusY=s,this.intensity=r,this.blendMode="lighter",this.visibleArea=Dn.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=Dn.pull("CanvasTexture",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),function(t){var e,i,s,n,r,o=t.texture.context,a=t.texture.width/2,h=t.texture.height/2,l=t.radiusX,d=t.radiusY;t.texture.clear(),l>=d?(e=1,s=1,i=d/l,n=l/d,r=o.createRadialGradient(a,h*n,0,a,d*n,l)):(i=1,n=1,e=l/d,s=d/l,r=o.createRadialGradient(a*s,h,0,a*s,h,d)),r.addColorStop(0,t.color.toRGBA(t.intensity)),r.addColorStop(1,t.color.toRGBA(0)),o.fillStyle=r,o.setTransform(e,0,0,i,0,0),o.fillRect(0,0,t.texture.width*s,t.texture.height*n)}(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}draw(t,e){t.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){Dn.push(this.color),this.color=void 0,Dn.push(this.texture),this.texture=void 0,Dn.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}const iu={width:1,height:1,image:void 0,textureSize:8,tint:"#fff",totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,blendMode:"normal",onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0};class su extends Ml{constructor(t,e,i={}){super(t,e,1|i.width,1|i.height),this.settings={},this.centerOn(t,e),this._stream=!1,this._frequencyTimer=0,this._durationTimer=0,this._enabled=!1,this.alwaysUpdate=!0,this.autoSort=!1,this._updateCount=0,this._dt=0,this.reset(i)}reset(t={}){Object.assign(this.settings,iu,t),void 0===this.settings.image&&(this._defaultParticle=function(t=8,e=8){var i=Dn.pull("CanvasTexture",t,e,{offscreenCanvas:!0});return i.context.fillStyle="#fff",i.context.fillRect(0,0,t,e),i}(t.textureSize,t.textureSize),this.settings.image=this._defaultParticle.canvas),this.floating=this.settings.floating,this.isDirty=!0}getRandomPointX(){return Cn(0,this.getBounds().width)}getRandomPointY(){return Cn(0,this.getBounds().height)}addParticles(t){for(var e=0;e<t;e++)this.addChild(Dn.pull("Particle",this),this.pos.z);this.isDirty=!0}isRunning(){return this._enabled&&this._stream}streamParticles(t){this._enabled=!0,this._stream=!0,this.settings.frequency=Math.max(1,this.settings.frequency),this._durationTimer="number"==typeof t?t:this.settings.duration}stopStream(){this._enabled=!1}burstParticles(t){this._enabled=!0,this._stream=!1,this.addParticles("number"==typeof t?t:this.settings.totalParticles),this._enabled=!1}update(t){if(++this._updateCount>this.settings.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=t,this.isDirty;if(t+=this._dt,this._dt=0,this.isDirty|=super.update(t),this._enabled&&this._stream){if(this._durationTimer!==1/0&&(this._durationTimer-=t,this._durationTimer<=0))return this.stopStream(),this.isDirty;this._frequencyTimer+=t;var e=this.children.length;e<this.settings.totalParticles&&this._frequencyTimer>=this.settings.frequency&&(e+this.settings.maxParticles<=this.settings.totalParticles?this.addParticles(this.settings.maxParticles):this.addParticles(this.settings.totalParticles-e),this._frequencyTimer=0,this.isDirty=!0)}return this.isDirty}destroy(){super.destroy(arguments),void 0!==this._defaultParticle&&(Dn.push(this._defaultParticle),this._defaultParticle=void 0),this.settings.image=void 0,this.settings=void 0}}class nu extends ul{constructor(t){super(t.getRandomPointX(),t.getRandomPointY(),t.settings.image.width,t.settings.image.height),this.onResetEvent(t,!0)}onResetEvent(t,e=!1){!1===e?(this.pos.set(t.getRandomPointX(),t.getRandomPointY()),this.resize(t.settings.image.width,t.settings.image.height),this.currentTransform.identity()):this.vel=Dn.pull("Vector2d"),this.image=t.settings.image,this.alwaysUpdate=!0,"string"==typeof t.settings.tint&&this.tint.parseCSS(t.settings.tint),!0===t.settings.textureAdditive&&(this.blendMode="additive"),"normal"!==t.settings.blendMode&&(this.blendMode=t.settings.blendMode);var i=t.settings.angle+(t.settings.angleVariation>0?(Cn(0,2)-1)*t.settings.angleVariation:0),s=t.settings.speed+(t.settings.speedVariation>0?(Cn(0,2)-1)*t.settings.speedVariation:0);this.vel.set(s*Math.cos(i),-s*Math.sin(i)),this.life=Cn(t.settings.minLife,t.settings.maxLife),this.startLife=this.life,this.startScale=_n(Cn(t.settings.minStartScale,t.settings.maxStartScale),t.settings.minStartScale,t.settings.maxStartScale),this.endScale=_n(Cn(t.settings.minEndScale,t.settings.maxEndScale),t.settings.minEndScale,t.settings.maxEndScale),this.gravity=t.settings.gravity,this.wind=t.settings.wind,this.followTrajectory=t.settings.followTrajectory,this.onlyInViewport=t.settings.onlyInViewport,this._deltaInv=Sc.maxfps/1e3,t.settings.followTrajectory||(this.angle=Cn(t.settings.minRotation,t.settings.maxRotation))}update(t){var e=t*this._deltaInv;if(this.life=this.life>t?this.life-t:0,this.life<=0)return this.ancestor.removeChild(this),!1;var i=this.life/this.startLife,s=this.startScale;this.startScale>this.endScale?s=(s*=i)<this.endScale?this.endScale:s:this.startScale<this.endScale&&(s=(s/=i)>this.endScale?this.endScale:s),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;var n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(s,0,0,0,s,0,this.pos.x,this.pos.y,1).rotate(n),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(t)}draw(t){var e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}class ru extends ul{constructor(t,e,i){if("number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(t,e,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new Wd(0,0,i)),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),"string"==typeof i.name&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,void 0===i.shapes&&(i.shapes=Dn.pull("Polygon",0,0,[Dn.pull("Vector2d",0,0),Dn.pull("Vector2d",this.width,0),Dn.pull("Vector2d",this.width,this.height),Dn.pull("Vector2d",0,this.height)])),this.body=new Al(this,i.shapes,this.onBodyUpdate.bind(this)),0===this.width&&0===this.height&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(t){if(!(t instanceof ul))throw new Error(t+"should extend me.Renderable");this.children[0]=t,this.children[0].ancestor=this}update(t){return this.renderable&&(this.isDirty|=this.renderable.update(t)),super.update(t)}onBodyUpdate(t){this.getBounds().addBounds(t.getBounds(),!0),this.updateBoundsPos(this.pos.x,this.pos.y)}preDraw(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof ul&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(t,e){var i=this.renderable;i instanceof ul&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function ou(t,e,i){var s="melonJS: %s is deprecated since version %s, please use %s",n=(new Error).stack;console.groupCollapsed?console.groupCollapsed("%c"+s,"font-weight:normal;color:yellow;",t,i,e):console.warn(s,t,i,e),void 0!==n&&console.warn(n),console.groupCollapsed&&console.groupEnd()}Object.defineProperty(Da.prototype,"Texture",{get:function(){return ou("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),qd}}),Da.prototype.getScreenCanvas=function(){return ou("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()},Da.prototype.getScreenContext=function(){return ou("getScreenContext","getContext","13.1.0"),this.getContext()};const au="13.4.0";var hu=!1;Bo((function(){!0!==hu&&(Dn.register("me.Entity",ru),Dn.register("me.Collectable",$c),Dn.register("me.Trigger",tu),Dn.register("me.Light2d",eu),Dn.register("me.Tween",Bc,!0),Dn.register("me.Color",Wn,!0),Dn.register("me.Particle",nu,!0),Dn.register("me.Sprite",Wd),Dn.register("me.NineSliceSprite",Zc),Dn.register("me.Renderable",ul),Dn.register("me.Text",Hc,!0),Dn.register("me.BitmapText",Yc),Dn.register("me.BitmapTextData",qc,!0),Dn.register("me.ImageLayer",Jc),Dn.register("me.ColorLayer",Xc,!0),Dn.register("me.Vector2d",Nn,!0),Dn.register("me.Vector3d",ih,!0),Dn.register("me.ObservableVector2d",eh,!0),Dn.register("me.ObservableVector3d",sh,!0),Dn.register("me.Matrix2d",qn,!0),Dn.register("me.Matrix3d",Kn,!0),Dn.register("me.Rect",Ma,!0),Dn.register("me.RoundRect",Oa,!0),Dn.register("me.Polygon",Pa,!0),Dn.register("me.Line",ka,!0),Dn.register("me.Point",Ba,!0),Dn.register("me.Ellipse",La,!0),Dn.register("me.Bounds",Ia,!0),Dn.register("Entity",ru),Dn.register("Collectable",$c),Dn.register("Trigger",tu),Dn.register("Light2d",eu),Dn.register("Tween",Bc,!0),Dn.register("Color",Wn,!0),Dn.register("Particle",nu,!0),Dn.register("Sprite",Wd),Dn.register("NineSliceSprite",Zc),Dn.register("Renderable",ul),Dn.register("Text",Hc,!0),Dn.register("BitmapText",Yc),Dn.register("BitmapTextData",qc,!0),Dn.register("ImageLayer",Jc),Dn.register("ColorLayer",Xc,!0),Dn.register("Vector2d",Nn,!0),Dn.register("Vector3d",ih,!0),Dn.register("ObservableVector2d",eh,!0),Dn.register("ObservableVector3d",sh,!0),Dn.register("Matrix2d",qn,!0),Dn.register("Matrix3d",Kn,!0),Dn.register("Rect",Ma,!0),Dn.register("RoundRect",Oa,!0),Dn.register("Polygon",Pa,!0),Dn.register("Line",ka,!0),Dn.register("Point",Ba,!0),Dn.register("Ellipse",La,!0),Dn.register("Bounds",Ia,!0),Dn.register("CanvasTexture",Nc,!0),Or(Qn),Vd.setNocache(Ac.getUriFragment().nocache||!1),ph(),hu=!0)}));var lu=i(379),du=i.n(lu),cu=i(795),uu=i.n(cu),pu=i(569),fu=i.n(pu),gu=i(565),mu=i.n(gu),yu=i(216),vu=i.n(yu),xu=i(589),bu=i.n(xu),wu=i(956),_u={};_u.styleTagTransform=bu(),_u.setAttributes=mu(),_u.insert=fu().bind(null,"head"),_u.domAPI=uu(),_u.insertStyleElement=vu(),du()(wu.Z,_u),wu.Z&&wu.Z.locals&&wu.Z.locals;const Eu={environment:"prod",appName:"{{applicationName}}",appVersion:"{{applicationVersion}}",baseURL:"",local:{baseURL:"http://192.168.2.198:8080/"},dev:{baseURL:"http://cat-server-cat-dev.apps.work.ocp.lan/"},test:{baseURL:"http://cat-server-cat-stage.apps.work.ocp.lan/"},prod:{baseURL:"{{baseURL}}"}};class Cu{constructor(t,e){this.x=t,this.y=e,this.pos=new Nn(t,e),this.pos.z=0,this.onResetEvent(t,e)}onResetEvent(t,e){this.x=t,this.y=e,this.z=0,this.pos.x=t,this.pos.y=e,this.forEnemy=""}update(){}}class Tu{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.id=i,this.x=t,this.y=e,this.pos=new Nn(t,e),this.pos.z=0,this.currentPoint=0,this.points=[],this.onResetEvent(t,e)}onResetEvent(t,e){this.x=t,this.y=e,this.z=0,this.pos.x=t,this.pos.y=e,this.points=[],this.forEnemy=""}addWayPoint(t){this.points.push(t)}getCurrentWayPoint(){return this.points[this.currentPoint]}getNextWayPoint(){return this.currentPoint++,this.currentPoint>=this.points.length&&(this.currentPoint=0),this.getCurrentWayPoint()}update(){}}function Au(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Su{constructor(t){this.obj=t,this.id=t.id,this.name=t.name,this.clazz=t.class,this.x=Math.round(t.x),this.y=Math.round(t.y),this.mapX=Math.floor((this.x-16)/32*32/32),this.mapY=Math.floor((this.y-16)/32*32/32),this.pathId=-1,console.log("  New Object ("+this.clazz+") at "+this.mapX+", "+this.mapY),"GolemEnemy"===this.clazz?(this.type=Su.types.ENEMY,this.pathId=this._propertyValue("path"),this.path=null):"EnemyEmitter"===this.clazz?(this.type=Su.types.ENEMY_EMITTER,this.initialDelay=this._propertyValue("initialDelay")||5e3,this.enemyType=this._propertyValue("enemyType")||"SpiderEnemy",this.numEnemies=this._propertyValue("numEnemies")||5,this.emitEvery=this._propertyValue("emitEvery")||5e3,console.log("  EnemyEmitter("+this.enemyType+"): "+this.mapX+", "+this.mapY)):"Chest"===this.clazz&&(this.type=Su.types.CHEST,this.numBombs=this._propertyValue("numBombs")||0,this.score=this._propertyValue("score")||Iu.scoreForChest,this.numMagicBolts=this._propertyValue("numMagicBolts")||0,this.numMagicFirespins=this._propertyValue("numMagicFirespin")||0,this.numMagicNebulas=this._propertyValue("numMagicNebula")||0,this.numMagicProtectionCircles=this._propertyValue("numMagicProtectionCircle")||0,console.log("  Chest "+this.name+": "+this.score+", "+this.numBombs+", "+this.numMagicBolts+", "+this.numMagicFirespins+", "+this.numMagicProtectionCircles))}_propertyValue(t){let e;return null!==this.obj.properties&&void 0!==this.obj.properties&&this.obj.properties.forEach((i=>{i.name===t&&(e="int"===i.type?Math.round(i.value):i.value)})),e}getPathObject(t){if(null!==this.pathId&&void 0!==this.pathId&&void 0!==t[this.pathId]&&null!==t[this.pathId])return t[this.pathId]}}Au(Su,"types",{ENEMY:1,CHEST:2,ENEMY_EMITTER:3,OTHER_OBJECT:100});class Pu{constructor(t,e,i,s){this.info=t,this.id=t.id,this.previewImage=t.preview,this.name=e,this.longName=i,this.data=s,this.description=s.description,this.loadedIntoMelon=!1,this.mapWidth=s.width,this.mapHeight=s.height,this.wayPoints=[],this.wayPaths=[],this.objects=[],this.parseObjects()}loadIntoMelon(){this.loadedIntoMelon||(Vd.load({name:this.id,src:this.info.path,type:"tmx",format:"json",data:this.data},this.onLoaded),this.loadedIntoMelon=!0)}onLoaded(){}applyProperties(t,e){e.forEnemy=void 0,null!==t.properties&&t.properties.forEach((t=>{"forEnemy"===t.name&&(e.forEnemy=t.value)}))}parseObjects(){this.data.layers.forEach((t=>{"objectgroup"===t.type&&null!==t.objects&&(t.objects.forEach((t=>{if("WayPoint"===t.name){let e=new Cu(Math.floor(t.x/32),Math.floor(t.y/32));this.applyProperties(t,e),this.wayPoints.push(e)}else if("WayPath"===t.name&&null!==t.polyline){let e=new Tu(Math.floor(Math.round(t.x)/32),Math.floor(Math.round(t.y)/32),t.id),i=Math.round(t.x),s=Math.round(t.y);this.applyProperties(t,e),null!==e.forEnemy&&void 0!==e.forEnemy?this.wayPaths[e.forEnemy]=e:this.wayPaths["Path."+t.id]=e,t.polyline.forEach((t=>{let n=Math.round(i+t.x),r=Math.round(s+t.y),o=new Cu(Math.floor(n/32),Math.floor(r/32));e.addWayPoint(o)}))}else{console.log("  parsing new object structure: "+t.name);let e=new Su(t);this.objects.push(e)}})),t.objects=null)})),this.wayPoints.length>0&&this.wayPoints.forEach((t=>{void 0!==this.wayPaths[t.forEnemy]?(console.log(this.wayPaths[t.forEnemy]),this.wayPaths[t.forEnemy].addWayPoint(t)):(this.wayPaths[t.forEnemy]=new Tu(t.x,t.y),this.wayPaths[t.forEnemy].addWayPoint(t))}))}getPathForEnemy(t){if(void 0!==this.wayPaths[t])return this.wayPaths[t]}}var Mu=null;const Ou=[{id:"level1",path:"maps/0.json",loaded:!1,error:!1,multiplayer:!1,preview:"Level1"},{id:"level2",path:"maps/1.json",loaded:!1,error:!1,multiplayer:!1,preview:"Level2"},{id:"level3",path:"maps/2.json",loaded:!1,error:!1,multiplayer:!1,preview:"Level3"},{id:"level4",path:"maps/3.json",loaded:!1,error:!1,multiplayer:!1,preview:"Level4"},{id:"level5",path:"maps/4.json",loaded:!1,error:!1,multiplayer:!1,preview:"Level5"},{id:"level6",path:"maps/5.json",loaded:!1,error:!1,multiplayer:!1,preview:"Level6"}],Lu=[{id:"mp1",path:"maps/mp/0.json",loaded:!1,error:!1,multiplayer:!0,preview:"mp1"},{id:"mp2",path:"maps/mp/1.json",loaded:!1,error:!1,multiplayer:!0,preview:"mp2"}];class ku{constructor(){Au(this,"allLevels",[]),Au(this,"mpLevels",[]),Au(this,"currentLevel",0),Au(this,"levelChangeListeners",[])}static getInstance(){return null==Mu&&(console.log("Creating LevelManager instance"),Mu=new ku),Mu}async _loadLevelData(t){let e=Eu.baseURL+t.path;console.log("  LevelManager: Loading level '"+t.id+"'");let i=await fetch(e),s=await i.json(),n=new Pu(t,s.name,s.longName,s);return console.log("  Loaded: "+t.id+" = "+n.name),t.multiplayer?this.mpLevels[t.id]=n:this.allLevels[t.id]=n,n}initialize(t){const e=[];for(let t=0;t<Ou.length;t++){let i=Ou[t];e.push(this._loadLevelData(i))}for(let t=0;t<Lu.length;t++){let i=Lu[t];e.push(this._loadLevelData(i))}Promise.all(e).then((e=>{console.log("  All Levels loaded: "+e),t()})).catch((function(t){console.log("  LevelManager: Failed loading level "+t)}))}addLevelChangeListener(t){this.levelChangeListeners.push(t)}async _fireLevelChanged(t,e){this.levelChangeListeners.forEach((i=>{i(t,e)}))}getCurrentLevel(){let t=Ou[this.currentLevel].id;return this.allLevels[t]}getCurrentLevelId(){return Ou[this.currentLevel].id}getCurrentLevelIndex(){return this.currentLevel}reset(){console.log("  LevelManager.reset() "),this.currentLevel=0}setCurrentLevel(t){return this.currentLevel=t,this.getCurrentLevel()}next(){console.log("  LevelManager.next() ");let t=this.currentLevel;this.currentLevel++,this.currentLevel>=Ou.length&&this.reset(),this._fireLevelChanged(t,this.currentLevel)}prev(){console.log("  LevelManager.prev() ");let t=this.currentLevel;this.currentLevel--,this.currentLevel<0&&this.reset(),this._fireLevelChanged(t,this.currentLevel)}hasNext(){return this.currentLevel<Ou.length-1}hasPrev(){return this.currentLevel>0}levelCount(){return Ou.length}prepareCurrentLevel(){let t=this.getCurrentLevel();console.log("  LevelManager.prepareCurrentLevel('"+this.getCurrentLevelId()+"')"),t.loadIntoMelon(),Md.load(t.id)}allMultiplayerLevels(){let t=[];return Lu.forEach((e=>{t.push(this.mpLevels[e.id])})),t}}const Iu={isMultiplayerMatch:!1,globalServerGame:null,globalServerVersion:null,gameToReplay:null,replayActions:null,screenControlsTexture:null,enemyStunnedTime:5e3,playerInvincibleTime:3e3,magicDurationTime:15e3,scoreForPills:10,scoreForBombs:50,scoreForMeat:25,scoreForCheese:15,scoreForStunningCat:50,scoreForStunningGolem:150,scoreForKillingSpider:100,scoreForBombingRemotePlayers:150,scoreForStars:50,scoreForChest:250,scoreForPotion:50,energyForMeat:25,energyForCheese:20,bombsForBombBonus:5,superPowersForStarBonus:5,magicForPotion:3,energyLostBySpider:25,energyLostByCat:10,energyLostByGolem:50,energyLostByRemoteBomb:50,maxEnergyForStar:15,energyOnBegin:100,energy:100,maxEnergy:100,score:0,bombs:0,invincible:!1,isGameOver:!1,isSlowed:!1,isHasted:!1,magicBolts:0,magicNebulas:0,magicProtections:0,magicFirespins:0,placedBarriers:0,usedBombs:0,bittenBySpiders:0,catchedByCats:0,catchedByGolems:0,killedSpiders:0,stunnedCats:0,stunnedGolems:0,bonusCollected:0,hitByRemotePlayerBomb:0,hitByRemotePlayerMagic:0,collectedChests:0,reset:function(){this.energy=this.energyOnBegin,this.maxEnergy=this.energyOnBegin,ku.getInstance().reset(),this.score=0,this.bombs=0,this.invincible=!1,this.isGameOver=!1,this.placedBarriers=0,this.usedBombs=0,this.bittenBySpiders=0,this.catchedByCats=0,this.killedSpiders=0,this.stunnedCats=0,this.stunnedGolems=0,this.catchedByGolems=0,this.bonusCollected=0,this.hitByRemotePlayerBomb=0,this.hitByRemotePlayerMagic=0,this.isMultiplayerMatch=!1,this.collectedChests=0,this.isSlowed=!1,this.isHasted=!1,this.magicBolts=50,this.magicNebulas=50,this.magicProtections=50,this.magicFirespins=50}};class Ru extends Yc{constructor(t){super(0,Bl.viewport.height-40,{font:"ArialFancy",textAlign:"left",fillStyle:"white",size:1.5,text:t}),this.textWidth=this.measureText().width,this.scrollingText=t,this.scrollerpos=Bl.viewport.width,this.scrollertween=new Bc(this).to({scrollerpos:-this.textWidth},2e4).repeat(1/0).start()}onDestroyEvent(){this.scrollertween.stop()}repeatScrolling(){this.scrollerpos=Bl.viewport.width,this.scrollertween.to({scrollerpos:-this.textWidth},0).onComplete(this.repeatScrolling.bind(this)).start()}update(t){return this.pos.x=Math.round(this.scrollerpos),!0}}class Bu extends Ml{constructor(){super(),this.floating=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.backgroundImage=new Wd(Bl.viewport.width/2,Bl.viewport.height/2,{image:Vd.getImage("sensa_grass")}),this.backgroundImage.scale(Bl.viewport.width/this.backgroundImage.width,Bl.viewport.height/this.backgroundImage.height),this.backgroundImage.setOpacity(.3),this.catLeftImage=new Wd(5,Bl.viewport.height-300,{image:Vd.getImage("grumpy_cat_right"),anchorPoint:new Nn(0,0)}),this.catRightImage=new Wd(Bl.viewport.width-180,Bl.viewport.height-300,{image:Vd.getImage("grumpy_cat_left"),anchorPoint:new Nn(0,0)}),this.titleText=new Wd(86,0,{image:Vd.getImage("title"),anchorPoint:new Nn(0,0)}),this.titleText.pos.x=(Bl.viewport.width-this.titleText.width)/2,this.subTitleText=new Yc(126,170,{font:"12Outline",size:"1",fillStyle:"white",textAlign:"left",text:"A JavaScript / melonJS client. Written by Wanja Pernath",offScreenCanvas:!1}),this.subTitleText.pos.x=this.titleText.pos.x+40,this.subVersionText=new Yc(126,186,{font:"12Outline",size:"1",fillStyle:"white",textAlign:"left",text:"Server API: "+Iu.globalServerVersion.appName+"@"+Iu.globalServerVersion.appVersion+" at "+Eu.baseURL,offScreenCanvas:!1}),this.subVersionText.pos.x=this.titleText.pos.x+40,this.addChild(this.backgroundImage,0),this.addChild(this.catLeftImage,5),this.addChild(this.catRightImage,5),this.addChild(this.titleText,2),this.addChild(this.subTitleText,5),this.addChild(this.subVersionText,5),this.addChild(new Ru("QUARKUS GRUMPYCAT. A GAME WRITTEN BY WANJA PERNATH, INSPIRED BY FAT CAT AND PAC MAN. THIS GAME IS USING A QUARKUS BACKEND TO LOAD AND STORE DATA FROM/TO A SERVER................................"))}}class Du extends Ml{constructor(t,e){super(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bl.viewport.width,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bl.viewport.height),this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.hover=!1,this.holdTimeout=null,this.released=!0,this.floating=!0,this.isKinematic=!1}clicked(t){if(0===t.button&&this.isClickable)return this.dirty=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&Sc.clearTimeout(this.holdTimeout),this.holdTimeout=Sc.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick(t)}onClick(t){return!1}enter(t){return this.hover=!0,this.dirty=!0,this.onOver(t)}onOver(t){}leave(t){return this.hover=!1,this.dirty=!0,this.release(t),this.onOut(t)}onOut(t){}release(t){if(!1===this.released)return this.released=!0,this.dirty=!0,Sc.clearTimeout(this.holdTimeout),this.onRelease(t)}onRelease(){return!1}hold(){Sc.clearTimeout(this.holdTimeout),this.dirty=!0,this.released||this.onHold()}onHold(){}onActivateEvent(){cl.registerPointerEvent("pointerdown",this,this.clicked.bind(this)),cl.registerPointerEvent("pointerup",this,this.release.bind(this)),cl.registerPointerEvent("pointercancel",this,this.release.bind(this)),cl.registerPointerEvent("pointerenter",this,this.enter.bind(this)),cl.registerPointerEvent("pointerleave",this,this.leave.bind(this))}onDeactivateEvent(){cl.releasePointerEvent("pointerdown",this.hitbox),cl.releasePointerEvent("pointerup",this),cl.releasePointerEvent("pointercancel",this),cl.releasePointerEvent("pointerenter",this),cl.releasePointerEvent("pointerleave",this),Sc.clearTimeout(this.holdTimeout)}}class Nu extends Du{constructor(t,e,i){super(t,e),i.font=i.font||"24Outline",i.size=i.size||1,i.text=i.text||"<Click Me>",i.bindKey=i.bindKey||-1,i.backgroundColor=i.backgroundColor||"#00aa00",i.hoverColor=i.hoverColor||"#00ff00",i.borderStrokeColor=i.borderStrokeColor||"#000000",i.offScreenCanvas=i.offScreenCanvas||!1,i.fillStyle=i.fillStyle||"#ffffff",i.lineWidth=i.lineWidth||1,i.anchorPoint=i.anchorPoint||new Nn(0,0),i.extraHeight=i.extraHeight||18,i.extraWidth=i.extraWidth||16,this.onClickCallback=i.onClick||null;let s=new Yc(t,e,i);s.fillStyle=i.fillStyle;let n=s.measureText();i.borderWidth=i.borderWidth||n.width+i.extraWidth,i.borderHeight=i.borderHeight||n.height+i.extraHeight;let r=new Oa(t,e,i.borderWidth,i.borderHeight);super.setShape(t,e,r.getBounds().width,r.getBounds().height),this.font=s,this.dimensions=n,this.border=r,this.settings=i,this.font.pos.set(Math.round((r.width-n.width)/2)+this.font.pos.x,Math.round((r.height-n.height)/2)+this.font.pos.y)}draw(t,e){t.setGlobalAlpha(.5),this.hover?t.setColor(this.settings.hoverColor):t.setColor(this.settings.backgroundColor),t.fill(this.border),t.setGlobalAlpha(1),t.setColor(this.settings.borderStrokeColor),t.stroke(this.border),t.setTint(this.font.tint,this.font.getOpacity()),this.font.draw(t,this.settings.text,this.font.pos.x,this.font.pos.y),super.draw(t,e)}onClick(t){if(null!==this.onClickCallback)return this.onClickCallback(t),!1}}const Fu={REPLAY_GAME_CHOOSER:sd.USER+0,REPLAY_GAME:sd.USER+1,CHOOSE_LEVEL:sd.USER+2,SINGLE_PLAYER_MENU:sd.USER+3,MULTIPLAYER_MENU:sd.USER+10,MULTIPLAYER_START_GAME:sd.USER+11,MULTIPLAYER_JOIN_GAME:sd.USER+12,MULTIPLAYER_LOBBY:sd.USER+13,MULTIPLAYER_PLAY:sd.USER+14,MULTIPLAYER_GAME_OVER:sd.USER+15,HOW_TO_PLAY:sd.USER+16},Gu={REMOTE_PLAYER:Tl.types.USER<<0,REMOTE_PROJECTILE:Tl.types.USER<<1},Uu=["#ffffff","#ffff32","#32ffff","#ff3232"],ju=970;class zu extends Nu{constructor(t,e){super(t,e,{text:"Single Player",borderWidth:250})}onClick(t){sd.change(Fu.SINGLE_PLAYER_MENU)}}class Hu extends Nu{constructor(t,e){super(t,e,{text:"Multi Player",borderWidth:250})}onClick(t){sd.change(Fu.MULTIPLAYER_MENU)}}class Yu extends Nu{constructor(t,e){super(t,e,{text:"Highscores",borderWidth:250})}onClick(t){sd.change(sd.SCORE)}}class Vu extends Nu{constructor(t,e){super(t,e,{text:"How to play",borderWidth:250})}onClick(t){sd.change(Fu.HOW_TO_PLAY)}}class Wu extends Ml{constructor(){super(0,0),this.floating=!0,this.z=100,this.setOpacity(1),this.name="TitleMenu";let t=Math.round((Bl.viewport.width-250)/2);this.addChild(new zu(t,300)),this.addChild(new Hu(t,360)),this.addChild(new Yu(t,420)),this.addChild(new Vu(t,480))}}class Ku extends zl{onResetEvent(){console.log("Title.OnEnter()"),Iu.reset(),this.background=new Bu,this.menu=new Wu,Bl.world.addChild(this.background),Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,((t,e,i)=>{sd.isCurrent(sd.MENU)&&("pause"===t&&(sd.isPaused()?sd.resume():sd.pause()),"bomb"===t&&sd.change(sd.READY),"fullscreen"===t&&(Wo.isFullscreen?Wo.exitFullscreen():Wo.requestFullscreen()))}))}onDestroyEvent(){console.log("Title.OnExit()"),Bl.world.removeChild(this.background),Bl.world.removeChild(this.menu),Rr.off(Rr.KEYUP,this.handler)}}function qu(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Xu{constructor(t,e,i,s,n,r){qu(this,"playerId",void 0),qu(this,"gameId",void 0),qu(this,"name",void 0),qu(this,"type",void 0),qu(this,"hasChanged",!1),qu(this,"isStunned",!1),qu(this,"isDead",!1),qu(this,"hasChanged",!1),qu(this,"time",void 0),qu(this,"x",0),qu(this,"y",0),qu(this,"dx",0),qu(this,"dy",0),qu(this,"last",{dx:0,dy:0}),this.onResetEvent(t,e,i,s,n,r)}onResetEvent(t,e,i,s,n,r){this.playerId=Iu.globalServerGame.player.id,this.gameId=Iu.globalServerGame.id,this.name=t,this.type=e,this.x=i,this.y=s,this.dx=n,this.dy=r,this.time=performance.now()}}class Ju{constructor(t,e,i,s){qu(this,"playerId",void 0),qu(this,"gameId",void 0),qu(this,"x",0),qu(this,"y",0),qu(this,"dx",0),qu(this,"dy",0),qu(this,"bombPlaced",!1),qu(this,"gutterThrown",!1),qu(this,"gameOver",!1),qu(this,"gameWon",!1),qu(this,"isInvincible",!1),qu(this,"hasChanged",!1),qu(this,"score",void 0),qu(this,"time",void 0),qu(this,"enemies",[]),this.onResetEvent(t,e,i,s)}onResetEvent(t,e,i,s){this.x=t,this.y=e,this.dx=i,this.dy=s,this.playerId=Iu.globalServerGame.player.id,this.gameId=Iu.globalServerGame.id,this.score=Iu.score,this.time=performance.now()}addEnemyMovement(t){this.enemies.push(t)}}function Zu(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Qu=null;class $u{static getInstance(){return null==Qu&&(Qu=new $u),Qu}constructor(){Zu(this,"readHighscoreURL",null),Zu(this,"createGameURL",null),Zu(this,"writeScoreURL",null),Zu(this,"readPlayerMovementsURL",null),Zu(this,"fakeNameURL",null),Zu(this,"BUFFER_SIZE",50),Zu(this,"playerActions",[]);let t=Eu.baseURL;this.readHighscoreURL=t+"highscore/10",this.writeScoreURL=t+"highscore",this.createGameURL=t+"game",this.fakeNameURL=t+"faker",this.readPlayerMovementsURL=t+"state/player/",this.readEnemyMovementsURL=t+"state/enemy/",this.playerActions=[];let e=t.substring(t.indexOf("://")+3);console.log(e),this.playerSocket=new WebSocket("ws://"+e+"player-update"),this.enemySocket=new WebSocket("ws://"+e+"enemy-update"),this.enemySocket.addEventListener("close",(function(t){console.log("Trying to reconnect to 'player-update'")})),this.enemySocket.addEventListener("error",(function(t){console.log(t)})),this.playerSocket.addEventListener("close",(function(t){console.log("Trying to reconnect to 'player-update'")})),this.playerSocket.addEventListener("error",(function(t){console.log(t)}))}async readTop10Highscores(){return(await fetch(this.readHighscoreURL)).json()}async writeHighscore(){let t={playerId:Iu.globalServerGame.player.id,gameId:Iu.globalServerGame.id,score:Iu.score,placedBarriers:Iu.placedBarriers,usedBombs:Iu.usedBombs,bittenBySpiders:Iu.bittenBySpiders,catchedByCats:Iu.catchedByCats,catchedByGolems:Iu.catchedByGolems,killedSpiders:Iu.killedSpiders,stunnedCats:Iu.stunnedCats,stunnedGolems:Iu.stunnedGolems,bonusCollected:Iu.bonusCollected,level:ku.getInstance().getCurrentLevelIndex()+1,name:Iu.globalServerGame.player.name};fetch(this.writeScoreURL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async writePlayerAction(t){null!==t&&(t.gameId=Iu.globalServerGame.id,t.playerId=Iu.globalServerGame.player.id,t.time=performance.now(),this.playerSocket.send(JSON.stringify(t)))}async writeEnemyUpdate(t){null!==t&&(t.gameId=Iu.globalServerGame.id,t.playerId=Iu.globalServerGame.player.id,t.time=performance.now(),this.enemySocket.send(JSON.stringify(t)))}async readPlayerActionsFromServer(t){const e={gameId:t.id,playerId:t.player.id,playerMovements:[],enemies:[]};let i=await fetch(this.readPlayerMovementsURL+"/"+t.id+"/"+t.player.id,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}});return e.playerMovements=await i.json(),i=await fetch(this.readEnemyMovementsURL+"/"+t.id+"/"+t.player.id,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}),e.enemies=await i.json(),e}async createGameOnServer(){let t,e,i={id:null,name:t,level:"0",playerId:null,player:{id:null,name:t}};null===Iu.globalServerVersion&&(e=await fetch(this.fakeNameURL),t=await e.text(),console.log("name: "+t),e=await fetch(this.createGameURL+"/version"),Iu.globalServerVersion=await e.json()),null!==Iu.globalServerGame?(console.log("  Initializing a new Game"),i.playerId=Iu.globalServerGame.playerId,i.level=ku.getInstance().getCurrentLevelIndex()+1,i.name=ku.getInstance().getCurrentLevel().longName,i.player=Iu.globalServerGame.player):(i.name=t,i.player.name=t),i=JSON.stringify(i),console.log("  Sending: "+i),e=await fetch(this.createGameURL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:i}),Iu.globalServerGame=await e.json(),console.log("   Server API: "+JSON.stringify(Iu.globalServerVersion)),console.log("   New game  : "+JSON.stringify(Iu.globalServerGame))}async readLastGamesFromServer(){return(await fetch(this.createGameURL,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}})).json()}}function tp(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ep{constructor(t,e){this.dx=t,this.dy=e}}class ip{constructor(t,e,i){this.x=t,this.y=e,this.initialDir=i}}class sp{constructor(){this.elements={},this.head=0,this.tail=0}enqueue(t){this.elements[this.tail]=t,this.tail++}dequeue(){const t=this.elements[this.head];return delete this.elements[this.head],this.head++,t}peek(){return this.elements[this.head]}get length(){return this.tail-this.head}get isEmpty(){return 0===this.length}clear(){this.elements={},this.head=0,this.tail=0}}const np=[new ep(-1,0),new ep(0,-1),new ep(0,1),new ep(1,0)],rp=[new ep(-1,0),new ep(0,-1),new ep(0,1),new ep(1,0),new ep(-1,-1),new ep(1,1),new ep(1,-1),new ep(-1,1)],op="CAT",ap="SPIDER",hp="GOLEM";class lp extends Wd{constructor(t,e,i){i.width=i.width||32,i.height=i.height||32,i.image=i.image,i.framewidth=i.framewidth||32,i.frameheight=i.frameheight||32,i.anchorPoint=i.anchorPoint||new Nn(.5,.5),super(32*t,32*e,i),tp(this,"borderLayer",void 0),tp(this,"discoveredPlaces",[]),tp(this,"nextPositionFound",!1),tp(this,"player",void 0),tp(this,"mapWidth",void 0),tp(this,"mapHeight",void 0),tp(this,"isDead",!1),tp(this,"isStunned",!1),tp(this,"enemyType",op),tp(this,"enemyCanWalkDiagonally",!0),tp(this,"enemyName",""),tp(this,"nextPosition",new Xu(this.name,this.enemyType)),tp(this,"mapX",0),tp(this,"mapY",0),this.settings=i,this.mapX=t,this.mapY=e;let s=Md.getCurrentLevel().getLayers();this.mapWidth=Md.getCurrentLevel().cols,this.mapHeight=Md.getCurrentLevel().rows,s.forEach((t=>{"Frame"===t.name&&(this.borderLayer=t)})),this.discoveredPlaces=new Array(this.mapHeight);for(let t=0;t<this.mapHeight;t++){this.discoveredPlaces[t]=new Array(this.mapWidth);for(let e=0;e<this.mapWidth;e++)this.discoveredPlaces[t][e]=!1}this.alwaysUpdate=!0,this.body=new Al(this),this.body.addShape(new Ma(0,0,this.width,this.height)),this.body.ignoreGravity=!0,this.body.collisionType=Tl.types.ENEMY_OBJECT,this.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Tl.types.PROJECTILE_OBJECT)}setEnemyName(t){this.name=t,this.nextPosition.name=t,this.enemyName=t}updatePosition(t){}update(t){this.updatePosition(t),super.update(t)}calculateNextPosition(){let t=0,e=0;if(this.player.hasPlacedNebula)t=this.player.spell.mapX,e=this.player.spell.mapY;else{let i=this.transformPosition(this.player.pos.x,this.player.pos.y);t=i.x,e=i.y}return this.calculateNextPositionToTarget(t,e)}calculateNextPositionToTarget(t,e){let i=t,s=e,n=this.transformPosition(this.pos.x,this.pos.y),r=n.x,o=n.y,a=rp,h=new sp,l=this.discoveredPlaces;this.nextPosition.hasChanged=!0,this.nextPositionFound=!1,a=this.enemyCanWalkDiagonally?rp:np;for(let t=0;t<this.mapHeight;t++)for(let e=0;e<this.mapWidth;e++)l[t][e]=!1;for(l[o][r]=!0,h.enqueue(new ip(r,o,null));!h.isEmpty;){let t=h.dequeue();for(let e=0;e<a.length;e++){let n=a[e],d=t.x+n.dx,c=t.y+n.dy,u=null==t.initialDir?n:t.initialDir;if(d==i&&c==s){r+=u.dx,o+=u.dy,h.clear(),this.nextPosition.last.dx=this.nextPosition.dx,this.nextPosition.last.dy=this.nextPosition.dy,this.nextPositionFound=!0,this.nextPosition.x=r,this.nextPosition.y=o,this.nextPosition.dx=u.dx,this.nextPosition.dy=u.dy;break}this.isWalkable(d,c)&&!l[c][d]&&(l[c][d]=!0,h.enqueue(new ip(d,c,u)))}}this.nextPositionFound}sendEnemyMovement(){this.storeEnemyMovements&&$u.getInstance().writeEnemyUpdate(this.nextPosition).catch((t=>console.err("Error writing enemy action: "+t)))}setPlayer(t){this.player=t}isWalkable(t,e){return!(t<0||t>=this.mapWidth||e<0||e>=this.mapHeight)&&null===this.borderLayer.cellAt(t,e)}transformPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pos.x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pos.y;return{x:Math.floor(t/32),y:Math.floor(e/32)}}getEnemyAction(){return this.nextPosition}}function dp(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const cp=class extends lp{constructor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(t,e,{width:32,height:32,image:"cat_left",storeEnemyMovements:i}),dp(this,"VELOCITY",.08),dp(this,"posUpdatedCount",0),this.enemyType=op,this.storeEnemyMovements=i}updatePosition(t){if(!this.isStunned&&(this.nextPositionFound||(this.posUpdatedCount=0,this.calculateNextPosition(),this.nextPositionFound&&this.sendEnemyMovement()),this.nextPositionFound)){let e=t*this.VELOCITY;this.pos.x+=this.nextPosition.dx*e,this.pos.y+=this.nextPosition.dy*e,this.nextPosition.dx<0?this.flipX(!1):this.nextPosition.dx>0&&this.flipX(!0),this.posUpdatedCount+=t,e=this.posUpdatedCount*this.VELOCITY,e>=32&&(this.nextPositionFound=!1,this.posUpdatedCount=0)}return!0}onCollision(t,e){return e.body.collisionType===Tl.types.PROJECTILE_OBJECT&&e.isExploding&&!this.isStunned&&(this.isStunned=!0,this.nextPosition.isStunned=!0,Iu.score+=Iu.scoreForStunningCat,Iu.stunnedCats++,this.flicker(Iu.enemyStunnedTime,(()=>{this.isStunned=!1,this.nextPosition.isStunned=!1}))),!1}};function up(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class pp extends lp{constructor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(t,e,{width:64,height:64,framewidth:64,frameheight:64,image:"spider-red",storeEnemyMovements:i}),up(this,"posUpdatedCount",0),up(this,"VELOCITY",.1),this.enemyType=ap,this.storeEnemyMovements=i,this.addAnimation("stand-up",[0]),this.addAnimation("walk-up",[4,5,6,7,8,9],32),this.addAnimation("attack-up",[0,1,2,3],32),this.addAnimation("stand-left",[10]),this.addAnimation("walk-left",[14,15,16,17,18,19],32),this.addAnimation("attack-left",[10,11,12,13],32),this.addAnimation("stand-down",[20]),this.addAnimation("walk-down",[24,25,26,27,28,29],32),this.addAnimation("attack-down",[20,21,22,23],32),this.addAnimation("stand-right",[30]),this.addAnimation("walk-right",[34,35,36,37,38,39],32),this.addAnimation("attack-right",[30,31,32,33],32),this.addAnimation("die",[40,41,42,43],100),this.addAnimation("dead",[43]),this.setCurrentAnimation("stand-left"),this.enemyCanWalkDiagonally=!1}updatePosition(t){if(!this.isStunned&&!this.isDead)if(this.nextPositionFound||(this.posUpdatedCount=0,this.calculateNextPosition(),this.nextPositionFound&&this.sendEnemyMovement()),this.nextPositionFound){let e=t*this.VELOCITY;this.pos.x+=this.nextPosition.dx*e,this.pos.y+=this.nextPosition.dy*e,this.nextPosition.last.dx==this.nextPosition.dx&&this.nextPosition.last.dy==this.nextPosition.dy||(this.nextPosition.dx<0?this.setCurrentAnimation("walk-left","walk-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("walk-right","walk-right"),this.nextPosition.dy<0?this.setCurrentAnimation("walk-up","walk-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("walk-down","walk-down")),this.posUpdatedCount+=t,e=this.posUpdatedCount*this.VELOCITY,e>=32&&(this.nextPositionFound=!1,this.posUpdatedCount=0)}else this.nextPosition.dx<0?this.setCurrentAnimation("stand-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("stand-right"),this.nextPosition.dy<0?this.setCurrentAnimation("stand-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("stand-down");return!0}onCollision(t,e){return e.body.collisionType===Tl.types.PROJECTILE_OBJECT?!e.isExploding||this.isStunned||this.isDead||(this.isStunned=!0,this.nextPosition.isStunned=!0,this.nextPosition.isDead=!0,this.setCurrentAnimation("die",(()=>{this.isDead=!0,Iu.killedSpiders++,Iu.score+=Iu.scoreForKillingSpider,this.setCurrentAnimation("dead")}))):e.body.collisionType!==Tl.types.PLAYER_OBJECT||this.isDead||this.isStunned||Iu.invincible||(this.nextPosition.dx<0?this.setCurrentAnimation("attack-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("attack-right"),this.nextPosition.dy<0?this.setCurrentAnimation("attack-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("attack-down")),!1}}const fp=pp;function gp(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class mp extends lp{constructor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(t,e,{width:64,height:64,framewidth:64,frameheight:64,image:"golem-walk"}),gp(this,"posUpdatedCount",0),gp(this,"VELOCITY",.08),this.enemyType=hp,this.storeEnemyMovements=i,this.addAnimation("stand-up",[0]),this.addAnimation("walk-up",[0,1,2,3,4,5,6],48),this.addAnimation("stand-left",[7]),this.addAnimation("walk-left",[7,8,9,10,11,12,13],48),this.addAnimation("stand-down",[14]),this.addAnimation("walk-down",[14,15,16,17,18,19,20],48),this.addAnimation("stand-right",[21]),this.addAnimation("walk-right",[21,22,23,24,25,26,27],48),this.setCurrentAnimation("stand-left"),this.enemyCanWalkDiagonally=!1,this.wayPath=null}setWayPath(t){this.wayPath=t}calculateNextPosition(){let t=this.transformPosition(),e=this.wayPath.getCurrentWayPoint();t.x===e.x&&t.y===e.y&&(e=this.wayPath.getNextWayPoint()),this.calculateNextPositionToTarget(e.x,e.y)}updatePosition(t){if(!this.isStunned)if(this.nextPositionFound||(this.posUpdatedCount=0,this.calculateNextPosition(),this.nextPositionFound&&this.sendEnemyMovement()),this.nextPositionFound){let e=t*this.VELOCITY;this.pos.x+=this.nextPosition.dx*e,this.pos.y+=this.nextPosition.dy*e,this.nextPosition.last.dx==this.nextPosition.dx&&this.nextPosition.last.dy==this.nextPosition.dy||(this.nextPosition.dx<0?this.setCurrentAnimation("walk-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("walk-right"),this.nextPosition.dy<0?this.setCurrentAnimation("walk-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("walk-down")),this.posUpdatedCount+=t,e=this.posUpdatedCount*this.VELOCITY,e>=32&&(this.nextPositionFound=!1,this.posUpdatedCount=0)}else this.nextPosition.dx<0?this.setCurrentAnimation("stand-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("stand-right"),this.nextPosition.dy<0?this.setCurrentAnimation("stand-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("stand-down");return!0}onCollision(t,e){if(e.body.collisionType===Tl.types.PROJECTILE_OBJECT||e.body.collisionType===Gu.REMOTE_BOMB){if(e.isExploding){this.isStunned=!0,this.nextPosition.dx<0?this.setCurrentAnimation("stand-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("stand-right"),this.nextPosition.dy<0?this.setCurrentAnimation("stand-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("stand-down");let t=e.body.collisionType===Tl.types.PROJECTILE_OBJECT;this.flicker(Iu.enemyStunnedTime,(()=>{this.isStunned=!1,t&&(Iu.stunnedGolems++,Iu.score+=Iu.scoreForStunningGolem,this.nextPosition.dx<0?this.setCurrentAnimation("walk-left"):this.nextPosition.dx>0&&this.setCurrentAnimation("walk-right"),this.nextPosition.dy<0?this.setCurrentAnimation("walk-up"):this.nextPosition.dy>0&&this.setCurrentAnimation("walk-down"))}))}}else e.body.collisionType===Tl.types.PLAYER_OBJECT&&!this.isDead&&!this.isStunned&&Iu.invincible;return!1}}class yp extends Wd{constructor(t,e,i){super(t,e,i),this.body=new Al(this),this.body.addShape(new Ma(0,0,i.width,i.height)),this.body.ignoreGravity=!0,this.body.isStatic=!0,this.body.collisionType=Tl.types.PROJECTILE_OBJECT,this.body.setCollisionMask(Tl.types.ENEMY_OBJECT|Gu.REMOTE_PLAYER),this.alwaysUpdate=!0,this.thrownByPlayer=null,this.owner=i.owner||null,this.borderLayer=null,this.isExploding=!1,this.mapWidth=Md.getCurrentLevel().cols,this.mapHeight=Md.getCurrentLevel().rows,Md.getCurrentLevel().getLayers().forEach((t=>{"Frame"===t.name&&(this.borderLayer=t)}))}isWalkable(t,e){return!(t<0||t>=this.mapWidth||e<0||e>=this.mapHeight)&&null===this.borderLayer.cellAt(t,e)}onCollision(t,e){return!1}}const vp=class extends yp{constructor(t,e){super(t,e,{width:32,height:64,image:"BombExploding",framewidth:32,frameheight:64}),this.addAnimation("bzzz",[0,1,2,3,4,5,6]),this.addAnimation("boom",[7,8,9,10,11,12,13]),this.setCurrentAnimation("bzzz",(()=>{Bl.viewport.shake(50,400),this.isExploding=!0,this.setCurrentAnimation("boom",(()=>(this.isExploding=!1,Bl.world.removeChild(this),[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}].forEach((t=>{let e=Math.floor((this.pos.x+32*t.x)/32),i=Math.floor((this.pos.y+32*t.y)/32);this.borderLayer.clearTile(e,i)})),!1)))}))}},xp=class extends yp{constructor(t,e){super(t,e,{width:96,height:96,image:"explosion",framewidth:256,frameheight:256}),this.addAnimation("boom",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],16),this.isExploding=!0,this.setCurrentAnimation("boom",(()=>{Bl.world.removeChild(this),[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}].forEach((t=>{let e=Math.floor((this.pos.x+32*t.x)/32),i=Math.floor((this.pos.y+32*t.y)/32);if(e>-1&&e<this.borderLayer.width&&i>-1&&i<this.borderLayer.height){let t=this.borderLayer.cellAt(e,i);null!=t&&184===t.tileId&&this.borderLayer.clearTile(e,i)}}))})),Bl.viewport.shake(50,992)}};function bp(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class wp extends yp{constructor(t,e,i,s,n){super(32*e+16,32*i+16,{width:100,height:100,image:"magic-bolt",framewidth:100,frameheight:100,anchorPoint:new Nn(.5,.5)}),bp(this,"VELOCITY",.5),bp(this,"isStopped",!0),this.owner=t,this.dx=s,this.dy=n,this.addAnimation("start",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],6),this.addAnimation("bruzzel",[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],6),this.addAnimation("boom",[54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80],2),this.setCurrentAnimation("start",(()=>{this.isStopped=!1,this.isExploding=!0,this.setCurrentAnimation("bruzzel")})),0!==n&&this.rotate(1.5708)}update(t){if(!this.isStopped&&!Iu.isGameOver){this.pos.x+=this.dx*(t*this.VELOCITY),this.pos.y+=this.dy*(t*this.VELOCITY);let e=Math.floor(this.pos.x/32),i=Math.floor(this.pos.y/32);this.isWalkable(e,i)||(this.isStopped=!0,this.setCurrentAnimation("boom",(()=>{Bl.world.removeChild(this),this.owner.spell=null,Bl.world.addChild(new xp(this.pos.x,this.pos.y))})))}return super.update(t)}onCollision(t,e){e.body.collisionType!==Tl.types.ENEMY_OBJECT&&e.body.collisionType!==Tl.types.PLAYER_OBJECT||(this.isStopped=!0,this.pos.x=e.pos.x,this.pos.y=e.pos.y,this.setCurrentAnimation("boom",(()=>{Bl.world.removeChild(this),this.owner.spell=null,Bl.world.addChild(new xp(this.pos.x,this.pos.y))})))}}function _p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Ep extends yp{constructor(t,e,i){super(32*e+16,32*i+16,{width:100,height:100,image:"magic-firespin",framewidth:100,frameheight:100,anchorPoint:new Nn(.5,.5)}),_p(this,"VELOCITY",.5),_p(this,"isStopped",!1),this.owner=t,this.body.addShape(new Ma(28,32,34,30)),this.alwaysUpdate=!0,this.addAnimation("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61],24),this.setCurrentAnimation("spin"),this.timerId=Sc.setTimeout((()=>{this.isStopped=!0,Bl.world.removeChild(this),this.owner.spell=null}),Iu.magicDurationTime,!0),this.isExploding=!0,this.currentStep=0,this.maxSteps=45,this.radius=48,this.maxHits=5}update(t){if(!this.isStopped&&!Iu.isGameOver){let t=this.radius*Math.cos(2*Math.PI*this.currentStep/this.maxSteps),e=this.radius*Math.sin(2*Math.PI*this.currentStep/this.maxSteps);this.pos.x=this.owner.pos.x+t,this.pos.y=this.owner.pos.y+e,this.currentStep++,this.currentStep>=this.maxSteps&&(this.currentStep=0)}return super.update(t)}onCollision(t,e){e.body.collisionType!==Tl.types.ENEMY_OBJECT||e.isStunned||e.isDead||(this.maxHits--,this.maxHits<=0&&(this.isStopped=!0,Bl.world.removeChild(this),this.owner.spell=null))}destroy(){void 0!==this.timerId&&0!==this.timerId&&Sc.clearTimeout(this.timerId),super.destroy()}}function Cp(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Tp extends yp{constructor(t,e,i){super(32*e+16,32*i+16,{width:100,height:100,image:"protection-circle",framewidth:100,frameheight:100,anchorPoint:new Nn(.5,.5)}),Cp(this,"VELOCITY",.5),Cp(this,"isStopped",!1),this.owner=t,this.body.addShape(new Ma(28,32,34,30)),this.alwaysUpdate=!0,this.addAnimation("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61],24),this.setCurrentAnimation("spin"),Iu.invincible=!0,this.timerId=Sc.setTimeout((()=>{this.isStopped=!0,Bl.world.removeChild(this),this.owner.spell=null,Iu.invincible=!1}),Iu.magicDurationTime,!0),this.currentStep=0,this.maxSteps=45,this.radius=48,this.maxHits=5,this.scale(2,2)}update(t){if(!this.isStopped){let t=0,e=0;this.pos.x=this.owner.pos.x+t,this.pos.y=this.owner.pos.y+e,this.currentStep++,this.currentStep>=this.maxSteps&&(this.currentStep=0)}return super.update(t)}onCollision(t,e){e.body.collisionType!==Tl.types.ENEMY_OBJECT||e.isStunned||e.isDead||(this.maxHits--,this.maxHits<=0&&(this.isStopped=!0,Bl.world.removeChild(this),this.owner.spell=null))}destroy(){void 0!==this.timerId&&0!==this.timerId&&Sc.clearTimeout(this.timerId),super.destroy()}}function Ap(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Sp extends yp{constructor(t,e,i){super(32*e+16,32*i+16,{width:100,height:100,image:"magic-vortex",framewidth:100,frameheight:100,anchorPoint:new Nn(.5,.5)}),Ap(this,"isExploding",!0),Ap(this,"mapX",void 0),Ap(this,"mapY",void 0),this.mapX=e,this.mapY=i,this.owner=t,this.body.addShape(new Ma(28,32,34,30)),this.alwaysUpdate=!0,this.isExploding=!0,this.addAnimation("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61],24),this.maxHits=5,this.owner.hasPlacedNebula=!0,this.setCurrentAnimation("spin"),this.timerId=Sc.setTimeout((()=>{this.isStopped=!0,Bl.world.removeChild(this),this.owner.spell=null,this.owner.hasPlacedNebula=!1}),Iu.magicDurationTime,!0)}onCollision(t,e){e.body.collisionType!==Tl.types.ENEMY_OBJECT||e.isStunned||e.isDead||(this.maxHits--,this.maxHits<=0&&(Bl.world.removeChild(this),this.owner.spell=null,this.owner.hasPlacedNebula=!1))}destroy(){void 0!==this.timerId&&0!==this.timerId&&Sc.clearTimeout(this.timerId),super.destroy()}}function Pp(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Mp extends Wd{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(super(32*t+16,32*e+16,{width:32,height:32,framewidth:32,frameheight:32,image:"player"}),Pp(this,"VELOCITY",.3),Pp(this,"borderLayer",void 0),Pp(this,"bonusLayer",void 0),Pp(this,"groundLayer",void 0),Pp(this,"xInMap",void 0),Pp(this,"yInMap",void 0),Pp(this,"mapWidth",void 0),Pp(this,"mapHeight",void 0),Pp(this,"collectedBonusTiles",0),Pp(this,"numberOfBonusTiles",0),Pp(this,"oldDx",0),Pp(this,"oldDy",0),Pp(this,"lastMapX",0),Pp(this,"lastMapY",0),Pp(this,"justImage",!1),Pp(this,"hasPlacedNebula",!1),this.justImage=i,this.xInMap=t,this.yInMap=e,this.lastMapX=t,this.lastMapY=e,this.spell=null,!this.justImage){this.body=new Al(this),this.body.ignoreGravity=!0,this.body.addShape(new Ma(0,0,this.width,this.height)),this.body.collisionType=Tl.types.PLAYER_OBJECT,this.body.setCollisionMask(Tl.types.ENEMY_OBJECT|Tl.types.COLLECTABLE_OBJECT),this.alwaysUpdate=!0,this.mapHeight=Md.getCurrentLevel().rows,this.mapWidth=Md.getCurrentLevel().cols,Md.getCurrentLevel().getLayers().forEach((t=>{"Bonus"===t.name?this.bonusLayer=t:"Frame"===t.name?this.borderLayer=t:"Ground"===t.name&&(this.groundLayer=t)}));for(let t=0;t<this.mapWidth;t++)for(let e=0;e<this.mapHeight;e++)null!==this.bonusLayer.cellAt(t,e)&&this.numberOfBonusTiles++}}isWalkable(t,e){let i=Math.floor(t/32),s=Math.floor(e/32);if(i<0||s<0||i>this.mapWidth||s>this.mapHeight)return!1;let n=this.borderLayer.cellAt(i,s);return null===n||null==n}updateWalkable(t,e,i){let s=this.pos;return this.isWalkable(s.x+e,s.y+i)?(this.pos.x+=e,this.pos.y+=i,t.dx=e,t.dy=i,!0):this.isWalkable(s.x+e,s.y)?(this.pos.x+=e,t.dx=e,t.dy=0,!0):!!this.isWalkable(s.x,s.y+i)&&(this.pos.y+=i,t.dx=0,t.dy=i,!0)}_collectBonusTile(t,e){let i=Math.floor(t/32),s=Math.floor(e/32),n=this.bonusLayer.cellAt(i,s);return null!==n&&null!=n?(this.bonusLayer.clearTile(i,s),n.tileId):0}checkBonusTile(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=this._collectBonusTile(this.pos.x,this.pos.y,i);return 0!==s&&(this.collectedBonusTiles++,i&&(Iu.bonusCollected++,961===s?(Iu.bombs+=Iu.bombsForBombBonus,Iu.score+=Iu.scoreForBombs):962===s?(Iu.score+=Iu.scoreForStars,Iu.maxEnergy+=Iu.maxEnergyForStar):963===s?Iu.score+=Iu.scoreForPills:966===s?(Iu.score+=Iu.scoreForMeat,Iu.energy<Iu.maxEnergy&&(Iu.energy+=Iu.energyForMeat,Iu.energy>Iu.maxEnergy&&(Iu.energy=Iu.maxEnergy))):967===s?(Iu.score+=Iu.scoreForCheese,Iu.energy<Iu.maxEnergy&&(Iu.energy+=Iu.energyForCheese,Iu.energy>Iu.maxEnergy&&(Iu.energy=Iu.maxEnergy))):974===s?(Iu.score+=Iu.scoreForPotion,Iu.magicBolts+=Iu.magicForPotion):975===s?(Iu.score+=Iu.scoreForPotion,Iu.magicFirespins+=Iu.magicForPotion):977===s?(Iu.score+=Iu.scoreForPotion,Iu.magicNebulas+=Iu.magicForPotion):976===s&&(Iu.score+=Iu.scoreForPotion,Iu.magicProtections+=Iu.magicForPotion))),s}throwMagicSpell(t,e,i,s){return null===this.spell&&null==this.borderLayer.cellAt(t,e)&&(this.spell=new wp(this,t,e,i,s),Bl.world.addChild(this.spell),!0)}throwMagicFireSpin(t,e){return null===this.spell&&(this.spell=new Ep(this,t,e),Bl.world.addChild(this.spell),!0)}throwMagicProtectionCircle(t,e){if(null!==this.spell)return!1;this.spell=new Tp(this,t,e),Bl.world.addChild(this.spell)}throwMagicNebula(t,e){if(null!==this.spell)return!1;this.spell=new Sp(this,t,e),Bl.world.addChild(this.spell)}placeBorderTile(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==this.borderLayer.cellAt(t,e)){let s=184,n=this.groundLayer.cellAt(t,e);null!==n&&n.tileId;let r=this.borderLayer.getTileById(s,t,e);return this.borderLayer.setTile(r,t,e),i&&Iu.placedBarriers++,!0}return!1}onCollision(t,e){return e.body.collisionType!==Tl.types.COLLECTABLE_OBJECT||e.isCollected?(Iu.invincible||e.body.collisionType!==Tl.types.ENEMY_OBJECT||e.isStunned||e.isDead||Iu.isGameOver||(e.enemyType===op?(Iu.catchedByCats++,Iu.energy-=Iu.energyLostByCat):e.enemyType===ap?(Iu.bittenBySpiders++,Iu.energy-=Iu.energyLostBySpider):e.enemyType===hp&&(Iu.catchedByGolems++,Iu.energy-=Iu.energyLostByGolem),Iu.invincible=!0,this.flicker(Iu.playerInvincibleTime,(()=>{Iu.invincible=!1}))),!1):(console.log("other.type: "+e.type),console.log("other.isCollected: "+e.isCollected),e.isCollected=!0,e.type===ju&&(console.log("  Collected Chest: "+e.score+", "+e.numBombs+", "+e.numMagicBolts+", "+e.numMagicFirespins+", "+e.numMagicProtectionCircles),Iu.score+=e.score,Iu.bombs+=e.numBombs,Iu.magicBolts+=e.numMagicBolts,Iu.magicFirespins+=e.numMagicFirespins,Iu.magicNebulas+=e.numMagicNebulas,Iu.magicProtections+=e.numMagicProtectionCircles,Iu.collectedChests+=1,console.log("  New score: "+Iu.score)),!1)}}const Op=class extends Mp{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var s;super(t,e,i),(s="levelOver")in this?Object.defineProperty(this,s,{value:false,enumerable:!0,configurable:!0,writable:!0}):this[s]=false,i||Bl.viewport.follow(this.pos,Bl.viewport.AXIS.BOTH,.1)}update(t){if(this.justImage)return!0;let e=Math.floor(this.pos.x/32),i=Math.floor(this.pos.y/32),s=0,n=0,r=new Ju;if(this.levelOver)return super.update(t);if(r.x=e,r.y=i,cl.isKeyPressed("barrier")){if(cl.isKeyPressed("left")?s=-1:cl.isKeyPressed("right")&&(s=1),cl.isKeyPressed("up")?n=-1:cl.isKeyPressed("down")&&(n=1),this.oldDx=s,this.oldDy=n,0!=s||0!=n){let t=e+s,o=i+n;this.placeBorderTile(t,o)&&(r.dx=s,r.dy=n,r.gutterThrown=!0,r.hasChanged=!0,$u.getInstance().writePlayerAction(r))}}else if(cl.isKeyPressed("magic")){if(cl.isKeyPressed("left")?s=-1:cl.isKeyPressed("right")&&(s=1),cl.isKeyPressed("up")?n=-1:cl.isKeyPressed("down")&&(n=1),this.oldDx=s,this.oldDy=n,0!=s||0!=n){let t=e+s,r=i+n;null==this.spell&&Iu.magicBolts>0&&(this.throwMagicSpell(t,r,s,n),Iu.magicBolts--,console.log("MAGIC!!!!!"))}}else{if(cl.isKeyPressed("bomb")&&Iu.bombs>0)return Bl.world.addChild(new vp(this.pos.x,this.pos.y)),Iu.usedBombs++,Iu.bombs--,r.bombPlaced=!0,r.dx=s,r.dy=n,r.hasChanged=!0,$u.getInstance().writePlayerAction(r),super.update(t);cl.isKeyPressed("damage")&&Iu.magicFirespins>0&&(this.throwMagicFireSpin(e,i),Iu.magicFirespins--),cl.isKeyPressed("magic-barrier")&&Iu.magicProtections>0&&(this.throwMagicProtectionCircle(e,i),Iu.magicProtections--),cl.isKeyPressed("magic-nebula")&&Iu.magicNebulas>0&&(this.throwMagicNebula(e,i),Iu.magicNebulas--),cl.isKeyPressed("left")?(this.flipX(!0),s=-t*this.VELOCITY,this.oldDx>=0&&(this.oldDx=s)):cl.isKeyPressed("right")&&(this.flipX(!1),s=t*this.VELOCITY,this.oldDx<=0&&(this.oldDx=s)),cl.isKeyPressed("up")?(n=-t*this.VELOCITY,this.oldDy>=0&&(this.oldDy=n)):cl.isKeyPressed("down")&&(n=t*this.VELOCITY,this.oldDy<=0&&(this.oldDy=n)),0==s&&0==n||!this.updateWalkable(r,s,n)||(this.checkBonusTile(this.pos.x,this.pos.y),this.collectedBonusTiles>=this.numberOfBonusTiles&&(r.gameWon=!0,this.levelOver=!0,$u.getInstance().writePlayerAction(r),ku.getInstance().hasNext()?(ku.getInstance().next(),sd.change(sd.READY)):sd.change(sd.GAME_END)),e=Math.floor(this.pos.x/32),i=Math.floor(this.pos.y/32),(e!=this.lastMapX||i!=this.lastMapY||r.gameWon||r.gameOver)&&(r.x=e,r.y=i,this.lastMapX=e,this.lastMapY=i,r.hasChanged=!0,$u.getInstance().writePlayerAction(r)))}return Iu.energy<=0&&(console.log("GAME OVER!"),Iu.isGameOver=!0,this.levelOver=!0,sd.change(sd.GAMEOVER),r.gameOver=!0,r.hasChanged=!0,$u.getInstance().writePlayerAction(r)),super.update(t)}};class Lp extends Wd{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(s||(t=32*t+16,e=32*e+16),super(t,e,{width:32,height:32,image:"terrain",framewidth:32,frameheight:32,anchorPoint:new Nn(.5,.5)}),this.animFrame=i,s)this.anchorPoint.set(0,0);else{this.body=new Al(this),this.body.addShape(new Ma(0,0,this.width,this.height)),this.body.ignoreGravity=!0,this.body.collisionType=Tl.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Gu.REMOTE_PLAYER),this.body.setStatic(!0);let t=Md.getCurrentLevel().getLayers();this.mapWidth=Md.getCurrentLevel().cols,this.mapHeight=Md.getCurrentLevel().rows,t.forEach((t=>{"Frame"===t.name&&(this.borderLayer=t)}))}this.addAnimation("start",i,60),this.setCurrentAnimation("start"),this.type=i[0]+1,this.isCollected=!1}update(t){return super.update(t)}onCollision(t,e){return!this.isCollected&&(e.body.collisionType===Tl.types.PLAYER_OBJECT?(Bl.world.removeChild(this),this.isCollected=!0,!1):void 0)}}class kp{constructor(t,e,i){this.fn=t,this.context=e,this.event=i}}class Ip{constructor(){this._events={}}on(t,e,i){this._events[t]||(this._events[t]=[]),this._events[t].push(new kp(e,i,t))}off(t,e){this._events[t]&&(this._events[t]=this._events[t].filter((t=>t.fn!==e)))}allOff(t){this._events[t]&&(this._events[t]=[])}emit(t,e){if(!this._events[t])return!1;this._events[t].forEach((t=>{t.fn.call(t.context,e)}))}reset(){this._events={}}}let Rp=null;const Bp="PLAYER_JOINED",Dp="PLAYER_REMOVED",Np="CLOSE_GAME",Fp="GAME_UPDATE",Gp="GAME_STARTED",Up="GAME_OVER",jp="BROADCAST_CHAT",zp="ERROR",Hp="PLAYER_GAVE_UP",Yp="PLAYER_PAUSED_GAME";class Vp{static gameUpdate(){let t=new Vp(Fp);return t.playerId=Rp.multiplayerPlayer.id,t.gameId=Rp.multiplayerGame.id,t}static gameStarted(){let t=new Vp(Gp);return t.gameId=Rp.multiplayerGame.id,t.playerId=Rp.multiplayerPlayer.id,t}static gameOver(){let t=new Vp(Up);return t.gameId=Rp.multiplayerGame.id,t.playerId=Rp.multiplayerPlayer.id,t}static giveUp(){let t=new Vp(Hp);return t.gameId=Rp.multiplayerGame.id,t.playerId=Rp.multiplayerPlayer.id,t.message=Rp.multiplayerPlayer.name+" gave up!",t}static pauseGame(t){let e=new Vp(Yp);return e.gameId=Rp.multiplayerGame.id,e.playerId=Rp.multiplayerPlayer.id,e.message=Rp.multiplayerPlayer.name+" PAUSED Game",e.isPaused=t,e}constructor(t){this.type=t,this.message=null,this.playerId=null,this.gameId=null,this.x=0,this.y=0,this.dx=0,this.dy=0,this.bombPlaced=!1,this.gutterThrown=!1,this.magicBolt=!1,this.magicNebula=!1,this.magicProtectionCircle=!1,this.magicFirespin=!1,this.chestCollected=!1,this.injuredByEnemy=!1,this.enemyType=null,this.hurtByBomb=!1,this.hurtByNebula=!1,this.hurtByBolt=!1,this.hurtByFirespin=!1,this.remotePlayerIdWhoHurtMe=null,this.score=0,this.energy=0,this.levelOver=!1,this.hasChanged=!1,this.isPaused=!1}}class Wp{static get(){return null==Rp&&(Rp=new Wp),Rp}constructor(){let t=Eu.baseURL;this.networkManager=$u.getInstance(),this.levelManager=ku.getInstance(),this.createPlayerURL=t+"mp-game/player",this.updatePlayerURL=t+"mp-game/player/",this.createGameURL=t+"mp-game/new",this.joinGameURL=t+"mp-game/join/",this.listGamesURL=t+"mp-game/open",this.closeGameURL=t+"mp-game/close/",this.getGameURL=t+"mp-game/",this.startGameURL=t+"mp-game/start/",this.finishGameURL=t+"mp-game/finish/",this.multiplayerSocket=null,this.socketBaseURL=t.substring(t.indexOf("://")+3),this.multiplayerGame=null,this.multiplayerPlayer=null,this.multiplayerLevels=this.levelManager.allMultiplayerLevels(),this.weAreHost=!1,this.multiplayerGameToJoin=null,this.selectedLevelForGame=null,this.selectedLevelIndex=0,this.eventEmitter=new Ip}async createPlayerFromMe(){if(null===this.multiplayerPlayer||null===this.multiplayerPlayer.id){let t=await fetch(this.createPlayerURL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(Iu.globalServerGame.player)});this.multiplayerPlayer=await t.json()}return this.multiplayerPlayer}async closeActiveGame(){null!==this.multiplayerSocket&&3!==this.multiplayerSocket.readyState&&(this.multiplayerSocket.close(),this.multiplayerSocket=null),this.eventEmitter.reset(),null!==this.multiplayerGame&&(this.weAreHost=!1,console.log("CLOSING: "),console.log("  Game  : "+this.multiplayerGame.id),console.log("  Player: "+this.multiplayerPlayer.id),await fetch(this.closeGameURL+this.multiplayerGame.id+"/"+this.multiplayerPlayer.id,{method:"PUT",mode:"cors"}),this.multiplayerGame=null),this.weAreHost=!1,this.multiplayerGameToJoin=null,this.selectedLevelForGame=null,this.selectedLevelIndex=0}async createGame(){null!==this.multiplayerGame&&await this.closeActiveGame(),null===this.multiplayerPlayer&&await this.createPlayerFromMe();const t={game:{level:this.selectedLevelIndex},host:this.multiplayerPlayer};let e=await fetch(this.createGameURL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return this.multiplayerGame=await e.json(),console.log("  Created new MultiplayerGame: "+this.multiplayerGame.id),this._createMultiplayerSocket(),this.weAreHost=!0,this.multiplayerGame}async finishGame(t){if(null!==this.multiplayerGame){console.log("Finishing MP game "+this.multiplayerGame.id);let e=await fetch(this.finishGameURL+this.multiplayerGame.id,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return this.multiplayerGame=await e.json(),this.multiplayerGame}return null}async sendAction(t){this.multiplayerSocket.send(JSON.stringify(t))}async sendGameStarted(){let t=Vp.gameStarted();this.sendAction(t)}async sendGameOver(){let t=Vp.gameOver();this.sendAction(t)}async sendPlayerGiveUp(){let t=Vp.giveUp();this.sendAction(t)}async sendPlayerPaused(t){let e=Vp.pauseGame(t);this.sendAction(e)}async startGame(){this.weAreHost&&(await fetch(this.startGameURL+this.multiplayerGame.id,{method:"PUT",mode:"cors"}),this.sendGameStarted())}async joinGame(){if(null!==this.multiplayerGame&&await this.closeActiveGame(),null===this.multiplayerPlayer&&await this.createPlayerFromMe(),null!==this.multiplayerGameToJoin){console.log("  Joining multi player game: "+this.multiplayerGameToJoin.id),null!==this.multiplayerSocket&&(this.multiplayerSocket.close(),this.multiplayerSocket=null);let t=await fetch(this.joinGameURL+this.multiplayerGameToJoin.id+"/"+this.multiplayerPlayer.id,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"}});this.multiplayerGame=await t.json(),this._createMultiplayerSocket(),this.weAreHost=!1,this.multiplayerGameToJoin=null}}_createMultiplayerSocket(){null!==this.multiplayerSocket&&(this.multiplayerSocket.close(),this.multiplayerSocket=null),this.multiplayerSocket=new WebSocket("ws://"+this.socketBaseURL+"multiplayer/"+this.multiplayerGame.id+"/"+this.multiplayerPlayer.id),this.multiplayerSocket.addEventListener("error",(t=>{console.log("  Socket error: "+t),this.eventEmitter.emit(zp,t)})),this.multiplayerSocket.addEventListener("message",(t=>{const e=JSON.parse(t.data);switch(e.type){case Bp:console.log("  Player "+e.playerId+" joined the game:  "+e.message),fetch(this.getGameURL+e.gameId).then((t=>t.json())).then((t=>{this.multiplayerGame=t,this.eventEmitter.emit(e.type,{message:e,game:t})}));break;case Hp:case Dp:console.log("  Player "+e.playerId+" removed from game: "+e.message),fetch(this.getGameURL+e.gameId).then((t=>t.json())).then((t=>{this.multiplayerGame=t,this.eventEmitter.emit(e.type,{message:e,game:t})}));break;case Np:console.log("  Game is going to be closed now: "+e.message),this.closeActiveGame().then((()=>{this.eventEmitter.emit(e.type,{message:e})}));break;case Gp:console.log("  Game will be started now: "+e.message),fetch(this.getGameURL+e.gameId).then((t=>t.json())).then((t=>{this.multiplayerGame=t,this.eventEmitter.emit(e.type,{message:e,game:t})}));break;default:this.eventEmitter.emit(e.type,{message:e})}}))}async refreshGameData(){if(null!==this.multiplayerGame){let t=await fetch(this.getGameURL+this.multiplayerGame.id);this.multiplayerGame=await t.json()}return this.multiplayerGame}async listOpenGames(){return(await fetch(this.listGamesURL)).json()}async updatePlayerData(){let t=await fetch(this.updatePlayerURL+this.multiplayerPlayer.id,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.multiplayerPlayer)});return this.multiplayerPlayer=await t.json(),this.multiplayerPlayer}addEventListener(t,e,i){if("string"==typeof t)this.eventEmitter.on(t,e,i);else if(t instanceof Array)for(let s=0;s<t.length;s++)this.eventEmitter.on(t[s],e,i);return e}removeEventListener(t,e){if(null===e)this.removeAllEventListeners(t);else if("string"==typeof t)this.eventEmitter.off(t,e);else if(t instanceof Array)for(let i=0;i<t.length;i++)this.eventEmitter.off(t[i],e)}removeAllEventListeners(t){if("string"==typeof t)this.eventEmitter.allOff(t);else if(t instanceof Array)for(let e=0;e<t.length;e++)this.eventEmitter.allOff(t[e])}clearAllEventListeners(){this.eventEmitter.reset()}addOnMessageCallback(t,e){null!==t?this.eventEmitter.on(Fp,t,e):this.eventEmitter.allOff(Fp)}setOnJoinCallback(t,e){t?this.eventEmitter.on(Bp,t,e):this.eventEmitter.allOff(Bp)}setOnLeaveCallback(t,e){t?this.eventEmitter.on(Dp,t,e):this.eventEmitter.allOff(Dp)}setOnErrorCallback(t){t?this.eventEmitter.on(zp,t):this.eventEmitter.allOff(zp)}setOnGameCloseCallback(t,e){t?this.eventEmitter.on(Np,t,e):this.eventEmitter.allOff(Np)}setOnBroadcastCallback(t){t?this.eventEmitter.on(jp,t):this.eventEmitter.allOff(jp)}setOnGameStartedCallback(t,e){t?this.eventEmitter.on(Gp,t,e):this.eventEmitter.allOff(Gp)}setOnGameOverCallback(t,e){t?this.eventEmitter.on(Up,t,e):this.eventEmitter.allOff(Up)}useSelectedLevel(t){this.selectedLevelIndex=t,this.selectedLevelForGame=this.levelManager.allMultiplayerLevels()[t]}allLevels(){return this.multiplayerLevels}setGameToJoin(t){this.multiplayerGameToJoin=t}getMultiplayerPlayerNumber(){let t=0;if(null!==this.multiplayerGame){let e=this.multiplayerGame,i=this.multiplayerPlayer.id;null!==e.player2&&i===e.player2.id?t=1:null!==e.player3&&i===e.player3.id?t=2:null!==e.player4&&i===e.player4.id&&(t=3)}return t}getPlayersFromGame(){let t=[],e=this.multiplayerGame;return null!==e&&(t[0]=void 0!==e.player1?e.player1:null,t[1]=void 0!==e.player2?e.player2:null,t[2]=void 0!==e.player3?e.player3:null,t[3]=void 0!==e.player4?e.player4:null),t}}class Kp extends Ml{constructor(t,e){super(t,e,240,34),this.text=new Yc(0,0,{font:"Shadow",textBaseline:"top",text:"99999999"}),this.isPersistent=!0,this.z=100,this.score=-1,this.scoretext="",Rr.on(Rr.CANVAS_ONRESIZE,function(t,e){this.pos.set(t,e,0)}.bind(this)),this.dogLeft=new Op(0,0,!0),this.dogRight=new Op(7,0,!0),this.dogLeft.tint.copy(Uu[Wp.get().getMultiplayerPlayerNumber()]),this.dogRight.tint.copy(Uu[Wp.get().getMultiplayerPlayerNumber()]),this.dogRight.flipX(!0),this.addChild(this.dogLeft),this.addChild(this.dogRight),this.addChild(this.text),this.text.pos.x=(this.width-this.text.measureText().width)/2}update(t){return this.isDirty=!1,super.update(t),this.score!=Iu.score&&(this.score=Iu.score,this.isDirty=!0,this.scoretext=this.score.toString().padStart(8,"0"),this.text.setText(this.scoretext)),this.isDirty}}class qp extends Ml{constructor(t,e){super(t,e,200,32),this.energyText=new Yc(0,0,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"Energy:"}),this.energyPercent=new Yc(0,0,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"100%"}),this.energy=0,this.maxEnergy=0,this.energyBarWidth=180,this.energyBarMaxFillWidth=this.energyBarWidth-10,this.energyBarHeight=17,this.energyBarBoxColor=new Wn(10,10,10),this.energyBarBoxBorder=new Oa(4,23,this.energyBarWidth,this.energyBarHeight),this.energyBarBoxBackFill=new Wn(50,50,50),this.energyBarFillBox=new Ma(10,24,this.energyBarMaxFillWidth,this.energyBarHeight-4),this.energyBarFillColor=new Wn(0,255,0),this.threeQuadEnergyColor=new Wn(100,255,0),this.lowEnergyColor=new Wn(255,255,0),this.criticalEnergyColor=new Wn(255,0,0)}update(t){return this.isDirty=!1,super.update(t),this.energy==Iu.energy&&this.maxEnergy==Iu.maxEnergy||(this.energy=Iu.energy,this.maxEnergy=Iu.maxEnergy,this.isDirty=!0),this.isDirty}draw(t,e){t.setGlobalAlpha(.5),t.setColor(this.energyBarBoxBackFill),t.fill(this.energyBarBoxBorder),t.setGlobalAlpha(1),t.setColor(this.energyBarBoxColor),t.stroke(this.energyBarBoxBorder);let i=this.energy/this.maxEnergy,s=this.energyBarFillColor;s=i<=.3?this.criticalEnergyColor:i>.3&&i<.51?this.lowEnergyColor:i>.5&&i<=.75?this.threeQuadEnergyColor:this.energyBarFillColor,t.setColor(s),this.energyBarFillBox.width=Math.round(this.energyBarMaxFillWidth*i),t.fill(this.energyBarFillBox),t.setTint(this.energyPercent.tint,this.energyPercent.getOpacity()),this.energyPercent.draw(t,Math.round(100*i)+" %",90,25),t.setTint(this.energyText.tint,this.energyText.getOpacity()),this.energyText.draw(t,"Energy:",6,8),super.draw(t,e)}}class Xp extends Ml{constructor(t,e,i,s){super(t,e,i,s),this.bombsText=new Yc(8,28,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"99"}),this.boltText=new Yc(40,28,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"99"}),this.fireText=new Yc(72,28,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"99"}),this.nebuText=new Yc(104,28,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"99"}),this.protText=new Yc(136,28,{font:"12Outline",textAlign:"left",textBaseline:"top",text:"99"}),this.bombs=-1,this.magicBolts=-1,this.magicFirespins=-1,this.magicNebulas=-1,this.magicProtections=-1,this.bombImg=new Lp(2,2,[978],!0),this.boltImg=new Lp(34,2,[973],!0),this.fireImg=new Lp(66,2,[974],!0),this.nebuImg=new Lp(98,2,[976],!0),this.protImg=new Lp(130,2,[975],!0),this.addChild(this.bombImg),this.addChild(this.boltImg),this.addChild(this.fireImg),this.addChild(this.nebuImg),this.addChild(this.protImg),this.addChild(this.bombsText),this.addChild(this.boltText),this.addChild(this.fireText),this.addChild(this.nebuText),this.addChild(this.protText)}update(t){return this.isDirty=!1,super.update(t),this.bombs!=Iu.bombs&&(this.bombs=Iu.bombs,this.bombsText.setText(this.bombs.toString().padStart(2,"0")),this.isDirty=!0),this.magicBolts!=Iu.magicBolts&&(this.magicBolts=Iu.magicBolts,this.boltText.setText(this.magicBolts.toString().padStart(2,"0")),this.isDirty=!0),this.magicFirespins!=Iu.magicFirespins&&(this.magicFirespins=Iu.magicFirespins,this.fireText.setText(this.magicFirespins.toString().padStart(2,"0")),this.isDirty=!0),this.magicNebulas!=Iu.magicNebulas&&(this.magicNebulas=Iu.magicNebulas,this.nebuText.setText(this.magicNebulas.toString().padStart(2,"0")),this.isDirty=!0),this.magicProtections!=Iu.magicProtections&&(this.magicProtections=Iu.magicProtections,this.protText.setText(this.magicProtections.toString().padStart(2,"0")),this.isDirty=!0),this.isDirty}}class Jp extends Ml{constructor(t,e,i,s){super(t,e,i,s),this.clipping=!0,this.floating=!1,this.textBox=new Yc(this.pos.x+4,0,{font:"24Outline",textBaseline:"top",text:""}),this.addChild(this.textBox),this.gradient=null;let n=[zp,Fp,Hp];Wp.get().addEventListener(n,(async t=>{let e,i=t.message,s=Wp.get().getPlayersFromGame(),n=null,r=0;if(i.type===zp)this.textBox.setText("INTERNAL ERROR: "+i.message);else if(i.playerId!==Wp.get().multiplayerPlayer.id){for(let t=0;t<s.length;t++)if(null!==s[t]&&s[t].id===i.playerId){r=t,n=s[t],e=Uu[r];break}if(null===n)return!1;if(this.textBox.tint=e,null!==i.message)console.log("message: "+i.message),this.textBox.setText(i.message);else if(i.type===Fp)if(i.bombPlaced)this.textBox.setText(n.name+" has placed a bomb!");else if(i.chestCollected)this.textBox.setText(n.name+" has found a chest!");else if(i.magicBolt)this.textBox.setText(n.name+" has fired a magic bolt!");else if(i.magicNebula)this.textBox.setText(n.name+" has placed a magic nebula!");else if(i.magicFirespin)this.textBox.setText(n.name+" has casted a magic firespin!");else if(i.magicProtectionCircle)this.textBox.setText(n.name+" has casted a magic protection circle!");else if(i.injuredByEnemy){let t="Oh nooo... "+n.name+" has been ";switch(i.enemyType){case op:t+="catched by a cat!";break;case ap:t+="bitten by a spider!";break;case hp:t+="in touch with a golem!"}this.textBox.setText(t)}}}),this)}}class Zp extends Ml{constructor(t){super(0,0,Bl.viewport.width,Iu.isMultiplayerMatch?62:48),this.backColor=new Wn(50,50,50),this.boxColor=new Wn(10,10,10),this.backBox=new Ma(this.pos.x+1,this.pos.y,Bl.viewport.width-2,this.height),this.isPersistent=!0,this.clipping=!0,this.floating=!0,this.updateWhenPaused=!0,this.z=100,this.setOpacity(1),this.name="HUD",this.pauseText=new Yc(5,(Bl.viewport.height-40)/2,{font:"Shadow",textAlign:"left",text:"*** P A U S E ***"}),this.pauseText.updateWhenPaused=!0,this.addChild(new Kp((Bl.viewport.width-240)/2,this.pos.y+1)),this.addChild(new qp(5,this.pos.y+1)),this.addChild(new Xp(Bl.viewport.width-170,this.pos.y+1,168,34)),Iu.isMultiplayerMatch&&this.addChild(new Jp(0,42,Bl.viewport.width,30)),this.addChild(this.pauseText),this.pauseText.setText("")}draw(t,e){t.setGlobalAlpha(.5),t.setColor(this.backColor),t.fill(this.backBox),t.setGlobalAlpha(1),t.setColor(this.boxColor),super.draw(t,e)}setPaused(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t){this.pauseText.setText(e);let t=this.pauseText.measureText(e).width;this.pauseText.pos.x=(Bl.viewport.width-t)/2,this.isDirty=!0}else this.pauseText.setText(""),this.isDirty=!0}}class Qp extends Qc{constructor(t,e){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark38"}),this.setOpacity(.5),this.anchorPoint.set(0,0)}onClick(t){return this.setOpacity(.25),cl.triggerKeyEvent(cl.KEY.SPACE,!0),!1}onRelease(t){return this.setOpacity(.5),cl.triggerKeyEvent(cl.KEY.SPACE,!1),!1}}class $p extends Qc{constructor(t,e){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark30"}),this.setOpacity(.5),this.anchorPoint.set(0,0)}onClick(t){return this.setOpacity(.25),cl.triggerKeyEvent(cl.KEY.F,!0),cl.triggerKeyEvent(cl.KEY.F,!1),!1}onRelease(t){return this.setOpacity(.5),cl.triggerKeyEvent(cl.KEY.F,!1),!1}}class tf extends Qc{constructor(t,e){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark14"}),this.setOpacity(.5),this.anchorPoint.set(0,0),this.isPaused=!1}onClick(t){return this.setOpacity(.25),this.isPaused?(this.isPaused=!1,this.tint.setColor(255,255,255)):(this.isPaused=!0,this.tint.setColor(50,50,0)),cl.triggerKeyEvent(cl.KEY.P,!0),!1}onRelease(t){return this.setOpacity(.5),cl.triggerKeyEvent(cl.KEY.P,!1),!1}}class ef extends Qc{constructor(t,e){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark35"}),this.setOpacity(.5),this.anchorPoint.set(0,0)}onClick(t){return this.setOpacity(.25),cl.triggerKeyEvent(cl.KEY.ESC,!0),!1}onRelease(t){return this.setOpacity(.5),cl.triggerKeyEvent(cl.KEY.ESC,!1),!1}}class sf extends Qc{constructor(t,e){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark36"}),this.setOpacity(.5),this.anchorPoint.set(0,0)}onClick(t){return this.setOpacity(.25),cl.triggerKeyEvent(cl.KEY.SHIFT,!0),!1}onRelease(t){return this.setOpacity(.5),cl.triggerKeyEvent(cl.KEY.SHIFT,!1),!1}}class nf extends Qc{constructor(t,e){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark07",anchorPoint:new Nn(0,0)}),this.pad=new Wd(t,e,{image:Iu.screenControlsTexture,region:"shadedDark01",anchorPoint:new Nn(0,0)}),this.relative=new Nn(this.width/2-this.pad.width/2,this.height/2-this.pad.height/2),this.joypad_offset=new Nn,this.setOpacity(.5),this.cursors={up:!1,down:!1,left:!1,right:!1},cl.registerPointerEvent("pointermove",this,this.pointerMove.bind(this))}onDestroyEvent(){cl.releasePointerEvent("pointermove",this)}pointerMove(t){if(!1===this.released){let e=Math.round(t.gameScreenX+t.width/2),i=Math.round(t.gameScreenY+t.height/2);this.getBounds().contains(e,i)?!0!==this.cursors.left&&!0!==this.cursors.right&&!0!==this.cursors.up&&!0!==this.cursors.down||this.checkDirection.call(this,e,i):this.onRelease.call(this,t)}}checkDirection(t,e){t=Math.round(t),e=Math.round(e);let i=t-this.pos.x,s=e-this.pos.y,n=this.width/2,r=this.height/2,o=i-n,a=s-r,h=Math.abs(o)>20,l=Math.abs(a)>20;l&&a<0&&(!1===this.cursors.up&&(cl.triggerKeyEvent(cl.KEY.UP,!0),this.cursors.up=!0,this.joypad_offset.y=-(r-s)%this.pad.height/4),!0===this.cursors.down&&(cl.triggerKeyEvent(cl.KEY.DOWN,!1),this.cursors.down=!1)),l&&a>0&&(!1===this.cursors.down&&(cl.triggerKeyEvent(cl.KEY.DOWN,!0),this.cursors.down=!0,this.joypad_offset.y=+(s-r)%this.pad.height/4),!0===this.cursors.up&&(cl.triggerKeyEvent(cl.KEY.UP,!1),this.cursors.up=!1)),h&&o<0&&(!1===this.cursors.left&&(cl.triggerKeyEvent(cl.KEY.LEFT,!0),this.cursors.left=!0,this.joypad_offset.x=-(n-i)%this.pad.width/4),!0===this.cursors.right&&(cl.triggerKeyEvent(cl.KEY.RIGHT,!1),this.cursors.right=!1)),h&&o>0&&(!1===this.cursors.right&&(cl.triggerKeyEvent(cl.KEY.RIGHT,!0),this.cursors.right=!0,this.joypad_offset.x=+(i-n)%this.pad.width/4),!0===this.cursors.left&&(cl.triggerKeyEvent(cl.KEY.LEFT,!1),this.cursors.left=!1))}onClick(t){let e=t.gameScreenX+t.width/2,i=t.gameScreenY+t.height/2;return this.setOpacity(.25),this.checkDirection.call(this,e,i),!1}onRelease(t){return this.setOpacity(.5),!0===this.cursors.left&&(cl.triggerKeyEvent(cl.KEY.LEFT,!1),this.cursors.left=!1),!0===this.cursors.right&&(cl.triggerKeyEvent(cl.KEY.RIGHT,!1),this.cursors.right=!1),!0===this.cursors.up&&(cl.triggerKeyEvent(cl.KEY.UP,!1),this.cursors.up=!1),!0===this.cursors.down&&(cl.triggerKeyEvent(cl.KEY.DOWN,!1),this.cursors.down=!1),this.joypad_offset.set(0,0),!1}draw(t){super.draw(t),this.pad.pos.setV(this.pos).add(this.relative).add(this.joypad_offset),this.pad.draw(t)}}const rf=class extends Ml{constructor(){super(),this.isPersistent=!0,this.floating=!0,this.z=1/0,this.name="VirtualJoypad";let t=Iu.isMultiplayerMatch?64:50;this.pauseButton=new tf(20,t),this.exitButton=new ef(Bl.viewport.width-48-20,t),Wo.isMobile&&(this.actionButton=new Qp(Bl.viewport.width-200,Bl.viewport.height-150),this.otherButton=new sf(Bl.viewport.width-120,Bl.viewport.height-200),this.joypad=new nf(50,Bl.viewport.height-200),this.addChild(this.joypad),this.addChild(this.actionButton),this.addChild(this.otherButton)),Wo.isMobile||(this.fullScreenButton=new $p(90,t),this.addChild(this.fullScreenButton)),this.addChild(this.pauseButton),this.addChild(this.exitButton);let e=this;Rr.on(Rr.VIEWPORT_ONRESIZE,(function(i,s){Wo.isMobile&&(e.actionButton.pos.set(i-200,s-150,e.button.pos.z),e.otherButton.pos.set(i-120,s-200,e.button.pos.z)),e.exitButton.pos.set(i-48-20,t,e.button.pos.z)}))}};class of extends Wd{constructor(t,e){super(32*t+16,32*e+16,{width:48,height:48,image:"open-chest",framewidth:48,frameheight:48,anchorPoint:new Nn(.5,.5)}),this.body=new Al(this),this.body.addShape(new Ma(8,8,32,32)),this.body.ignoreGravity=!0,this.body.collisionType=Tl.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Gu.REMOTE_PLAYER),this.body.setMaxVelocity(0,0),this.body.setFriction(0,0),this.addAnimation("closed",[0,1,2,1],100),this.addAnimation("opening",[0,1,2,3,4,5,6,7],24),this.addAnimation("opened",[7]);let i=Md.getCurrentLevel().getLayers();this.mapWidth=Md.getCurrentLevel().cols,this.mapHeight=Md.getCurrentLevel().rows,i.forEach((t=>{"Frame"===t.name&&(this.borderLayer=t)})),this.setCurrentAnimation("closed"),this.type=ju,this.isCollected=!1,this.isOpening=!1,this.mapX=t,this.mapY=e,this.score=Iu.scoreForChest,this.numBombs=0,this.numMagicProtectionCircle=0,this.numMagicBolts=0,this.numMagicNebula=0,this.numMagicFirespin=0}onCollision(t,e){return this.isOpening||(this.isOpening=!0,this.setCurrentAnimation("opening",(()=>{this.isCollected=!0,this.setCurrentAnimation("opened")}))),!1}}function af(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class hf extends zl{constructor(){super(...arguments),af(this,"player",void 0),af(this,"enemies",[]),af(this,"hudContainer",null),af(this,"virtualJoypad",null),af(this,"isActive",!1),af(this,"spriteLayer",6),af(this,"currentLevel",null),af(this,"enemyEmitter",{isActive:!1,emitAt:{x:0,y:0},emitEvery:5e3,emitTime:5e3,emitCount:10})}updateasdfadf(t){if(!this.isActive)return super.update(t);if(this.enemyEmitter.isActive&&this.enemyEmitter.emitEvery<=0&&this.enemyEmitter.emitCount>0){this.enemyEmitter.emitCount--,this.enemyEmitter.emitEvery=this.enemyEmitter.emitTime;let t=new pp(this.enemyEmitter.emitAt.x,this.enemyEmitter.emitAt.y);t.setEnemyName("SpiderEnemy."+(this.enemyEmitter.emitCount+1)),this.enemies.push(t),Bl.world.addChild(t,this.spriteLayer),t.setPlayer(this.player)}return this.enemyEmitter.emitEvery-=t,super.update(t)}setupLevel(){ku.getInstance().prepareCurrentLevel(),this.currentLevel=ku.getInstance().getCurrentLevel();let t=Md.getCurrentLevel().getLayers(),e=0;t.forEach((t=>{if(console.log(t.name),"Bonus"===t.name)for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){let n=t.cellAt(s,i);null!=n&&(n.tileId===ju?(console.log("  Chest at ("+s+"/"+i+")"),t.clearTile(s,i),Bl.world.addChild(new of(s,i),e)):n.tileId)}else if("Persons"===t.name){let i=0;this.spriteLayer=e;for(let e=0;e<t.height;e++)for(let s=0;s<t.width;s++){let n=t.cellAt(s,e);if(null!=n)if(993===n.tileId)this.player=new Op(s,e),this.player.name="Player",console.log("  player at ("+s+"/"+e+"): "+this.player),Bl.world.addChild(this.player,this.spriteLayer);else if(994===n.tileId){let t=new cp(s,e),n="CatEnemy."+i++;t.setEnemyName(n),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+s+"/"+e+"): "+t)}else if(995===n.tileId)this.enemyEmitter.isActive=!0,this.enemyEmitter.emitAt.x=s,this.enemyEmitter.emitAt.y=e,this.enemyEmitter.emitCount=t.enemyNumEmitting,this.enemyEmitter.emitEvery=t.enemyTimeEmitting,console.log("  enemyEmitter at ("+s+"/"+e+"): ");else if(996===n.tileId){let t=new mp(s,e),n="Golem."+(i+1);i++,t.setEnemyName(n),t.setWayPath(this.currentLevel.getPathForEnemy(n)),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+s+"/"+e+"): "+t)}}}e++})),this.parseLevelObjects(),this.enemies.forEach((t=>t.setPlayer(this.player)))}parseLevelObjects(){null!==this.currentLevel.objects&&void 0!==this.currentLevel.objects&&this.currentLevel.objects.forEach((t=>{if(t.type==Su.types.ENEMY){if("GolemEnemy"===t.clazz){let e=new mp(t.mapX,t.mapY,!1);e.setEnemyName(t.name);let i=this.currentLevel.getPathForEnemy("Path."+t.pathId);console.log("    Golem requires path "+t.pathId+": "+i),null!==i&&(e.setWayPath(i),Bl.world.addChild(e,this.spriteLayer),this.enemies.push(e),console.log("  enemy at ("+t.mapX+"/"+t.mapY+"): "+e.name))}}else if(t.type===Su.types.ENEMY_EMITTER){console.log("  Placing an enemy emitter at "+t.mapX+", "+t.mapY);let e=new EnemyEmitter(t.mapX,t.mapY,t,this.player);Bl.world.addChild(e,this.spriteLayer)}else if(t.type===Su.types.CHEST){let e=new of(t.mapX,t.mapY);e.score=t.score,e.numBombs=t.numBombs,e.numMagicBolts=t.numMagicBolts,e.numMagicFirespins=t.numMagicFirespins,e.numMagicNebulas=t.numMagicNebulas,e.numMagicProtectionCircles=t.numMagicProtectionCircles,Bl.world.addChild(e,this.spriteLayer-1)}}))}}const lf=class extends hf{onResetEvent(){this.isActive=!1,this.exiting=!1,this.player=null,this.enemies=[],this.enemyEmitter.isActive=!1,this.setupLevel(),this.hudContainer=new Zp(0,0),this.virtualJoypad=new rf,Bl.world.addChild(this.hudContainer),Bl.world.addChild(this.virtualJoypad,1/0),this.handler=Rr.on(Rr.KEYUP,(t=>{sd.isCurrent(sd.PLAY)&&("pause"===t&&(sd.isPaused()?(sd.resume(),this.hudContainer.setPaused(!1)):(this.hudContainer.setPaused(!0,"*** P A U S E ***"),sd.pause())),"exit"===t&&(this.exiting||sd.isPaused()||(sd.change(sd.GAMEOVER),this.exiting=!0)),"fullscreen"===t&&(console.log("requesting full screen"),Wo.isFullscreen?Wo.exitFullscreen():Wo.requestFullscreen()))})),this.isActive=!0}onDestroyEvent(){console.log("Play.OnExit()"),Bl.world.removeChild(this.hudContainer),Bl.world.removeChild(this.virtualJoypad),Rr.off(Rr.KEYUP,this.handler),this.isActive=!1}update(t){if(!this.isActive)return super.update(t);if(this.enemyEmitter.isActive&&this.enemyEmitter.emitEvery<=0&&this.enemyEmitter.emitCount>0){this.enemyEmitter.emitCount--,this.enemyEmitter.emitEvery=this.enemyEmitter.emitTime;let t=new pp(this.enemyEmitter.emitAt.x,this.enemyEmitter.emitAt.y);t.setEnemyName("SpiderEnemy."+(this.enemyEmitter.emitCount+1)),this.enemies.push(t),Bl.world.addChild(t,this.spriteLayer),t.setPlayer(this.player)}return this.enemyEmitter.emitEvery-=t,super.update(t)}setupLevel(){ku.getInstance().prepareCurrentLevel(),this.currentLevel=ku.getInstance().getCurrentLevel();let t=Md.getCurrentLevel().getLayers(),e=0;t.forEach((t=>{if(console.log(t.name),"Bonus"===t.name)for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){let n=t.cellAt(s,i);if(null!=n&&n.tileId===ju){console.log("  Chest at ("+s+"/"+i+")"),t.clearTile(s,i);let n=new of(s,i);n.score=Iu.scoreForChest,n.numBombs=0,n.numMagicBolts=0,n.numMagicFirespins=0,n.numMagicNebulas=0,n.numMagicProtectionCircles=0,Bl.world.addChild(n,e)}}else if("Persons"===t.name){let i=0;this.spriteLayer=e;for(let e=0;e<t.height;e++)for(let s=0;s<t.width;s++){let n=t.cellAt(s,e);if(null!=n)if(993===n.tileId)this.player=new Op(s,e),this.player.name="Player",console.log("  player at ("+s+"/"+e+"): "+this.player),Bl.world.addChild(this.player,this.spriteLayer);else if(994===n.tileId){let t=new cp(s,e),n="CatEnemy."+i++;t.setEnemyName(n),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+s+"/"+e+"): "+t)}else if(995===n.tileId)this.enemyEmitter.isActive=!0,this.enemyEmitter.emitAt.x=s,this.enemyEmitter.emitAt.y=e,this.enemyEmitter.emitCount=t.enemyNumEmitting,this.enemyEmitter.emitEvery=t.enemyTimeEmitting,console.log("  enemyEmitter at ("+s+"/"+e+"): ");else if(996===n.tileId){let t=new mp(s,e),n="Golem."+(i+1);i++,t.setEnemyName(n),t.setWayPath(this.currentLevel.getPathForEnemy(n)),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+s+"/"+e+"): "+t)}}}e++})),this.parseLevelObjects(),this.enemies.forEach((t=>t.setPlayer(this.player)))}};class df extends Ml{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(0,0,Bl.viewport.width,Bl.viewport.height),this.floating=!0,this.z=0,this.setOpacity(1),this.name="Background",this.transparent=!0,this.backgroundImage=new Wd(Bl.viewport.width/2,Bl.viewport.height/2,{image:Vd.getImage("sensa_grass")}),this.backgroundImage.scale(Bl.viewport.width/this.backgroundImage.width,Bl.viewport.height/this.backgroundImage.height),this.backgroundImage.setOpacity(.3),i&&(this.catLeftImage=new Wd(5,Bl.viewport.height-300,{image:Vd.getImage("grumpy_cat_right"),anchorPoint:new Nn(0,0)})),e&&(this.catRightImage=new Wd(Bl.viewport.width-180,Bl.viewport.height-300,{image:Vd.getImage("grumpy_cat_left"),anchorPoint:new Nn(0,0)})),this.titleImage=new Wd(86,0,{image:Vd.getImage("title"),anchorPoint:new Nn(0,0)}),this.titleImage.pos.x=(Bl.viewport.width-this.titleImage.width)/2,this.subTitleText=new Yc(126,170,{font:"Shadow",fillStyle:"white",textAlign:"left",text:t}),this.subTitleText.pos.x=this.titleImage.pos.x+40,s&&this.addChild(new Yc(this.titleImage.pos.x+this.titleImage.width-20,170,{font:"24Outline",textAlign:"right",text:Wp.get().multiplayerPlayer.name}),5),this.addChild(this.backgroundImage,0),i&&this.addChild(this.catLeftImage,5),e&&this.addChild(this.catRightImage,5),this.addChild(this.titleImage,2),this.addChild(this.subTitleText,5)}}class cf extends Ml{constructor(t,e,i,s,n){super(t,e,i,s),this.options=n,this.options.titleFont=n.titleFont||"24Outline",this.options.titlePos=n.titlePos||"center",this.options.titleText=n.titleText||"Header",this.options.titleColor=n.titleColor||"#ffa000",this.options.backgroundColor=n.backgroundColor||"#008800",this.options.backgroundBorderColor=n.backgroundBorderColor||"#000000",this.options.backgroundAlpha=n.backgroundAlpha||.3,this.options.dividerColor=n.dividerColor||"#008800",this.clipping=!0,this.floating=!1,this.enableChildBoundsUpdate=!0,this.header=new Yc(4,6,{font:this.options.titleFont,fillStyle:this.options.titleColor,textAlign:"left",text:this.options.titleText});let r=this.header.measureText();switch(this.border=new Oa(t,e,i,s),this.divider=new Ma(t+5,e+r.height+16,i-10,2),this.addChild(this.header),this.options.titlePos){case"left":this.header.pos.x=6;break;case"center":this.header.pos.x=(i-r.width)/2;break;case"right":this.header.pos.x=i-r.width-6;break;default:console.error("Wrong titlePos option. Must be left, right, center")}this.contentContainer=new Ma(6,this.divider.pos.y+14-e,i-12,s-(r.height+16+10))}draw(t,e){t.setGlobalAlpha(this.options.backgroundAlpha),t.setColor(this.options.backgroundColor),t.fill(this.border),t.setGlobalAlpha(1),t.setColor(this.options.backgroundBorderColor),t.stroke(this.divider),t.stroke(this.border),t.setColor(this.options.dividerColor),t.fill(this.divider),super.draw(t,e)}}class uf extends cf{constructor(t,e,i,s){super(t,e,i,s,{titleText:ku.getInstance().getCurrentLevel().longName,titleColor:"#ffa000"}),this.levelDescr=new Yc(this.contentContainer.pos.x,this.contentContainer.pos.y,{font:"18Outline",lineHeight:1.5,fillStyle:"white",textAlign:"left",wordWrapWidth:this.contentContainer.width,text:ku.getInstance().getCurrentLevel().description}),this.addChild(this.levelDescr)}}class pf extends Ml{constructor(){super(),this.floating=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.addChild(new df("GET READY"));let t=(Bl.viewport.width-644)/2,e=Bl.viewport.height-350;this.addChild(new uf(t,e,644,300))}}class ff extends zl{onResetEvent(){console.log("GetReady.OnEnter()"),this.back=new pf,Bl.world.addChild(this.back),this.emitter=new su(Bl.viewport.width/2,Bl.viewport.height/2-30,{image:Vd.getImage("player"),width:32,height:32,totalParticles:30,gravity:.03,angle:0,angleVariation:6.283185307179586,speed:3}),Bl.world.addChild(this.emitter),this.emitter.streamParticles(),cl.bindKey(cl.KEY.ENTER,"enter",!0),cl.bindPointer(cl.pointer.LEFT,cl.KEY.ENTER),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(sd.READY)&&(console.log("GetReady.EventHandler()"),"enter"!==t&&"bomb"!==t||$u.getInstance().createGameOnServer().then((function(){sd.change(sd.PLAY),cl.unbindKey(cl.KEY.ENTER),cl.unbindPointer(cl.pointer.LEFT)})).catch((function(t){console.error("Error creating new game on server: "+t),sd.change(sd.MENU)})),"exit"===t&&sd.change(Fu.SINGLE_PLAYER_MENU))}))}onDestroyEvent(){console.log("GetReady.OnExit()"),cl.unbindKey(cl.KEY.ENTER),cl.unbindPointer(cl.pointer.LEFT),Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.back),Bl.world.removeChild(this.emitter)}}class gf extends cf{constructor(t,e,i,s){super(t,e,i,s,{titleText:Iu.globalServerGame.player.name+" - Statistics",titleColor:"#ffffff"});let n=Iu.score+"\n"+(ku.getInstance().getCurrentLevelIndex()+1)+"\n"+Iu.bonusCollected+"\n"+Iu.collectedChests+"\n"+Iu.bombs+"\n"+Iu.usedBombs+"\n"+Iu.placedBarriers+"\n"+Iu.bittenBySpiders+"\n"+Iu.catchedByCats+"\n"+Iu.catchedByGolems+"\n"+Iu.killedSpiders+"\n"+Iu.stunnedCats+"\n"+Iu.stunnedGolems+"\n";this.levelDescr=new Yc(14,this.contentContainer.pos.y,{font:"18Outline",textAlign:"left",text:"Score: \nLevel: \nBonus collected: \nChests opened: \nBombs left: \nUsed bombs: \nPlaced barriers: \nBitten by spiders: \nCatched by cats: \nCatched by golems: \nKilled spiders: \nStunned cats: \nStunned golems: \n"}),this.levelDescr2=new Yc(324,this.contentContainer.pos.y,{font:"18Outline",textAlign:"right",text:n}),this.addChild(this.levelDescr,1),this.addChild(this.levelDescr2,1)}}class mf extends Ml{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(0,0),this.floating=!0,this.z=10,this.name="TitleBack",this.sensaSprite=new Wd(600,Bl.viewport.height-300,{image:Vd.getImage(t?"sensa_nee":"sensa_jaa"),anchorPoint:new Nn(0,0)}),this.sensaSprite.setOpacity(.8);let e=(Bl.viewport.width-460)/2,i=Bl.viewport.height-350;this.addChild(new df(t?"You LOOOOOSE!":"CONGRATS! You won!",!1),0),this.addChild(new gf(e,i,460,300,t),6),this.sensaSprite.pos.x=Bl.viewport.width-this.sensaSprite.width+50,this.sensaSprite.pos.y=Bl.viewport.height-this.sensaSprite.height,this.addChild(this.sensaSprite,1)}}class yf extends zl{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),this.isGameOver=t}onResetEvent(){console.log("GameOver.OnEnter()"),this.back=new mf(this.isGameOver),Bl.world.addChild(this.back),this.emitter=new su(Bl.viewport.width/2,Bl.viewport.height/2-50,{image:Vd.getImage("cat_left"),tint:"#ffffff33",width:32,height:32,totalParticles:34,gravity:.04,angle:0,angleVariation:6.283185307179586,speed:2,wind:.15}),Bl.world.addChild(this.emitter),this.emitter.streamParticles(),$u.getInstance().writeHighscore().then((()=>{cl.bindKey(cl.KEY.ENTER,"enter",!0),cl.bindPointer(cl.pointer.LEFT,cl.KEY.ENTER),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(sd.GAMEOVER)&&(console.log("GameOver.EventHandler()"),"enter"!==t&&"bomb"!==t||sd.change(sd.SCORE),"exit"===t&&sd.change(sd.MENU))}))}))}onDestroyEvent(){console.log("GameOver.OnExit()"),cl.unbindKey(cl.KEY.ENTER),cl.unbindPointer(cl.pointer.LEFT),Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.back),Bl.world.removeChild(this.emitter)}}function vf(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class xf extends Ml{constructor(t,e,i,s,n){super(i,s,n,32),vf(this,"font",void 0),vf(this,"scoreEntry",void 0),vf(this,"nameText",void 0),vf(this,"dateText",void 0),vf(this,"scoreText",void 0),this.scoreEntry=t,this.position=e,this.posFont=new Yc(i,s,{font:"24Outline",size:1,text:e.toString().padStart(2,"0")+".",anchorPoint:new Nn(0,0)}),this.nameFont=new Yc(i,s,{font:"24Outline",size:1,text:"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",anchorPoint:new Nn(0,0)}),this.dateFont=new Yc(i+200,s,{font:"24Outline",size:1,text:this.scoreEntry.time,anchorPoint:new Nn(0,0)}),this.scoreFont=new Yc(i+350,s,{font:"24Outline",size:1,fillStyle:"#ffffff",text:this.scoreEntry.score,textAlign:"left",anchorPoint:new Nn(0,0)}),this.fontSize=this.nameFont.measureText(),super.setShape(i,s,n,this.fontSize.height+16),this.border=new Ma(i,s,n,this.fontSize.height+16),this.posFont.pos.x+=8,this.posFont.pos.y+=8,this.nameFont.pos.x+=48,this.nameFont.pos.y+=8,this.dateFont.pos.x+=200,this.dateFont.pos.y+=8,this.scoreFont.pos.x+=320,this.scoreFont.pos.y+=8,this.setName("Wanja Pernath"),this.setTime(this.scoreEntry.time),this.setScore(this.scoreEntry.score),this.posText=e.toString().padStart(2,"0")+"."}draw(t){t.setGlobalAlpha(.5),t.setColor("#008800"),t.fill(this.border),t.setGlobalAlpha(1),t.setColor("#000000"),t.stroke(this.border),t.setColor("#ffffff"),this.posFont.draw(t,this.posText,this.posFont.pos.x,this.posFont.pos.y),this.nameFont.draw(t,this.nameText,this.nameFont.pos.x,this.nameFont.pos.y),this.dateFont.draw(t,this.dateText,this.dateFont.pos.x,this.dateFont.pos.y),this.scoreFont.draw(t,this.scoreText,this.scoreFont.pos.x,this.scoreFont.pos.y)}setName(t){this.nameText=t,this.isDirty=!0}setTime(t){this.dateText=new Date(t).toLocaleDateString(),this.isDirty=!0}setScore(t){this.scoreText=t.toString().padStart(7,"0"),this.isDirty=!0}updateScoreEntry(t){this.scoreEntry=t,this.setName(t.name),this.setTime(t.time),this.setScore(t.score)}}class bf extends Ml{constructor(){super(),vf(this,"highscoreComponent",[]),vf(this,"highscores",[{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:1e5,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:9e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:8e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:7e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:6e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:5e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:4e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:3e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:2e4,time:new Date(Date.now())},{pos:0,name:"Wanja Pernath",playerId:1,gameId:2,score:1e4,time:new Date(Date.now())}]),this.floating=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.addChild(new df("HIGHSCORES",!1,!1));for(let t=0;t<this.highscores.length;t++){let e=this.highscores[t],i=new xf(e,t+1,50,250+42*t,Bl.viewport.width-100,36);this.highscoreComponent.push(i),this.addChild(i)}}updateHighscores(t){null!=t&&0!=t.length||(t=this.highscores);for(let e=0;e<t.length;e++){let i=t[e];this.highscoreComponent[e].updateScoreEntry(i)}console.log(t)}}class wf extends zl{onResetEvent(){this.highscore=new bf,Bl.world.addChild(this.highscore),cl.bindPointer(cl.pointer.LEFT,cl.KEY.ESC),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(sd.SCORE)&&"exit"===t&&sd.change(sd.MENU)})),$u.getInstance().readTop10Highscores().then((t=>this.highscore.updateHighscores(t))).catch((t=>console.log(t)))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),cl.unbindPointer(cl.pointer.LEFT),Bl.world.removeChild(this.highscore)}}function _f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Ef{constructor(t,e){_f(this,"lastPlayerAction",null),_f(this,"lastReplay",0),this.enemy=t,this.playerActions=e,this.replayActionIndex=0,this.replayDone=!1}calculateNextPosition(){if(this.enemy.nextPositionFound=!1,this.replayActionIndex<this.playerActions.length){console.log("  calculateNextPos(): "+this.replayActionIndex+" / "+this.playerActions.length);let t=this.playerActions[this.replayActionIndex];console.log("    New pos: "+JSON.stringify(t)),this.enemy.nextPosition.x=t.x,this.enemy.nextPosition.y=t.y,this.enemy.nextPosition.dx=t.dx,this.enemy.nextPosition.dy=t.dy,null!==this.lastPlayerAction&&(this.enemy.nextPosition.last.dx=this.lastPlayerAction.dx,this.enemy.nextPosition.last.dy=this.lastPlayerAction.dy),this.lastPlayerAction=t,this.enemy.nextPositionFound=!0,this.replayActionIndex++}}playNext(t){if(!this.replayDone)if(this.replayActionIndex<this.playerActions.length){let t=this.playerActions[this.replayActionIndex],e=0,i=0;if(null!=this.lastPlayerAction&&(i=t.time-this.lastPlayerAction.time,e=performance.now()-this.lastReplay,e<i))return;this.lastReplay=performance.now(),this.lastPlayerAction=t,this.replayActionIndex++,t.isDead||t.isStunned||(this.enemy.pos.x=32*t.x+16,this.enemy.pos.y=32*t.y+16)}else this.replayDone||(this.replayDone=!0)}}class Cf extends cp{constructor(t,e,i){super(t,e),this.replayer=new Ef(this,i)}calculateNextPosition(){this.replayer.calculateNextPosition()}sendEnemyMovement(){}}function Tf(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Af extends Mp{constructor(t,e){super(t,e),Tf(this,"lastPlayerAction",null),Tf(this,"lastReplay",0),this.playerActions=Iu.replayActions.playerMovements,this.replayActionIndex=0,this.replayDone=!1,Bl.viewport.follow(this.pos,Bl.viewport.AXIS.BOTH,.1)}update(t){if(this.replayActionIndex<this.playerActions.length){let e=this.playerActions[this.replayActionIndex],i=0,s=0;if(null!=this.lastPlayerAction&&(s=e.time-this.lastPlayerAction.time,i=performance.now()-this.lastReplay,i<s))return super.update(t);this.lastReplay=performance.now(),this.lastPlayerAction=e,this.replayActionIndex++,e.gutterThrown?this.placeBorderTile(e.x+e.dx,e.y+e.dy):e.bombPlaced?(this.pos.x=32*e.x+16,this.pos.y=32*e.y+16,Bl.world.addChild(new vp(this.pos.x,this.pos.y)),Iu.usedBombs++,Iu.bombs--):(this.pos.x=32*e.x+16,this.pos.y=32*e.y+16,this.checkBonusTile(this.pos.x,this.pos.y))}else this.replayDone||(sd.change(sd.MENU),this.replayDone=!0);return super.update(t)}}class Sf extends fp{constructor(t,e,i){super(t,e),this.replayer=new Ef(this,i)}calculateNextPosition(){this.replayer.calculateNextPosition()}sendEnemyMovement(){}}function Pf(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Mf extends zl{constructor(){super(...arguments),Pf(this,"player",void 0),Pf(this,"enemies",[]),Pf(this,"hudContainer",null),Pf(this,"virtualJoypad",null),Pf(this,"enemyActions",[]),Pf(this,"enemyEmitter",{isActive:!1,emitAt:{x:0,y:0},emitEvery:5e3,emitTime:5e3,emitCount:10}),Pf(this,"spotLight",null)}onResetEvent(){this.player=null,this.spotLight=null,this.enemies=[],this.enemyEmitter.isActive=!1,sd.pause(),ku.getInstance().setCurrentLevel(Iu.gameToReplay.level-1);let t="",e=[];Iu.replayActions.enemies.forEach(((i,s)=>{i.name!==t&&(console.log("Loading & parsing actions for "+i.name),""!==t&&(this.enemyActions[t]=e),t=i.name,e=[]),e.push(i)})),this.enemyActions[t]=e,this.setupLevel(),this.hudContainer=new Zp(0,0),this.virtualJoypad=new rf,Bl.world.addChild(this.hudContainer),Bl.world.addChild(this.virtualJoypad,1/0),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.REPLAY_GAME)&&("pause"===t&&(sd.isPaused()?sd.resume():sd.pause()),"exit"===t&&sd.change(sd.MENU),"fullscreen"===t&&(console.log("requesting full screen"),device.isFullscreen?device.exitFullscreen():device.requestFullscreen()))})),sd.resume()}onDestroyEvent(){console.log("RePlay.OnExit()"),Bl.world.removeChild(this.hudContainer),Bl.world.removeChild(this.virtualJoypad),Rr.off(Rr.KEYUP,this.handler)}update(t){if(this.enemyEmitter.isActive&&this.enemyEmitter.emitEvery<=0&&this.enemyEmitter.emitCount>0){this.enemyEmitter.emitCount--,this.enemyEmitter.emitEvery=this.enemyEmitter.emitTime;let t="SpiderEnemy."+(this.enemyEmitter.emitCount+1),e=new Sf(this.enemyEmitter.emitAt.x,this.enemyEmitter.emitAt.y,this.enemyActions[t]);e.setEnemyName(t),this.enemies.push(e),Bl.world.addChild(e),e.setPlayer(this.player)}return this.enemyEmitter.emitEvery-=t,super.update(t)}setupLevel(){ku.getInstance().prepareCurrentLevel(),Md.getCurrentLevel().getLayers().forEach((t=>{if(console.log(t.name),"Persons"===t.name){let e=0;for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){let n=t.cellAt(s,i);if(null!=n)if(993===n.tileId)this.player=new Af(s,i),this.player.name="Player",console.log("  player at ("+s+"/"+i+"): "+this.player),Bl.world.addChild(this.player);else if(994===n.tileId){let t="CatEnemy."+e++,n=new Cf(s,i,this.enemyActions[t]);n.name=t,Bl.world.addChild(n),this.enemies.push(n),console.log("  enemy at ("+s+"/"+i+"): "+n)}else if(995===n.tileId)this.enemyEmitter.isActive=!0,this.enemyEmitter.emitAt.x=s,this.enemyEmitter.emitAt.y=i,this.enemyEmitter.emitCount=t.enemyNumEmitting,this.enemyEmitter.emitEvery=t.enemyTimeEmitting,console.log("  enemyEmitter at ("+s+"/"+i+"): ");else if(996===n.tileId){let t=new mp(s,i),n="Golem."+(e+1);e++,t.setEnemyName(n),t.setWayPath(ku.getInstance().getCurrentLevel().getPathForEnemy(n)),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+s+"/"+i+"): "+t)}}}})),this.enemies.forEach((t=>t.setPlayer(this.player)))}}const Of=[{name:"screen-controls",type:"image",src:"./data/img/screen-controls.png"},{name:"screen-controls",type:"json",src:"./data/img/screen-controls.json"},{name:"24Outline",type:"image",src:"./data/fnt/24Outline.png"},{name:"24Outline",type:"binary",src:"./data/fnt/24Outline.fnt"},{name:"12Outline",type:"image",src:"./data/fnt/12Outline.png"},{name:"12Outline",type:"binary",src:"./data/fnt/12Outline.fnt"},{name:"18Outline",type:"image",src:"./data/fnt/18Outline.png"},{name:"18Outline",type:"binary",src:"./data/fnt/18Outline.fnt"},{name:"ArialFancy",type:"image",src:"./data/fnt/arialfancy.png"},{name:"ArialFancy",type:"binary",src:"./data/fnt/arialfancy.fnt"},{name:"Shadow",type:"image",src:"./data/fnt/Shadow.png"},{name:"Shadow",type:"binary",src:"./data/fnt/Shadow.fnt"},{name:"grumpy_cat_left",type:"image",src:"./data/img/grumpy_cat_left.png"},{name:"grumpy_cat_right",type:"image",src:"./data/img/grumpy_cat_right.png"},{name:"title",type:"image",src:"./data/img/GrumpyCat-Title.png"},{name:"explosion",type:"image",src:"./data/img/explosion4.png"},{name:"spider-red",type:"image",src:"./data/img/spider-red.png"},{name:"animals-walk",type:"image",src:"./data/img/animals-walk.png"},{name:"golem-walk",type:"image",src:"./data/img/golem-walk.png"},{name:"terrain",type:"image",src:"./data/img/terrain.png"},{name:"BombExploding",type:"image",src:"./data/img/BombExploding.png"},{name:"sensa_jaa",type:"image",src:"./data/img/sensa_jaa.png"},{name:"sensa_nee",type:"image",src:"./data/img/sensa_nee.png"},{name:"sensa_grass",type:"image",src:"./data/img/sensa_grass.jpeg"},{name:"player",type:"image",src:"./data/img/player.png"},{name:"cat_left",type:"image",src:"./data/img/cat_left.png"},{name:"cat_right",type:"image",src:"./data/img/cat_right.png"},{name:"magic-bolt",type:"image",src:"./data/img/effects/1_magicspell_spritesheet.png"},{name:"magic-hit",type:"image",src:"./data/img/effects/5_magickahit_spritesheet.png"},{name:"magic-nebula",type:"image",src:"./data/img/effects/12_nebula_spritesheet.png"},{name:"magic-firespin",type:"image",src:"./data/img/effects/7_firespin_spritesheet.png"},{name:"protection-circle",type:"image",src:"./data/img/effects/8_protectioncircle_spritesheet.png"},{name:"magic-vortex",type:"image",src:"./data/img/effects/13_vortex_spritesheet.png"},{name:"open-chest",type:"image",src:"./data/img/chest-sheet.png"},{name:"Level1",type:"image",src:"./data/map/Level1.png"},{name:"Level2",type:"image",src:"./data/map/Level2.png"},{name:"Level3",type:"image",src:"./data/map/Level3.png"},{name:"Level4",type:"image",src:"./data/map/Level4.png"},{name:"Level5",type:"image",src:"./data/map/Level5.png"},{name:"Level6",type:"image",src:"./data/map/Level6.png"},{name:"mp1",type:"image",src:"./data/map/mp_arena.png"},{name:"mp2",type:"image",src:"./data/map/mp_golems.png"}];function Lf(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class kf extends Du{constructor(t,e,i,s){super(e,i,s,32),Lf(this,"font",void 0),Lf(this,"nameText",void 0),Lf(this,"dateText",void 0),Lf(this,"scoreText",void 0),Lf(this,"borderColor",void 0),Lf(this,"callbackOnClick",void 0),this.gameEntry=t,this.playerFont=new Yc(e,i,{font:"24Outline",size:1,text:"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",anchorPoint:new Nn(0,0)}),this.dateFont=new Yc(e+300,i,{font:"24Outline",size:1,anchorPoint:new Nn(0,0)}),this.gameFont=new Yc(e+500,i,{font:"24Outline",size:1,fillStyle:"#ffffff",text:this.gameEntry.name,textAlign:"left",anchorPoint:new Nn(0,0)}),this.fontSize=this.playerFont.measureText(),super.setShape(e,i,s,this.fontSize.height+16),this.border=new Ma(e,i,s,this.fontSize.height+16),this.gameFont.pos.x+=8,this.gameFont.pos.y+=8,this.dateFont.pos.x+=8,this.dateFont.pos.y+=8,this.playerFont.pos.x+=8,this.playerFont.pos.y+=8,this.playerName=this.gameEntry.player.name,this.gameName=this.gameEntry.name,this.dateTime=new Date(this.gameEntry.time).toLocaleDateString(),this.borderColor="#008800",this.callbackOnClick=this.onClick}draw(t){t.setGlobalAlpha(.5),t.setColor(this.borderColor),t.fill(this.border),t.setGlobalAlpha(1),t.setColor("#000000"),t.stroke(this.border),t.setColor("#ffffff"),this.gameFont.draw(t,this.gameName,this.gameFont.pos.x,this.gameFont.pos.y),this.dateFont.draw(t,this.dateTime,this.dateFont.pos.x,this.dateFont.pos.y),this.playerFont.draw(t,this.playerName,this.playerFont.pos.x,this.playerFont.pos.y)}setCallbackOnClick(t){this.callbackOnClick=t}onClick(t){console.log("onClick"),this.callbackOnClick(this.gameEntry)}onOver(t){this.borderColor="#00aa00",this.isDirty=!0}onOut(t){this.borderColor="#008800",this.isDirty=!0}}class If extends Ml{constructor(){super(),Lf(this,"listComponents",[]),this.floating=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.addChild(new df("Replay Game",!1,!1))}updateList(t){if(null!==t&&t.length>0){for(let e=0;e<t.length;e++){let i=new kf(t[e],50,250+42*e,Bl.viewport.width-100,36);if(this.listComponents.push(i),this.addChild(i),i.setCallbackOnClick(this.useSelectedGame),e>=10)break}this.isDirty=!0}}useSelectedGame(t){console.log("  selected game = "+JSON.stringify(t)),$u.getInstance().readPlayerActionsFromServer(t).then((function(e){Iu.gameToReplay=t,Iu.replayActions=e,sd.change(Fu.REPLAY_GAME)})).catch((function(t){console.error("Could not read player actions: "+t),sd.change(sd.MENU)}))}}class Rf extends zl{onResetEvent(){this.replay=new If,Bl.world.addChild(this.replay),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.REPLAY_GAME_CHOOSER)&&"exit"===t&&sd.change(Fu.SINGLE_PLAYER_MENU)})),$u.getInstance().readLastGamesFromServer().then((t=>this.replay.updateList(t))).catch((t=>console.log(t)))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.replay)}}function Bf(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Df extends Qc{constructor(t,e,i){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark24",anchorPoint:new Nn(0,0)}),this.callback=i,this.setOpacity(.5)}onClick(){void 0!==this.callback&&this.callback()}onRelease(){}onOver(){this.setOpacity(.8)}onOut(){this.setOpacity(.5)}}class Nf extends Qc{constructor(t,e,i){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark25",anchorPoint:new Nn(0,0)}),this.callback=i,this.setOpacity(.5)}onOver(){this.setOpacity(.8)}onOut(){this.setOpacity(.5)}onClick(){void 0!==this.callback&&this.callback()}}class Ff extends Du{constructor(t,e,i,s,n){super(e,i,s,n),Bf(this,"currentLevel",void 0),Bf(this,"levelIndex",void 0),Bf(this,"name",void 0),Bf(this,"description",void 0),Bf(this,"mapSize",void 0),Bf(this,"image",void 0),Bf(this,"callbackOnClick",void 0),this.clipping=!1,this.floating=!1,this.levelIndex=t,this.currentLevel=ku.getInstance().setCurrentLevel(t),this.name=this.currentLevel.longName,this.description=this.currentLevel.description,this.mapSize="Map size: "+this.currentLevel.mapWidth+" x "+this.currentLevel.mapHeight,this.image=Vd.getImage(this.currentLevel.previewImage),this.addChild(new Yc(358,0,{font:"18Outline",text:"Map information",fillStyle:"#ffa000"})),this.addChild(new Yc(358,30,{font:"12Outline",text:"Name: "+this.name})),this.addChild(new Yc(358,50,{font:"12Outline",text:this.mapSize})),this.addChild(new Yc(358,90,{font:"18Outline",text:"Description: ",fillStyle:"#ffa000"})),this.addChild(new Yc(358,120,{font:"12Outline",lineHeight:1.5,wordWrapWidth:s-358,text:this.description})),this.callbackOnClick=void 0}draw(t){t.drawImage(this.image,this.pos.x+5,this.pos.y,348,444),super.draw(t)}setCallbackOnClick(t){this.callbackOnClick=t}onClick(t){this.callbackOnClick(this.levelIndex)}onOver(t){this.setOpacity(1)}onOut(t){this.setOpacity(.8)}}class Gf extends cf{constructor(){let t=(Bl.viewport.width-900)/2,e=Bl.viewport.height-505-60;super(t,e,900,505,{titleText:"Choose a Level",backgroundAlpha:.4,backgroundColor:"#202020"}),Bf(this,"listComponents",[]),Bf(this,"levelChosen",!1),this.floating=!1,this.clipping=!1,this.z=10,this.setOpacity(1),this.name="TitleBack",e=214,this.prev=new Df(this.pos.x+2,this.pos.y+e,this.prevLevel.bind(this)),this.next=new Nf(this.pos.x+900-80,this.pos.y+e,this.nextLevel.bind(this)),this.addChild(this.prev),this.addChild(this.next),ku.getInstance().reset();for(let t=0;t<ku.getInstance().levelCount();t++){let e=new Ff(t,this.contentContainer.pos.x+80,this.contentContainer.pos.y,720,455);e.setCallbackOnClick(this.useSelectedGame.bind(this)),e.setOpacity(.8),this.listComponents.push(e)}ku.getInstance().reset(),this.addChild(this.listComponents[0])}prevLevel(){let t=ku.getInstance().getCurrentLevelIndex();ku.getInstance().hasPrev()&&(this.removeChild(this.listComponents[t],!0),ku.getInstance().prev(),this.addChild(this.listComponents[t-1]))}nextLevel(){let t=ku.getInstance().getCurrentLevelIndex();ku.getInstance().hasNext()&&(this.removeChild(this.listComponents[t],!0),ku.getInstance().next(),this.addChild(this.listComponents[t+1]))}useSelectedGame(t){this.levelChosen||(console.log("  selected level = "+t),ku.getInstance().setCurrentLevel(t),sd.change(sd.READY),this.levelChosen=!0)}}class Uf extends zl{constructor(){super(...arguments),Bf(this,"chooserComponent",null)}onResetEvent(){console.log("ChooserLevel.onEnter()"),this.back=new df("Choose Level",!1,!1),Bl.world.addChild(this.back),this.chooserComponent=new Gf,Bl.world.addChild(this.chooserComponent),this.handler=Rr.on(Rr.KEYUP,((t,e,i)=>{sd.isCurrent(Fu.CHOOSE_LEVEL)&&("exit"===t?sd.change(Fu.SINGLE_PLAYER_MENU):"left"===t?this.chooserComponent.prevLevel():"right"===t?this.chooserComponent.nextLevel():"bomb"===t&&this.chooserComponent.useSelectedGame(ku.getInstance().getCurrentLevelIndex()))}))}onDestroyEvent(){console.log("ChooserLevel.onExit()"),Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.chooserComponent),Bl.world.removeChild(this.back)}}var jf,zf,Hf;i(755);class Yf extends Nu{constructor(t,e){super(t,e,{text:"Host Game",borderWidth:250,fillStyle:"#ff1000"})}onClick(){sd.change(Fu.MULTIPLAYER_START_GAME)}}class Vf extends Nu{constructor(t,e){super(t,e,{text:"Join Game",borderWidth:250})}onClick(){sd.change(Fu.MULTIPLAYER_JOIN_GAME)}}class Wf extends Nu{constructor(t,e){super(t,e,{text:"Back",borderWidth:250})}onClick(){sd.change(sd.MENU)}}class Kf extends Ml{constructor(){super(),this.floating=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.addChild(new df("MULTIPLAYER",!0,!0,!0)),this.addChild(new Yf((Bl.viewport.width-250)/2,300)),this.addChild(new Vf((Bl.viewport.width-250)/2,360)),this.addChild(new Wf((Bl.viewport.width-250)/2,420))}}class qf extends zl{onResetEvent(){this.multiplayerManager=Wp.get(),this.menu=null,Iu.reset(),this.multiplayerManager.createPlayerFromMe().then((t=>{console.log("  Got new MultiPlayer: "+t.id),this.menu=new Kf,Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.MULTIPLAYER_MENU)&&"exit"===t&&sd.change(sd.MENU)}))})).catch((t=>{console.log("ERROR: "+t),sd.change(sd.MENU)}))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),null!==this.menu&&Bl.world.removeChild(this.menu),this.menu=null}}class Xf extends Nu{constructor(t,e){super(t,e,{text:"Play",borderWidth:250})}onClick(t){sd.change(sd.READY)}}class Jf extends Nu{constructor(t,e){super(t,e,{text:"Choose Level",borderWidth:250})}onClick(t){sd.change(Fu.CHOOSE_LEVEL)}}class Zf extends Nu{constructor(t,e){super(t,e,{text:"Replay",borderWidth:250})}onClick(t){sd.change(Fu.REPLAY_GAME_CHOOSER)}}class Qf extends Nu{constructor(t,e){super(t,e,{text:"Back",borderWidth:250})}onClick(){sd.change(sd.MENU)}}class $f extends Ml{constructor(){super(),this.floating=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.addChild(new df("SINGLE PLAYER"));let t=Math.round((Bl.viewport.width-250)/2);this.addChild(new Xf(t,300)),this.addChild(new Zf(t,360)),this.addChild(new Jf(t,420)),this.addChild(new Qf(t,480))}}class tg extends zl{onResetEvent(){this.menu=new $f,Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.SINGLE_PLAYER_MENU)&&"exit"===t&&sd.change(sd.MENU)}))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.menu)}}function eg(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ig extends Qc{constructor(t,e,i){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark24",anchorPoint:new Nn(0,0)}),this.callback=i,this.setOpacity(.5)}onClick(){void 0!==this.callback&&this.callback()}onRelease(){}onOver(){this.setOpacity(.8)}onOut(){this.setOpacity(.5)}}class sg extends Qc{constructor(t,e,i){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark25",anchorPoint:new Nn(0,0)}),this.callback=i,this.setOpacity(.5)}onOver(){this.setOpacity(.8)}onOut(){this.setOpacity(.5)}onClick(){void 0!==this.callback&&this.callback()}}class ng extends Du{constructor(t,e,i,s,n){super(e,i,s,n),eg(this,"currentLevel",void 0),eg(this,"levelIndex",void 0),eg(this,"name",void 0),eg(this,"description",void 0),eg(this,"mapSize",void 0),eg(this,"image",void 0),eg(this,"callbackOnClick",void 0),this.clipping=!1,this.floating=!1,this.level=t,this.name=this.level.longName,this.description=this.level.description,this.mapSize="Map size: "+this.level.mapWidth+" x "+this.level.mapHeight,this.numPlayers="Max players: "+this.level.numPlayers,this.image=Vd.getImage(this.level.previewImage),this.addChild(new Yc(358,0,{font:"18Outline",text:"Map information",fillStyle:"#ffa000"})),this.addChild(new Yc(358,30,{font:"12Outline",text:"Name: "+this.name})),this.addChild(new Yc(358,50,{font:"12Outline",text:this.mapSize})),this.addChild(new Yc(358,70,{font:"12Outline",text:"Max players: "+this.level.numPlayers})),this.addChild(new Yc(358,110,{font:"18Outline",text:"Description: ",fillStyle:"#ffa000"})),this.addChild(new Yc(358,140,{font:"12Outline",lineHeight:1.5,text:this.description})),this.callbackOnClick=void 0}draw(t,e){t.drawImage(this.image,this.pos.x+5,this.pos.y,348,444),super.draw(t,e)}setCallbackOnClick(t){this.callbackOnClick=t}onClick(t){this.callbackOnClick(this.levelIndex)}onOver(t){this.setOpacity(1)}onOut(t){this.setOpacity(.8)}}class rg extends cf{constructor(t){let e=(Bl.viewport.width-900)/2,i=Bl.viewport.height-505-60;super(e,i,900,505,{titleText:"Choose a Level",backgroundAlpha:.4,backgroundColor:"#202020"}),eg(this,"listComponents",[]),eg(this,"levelChosen",!1),eg(this,"levelIndex",0),this.levels=t,this.floating=!1,this.clipping=!0,this.z=12,this.name="LevelChooser",i=214,this.prev=new ig(this.pos.x+2,this.pos.y+i,this.prevLevel.bind(this)),this.next=new sg(this.pos.x+900-80,this.pos.y+i,this.nextLevel.bind(this)),this.addChild(this.prev),this.addChild(this.next);for(let t=0;t<this.levels.length;t++){let e=new ng(this.levels[t],this.contentContainer.pos.x+80,this.contentContainer.pos.y,720,455);e.setCallbackOnClick(this.useSelectedGame.bind(this)),e.setOpacity(.8),this.listComponents.push(e)}this.listComponents.length>0?this.addChild(this.listComponents[0]):console.log("no entries in list")}prevLevel(){let t=this.levelIndex;t>0&&(this.removeChild(this.listComponents[t],!0),this.levelIndex-=1,this.addChild(this.listComponents[t-1]))}nextLevel(){let t=this.levelIndex;t<this.levels.length-1&&(this.removeChild(this.listComponents[t],!0),this.levelIndex+=1,this.addChild(this.listComponents[t+1]))}useSelectedGame(t){this.levelChosen||(console.log("  selected level = "+this.levelIndex),Wp.get().useSelectedLevel(this.levelIndex),this.levelChosen=!0,Wp.get().createGame().then((t=>{sd.change(Fu.MULTIPLAYER_LOBBY)})))}}class og extends Nu{constructor(t,e){super(t,e,{text:"Back",borderWidth:150})}onClick(){Wp.get().closeActiveGame(),sd.change(Fu.MULTIPLAYER_MENU)}}class ag extends Ml{constructor(){super(),this.floating=!0,this.enableChildBoundsUpdate=!0,this.z=10,this.setOpacity(1),this.name="TitleBack",this.levelChooser=new rg(Wp.get().allLevels()),this.addChild(new df("HOST GAME",!1,!1,!0)),this.addChild(this.levelChooser),this.addChild(new og(5,Bl.viewport.height-55)),this.updateBounds(!0)}}class hg extends zl{onResetEvent(){this.menu=new ag,Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.MULTIPLAYER_START_GAME)&&"exit"===t&&(Wp.get().closeActiveGame(),sd.change(Fu.MULTIPLAYER_MENU))}))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.menu)}}function lg(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class dg extends Qc{constructor(t,e,i){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark24",anchorPoint:new Nn(0,0)}),this.callback=i,this.setOpacity(.5)}onClick(){void 0!==this.callback&&this.callback()}onRelease(){}onOver(){this.setOpacity(.8)}onOut(){this.setOpacity(.5)}}class cg extends Qc{constructor(t,e,i){super(t,e,{image:Iu.screenControlsTexture,region:"shadedDark25",anchorPoint:new Nn(0,0)}),this.callback=i,this.setOpacity(.5)}onOver(){this.setOpacity(.8)}onOut(){this.setOpacity(.5)}onClick(){void 0!==this.callback&&this.callback()}}class ug extends Du{constructor(t,e,i,s,n){super(e,i,s,n),lg(this,"currentLevel",void 0),lg(this,"levelIndex",void 0),lg(this,"name",void 0),lg(this,"description",void 0),lg(this,"mapSize",void 0),lg(this,"image",void 0),lg(this,"callbackOnClick",void 0),this.clipping=!1,this.floating=!1,this.game=t,this.level=Wp.get().allLevels()[t.level],this.name=this.level.longName,this.description=this.level.description,this.image=Vd.getImage(this.level.previewImage),this.addChild(new Yc(358,0,{font:"18Outline",text:"Multiplayer Session",fillStyle:"#ffa000"})),this.addChild(new Yc(358,30,{font:"12Outline",text:"Opened By: "+this.game.player1.name}));let r=new Date(this.game.timeStarted);this.addChild(new Yc(358,50,{font:"12Outline",text:"Opened on: "+r.toLocaleDateString()+" "+r.toLocaleTimeString()})),this.addChild(new Yc(358,80,{font:"18Outline",text:"Map information",fillStyle:"#ffa000"})),this.addChild(new Yc(358,110,{font:"12Outline",text:"Name: "+this.name})),this.addChild(new Yc(358,130,{font:"12Outline",text:"Map size: "+this.level.mapWidth+" x "+this.level.mapHeight})),this.addChild(new Yc(358,150,{font:"12Outline",text:"Max players: "+this.level.numPlayers})),this.addChild(new Yc(358,180,{font:"18Outline",text:"Description: ",fillStyle:"#ffa000"})),this.addChild(new Yc(358,210,{font:"12Outline",lineHeight:1.5,text:this.description})),this.callbackOnClick=void 0}draw(t,e){t.drawImage(this.image,this.pos.x+5,this.pos.y,348,444),super.draw(t,e)}setCallbackOnClick(t){this.callbackOnClick=t}onClick(t){this.callbackOnClick(this.game)}onOver(t){this.setOpacity(1)}onOut(t){this.setOpacity(.8)}}class pg extends cf{constructor(t){let e=(Bl.viewport.width-900)/2,i=Bl.viewport.height-505-60;super(e,i,900,505,{titleText:"Choose a Match to join",backgroundAlpha:.4,backgroundColor:"#202020"}),lg(this,"listComponents",[]),lg(this,"levelChosen",!1),lg(this,"levelIndex",0),this.floating=!1,this.clipping=!0,this.levels=t,this.z=12,this.name="GameChooser",i=214,this.prev=new dg(this.pos.x+2,this.pos.y+i,this.prevLevel.bind(this)),this.next=new cg(this.pos.x+900-80,this.pos.y+i,this.nextLevel.bind(this)),this.addChild(this.prev),this.addChild(this.next);for(let t=0;t<this.levels.length;t++){let e=new ug(this.levels[t],this.contentContainer.pos.x+80,this.contentContainer.pos.y,720,455);e.setCallbackOnClick(this.useSelectedGame.bind(this)),e.setOpacity(.8),this.listComponents.push(e)}this.listComponents.length>0?this.addChild(this.listComponents[0]):console.log("no entries in list")}prevLevel(){let t=this.levelIndex;t>0&&(this.removeChild(this.listComponents[t],!0),this.levelIndex-=1,this.addChild(this.listComponents[t-1]))}nextLevel(){let t=this.levelIndex;t<this.levels.length-1&&(this.removeChild(this.listComponents[t],!0),this.levelIndex+=1,this.addChild(this.listComponents[t+1]))}useSelectedGame(t){this.levelChosen||(this.levelChosen=!0,console.log("  selected game = "+t),Wp.get().setGameToJoin(t),Wp.get().joinGame().then((()=>{console.log("Game joined"),sd.change(Fu.MULTIPLAYER_LOBBY)})).catch((t=>{console.log("ERROR joining game: "+t),sd.change(Fu.MULTIPLAYER_MENU)})))}}class fg extends Nu{constructor(t,e){super(t,e,{text:"Back",borderWidth:150})}onClick(){sd.change(Fu.MULTIPLAYER_MENU)}}class gg extends Ml{constructor(){super(),this.floating=!0,this.z=10,this.name="TitleBack",this.addChild(new df("JOIN GAME",!1,!1,!0)),this.addChild(new fg(5,Bl.viewport.height-55)),Wp.get().listOpenGames().then((t=>{this.gameChooser=new pg(t),this.addChild(this.gameChooser)})).catch((t=>{console.log("  ERROR can't read open games: "+t),sd.change(Fu.MULTIPLAYER_MENU)}))}}class mg extends zl{onResetEvent(){this.menu=new gg,Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.MULTIPLAYER_JOIN_GAME)&&"exit"===t&&sd.change(Fu.MULTIPLAYER_MENU)}))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.menu)}}class yg extends Nu{constructor(t,e){super(t,e,{text:"Back",borderWidth:150})}onClick(){Wp.get().closeActiveGame(),sd.change(Fu.MULTIPLAYER_MENU)}}class vg extends Nu{constructor(t,e){super(t,e,{text:"Start",borderWidth:150})}onClick(){console.log("**** onClick() ****"),Wp.get().startGame().then((()=>{sd.change(Fu.MULTIPLAYER_PLAY)}))}}class xg extends Ml{constructor(t,e,i,s){super(t,e),this.player=i,this.playerNum=s,this.playerNumText=new Yc(40,4,{font:"24Outline",text:"Player "+(s+1)+":"}),this.playerNameText=new Yc(160,4,{font:"24Outline"}),this.sprite=new Op(0,0,!0),this.sprite.tint=Uu[s],this.updatePlayer(i),this.addChild(this.playerNumText),this.addChild(this.playerNameText),this.addChild(this.sprite)}updatePlayer(t){this.player=t,null!==t?(this.playerNameText.setText(t.name),Wp.get().multiplayerPlayer.id==t.id?(this.playerNameText.fillStyle="#00ffa0",this.playerNameText.setText(t.name+" (you)")):(this.playerNameText.fillStyle="#ffffff",this.playerNameText.setText(t.name))):(this.playerNameText.fillStyle="#ffffff",this.playerNameText.setText("waiting..."))}}class bg extends cf{constructor(t,e,i,s,n){super(t,e,i,s,{titleText:"Status:",titleColor:"#ffa000",titlePos:"left",backgroundAlpha:.3}),this.statusMessage=new Yc(this.contentContainer.pos.x,this.contentContainer.pos.y,{font:"18Outline"}),this.addChild(this.statusMessage),this.updateMessage(n)}updateMessage(t){this.statusMessage.setText(t)}}class wg extends cf{constructor(t,e,i){super(t,e,i,224,{titleText:"Players in the Game",titleColor:"#ffa000",titlePos:"left",backgroundAlpha:.3,backgroundColor:"#202020"}),this.playerComponents=[]}addPlayer(t,e){let i=new xg(this.contentContainer.pos.x,this.contentContainer.pos.y+42*e,t,e);this.playerComponents.push(i),this.addChild(i,100)}updatePlayer(t,e){this.playerComponents[e].updatePlayer(t)}}class _g extends Ml{constructor(){super(),this.floating=!0,this.setOpacity(1),this.z=20,this.players=[],this.name="mp-lobby",this.addChild(new df("LOBBY",!1,!1,!0)),this.addChild(new yg(5,Bl.viewport.height-60)),Wp.get().weAreHost&&(this.startButton=new vg(Bl.viewport.width-155,Bl.viewport.height-60),this.addChild(this.startButton));let t=(Bl.viewport.width-600)/2;this.statusContainer=new bg(t,236,600,100,"Waiting........"),this.addChild(this.statusContainer),this.playerContainer=new wg(t,344,600),this.addChild(this.playerContainer),this.players=this.playersFromGame(Wp.get().multiplayerGame);for(let t=0;t<4;t++)this.playerContainer.addPlayer(this.players[t],t);Wp.get().setOnJoinCallback(this.playerJoined.bind(this)),Wp.get().setOnLeaveCallback(this.playerLeft.bind(this)),Wp.get().setOnGameCloseCallback(this.gameClosed.bind(this)),Wp.get().setOnBroadcastCallback(this.broadcasted.bind(this)),Wp.get().setOnGameStartedCallback(this.gameStarted.bind(this))}playersFromGame(t){let e=[];return e[0]=void 0!==t.player1?t.player1:null,e[1]=void 0!==t.player2?t.player2:null,e[2]=void 0!==t.player3?t.player3:null,e[3]=void 0!==t.player4?t.player4:null,e}updatePlayers(t){this.players=this.playersFromGame(Wp.get().multiplayerGame);for(let t=0;t<4;t++)this.playerContainer.updatePlayer(this.players[t],t)}gameStarted(t){t.message,this.statusContainer.updateMessage("Game starting now!"),sd.change(Fu.MULTIPLAYER_PLAY)}playerJoined(t){let e=t.message,i=t.game;this.statusContainer.updateMessage(e.message),Wp.get().weAreHost&&null===this.startButton&&(this.startButton=new vg(Bl.viewport.width-105,Bl.viewport.height-60),this.addChild(this.startButton)),this.updatePlayers(i)}playerLeft(t){let e=t.message,i=t.game;this.statusContainer.updateMessage(e.message),Wp.get().weAreHost&&(null!==this.startButton&&void 0!==i.player1||void 0===i.player2||void 0===i.player3||i.player4),this.updatePlayers(i)}gameClosed(t){Wp.get().closeActiveGame(),then((()=>{sd.change(Fu.MULTIPLAYER_MENU)}))}broadcasted(t){let e=t.message;this.statusMessage.setText(e.message)}}class Eg extends zl{onResetEvent(){this.menu=new _g,Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.MULTIPLAYER_LOBBY)&&"exit"===t&&(Wp.get().closeActiveGame(),sd.change(Fu.MULTIPLAYER_MENU))}))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.menu),Wp.get().setOnJoinCallback(null),Wp.get().setOnLeaveCallback(null),Wp.get().setOnGameCloseCallback(null),Wp.get().setOnBroadcastCallback(null),Wp.get().setOnGameStartedCallback(null)}}class Cg extends Mp{constructor(t,e,i,s){super(t,e),this.player=i,this.color=s,this.tint=s,this.invincible=!1,this.body.collisionType=Gu.REMOTE_PLAYER,this.body.setCollisionMask(Tl.types.ENEMY_OBJECT|Gu.REMOTE_PROJECTILE|Tl.types.PROJECTILE_OBJECT),Wp.get().addOnMessageCallback((async t=>{let e=t.message;if(e.playerId===this.player.id)if(this.pos.x=32*e.x+16,this.pos.y=32*e.y+16,e.gutterThrown)this.placeBorderTile(e.x+e.dx,e.y+e.dy,!1);else if(e.magicBolt)this.throwMagicSpell(e.x,e.y,e.dx,e.dy,!1),this.spell.body.collisionType=Gu.REMOTE_PROJECTILE,this.spell.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Tl.types.ENEMY_OBJECT),this.spell.tint.copy(this.color),this.spell.thrownByPlayer=this.player;else if(e.chestCollected);else if(e.magicNebula)this.throwMagicNebula(e.x,e.y,!1),this.spell.body.collisionType=Gu.REMOTE_PROJECTILE,this.spell.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Tl.types.ENEMY_OBJECT),this.spell.tint.copy(this.color),this.spell.thrownByPlayer=this.player;else if(e.magicProtectionCircle)this.throwMagicProtectionCircle(e.x,e.y,!1),this.spell.body.collisionType=Gu.REMOTE_PROJECTILE,this.spell.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Tl.types.ENEMY_OBJECT),this.spell.tint.copy(this.color),this.spell.thrownByPlayer=this.player;else if(e.magicFirespin)this.throwMagicFireSpin(e.x,e.y,!1),this.spell.body.collisionType=Gu.REMOTE_PROJECTILE,this.spell.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Tl.types.ENEMY_OBJECT),this.spell.tint.copy(this.color),this.spell.thrownByPlayer=this.player;else if(e.bombPlaced){let t=new vp(this.pos.x,this.pos.y);t.body.collisionType=Gu.REMOTE_PROJECTILE,t.body.setCollisionMask(Tl.types.PLAYER_OBJECT|Tl.types.ENEMY_OBJECT),t.tint.copy(this.color),t.thrownByPlayer=this.player,Bl.world.addChild(t)}else this.checkBonusTile(this.pos.x,this.pos.y,!1)}),this)}update(t){return super.update(t)}onCollision(t,e){return this.invincible||(e.body.collisionType!==Tl.types.ENEMY_OBJECT||e.isStunned||e.isDead||Iu.isGameOver?e.body.collisionType===Tl.types.PROJECTILE_OBJECT&&e.isExploding&&(this.invincible=!0,Iu.score+=Iu.scoreForBombingRemotePlayers,this.flicker(Iu.playerInvincibleTime,(()=>{this.invincible=!1}))):(this.invincible=!0,this.flicker(Iu.playerInvincibleTime,(()=>{this.invincible=!1})))),!1}}class Tg extends Mp{constructor(t,e,i,s){var n;super(t,e,!1),(n="levelOver")in this?Object.defineProperty(this,n,{value:false,enumerable:!0,configurable:!0,writable:!0}):this[n]=false,this.player=i,this.color=s,this.tint=s,this.body.setCollisionMask(Gu.REMOTE_PROJECTILE|Gu.REMOTE_PLAYER|Tl.types.ENEMY_OBJECT|Tl.types.COLLECTABLE_OBJECT),Bl.viewport.follow(this.pos,Bl.viewport.AXIS.BOTH,.1)}update(t){let e=Math.floor(this.pos.x/32),i=Math.floor(this.pos.y/32),s=0,n=0,r=Vp.gameUpdate();if(this.levelOver)return super.update(t);if(r.x=e,r.y=i,cl.isKeyPressed("barrier")){if(cl.isKeyPressed("left")?s=-1:cl.isKeyPressed("right")&&(s=1),cl.isKeyPressed("up")?n=-1:cl.isKeyPressed("down")&&(n=1),this.oldDx=s,this.oldDy=n,0!=s||0!=n){let t=e+s,o=i+n;this.placeBorderTile(t,o)&&(r.dx=s,r.dy=n,r.gutterThrown=!0,Wp.get().sendAction(r))}}else if(cl.isKeyPressed("magic")){if(Iu.magicBolts>0&&(cl.isKeyPressed("left")?s=-1:cl.isKeyPressed("right")&&(s=1),cl.isKeyPressed("up")?n=-1:cl.isKeyPressed("down")&&(n=1),this.oldDx=s,this.oldDy=n,0!=s||0!=n)){let t=e+s,o=i+n;null==this.spell&&this.throwMagicSpell(t,o,s,n)&&(this.spell.tint.copy(this.color),Iu.magicBolts--,r.dx=s,r.dy=n,r.magicBolt=!0,Wp.get().sendAction(r))}}else{if(cl.isKeyPressed("bomb")&&Iu.bombs>0){let e=new vp(this.pos.x,this.pos.y);return e.tint=this.color,e.body.setCollisionMask(Tl.types.ENEMY_OBJECT|Gu.REMOTE_PLAYER),e.thrownByPlayer=this.player,Bl.world.addChild(e),Iu.usedBombs++,Iu.bombs--,r.bombPlaced=!0,r.dx=s,r.dy=n,Wp.get().sendAction(r),super.update(t)}cl.isKeyPressed("damage")&&Iu.magicFirespins>0&&(this.throwMagicFireSpin(e,i),this.spell.tint.copy(this.color),Iu.magicFirespins--,r.magicFirespin=!0,Wp.get().sendAction(r)),cl.isKeyPressed("magic-barrier")&&Iu.magicProtections>0&&(this.throwMagicProtectionCircle(e,i),this.spell.tint.copy(this.color),Iu.magicProtections--,r.magicProtectionCircle=!0,Wp.get().sendAction(r)),cl.isKeyPressed("magic-nebula")&&Iu.magicNebulas>0&&(this.throwMagicNebula(e,i),this.spell.tint.copy(this.color),Iu.magicNebulas--,r.magicNebula=!0,Wp.get().sendAction(r)),cl.isKeyPressed("left")?(this.flipX(!0),s=-t*this.VELOCITY,this.oldDx>=0&&(this.oldDx=s)):cl.isKeyPressed("right")&&(this.flipX(!1),s=t*this.VELOCITY,this.oldDx<=0&&(this.oldDx=s)),cl.isKeyPressed("up")?(n=-t*this.VELOCITY,this.oldDy>=0&&(this.oldDy=n)):cl.isKeyPressed("down")&&(n=t*this.VELOCITY,this.oldDy<=0&&(this.oldDy=n)),0==s&&0==n||!this.updateWalkable(r,s,n)||(this.checkBonusTile(this.pos.x,this.pos.y),this.collectedBonusTiles>=this.numberOfBonusTiles&&(r.levelOver=!0,this.levelOver=!0,Iu.isGameOver=!0,console.log("No more bonus tiles: GAME OVER"),Wp.get().sendAction(r),Wp.get().sendAction(Vp.gameOver())),e=Math.floor(this.pos.x/32),i=Math.floor(this.pos.y/32),(e!=this.lastMapX||i!=this.lastMapY||r.gameWon||r.gameOver)&&(r.x=e,r.y=i,this.lastMapX=e,this.lastMapY=i,Wp.get().sendAction(r)))}return Iu.energy<=0&&(console.log("Out of Energy: GAME OVER!"),Iu.isGameOver=!0,this.levelOver=!0,r.levelOver=!0,r.hasChanged=!0,Wp.get().sendAction(Vp.gameOver())),super.update(t)}onCollision(t,e){let i=Math.floor(this.pos.x/32),s=Math.floor(this.pos.y/32);if(e.body.collisionType===Tl.types.COLLECTABLE_OBJECT&&!e.isCollected&&(console.log("other.type: "+e.type),console.log("other.isCollected: "+e.isCollected),e.isCollected=!0,e.type===ju)){Iu.score+=e.score,Iu.bombs+=e.numBombs,Iu.magicBolts+=e.numMagicBolts,Iu.magicFirespins+=e.numMagicFirespins,Iu.magicNebulas+=e.numMagicNebulas,Iu.magicProtections+=e.numMagicProtectionCircles,Iu.collectedChests+=1;let t=Vp.gameUpdate();t.chestCollected=!0,t.x=i,t.y=s,Wp.get().sendAction(t)}if(Iu.invincible)return!1;if(e.body.collisionType!==Tl.types.ENEMY_OBJECT||e.isStunned||e.isDead||Iu.isGameOver){if(e.body.collisionType===Gu.REMOTE_PROJECTILE&&e.isExploding){Iu.energy-=Iu.energyLostByRemoteBomb,Iu.hitByRemotePlayerBomb++,Iu.invincible=!0;let t=Vp.gameUpdate();t.hurtByBomb=!0,t.x=i,t.y=s,this.flicker(Iu.playerInvincibleTime,(()=>{Iu.invincible=!1}))}}else{let t=Vp.gameUpdate();t.injuredByEnemy=!0,t.x=i,t.y=s,e.enemyType===op?(Iu.catchedByCats++,Iu.energy-=Iu.energyLostByCat,t.enemyType=op):e.enemyType===ap?(Iu.bittenBySpiders++,Iu.energy-=Iu.energyLostBySpider,t.enemyType=ap):e.enemyType===hp&&(Iu.catchedByGolems++,Iu.energy-=Iu.energyLostByGolem,t.enemyType=hp),Iu.invincible=!0,this.flicker(Iu.playerInvincibleTime,(()=>{Iu.invincible=!1})),Wp.get().sendAction(t)}return!1}}function Ag(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Sg extends hf{constructor(){super(...arguments),Ag(this,"players",[]),Ag(this,"remotePlayers",[]),Ag(this,"chests",[])}onResetEvent(){console.log("mp-play.OnEnter()"),this.isExiting=!1,this.isActive=!1,this.players=[],this.player=null,this.enemies=[],this.enemyEmitter.isActive=!1,this.remotePlayers=[],this.chests=[],this.players=this.playersFromGame(Wp.get().multiplayerGame);for(let t=0;t<this.players.length;t++){let e=this.players[t];null!==e&&console.log("  Player "+t+": "+e.name)}this.setupLevel(),Iu.isMultiplayerMatch=!0,this.hudContainer=new Zp(0,0),this.virtualJoypad=new rf,Bl.world.addChild(this.hudContainer),Bl.world.addChild(this.virtualJoypad,1/0),this.handler=Rr.on(Rr.KEYUP,this.actionHandler,this),Wp.get().addEventListener(Yp,(t=>{let e=t.message;e.playerId!==Wp.get().multiplayerPlayer.id&&(e.isPaused?(this.hudContainer.setPaused(!0,"*** "+e.message+" *** "),sd.pause()):(sd.resume(),this.hudContainer.setPaused(!1)))}),this),Wp.get().addEventListener(Up,(t=>{sd.pause(),this.cleanupWorld(),sd.resume(),this.updatePlayerData(),Wp.get().updatePlayerData().then((()=>{sd.change(Fu.MULTIPLAYER_GAME_OVER)}))}),this),Wp.get().addEventListener([Dp,Hp],(t=>{let e=t.message;t.game;for(let t=0;t<this.remotePlayers.length;t++){let i=this.remotePlayers[t];if(null!==i&&i.player.id===e.playerId){Bl.world.removeChild(i),console.log(e.type+": Player "+(t+1)+" ("+i.player.name+") was successfully removed"),this.remotePlayers[t]=null;break}}}),this),this.isActive=!0}updatePlayerData(){let t=Wp.get().multiplayerPlayer;t.energyLeft=Iu.energy,t.score=Iu.score,t.potionsLeft=Iu.magicBolts+Iu.magicFirespins+Iu.magicNebulas+Iu.magicProtections,t.chestsOpened=Iu.chestsOpened,t.placedBarriers=Iu.placedBarriers,t.usedBombs=Iu.usedBombs,t.bombsLeft=Iu.bombs,t.bittenBySpiders=Iu.bittenBySpiders,t.catchedByGolems=Iu.catchedByGolems,t.catchedByCats=Iu.catchedByCats,t.killedSpiders=Iu.killedSpiders,t.stunnedCats=Iu.stunnedCats,t.stunnedGolems=Iu.stunnedGolems,t.bonusCollected=Iu.bonusCollected,t.catchedByRemotePlayers=0,t.otherPlayersHurt=0}actionHandler(t,e,i){sd.isCurrent(Fu.MULTIPLAYER_PLAY)&&("exit"===t?this.isExiting||sd.isPaused()||(this.isExiting=!0,this.cleanupWorld(),Wp.get().sendPlayerGiveUp().then((()=>{Wp.get().closeActiveGame()})).then((()=>{sd.change(Fu.MULTIPLAYER_GAME_OVER)}))):"pause"===t&&(sd.isPaused()?(console.log("switching to resume"),sd.resume(),this.hudContainer.setPaused(!1)):(console.log("switching to pause"),this.hudContainer.setPaused(!0,"*** PAUSE ***"),sd.pause()),Wp.get().sendPlayerPaused(sd.isPaused())))}cleanupWorld(){this.isActive=!1,null!==this.player&&Bl.world.removeChild(this.player);for(let t=0;t<this.remotePlayers.length;t++)null!==this.remotePlayers[t]&&(Bl.world.removeChild(this.remotePlayers[t]),this.remotePlayers[t]=null);for(let t=0;t<this.enemies.length;t++)Bl.world.removeChild(this.enemies[t]),this.enemies[t]=null;this.player=null,this.remotePlayers=[],this.enemies=[],this.chests=[]}playersFromGame(t){return Wp.get().getPlayersFromGame()}update(t){let e=!1;if(Iu.isGameOver)this.isActive=!1,this.isExiting||(this.isExiting=!0,this.cleanupWorld(),this.updatePlayerData(),Wp.get().updatePlayerData().then((()=>{sd.change(Fu.MULTIPLAYER_GAME_OVER)})));else{if(!this.isActive)return super.update(t);if(this.enemyEmitter.isActive&&this.enemyEmitter.emitEvery<=0&&this.enemyEmitter.emitCount>0){this.enemyEmitter.emitCount--,this.enemyEmitter.emitEvery=this.enemyEmitter.emitTime;let t=new pp(this.enemyEmitter.emitAt.x,this.enemyEmitter.emitAt.y,!1);t.setEnemyName("SpiderEnemy."+(this.enemyEmitter.emitCount+1)),this.enemies.push(t),Bl.world.addChild(t,this.spriteLayer),t.setPlayer(this.player),e=!0}this.enemyEmitter.emitEvery-=t}return super.update(t)||e}setupLevel(){this.multiplayerGame=Wp.get().multiplayerGame,this.currentLevel=Wp.get().allLevels()[this.multiplayerGame.level],this.currentLevel.loadIntoMelon(),Md.load(this.currentLevel.id);let t=Md.getCurrentLevel().getLayers(),e=0,i=0;t.forEach((t=>{if(console.log(t.name),"Bonus"===t.name)for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){let n=t.cellAt(s,i);if(null!=n)if(n.tileId===ju){console.log("  Chest at ("+s+"/"+i+")"),t.clearTile(s,i);let n=new of(s,i);this.chests.push(n),Bl.world.addChild(n,e)}else n.tileId}else if("Persons"===t.name){let s=0;this.spriteLayer=e;for(let e=0;e<t.height;e++)for(let n=0;n<t.width;n++){let r=t.cellAt(n,e);if(null!=r)if(993===r.tileId){if(i<Uu.length&&null!==this.players[i]){let t=Uu[i],s=this.players[i];if(s.id===Wp.get().multiplayerPlayer.id)this.player=new Tg(n,e,s,t),Bl.world.addChild(this.player,this.spriteLayer),this.player.name=s.name,console.log("  local player at ("+n+"/"+e+"): "+this.player.name);else{let i=new Cg(n,e,s,t);i.name=s.name,this.remotePlayers.push(i),Bl.world.addChild(i,this.spriteLayer),console.log("  remote player at ("+n+"/"+e+"): "+i.name)}}i++}else if(994===r.tileId){let t=new cp(n,e,!1),i="CatEnemy."+s++;t.setEnemyName(i),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+n+"/"+e+"): "+t)}else if(995===r.tileId)this.enemyEmitter.isActive=!0,this.enemyEmitter.emitAt.x=n,this.enemyEmitter.emitAt.y=e,this.enemyEmitter.emitCount=t.enemyNumEmitting,this.enemyEmitter.emitEvery=t.enemyTimeEmitting,console.log("  enemyEmitter at ("+n+"/"+e+"): ");else if(996===r.tileId){let t=new mp(n,e,!1),i="Golem."+(s+1);s++,t.setEnemyName(i),t.setWayPath(this.currentLevel.getPathForEnemy(i)),Bl.world.addChild(t,this.spriteLayer),this.enemies.push(t),console.log("  enemy at ("+n+"/"+e+"): "+t)}}}e++})),this.parseLevelObjects(),this.enemies.forEach((t=>t.setPlayer(this.player)))}onDestroyEvent(){console.log("MP-Play.OnExit()"),this.isActive=!1,Bl.world.removeChild(this.hudContainer),Bl.world.removeChild(this.virtualJoypad),Rr.off(Rr.KEYUP,this.actionHandler),this.cleanupWorld(),Bl.world.reset(),Wp.get().clearAllEventListeners()}}class Pg extends Ml{constructor(t,e,i,s,n,r){super(t,e,i,s),this.player=n,this.border=new Oa(t,e,i,s),this.divider=new Ma(t+4,e+42,i-8,2),this.playerEntity=new Op(0,0,!0),this.playerEntity.tint.copy(r),this.levelName=new Yc(36,2,{font:"18Outline",fillStyle:r,textAlign:"left",text:n.name+"\nStatistics:"});let o=n.score+"\n"+n.internalScore+"\n"+n.energyLeft+"\n"+n.bonusCollected+"\n"+n.bombsLeft+"\n"+n.usedBombs+"\n"+n.placedBarriers+"\n"+n.bittenBySpiders+"\n"+n.catchedByCats+"\n"+n.catchedByGolems+"\n"+n.killedSpiders+"\n"+n.stunnedCats+"\n"+n.stunnedGolems+"\n";this.levelDescr=new Yc(6,50,{font:"12Outline",textAlign:"left",text:"Score: \nReal Score: \nEnergy left: \nBonus collected: \nBombs left: \nUsed bombs: \nPlaced barriers: \nBitten by spiders: \nCatched by cats: \nCatched by golems: \nKilled spiders: \nStunned cats: \nStunned golems: \n"}),this.levelDescr2=new Yc(200,50,{font:"12Outline",textAlign:"right",text:o}),this.addChild(this.playerEntity,1),this.addChild(this.levelName,1),this.addChild(this.levelDescr,1),this.addChild(this.levelDescr2,1)}draw(t,e){t.setGlobalAlpha(.3),t.setColor("#008800"),t.fill(this.border),t.setGlobalAlpha(1),t.setColor("#000000"),t.stroke(this.divider),t.stroke(this.border),t.setColor("#ffffff"),t.fill(this.divider),super.draw(t,e)}}class Mg extends Ml{constructor(t){super(),this.theGame=t,this.players=Mg.playersFromGame(t),this.isGameOver=!0,this.posArray=[new Nn(60,215),new Nn(280,Bl.viewport.height-400),new Nn(500,215),new Nn(720,Bl.viewport.height-400)];for(let t=0;t<this.players.length;t++)if(null!==this.players[t]&&this.players[t].hasWon&&Wp.get().multiplayerPlayer.id===this.players[t].id){this.isGameOver=!1;break}this.floating=!0,this.z=10,this.name="TitleBack",this.sensaSprite=new Wd(790,Bl.viewport.height-300,{image:this.isGameOver?"sensa_nee":"sensa_jaa"}),this.sensaSprite.setOpacity(.6),this.addChild(this.sensaSprite,1),this.addChild(new df(this.isGameOver?"LOOOOOOSER!":"CONGRATS! WINNER!",!1,!0,!0),0);for(let t=0;t<this.players.length;t++)null!==this.players[t]&&this.addChild(new Pg(this.posArray[t].x,this.posArray[t].y,210,240,this.players[t],Uu[t]),6)}static playersFromGame(t){let e=Wp.get().getPlayersFromGame();if(null===e)return;for(let t=0;t<e.length;t++)if(null!==e[t]){let i=e[t],s=i.score;s+=i.energyLeft>0?5*i.energyLeft:0,s+=i.potionsLeft>0?5*i.potionsLeft:0,s+=i.bombsLeft>0?5*i.bombsLeft:0,e[t].internalScore=s,e[t].hasWon=!1}let i=null,s=0;for(let t=0;t<e.length;t++)null!==e[t]&&e[t].energyLeft>0&&e[t].internalScore>s&&(s=e[t].internalScore,i=e[t]);return null!==i&&(i.hasWon=!0),e}}class Og extends zl{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),this.isGameOver=t,this.back=null,this.emitter=null,this.handler=null}onResetEvent(){console.log("GameOver.OnEnter()"),Wp.get().weAreHost?(console.log("We are host, so we are sending updated data to the host and finishing this game"),Wp.get().refreshGameData().then((t=>{Mg.playersFromGame(t),Wp.get().finishGame(t).then((t=>{this.theGame=t,this.buildUI(t)}))}))):(console.log("We are no host, so we are NOT sending updated data to the host and finishing this game"),Wp.get().refreshGameData().then((t=>{this.theGame=t,this.buildUI(t)})))}buildUI(t){this.back=new Mg(t),Bl.world.addChild(this.back),this.emitter=new su(Bl.viewport.width/2,Bl.viewport.height/2+100,{tint:new Wn(255,0,0),width:64,height:64,totalParticles:30,gravity:.02,angle:0,angleVariation:6.283185307179586,speed:2,wind:.25}),Bl.world.addChild(this.emitter),this.emitter.streamParticles(),cl.bindKey(cl.KEY.ENTER,"enter",!0),cl.bindPointer(cl.pointer.LEFT,cl.KEY.ENTER),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.MULTIPLAYER_GAME_OVER)&&(console.log("GameOver.EventHandler()"),"enter"!==t&&"bomb"!==t||sd.change(Fu.MULTIPLAYER_MENU),"exit"===t&&sd.change(Fu.MULTIPLAYER_MENU))}))}onDestroyEvent(){console.log("GameOver.OnExit()"),cl.unbindKey(cl.KEY.ENTER),cl.unbindPointer(cl.pointer.LEFT),Rr.off(Rr.KEYUP,this.handler),null!==this.back&&Bl.world.removeChild(this.back),null!==this.emitter&&Bl.world.removeChild(this.emitter),Iu.reset(),Wp.get().closeActiveGame()}}class Lg extends cf{constructor(t,e,i,s,n){super(t,e,i,s,{titleFont:"18Outline",titleText:n})}}class kg extends Lg{constructor(t,e,i,s){super(t,e,i,s,"Keyboard Controls"),this.keys=new Yc(4,46,{font:"12Outline",textAlign:"left",lineHeight:"1.5",text:"W | UP: \nA | LEFT: \nD | RIGHT: \nS | DOWN: \nP: \nspace: \nQ: \nE: \nR: \nshift + movement: \nalt + movement:"}),this.description=new Yc(124,46,{font:"12Outline",textAlign:"left",lineHeight:"1.5",text:"Move UP \nMove LEFT\nMove RIGHT\nMove DOWN\nPause / Unpause\nPlace a bomb \nMagic Firestorm\nMagic protection circle \nMagic Nebula \nPlace a barrier in the corresponding direction\nThrow a magic bolt into the direction"}),this.addChild(this.keys),this.addChild(this.description)}}class Ig extends Lg{constructor(t,e,i,s){super(t,e,i,s,"Your Enemies"),this.description=new Yc(44,46,{font:"12Outline",textAlign:"left",lineHeight:1.5,text:"A nasty cat. She will follow you whereever you are.\n  She hurts you by 10 hit points. \n  Damage will stunn the cat for 5sec.\n  A magic nebula is supposed to be a good weapon\n  Best strategy: Lock her up!\n\nA spider. They come in hordes and they are fast!.\n  They hurt you by 25 hit points.\n  Damage will kill the spider.\n  A magic nebula is supposed to be the best weapon\n  Best strategy: Kill them all!\n\nA golem. They are stupid and follow their path.\n  They hurt you by 50 hit points. Be careful!\n  Damage will stunn them for 5sec. \n  There is no weapon, except stunning them!\n  Best strategy: Don't get in touch with them!\n"}),this.catImg=new Lp(20,80,[993],!0),this.spiderImg=new Lp(20,190,[994],!0),this.golemImg=new Lp(20,310,[995],!0),this.addChild(this.description),this.addChild(this.catImg),this.addChild(this.spiderImg),this.addChild(this.golemImg)}}class Rg extends Lg{constructor(t,e,i,s){super(t,e,i,s,"Collectable Bonus items"),this.description=new Yc(44,46,{font:"12Outline",textAlign:"left",lineHeight:2.5,text:"A pill. You need to eat all of them to win.\nA Chest. Open it and get a jackpot!\nA Bomb. Adds 5 more bombs to your inventory \nMeat! You get 25 points more energy \nCheese! You get 20 points more energy \nPotion of Bolts. Adds 3 magic bolts to your inventory \nPotion of Fire. Adds 3 magic firespins to your inventory \nPotion of Nebula. Adds 3 magic nebulas to your inventory \nPotion of Protection. Adds 3 magic protections to your inventory\n"}),this.pillImg=new Lp(20,50,[962],!0),this.chestImg=new Lp(20,78,[969],!0),this.bombImg=new Lp(20,110,[978],!0),this.meatImg=new Lp(20,142,[965],!0),this.cheeseImg=new Lp(20,174,[966],!0),this.boltImg=new Lp(20,206,[973],!0),this.fireImg=new Lp(20,238,[974],!0),this.nebuImg=new Lp(20,270,[976],!0),this.protImg=new Lp(20,302,[975],!0),this.addChild(this.pillImg),this.addChild(this.chestImg),this.addChild(this.bombImg),this.addChild(this.meatImg),this.addChild(this.cheeseImg),this.addChild(this.boltImg),this.addChild(this.fireImg),this.addChild(this.nebuImg),this.addChild(this.protImg),this.addChild(this.description)}}class Bg extends Nu{constructor(t,e,i,s,n){super(t,e,{font:"18Outline",text:"Controls",borderWidth:i,onClick:n})}}class Dg extends Nu{constructor(t,e,i,s,n){super(t,e,{font:"18Outline",text:"Collectables",borderWidth:i,onClick:n})}}class Ng extends Nu{constructor(t,e,i,s,n){super(t,e,{font:"18Outline",text:"Enemies",borderWidth:i,onClick:n})}}class Fg extends Nu{constructor(t,e,i,s,n){super(t,e,{font:"18Outline",text:"Back",borderWidth:i,onClick:n})}}class Gg extends Ml{constructor(){super(),this.floating=!0,this.z=10,this.setOpacity(1),this.helpScreens=[],this.helpScreen=Gg.helps.CONTROLS,this.name="TitleBack";let t=420,e=380,i=(Bl.viewport.width-t)/2,s=(Bl.viewport.height-e)/2+40;this.keysHelp=new kg(i,s,t,e),this.bonusHelp=new Rg(i,s,t,e),this.enemiesHelp=new Ig(i,s,t,e),this.helpScreens.push(this.keysHelp),this.helpScreens.push(this.bonusHelp),this.helpScreens.push(this.enemiesHelp),this.addChild(new df("How to play",!0,!0)),this.addChild(this.keysHelp),this.addChild(new Bg(i,s+e+5,128,24,this.controlsClicked.bind(this))),this.addChild(new Dg(i+140,s+e+5,128,24,this.bonusClicked.bind(this))),this.addChild(new Ng(i+280,s+e+5,128,24,this.enemiesClicked.bind(this))),this.addChild(new Fg(i,s+e+42,t,24,this.backClicked.bind(this)))}backClicked(t){sd.change(sd.MENU)}enemiesClicked(t){this.helpScreen!==Gg.helps.ENEMIES&&(this.removeChild(this.helpScreens[this.helpScreen],!0),this.addChild(this.enemiesHelp),this.helpScreen=Gg.helps.ENEMIES)}controlsClicked(t){this.helpScreen!==Gg.helps.CONTROLS&&(this.removeChild(this.helpScreens[this.helpScreen],!0),this.addChild(this.keysHelp),this.helpScreen=Gg.helps.CONTROLS)}bonusClicked(t){this.helpScreen!==Gg.helps.BONUS&&(this.removeChild(this.helpScreens[this.helpScreen],!0),this.addChild(this.bonusHelp),this.helpScreen=Gg.helps.BONUS)}}Hf={CONTROLS:0,BONUS:1,ENEMIES:2},(zf="helps")in(jf=Gg)?Object.defineProperty(jf,zf,{value:Hf,enumerable:!0,configurable:!0,writable:!0}):jf[zf]=Hf;class Ug extends zl{onResetEvent(){this.menu=new Gg,Bl.world.addChild(this.menu),this.handler=Rr.on(Rr.KEYUP,(function(t,e,i){sd.isCurrent(Fu.HOW_TO_PLAY)&&"exit"===t&&sd.change(sd.MENU)}))}onDestroyEvent(){Rr.off(Rr.KEYUP,this.handler),Bl.world.removeChild(this.menu)}}const jg=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],zg=(()=>{if("undefined"==typeof document)return!1;const t=jg[0],e={};for(const i of jg){const s=i?.[1];if(s in document){for(const[s,n]of i.entries())e[t[s]]=n;return e}}return!1})(),Hg={change:zg.fullscreenchange,error:zg.fullscreenerror};let Yg={request:(t=document.documentElement,e)=>new Promise(((i,s)=>{const n=()=>{Yg.off("change",n),i()};Yg.on("change",n);const r=t[zg.requestFullscreen](e);r instanceof Promise&&r.then(n).catch(s)})),exit:()=>new Promise(((t,e)=>{if(!Yg.isFullscreen)return void t();const i=()=>{Yg.off("change",i),t()};Yg.on("change",i);const s=document[zg.exitFullscreen]();s instanceof Promise&&s.then(i).catch(e)})),toggle:(t,e)=>Yg.isFullscreen?Yg.exit():Yg.request(t,e),onchange(t){Yg.on("change",t)},onerror(t){Yg.on("error",t)},on(t,e){const i=Hg[t];i&&document.addEventListener(i,e,!1)},off(t,e){const i=Hg[t];i&&document.removeEventListener(i,e,!1)},raw:zg};Object.defineProperties(Yg,{isFullscreen:{get:()=>Boolean(document[zg.fullscreenElement])},element:{enumerable:!0,get:()=>document[zg.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>Boolean(document[zg.fullscreenEnabled])}}),zg||(Yg={isEnabled:!1});const Vg=Yg;Wo.onReady((()=>{if(!Ec.init(1024,768,{parent:"screen",scaleMethod:"flex-width",renderer:Ec.AUTO,subPixel:!1,antiAlias:!0,doubleBuffering:!0}))return void alert("Your browser does not support HTML5 canvas.");th.init("mp3,ogg"),Wo.isMobile&&Vg.isEnabled&&(console.log("INFO: Requesting full screen..."),Vg.request());let t,e=Eu.environment;"local"===e?t=Eu.local.baseURL:"dev"===e?t=Eu.dev.baseURL:"test"===e?t=Eu.test.baseURL:"prod"===e&&(t=Eu.prod.baseURL),Vd.setBaseURL("tmx",t),Eu.baseURL=t,Vd.crossOrigin="anonymous",$u.getInstance(),ku.getInstance().initialize((function(){Vd.preload(Of,(function(){Dn.register("WayPoint",Cu,!0),Dn.register("WayPath",Tu,!0),Dn.register("GameStateAction",Ju,!0),Dn.register("EnemyAction",Xu,!0),Iu.screenControlsTexture=new qd(Vd.getJSON("screen-controls"),Vd.getImage("screen-controls")),sd.set(sd.MENU,new Ku),sd.set(sd.PLAY,new lf),sd.set(Fu.REPLAY_GAME_CHOOSER,new Rf),sd.set(Fu.REPLAY_GAME,new Mf),sd.set(Fu.CHOOSE_LEVEL,new Uf),sd.set(sd.READY,new ff),sd.set(sd.GAMEOVER,new yf(!0)),sd.set(sd.GAME_END,new yf(!1)),sd.set(sd.SCORE,new wf),sd.set(Fu.SINGLE_PLAYER_MENU,new tg),sd.set(Fu.HOW_TO_PLAY,new Ug),sd.set(Fu.MULTIPLAYER_MENU,new qf),sd.set(Fu.MULTIPLAYER_START_GAME,new hg),sd.set(Fu.MULTIPLAYER_JOIN_GAME,new mg),sd.set(Fu.MULTIPLAYER_LOBBY,new Eg),sd.set(Fu.MULTIPLAYER_PLAY,new Sg),sd.set(Fu.MULTIPLAYER_GAME_OVER,new Og),sd.transition("fade","#000000",500),cl.bindKey(cl.KEY.ALT,"magic"),cl.bindKey(cl.KEY.Q,"damage",!0),cl.bindKey(cl.KEY.E,"magic-barrier",!0),cl.bindKey(cl.KEY.R,"magic-nebula",!0),cl.bindKey(cl.KEY.SHIFT,"barrier"),cl.bindKey(cl.KEY.LEFT,"left"),cl.bindKey(cl.KEY.A,"left"),cl.bindKey(cl.KEY.RIGHT,"right"),cl.bindKey(cl.KEY.D,"right"),cl.bindKey(cl.KEY.UP,"up"),cl.bindKey(cl.KEY.W,"up"),cl.bindKey(cl.KEY.DOWN,"down"),cl.bindKey(cl.KEY.S,"down"),cl.bindKey(cl.KEY.P,"pause",!0),cl.bindKey(cl.KEY.SPACE,"bomb",!0),cl.bindKey(cl.KEY.ESC,"exit",!0),cl.bindKey(cl.KEY.F,"fullscreen",!0),$u.getInstance().createGameOnServer().then((function(){Bl.world.gravity=new Nn(0,0),Bl.world.preRender=!0,sd.change(sd.MENU)})).catch((function(t){console.log(t)}))}))}))}))})()})();